<!DOCTYPE html>
<html lang="en-GB">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Bart Busschots">
<meta name="copyright" content="CC-BY-NC-ND 4.0">
<title>Taming the Terminal</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=ngjgngJqzr">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?v=ngjgngJqzr">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?v=ngjgngJqzr">
<link rel="manifest" href="/site.webmanifest?v=ngjgngJqzr">
<link rel="mask-icon" href="/safari-pinned-tab.svg?v=ngjgngJqzr" color="#29c943">
<link rel="shortcut icon" href="/favicon.ico?v=ngjgngJqzr">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
<style>
    pre.rouge .hll {
        background-color: #ffc;
    }

    pre.rouge .hll * {
        background-color: initial;
    }
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Taming the Terminal</h1>
<div class="details">
<span id="author" class="author">Bart Busschots</span><br>
<span id="revnumber">version 1.4.2,</span>
<span id="revdate">2020-10-07</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#foreword">Foreword</a></li>
<li><a href="#preface">Preface</a></li>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#ttt01">TTT Part 1 of n &#8212; Command Shells</a></li>
<li><a href="#ttt02">TTT Part 2 of n &#8212; Commands</a></li>
<li><a href="#ttt03">TTT Part 3 of n &#8212; File Systems</a></li>
<li><a href="#ttt04">TTT Part 4 of n &#8212; Navigation</a></li>
<li><a href="#ttt05">TTT Part 5 of n &#8212; File Permissions</a></li>
<li><a href="#ttt06">TTT Part 6 of n &#8212; More File Permissions</a></li>
<li><a href="#ttt07">TTT Part 7 of n &#8212; Managing Files</a></li>
<li><a href="#ttt08">TTT Part 8 of n &#8212; Processes</a></li>
<li><a href="#ttt09">TTT Part 9 of n &#8212; Controlling Processes</a></li>
<li><a href="#ttt10">TTT Part 10 of n &#8212; man</a></li>
<li><a href="#ttt11">TTT Part 11 of n &#8212; Text Files</a></li>
<li><a href="#ttt12">TTT Part 12 of n &#8212; the Environment</a></li>
<li><a href="#ttt13">TTT Part 13 of n &#8212; PATH</a></li>
<li><a href="#ttt14">TTT Part 14 of n &#8212; Aliases &amp; Prompts</a></li>
<li><a href="#ttt15">TTT Part 15 of n &#8212; 'Plumbing'</a></li>
<li><a href="#ttt16">TTT Part 16 of n &#8212; Crossing the Streams</a></li>
<li><a href="#ttt17">TTT Part 17 of n &#8212; Regular Expressions</a></li>
<li><a href="#ttt18">TTT Part 18 of n &#8212; More REs</a></li>
<li><a href="#ttt19">TTT Part 19 of n &#8212; Text Searches</a></li>
<li><a href="#ttt20">TTT Part 20 of n &#8212; File Searches</a></li>
<li><a href="#ttt21">TTT Part 21 of n &#8212; More Searching</a></li>
<li><a href="#ttt22">TTT Part 22 of n &#8212; Tips &amp; Tricks</a></li>
<li><a href="#ttt23">TTT Part 23 of n &#8212; Networking Intro</a></li>
<li><a href="#ttt24">TTT Part 24 of n &#8212; Ethernet &amp; ARP</a></li>
<li><a href="#ttt25">TTT Part 25 of n &#8212; IP Subnets</a></li>
<li><a href="#ttt26">TTT Part 26 of n &#8212; DHCP</a></li>
<li><a href="#ttt27">TTT Part 27 of n &#8212; DNS</a></li>
<li><a href="#ttt28">TTT Part 28 of n &#8212; Network Troubleshooting</a></li>
<li><a href="#ttt29">TTT Part 29 of n &#8212; Intro to SSH</a></li>
<li><a href="#ttt30">TTT Part 30 of n &#8212; SSHing More Securely</a></li>
<li><a href="#ttt31">TTT Part 31 of n &#8212; SSH File Transfers</a></li>
<li><a href="#ttt32">TTT Part 32 of n &#8212; SSH Tunnelling</a></li>
<li><a href="#ttt33">TTT Part 33 of n &#8212; SSH 'Bookmarks'</a></li>
<li><a href="#ttt34">TTT Part 34 of n &#8212; Introducing HTTP</a></li>
<li><a href="#ttt35">TTT Part 35 of n &#8212; HTTP Commands</a></li>
<li><a href="#ttt36">TTT Part 36 of n &#8212; screen &amp; cron</a></li>
<li><a href="#ttt37">TTT Part 37 of n &#8212; SSH Agents</a></li>
<li><a href="#ttt38">TTT Part 38 of n &#8212; TMUX (A Screen Alternative)</a></li>
<li><a href="#ttt39">TTT Part 39 of n &#8212; Advanced TMUX</a></li>
<li><a href="#ttt40">TTT Part 40 of n &#8212; Automating TMUX</a></li>
<li><a href="#afterword">Afterword</a></li>
<li><a href="#colophon">Colophon</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="foreword">Foreword</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As an IT-person and Apple geek I started listening to the NosillaCast podcast by Allison Sheridan somewhere in the early '10s. It&#8217;s a podcast with a wide variety of tech topics with a <em>slight</em> Apple bias. Topics range from an interview of a blind person using an iPhone to an article on the security measures of a certain bank&#8217;s webapp to tutorials on how to fix a tech problem with one of your devices.
I especially enjoyed the sections where Bart was explaining some technical topic. The podcasts kept me company on my long commute to and from work.</p>
</div>
<div class="paragraph">
<p>Somewhere in 2013 Bart announced he was starting a series of tutorials on the Terminal and all kinds of commands to teach Allison. Cool, let&#8217;s see how much I already know. The first sessions were easy. I knew most of what Bart was explaining, and yes, I was one of those persons yelling in the car when Bart quizzed Allison.</p>
</div>
<div class="paragraph">
<p>Soon I heard new things and quickly it became a game. What would Bart explain this time and would I know it or would it be new. I started to look forward to the commute time because that&#8217;s the time I would listen to the podcast. I even felt sad when Bart explained that episode 35 was the last one of the series. Luckily time proved him wrong and now the episodes kept coming.</p>
</div>
<div class="paragraph">
<p>When people at work expressed fear of Terminal commands, I would point them to the series on Bart&#8217;s website, allowing my co-workers to read his tutorials and listen to the podcast audio. I even added the most relevant episodes to the training we had for our new junior developers.</p>
</div>
<div class="paragraph">
<p>In 2016 I went to Dublin for a holiday and actually met Bart in real life. Turns out he&#8217;s a great guy and a kindred spirit. It&#8217;s his passion to teach people about the stuff he loves that makes him so valuable to the community. He combines that with academic precision to present well-researched information in bite-sized chunks that makes it easy to follow along, no matter what your skill level is.</p>
</div>
<div class="paragraph">
<p>I hope you get as much fun and knowledge out of this series as I did, now in an eBook.</p>
</div>
<div class="paragraph">
<p>Helma van der Linden<br>
<em>TTT fan</em></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preface">Preface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Taming the Terminal was created as a podcast and written tutorial with Bart Busschots as the instructor and Allison Sheridan as the student.  Taming the Terminal started its life as part of the <a href="https://www.podfeet.com">NosillaCast Apple Podcast</a> and was eventually spun off as a standalone Podcast. Bart and Allison have been podcasting together for many years, and their friendship and camaraderie make the recordings a delightful way to learn these technical concepts. To our American readers, note that the text is written in British English so some words such as "instalment" may appear misspelled, but they are not.</p>
</div>
<div class="paragraph">
<p>The book version of the podcast was a labor of love by Allison Sheridan and Helma van der Linden as a surprise gift to Bart Busschots for all he has done for the community.</p>
</div>
<div class="paragraph">
<p>If you enjoy Taming the Terminal, you may also enjoy Bart and Allison&#8217;s second podcast entitled Programming By Stealth.  This is a fortnightly podcast where Bart is teaching the audience to program, starting with HTML and CSS (that&#8217;s the stealthy part since it&#8217;s not proper programming), into JavaScript and beyond. As with Taming the Terminal, Bart creates fantastic written tutorials for Programming By Stealth, including challenges to cement the listener&#8217;s skills.</p>
</div>
<div class="paragraph">
<p>You can find Programming By Stealth and Taming the Terminal podcasts along with Allison&#8217;s other shows at <a href="https://www.podfeet.com/blog/subscribe-to-the-podcasts/">podfeet.com/blog/subscribe-to-the-podcasts/</a>.</p>
</div>
<div class="sect2">
<h3 id="contributors">Contributors to Taming the Terminal</h3>
<div class="paragraph">
<p>Bart Busschots is the author of all of the written tutorials in the Taming the Terminal series so the lion&#8217;s share of the credit goes to him.  Allison Sheridan is the student of the series asking the dumb questions, and she created the podcast.  Steve Sheridan convinced Bart and Allison that instead of having the series buried inside the larger NosillaCast Podcast, that it should be a standalone podcast.  He did all of the editing to pull out the audio for the 35 original episodes from the NosillaCast, top and tail with music, and pushed Bart and Allison to record the intros.  Steve even created the Taming the Terminal logo.</p>
</div>
<div class="paragraph">
<p>Allison had a vision of Taming the Terminal becoming an eBook but had no idea how to accomplish this.  Helma van der Linden figured out how to programmatically turn the original feature-rich set of HTML web pages into an ePub book as well as producing a PDF version, and even an HTML version.  She managed the GitHub project and fixed the technical aspects of the book and kept Allison on task as she did the proofreading and editing of the entire book.  Allison created the book cover as well.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Taming the Terminal is specifically targeted at learning the macOS Terminal but most of the content is applicable to the Linux command line. If you&#8217;re on Windows, it is recommended that you use the Linux Subsystem for Windows to learn along with this book. Wherever practical, Bart explains the differences that you may encounter if you&#8217;re not on macOS.</p>
</div>
<div class="paragraph">
<p>The series started in April 2013 and was essentially complete in 2015 after 35 of n lessons, but Bart carefully labeled them as "of n" because he knew that over time there likely would be new episodes.  More episodes have indeed come out, and this book will be updated over time as the new instalments are released.</p>
</div>
<div class="sect2">
<h3 id="_zsh_vs_bash">Zsh vs Bash</h3>
<div class="paragraph">
<p>In macOS Catalina, released after much of the tutorial content in this book was released, Apple replaced the default shell bash with the zsh shell. As a result you&#8217;ll notice the prompt change from <code>$</code> to <code>%</code> partway through the book.  There may be cases where the instructions given during the bash days might not work with today&#8217;s zsh.</p>
</div>
<div class="paragraph">
<p>To switch back to bash if you do run into problems, simply enter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">bash <span style="color: #000080">--login</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll be shown this warning explaining how to switch your default interactive shell back to zsh, and can proceed with the lessons.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">The default interactive shell is now zsh.
To update your account to use zsh, please run <span style="color: #d14">`</span>chsh <span style="color: #000080">-s</span> /bin/zsh<span style="color: #d14">`</span><span style="color: #0086B3">.</span>
For more details, please visit https://support.apple.com/kb/HT208050.</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you&#8217;d like to see these instalments in their web form, you can go to <a href="https://ttt.bartificer.net">ttt.bartificer.net</a>.</p>
</div>
<div class="paragraph">
<p>If you enjoy the format of this series, you might also enjoy the podcast and written tutorials for Bart and Allison&#8217;s next series, Programming By Stealth at <a href="https://pbs.bartificer.net">pbs.bartificer.net</a>.</p>
</div>
<div class="paragraph">
<p>Feedback on the book can be sent to <a href="mailto:allison@podfeet.com">allison@podfeet.com</a>.</p>
</div>
<div class="paragraph">
<p>We hope you enjoy your journey with Taming the Terminal.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt01">TTT Part 1 of n &#8212; Command Shells</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I have no idea whether or not this idea is going to work out, but on this week&#8217;s Chit Chat Across the Pond audio  podcast segment on the <a href="https://www.podfeet.com">NosillaCast Apple Podcast</a> (to be released Sunday evening PST), I&#8217;m going to try to start what will hopefully be an on-going series of short unintimidating segments to gently introduce Mac users to the power contained within the OS X Terminal app.</p>
</div>
<div class="paragraph">
<p><em>Note: this entire series was later moved to a standalone podcast called Taming the Terminal at <a href="https://podfeet.com/ttt-podcast">podfeet.com/&#8230;&#8203;</a>.</em></p>
</div>
<div class="paragraph">
<p>I&#8217;m on with Allison every second week, and I&#8217;ll have other topics to talk about, so the most frequent the instalments in this series could be would be biweekly, but I think they&#8217;ll turn out to be closer to monthly on average.
While the focus will be on OS X, the majority of the content will be equally applicable to any other Unix or Linux operating system.</p>
</div>
<div class="paragraph">
<p>In the <a href="https://www.podfeet.com/wordpress/2013/03/31/412-rslsteeper-autismate-audio-hijack-pro-mail-security/">last CCATP</a>, we did a very detailed segment on email security, and despite the fact that with the benefit of hindsight I realise it was too much to do at once and should have been split into two segments, it received the strongest listener response of anything of any of my many contributions to the NosillaCast in the last 5 or more years.
I hope I&#8217;m right in interpreting that as evidence that there are a lot of NosillaCast listeners who want to get a little more technical, and get their hands dirty with some good old-fashioned nerdery!</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 1</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 1</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT01CommandShells/TTT_01_Command_Shells.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_01.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT01CommandShells/TTT_01_Command_Shells.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_basics">The basics</h3>
<div class="paragraph">
<p>In this first segment, I just want to lay a very basic foundation.
I plan to take things very slowly with this series, so I&#8217;m going to start the way I mean to continue.
Let&#8217;s start with some history and some wider context.</p>
</div>
<div class="paragraph">
<p>Before the days of GUIs (Graphical User Interfaces), and even before the days of simple menu-driven non-graphical interfaces like the <a href="https://en.wikipedia.org/wiki/File:Wordperfect-5.1-dos.png">original Word Perfect on DOS</a>, the way humans interacted with computers was through a &#8220;command shell&#8221;.
Computers couldn&#8217;t (and still can&#8217;t) speak or interpret human languages properly, and humans find it very hard to speak in native computer languages like binary machine codes (though early programmers did actually have to do that). New languages were invented to help bridge the gap, and allow humans and computers to meet somewhere in the middle.</p>
</div>
<div class="paragraph">
<p>The really big problem is that computers have absolutely no intelligence, so they can&#8217;t deal with ambiguity at all.
Command shells use commands that look Englishy, but they have very rigid structures (or grammars if you will) that remove all ambiguity.
It&#8217;s this rigid structure that allows the automated translation from shell commands to binary machine code the computer can execute.</p>
</div>
<div class="paragraph">
<p>When using any command shell, the single most important thing to remember is that computers are absolutely stupid, so they will do EXACTLY what you tell them to, no matter how silly the command you give them.
If you tell a computer to delete all the files on a hard drive, it will, because, well, that&#8217;s what you asked it to do!
Another important effect of computers&#8217; total lack of intelligence is that there is no such thing as &#8220;close enough&#8221;&#8201;&#8212;&#8201;if you give it a command that&#8217;s nearly valid, a computer can no more execute it than if you&#8217;d just mashed the keyboard with your face.
Nearly right and absolute gibberish are just as unintelligible to a computer.
You must be exact, and you must be explicit at all times.</p>
</div>
<div class="paragraph">
<p>No wonder we went on to invent the GUI, this command shell malarky sounds really complicated!
There is no doubt that if the GUI hadn&#8217;t been invented the personal computer wouldn&#8217;t have taken off like it has.
If it wasn&#8217;t for the GUI, there&#8217;s no way there would be more computers than people in my parents home (two of them, and including iPhones and tablets, 6 computers!)
Even the nerdiest of nerds use GUI operating systems most of the time because they make a lot of things both easier and more pleasant.
BUT&#8201;&#8212;&#8201;not everything.</p>
</div>
<div class="paragraph">
<p>We all know that a picture says a thousand words, but when you are using a GUI it&#8217;s the computer that is showing you a picture, all you get to do is make crude hand gestures at the computer, which I&#8217;d say is worth about a thousandth of a word&#8201;&#8212;&#8201;so, a single shell command can easily be worth a thousand clicks.
This is why all desktop OSes still have command shells built in&#8201;&#8212;&#8201;not as their ONLY user interface like in times past, but as a window within the GUI environment that lets you communicate with the computer using the power of a command shell.</p>
</div>
<div class="paragraph">
<p>Even Microsoft understands the power of the command shell. DOS may be dead, but the new <a href="https://en.wikipedia.org/wiki/Windows_PowerShell">Windows Power Shell</a> is giving Windows power users a new, more modern, and more powerful command shell than ever before.
Windows 8 may have removed the Start menu, but Powershell is still there!
All Linux and Unix distros have command shells, and OS X gives you access to an array of different Command Shells through Terminal.app.</p>
</div>
<div class="paragraph">
<p>Just like there is no one GUI interface, there is no one command shell.
Also, just like most GUIs are at least somewhat similar to each other, they all use icons for example, most command shells are also quite similar, having a command prompt that accepts commands with arguments to supply input to the commands or alter their behaviour.
OS X does not ship with one command shell, it ships with SIX (<a href="https://en.wikipedia.org/wiki/Bourne_shell">sh</a>, <a href="https://en.wikipedia.org/wiki/Bash_(Unix_shell)">bash</a>, <a href="https://en.wikipedia.org/wiki/Zsh">zsh</a>, <a href="https://en.wikipedia.org/wiki/C_shell">csh</a>, <a href="https://en.wikipedia.org/wiki/Tcsh">tcsh</a>, and <a href="https://en.wikipedia.org/wiki/Korn_shell">ksh</a>)!</p>
</div>
<div class="paragraph">
<p>You can see the list of available shells (and set your default shell) by opening <code>System Preferences</code>, going to the <code>Users &amp; Groups</code> pref pane, unlocking it, then right-clicking on your username in the sidebar, and selecting <code>Advanced Options ...</code>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt1/Screen-Shot-2013-04-13-at-15.29.39.png" alt="Select Advanced Options &#8230;&#8203;">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt1/Screen-Shot-2013-04-13-at-15.30.07.png" alt="Select Login Shell">
</div>
</div>
<div class="paragraph">
<p>The default shell on OS X is the Bourne Again Shell (Bash), so that&#8217;s the shell we&#8217;ll be using for the remainder of this series.
If you&#8217;ve not altered the defaults, then whenever you open a Terminal window on OS X, what you&#8217;re presented with is a Bash command shell.
Bash is an updated and improved version of the older Bourne Shell (sh), which was the default shell in Unix for many years.
The original Bourne Shell dates all the way back to 1977 and is called after its creator, <a href="https://en.wikipedia.org/wiki/Stephen_Richard_Bourne">Stephen Bourne</a>.
The Bourne Again Shell is a &#8216;newer&#8217; update to the Bourne Shell dating back to 1989, the name being a nerdy religious joke by its author, <a href="https://en.wikipedia.org/wiki/Brian_Fox_(computer_programmer)">Brian Fox</a>.
The Bourne Again Shell was not the last in the line of shells tracing their origins to the Bourne Shell, there is also zsh which dates back to 1990, but despite being a more powerful shell, it hasn&#8217;t taken off like Bash has.</p>
</div>
<div class="paragraph">
<p>So, what does a shell do?
Does it just let you enter a single command and then run it?
Or is there more to it?
Unsurprisingly, there&#8217;s a lot more to it!
The shell does its own pre-processing before issuing a command for you, so a lot of things that we think of as being part of how a command works are actually features provided by the command shell.
The best example is the almost ubiquitous <code>*</code> symbol.
When you issue a command like <code>chmod 755 *.php</code>, the actual command is not given <code>*.php</code> as a single argument that it must then interpret. No, the <code>*</code> is interpreted and processed by the shell before being passed on to the <code>chmod</code> command.
It&#8217;s the shell that goes and looks for all the files in the current folder that end in <code>.php</code>, and replaces the <code>*.php</code> bit of the command with a list of all the actual files that end in <code>.php</code>, and passes that list on to the <code>chmod</code> command.</p>
</div>
<div class="paragraph">
<p>As well as providing wildcard substitution (the * thing), almost all shells also provide &#8216;plumbing&#8217; for routing command inputs and outputs between commands and files, the definition of variables to allow sequences of commands to be generalised in a more reusable way, simple programming constructs to enable conditional actions, looping, and the grouping of sequences of commands into named functions, and the execution of a sequence of commands inside a file (scripting), and much more.
Different shells also provide their own custom features to help make life at the command prompt easier for users. My favourite is tab-completion which is the single best thing Bash has to offer over sh in my opinion.
OS X also brings some unique features to the table, with superb integration between the GUI and the command shell through features like drag-and-drop support in Terminal.app and shell scripting support in Automator.app.
Of all the OSes I&#8217;ve used, OS X is the one that makes it the easiest to integrate command-line programs into the GUI.</p>
</div>
<div class="paragraph">
<p>I&#8217;ll end today by explaining an important part of the Unix philosophy, a part that&#8217;s still very much alive and well within OS X today. Unix aims to provide a suite of many simple command-line tools that each do just one thing, but do it very well. Complex tasks can then be achieved by chaining these simple commands together using a powerful command shell.
Each Unix/Linux command-line program can be seen as a lego brick&#8201;&#8212;&#8201;not all that exciting on their own, but using a bunch of them, you can build fantastic things!
My hope for this series is to help readers and listeners like you develop the skills to build your own fantastic things to make your computing lives easier.
Ultimately the goal is to help you create more and better things by using automation to free you from as many of your repetitive tasks as possible!</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt02">TTT Part 2 of n &#8212; Commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is the second instalment of an on-going series.
In <a href="#ttt01">the first instalment</a>, I tried to give you a sort of 40,000 foot view of command shells&#8201;&#8212;&#8201;some context, some history, a very general description of what command shells do, and a little bit on why they are still very useful in the modern GUI age.
The most important points to remember from last time are that command shells execute commands, that there are lots of different command shells on lots of different OSes, but that we will be focusing on <a href="https://en.wikipedia.org/wiki/Bash_(Unix_shell)">Bash</a> on Linux/Unix in general, and Bash on OS X in particular.
The vast majority of topics I plan to discuss in these segments will be applicable on any system that runs Bash, but, the screenshots I use will be from OS X, and some of the cooler stuff will be OS X only.
This segment, like all the others, will be used as part of my bi-weekly
Chit Chat Across The Pond (CCATP) audio podcast segment with Allison Sheridan on <a href="https://podfeet.com/ttt-podcast">podfeet.com/&#8230;&#8203;</a></p>
</div>
<div class="paragraph">
<p>Last time I focused on the shell and avoided getting in any way specific about the actual commands that we will be executing within the Bash shell.
I thought it was very important to make as clear a distinction between command shells and commands as possible, so I split the two concepts into two separate segments.
Having focused on command shells last time, this instalment will focus on the anatomy of a command but will start with a quick intro to the Terminal app in OS X first.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 2</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 2</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT02Commands/TTT_02_Commands.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_02.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT02Commands/TTT_02_Commands.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_introducing_the_terminal_window">Introducing the Terminal Window</h3>
<div class="paragraph">
<p>You&#8217;ll find Terminal.app in <code>/Applications/Utilities</code>.
Unless you&#8217;ve changed some of the default settings (or are using a very old version of OS X), you will now see a white window that is running the bash command shell that looks something like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt2/Screen-Shot-2013-04-26-at-20.47.07.png" alt="An OS X Terminal Window">
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s start at the very top of the window with its title bar.
At the left of the title is a proxy icon representing the <em>current directory</em> for the current Bash command shell and beside it the name of that folder.
(Note that <em>directory</em> is the Unix/Linux/DOS word for what OS X and Windows refers to as a <em>folder</em>.) Like Finder windows, Terminal sessions are always &#8220;in&#8221; a particular directory/folder.
After the current directory will be a dash, followed by the name of the process currently running in the Terminal session (in our case, a bash shell).
The current process is followed by another dash, and then the dimensions of the window in fixed-width characters.</p>
</div>
<div class="paragraph">
<p>Within the window itself you will likely see a line of output telling you when you last logged in, and from where (if it was on this computer it will say ttys followed by some number, if it was from another computer, it will give the computer&#8217;s hostname).
This will be followed on the next line by the so-called <em>command prompt</em>, and then the input cursor.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt2/Screenshot_26_04_2013_20_28.png" alt="The Anatomy of a Terminal Window">
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s have a closer look at the command prompt.
As with almost everything in Linux/Unix, the prompt is entirely customisable, so although Bash is the default shell on lots of different operating systems, the default prompt on each of those systems can be different.
Let&#8217;s first look at the default Bash command prompt on OS X:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt2/Screen-Shot-2013-04-26-at-21.01.29.png" alt="Screen Shot 2013 04 26 at 21.01.29">
</div>
</div>
<div class="paragraph">
<p>On OS X, the prompt takes the following form:</p>
</div>
<div class="paragraph">
<p><code>hostname:current_directory username$</code></p>
</div>
<div class="paragraph">
<p>First, you have the hostname of the computer on which the command shell is running (defined in <span class="menuseq"><b class="menu">System Preferences</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Sharing</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Computer Name</b></span>).
This might seem superfluous, but it becomes exceptionally useful once you start using ssh to log in to other computers via the Terminal.</p>
</div>
<div class="paragraph">
<p>The hostname is followed by a <code>:</code> and then the command shell&#8217;s current directory (note that <code>~</code> is short-hand for &#8220;the current user&#8217;s home folder&#8221;, more on this next time).</p>
</div>
<div class="paragraph">
<p>The current directory is followed by a space, and then the Unix username of the user running the command shell (defined when you created your OS X account, defaults to your first name if available).
Finally, there is a <code>$</code> character (which changes to a <code>#</code> when you run bash as the root user).
Again, this might not seem very useful at first, but there are many reasons you may want to switch your command shell to run as a different user from time to time, so it is also very useful information.</p>
</div>
<div class="paragraph">
<p>As an example of how the default shells differ on different operating systems, below is an example from a RedHat-style Linux distribution (CentOS in this case):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt2/Screen-Shot-2013-04-26-at-21.11.39.png" alt="Default Bash Command Prompt on CentOS">
</div>
</div>
<div class="paragraph">
<p>As you can see, it contains the same information, but arranged a little differently:</p>
</div>
<div class="paragraph">
<p><code>[username@hostname current_directory]$</code></p>
</div>
<div class="paragraph">
<p>Finally, Debian-style Linux distributions like Ubuntu use a different default prompt again, but also showing the same information:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt2/Screen-Shot-2013-04-26-at-21.16.18.png" alt="Default Bash Command Prompt on Ubuntu">
</div>
</div>
<div class="paragraph">
<p><code>username@hostname:current_directory$</code></p>
</div>
<div class="paragraph">
<p><strong>Handy Tip:</strong> if you find the text in the Terminal window to small to read, you can make it bigger or smaller with <span class="keyseq"><kbd>&#8984;</kbd>+<kbd>+</kbd></span> or <span class="keyseq"><kbd>&#8984;</kbd>+<kbd>-</kbd></span>.
This will affect just your current Terminal window.
You can permanently change the default by editing the default profile in <span class="menuseq"><b class="menu">Terminal</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Preferences</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Profiles</b></span>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_anatomy_of_a_command">The Anatomy of a Command</h3>
<div class="paragraph">
<p>Now that we understand the different parts of our Terminal window, let&#8217;s have a look at the structure of the actual commands we will be typing at that cursor!</p>
</div>
<div class="paragraph">
<p>I want to start by stressing that the commands executed by a command shell are not determined by the command shell, but by the operating system.
Regardless of whether you use Bash on OS X, or zsh on OS X, you will have to enter OS X commands.
Similarly, if you use Bash on Linux, you will have to enter Linux commands.
Thankfully Linux and Unix agree almost entirely on the structure of their basic commands, so with a very few (and very annoying) exceptions, you can use the same basic commands on any Linux or Unix distribution (remember that at its heart OS X is Free BSD Unix).</p>
</div>
<div class="paragraph">
<p>Commands take the form of the command itself optionally followed by a list of <em>arguments</em> separated by spaces, e.g.:</p>
</div>
<div class="paragraph">
<p><code>command argument_1 argument_2 &#8230;&#8203; argument_n</code></p>
</div>
<div class="paragraph">
<p>Arguments are a mechanism for passing information to a command.
Most commands need at least one argument to be able to perform their task, but some don&#8217;t.
Both commands and arguments are case-sensitive, so beware your capitalisation!</p>
</div>
<div class="paragraph">
<p>For example, the <code>cd</code> (change directory) command takes one argument (a directory path):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac:~ bart$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">cd</span> /Users/Shared/
<span style="color: #555555">bart-imac:Shared bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the command is <code>cd</code>, and the one argument passed is <code>/Users/Shared/</code>.</p>
</div>
<div class="paragraph">
<p>Some commands don&#8217;t require any arguments at all, e.g.
the <code>pwd</code> (present working directory) command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac:~ bart$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">pwd</span>
<span style="color: #888888">/Users/bart
</span><span style="color: #555555">bart-imac:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is up to each command to determine how it will process the arguments it is given.
When the developer was creating the command he or she will have had to make decisions about what arguments are compulsory, what arguments are optional, and how to parse the list of arguments the command is given by the shell when being executed.</p>
</div>
<div class="paragraph">
<p>In theory, every developer could come up with their own mad complex scheme for parsing argument lists, but in reality most developers loath re-inventing the wheel (thank goodness), so a small number of standard libraries have come into use for parsing arguments.
This means that many apps use very similar argument styles.</p>
</div>
<div class="paragraph">
<p>As well as accepting simple arguments like the <code>cd</code> command above, many apps accept specially formatted arguments referred to as <code>flags</code>.
Flags are usually used to specify optional extra information, with information that is required taken as simple arguments.
Flags are arguments (or pairs of arguments) that start with the <code>-</code> symbol.</p>
</div>
<div class="paragraph">
<p>The simplest kinds of flags are those that don&#8217;t take a value, they are specified using a single argument consisting of a <code>-</code> sign followed by a single letter.
For example, the <code>ls</code> (list directory) command can accept the flag <code>-l</code> (long-form listing) as an argument.
e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac:Shared bart$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">ls</span> <span style="color: #000080">-l</span>
<span style="color: #888888">total 632
drwxrwxrwx  3 root   wheel     102  5 Dec  2010 Adobe
drwxrwxrwx  3 bart   wheel     102 27 Mar  2012 Library
drwxrwxrwx@ 5 bart   wheel     170 28 Dec 21:24 SC Info
drwxr-xr-x  4 bart   wheel     136 22 Feb 21:42 cfx collagepro
</span><span style="color: #555555">bart-imac:Shared bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The way the standard argument processing libraries work, flags can generally be specified in an arbitrary order.
The <code>ls</code> command also accepts the flag -a (list all), so the following are both valid and equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac:Shared bart$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">ls</span> <span style="color: #000080">-l</span> <span style="color: #000080">-a</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac:Shared bart$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">ls</span> <span style="color: #000080">-a</span> <span style="color: #000080">-l</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The standard libraries also allow flags that don&#8217;t specify values to be compressed into a single argument like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">bart-imac:Shared bart<span style="color: #008080">$ </span><span style="color: #0086B3">ls</span> <span style="color: #000080">-al</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Sometimes flags need to accept a value, in which case the flag stretches over two arguments which have to be contiguous.
For example, the <code>ssh</code> (secure shell) command allows the port to be used for the connection to be specified with the <code>-p</code> flag, and the username to connect as with the <code>-l</code> flag, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac:Shared bart$</span><span style="color: #bbbbbb"> </span>ssh bw-server.localdomain <span style="color: #000080">-l</span> bart <span style="color: #000080">-p</span> 443</code></pre>
</div>
</div>
<div class="paragraph">
<p>These single-letter flags work great for simple commands that don&#8217;t have too many options, but more complex commands often support many tens of optional flags.
For that reason, another commonly used argument processing library came into use that accepts long-form flags that start with a <code>--</code> instead of a single <code>-</code>.
As well as allowing a command to support more flags, these longer form flags also allow values to be set within a single argument by using the <code>=</code> sign.</p>
</div>
<div class="paragraph">
<p>As an example, the <code>mysql</code> command (needs to be installed separately on OS X) allows the username and password to be used when making a database connection to be specified using long-form flags:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">...$</span><span style="color: #bbbbbb"> </span>mysql <span style="color: #000080">--username</span><span style="color: #000000;font-weight: bold">=</span>bart <span style="color: #000080">--password</span><span style="color: #000000;font-weight: bold">=</span>open123 example_database</code></pre>
</div>
</div>
<div class="paragraph">
<p>Many commands support both long and short form arguments, and they can be used together, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">...$</span><span style="color: #bbbbbb"> </span>mysql <span style="color: #000080">--username</span><span style="color: #000000;font-weight: bold">=</span>bart <span style="color: #000080">--password</span><span style="color: #000000;font-weight: bold">=</span>open123 example_database <span style="color: #000080">-v</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So far we know that commands consist of a command optionally followed by a list of arguments separated by spaces, and that many Unix/Linux commands use similar schemes for processing arguments where arguments starting with <code>-</code> or <code>--</code> are treated in a special way, and referred to as flags.
That all seems very simple, but, there is one important complication that we have to address before finishing up for this segment, and that&#8217;s special characters.</p>
</div>
<div class="paragraph">
<p>Within Bash (and indeed every other command shell), there are some characters that have a special meaning, so they cannot be used in commands or arguments without signifying to the command shell in some way that is should interpret these symbols as literal symbols, and not as representations of some sort of special value or function.</p>
</div>
<div class="paragraph">
<p>The most obvious example from what we have learned today is the space character, it is used as the separator between commands and the argument list that follows, and within that argument list as the separator between individual arguments.
What if we want to pass some text that contains a space to a command as an argument?
This happens a lot because spaces are valid characters within file and folder names on Unix and Linux, and file and folder names are often passed as arguments.</p>
</div>
<div class="paragraph">
<p>As well as the space there are other symbols that have special meanings.
I won&#8217;t explain what they mean today, but I will list them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>space</p>
</li>
<li>
<p><code>#</code></p>
</li>
<li>
<p><code>;</code></p>
</li>
<li>
<p><code>"</code></p>
</li>
<li>
<p><code>'</code></p>
</li>
<li>
<p><code>`</code></p>
</li>
<li>
<p><code>\</code></p>
</li>
<li>
<p><code>!</code></p>
</li>
<li>
<p><code>$</code></p>
</li>
<li>
<p><code>(</code></p>
</li>
<li>
<p><code>)</code></p>
</li>
<li>
<p><code>&amp;</code></p>
</li>
<li>
<p><code>&lt;</code></p>
</li>
<li>
<p><code>&gt;</code></p>
</li>
<li>
<p><code>|</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You have two choices for how you deal with these special characters when you need to include them within an argument, you can <em>escape</em> each individual special character within the argument, or you can <em>quote</em> the entire argument.</p>
</div>
<div class="paragraph">
<p>Escaping is easy, you simply prefix the special character in question with a <code>\</code>.
If there are only one or two special characters in an argument this is the simplest and easiest solution.
But, it can become tedious if there are many such special characters.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s use the <code>echo</code> command to illustrate escaping.
The <code>echo</code> command simply prints out the input it receives.
The following example passes the phrase <em>Hello World!</em> to the echo command as a single argument.
Note that this phrase contains two special characters that will need to be escaped, the space and the <code>!</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac:~ bart$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">echo </span>Hello<span style="color: #d14">\ </span>World<span style="color: #d14">\!</span>
<span style="color: #888888">Hello World!
</span><span style="color: #555555">bart-imac:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t want to escape each special character in an argument, you can quote the argument by prepending and appending either a <code>"</code> or a <code>'</code> symbol to it.
There is a subtle difference between using <code>'</code> or <code>"</code>.</p>
</div>
<div class="paragraph">
<p>When you quote with <code>'</code> you are doing so-called <em>full quoting</em>, every special character can be used inside a full quote, but, it is impossible to use a <code>'</code> character inside a fully quoted argument.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac:~ bart$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">echo</span> <span style="color: #d14">'# ;"\!$()&amp;&lt;&gt;|'</span>
<span style="color: #999988;font-style: italic"># ;"\!$()&amp;&lt;&gt;|
</span><span style="color: #555555">bart-imac:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When you quote with <code>"</code> on the other hand you are doing so-called <em>partial quoting</em>, which means you can use most special characters without escaping them, but not all.
Partial quoting will become very important later when we start to use variables and things because the biggest difference between full and partial quoting is that you can&#8217;t use variable substitution with full quoting, but you can with partial quoting (don&#8217;t worry if that makes no sense at the moment, it will later in the series).</p>
</div>
<div class="paragraph">
<p>When using partial quoting you still have to escape the following special characters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>"</code></p>
</li>
<li>
<p><code>`</code></p>
</li>
<li>
<p><code>\</code></p>
</li>
<li>
<p><code>$</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac:~ bart$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">echo</span> <span style="color: #d14">"# ;</span><span style="color: #d14">\!</span><span style="color: #d14">()&amp;&lt;&gt;|"</span>
<span style="color: #999988;font-style: italic"># ;\!()&amp;&lt;&gt;|
</span><span style="color: #555555">bart-imac:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac:~ bart$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">echo</span> <span style="color: #d14">"</span><span style="color: #d14">\\</span><span style="color: #d14"> </span><span style="color: #d14">\$</span><span style="color: #d14"> </span><span style="color: #d14">\"</span><span style="color: #d14"> </span><span style="color: #d14">\`</span><span style="color: #d14">"</span>
<span style="color: #888888">\ $ " `
</span><span style="color: #555555">bart-imac:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are a few other peculiar edge cases with partial quoting&#8201;&#8212;&#8201;for example, you can&#8217;t end a partial quote with a <code>!</code>, and you can&#8217;t quote just a <code>*</code> on its own (there may well be more edge cases I haven&#8217;t bumped into yet).</p>
</div>
<div class="paragraph">
<p>That&#8217;s where we&#8217;ll leave it for this segment.
We&#8217;ve now familiarised ourselves with the OS X Terminal window, and we&#8217;ve described the anatomy of a Unix/Linux command.
In the next segment, we&#8217;ll look at the Unix/Linux file system, and at some of the commands used to navigate around it.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt03">TTT Part 3 of n &#8212; File Systems</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is the third instalment of an on-going series.
These blog posts are only part of the series, they are actually the side-show, being effectively just my show notes for discussions with Allison Sheridan on my bi-weekly Chit Chat Across the Pond audio podcast on <a href="https://podfeet.com/ttt-podcast">podfeet.com/&#8230;&#8203;</a>.
This instalment will be featured in NosillaCast episode 418 (scheduled for release late on Sunday the 12th of May 2013).</p>
</div>
<div class="paragraph">
<p>In the <a href="#ttt01">first instalment</a>, we started with the 40,000ft view, looking at what command shells are, and why they&#8217;re still relevant in today&#8217;s GUI-dominated world.
In the <a href="#ttt02">second instalment</a> we looked at OS X&#8217;s Terminal.app, the anatomy of the Bash command prompt, and the anatomy of a Unix/Linux command.
This time we&#8217;ll be looking at the anatomy of file systems in general, and the Unix/Linux file system in particular, and how it differs from the Windows/DOS file system many of us grew up using.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 3</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 3</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT03FileSystems/TTT_03_File_Systems.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/qrcodes/TTT_03.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT03FileSystems/TTT_03_File_Systems.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_file_systems">File systems</h3>
<div class="paragraph">
<p>Physical storage media are nothing more than a massive array of virtual pigeon holes, each of which can hold a single 1 or 0.
All your information is stored by grouping together a whole bunch of these pigeon holes and giving that grouping of 1s and 0s some kind of name.
Humans simply could not deal with remembering that the essay they were working on is stored in sectors 4 to 1024 on cylinder 213 on the disk connected to the first SATA channel on the motherboard.
We need some kind of abstraction to bring order to the chaos and to allow us to organise our data in a human-friendly way.</p>
</div>
<div class="paragraph">
<p>A good analogy would be a pre-computer office where the unit of storage was a single sheet of paper.
Without some sort of logical system for organising all this paper, no one would ever be able to find anything, hence, in the real world, we developed &#8216;systems&#8217; for &#8216;filing&#8217; paper.
Or, to put it another way, we invented physical filesystems, based around different ways of grouping and naming the pieces of paper.
If a single document contained so much information that it ran over multiple pages, those piece of paper were physically attached to each other using a tie, a paperclip, or a staple.
To be able to recognise a given document at a glance, documents were given titles.
Related documents were then put together into holders that, for some reason were generally green, and those holders were then placed into cabinets with rails designed to hold the green holders in an organised way.
I.e.
we had filing cabinets containing folders which contained files.
The exact organisation of the files and folders were up to the individual clerks who managed the data and were dependant on the kind of data being stored.
Doctors tend to store files alphabetically by surname, while libraries love the <a href="https://en.wikipedia.org/wiki/Dewey_Decimal_Classification">Dewey Decimal</a> system.</p>
</div>
<div class="paragraph">
<p>When it comes to computers, the job of bringing order to the chaos falls to our operating systems.
We call the many different schemes that have been devised to provide that order, filesystems.
Some filesystems are media dependent, while others are operating system dependent.
E.g.
the <a href="https://en.wikipedia.org/wiki/Joliet_(file_system)">Joliet file system</a> is used on CDs and DVDs regardless of OS, while <a href="https://en.wikipedia.org/wiki/File_Allocation_Table">FAT</a> and <a href="https://en.wikipedia.org/wiki/NTFS">NTFS</a> are Windows filesystems, <a href="https://en.wikipedia.org/wiki/Extended_file_system">EXT</a> is a family of Linux file systems, and <a href="https://en.wikipedia.org/wiki/HFS%2B">HFS+</a> is a Mac file system.</p>
</div>
<div class="paragraph">
<p>There is an infinite number of possible ways computer scientists could have chosen to bring order to the chaos of bits on our various media, but, as is often the case, a single real-world analogy was settled on by just about all operating system authors.
Whether you use Linux, Windows, or OS X, you live in a world of filesystems that contain folders (AKA directories) that contain files and folders.
Each folder and file in this recursive hierarchical structure has a name, so it allows us humans, to keep our digital documents organised in a way that we can get our heads around.
Although all our modern filesystems have their own little quirks under the hood, they all share the same simple architecture, your data goes in files which go in folders which can go in other folders which eventually go into file systems.</p>
</div>
<div class="paragraph">
<p>You can have lots of files with the same name in this kind of file system, but, you can never have two items with the same name in the same folder.
This means that each file and folder can be uniquely identified by listing all the folders you pass to get from the so-called &#8216;root&#8217; of the filesystem as far as the file or folder you are describing.
This is what we call the full path to a file or folder.
Where operating systems diverge is in their choice of separator, and in the rules they impose on file and folder names.
On all modern consumer operating systems, we write file paths as a list of folder and file names separated by some character, called the &#8216;path separator&#8217;.
DOS and Windows use <code>\</code> (the backslash) as the path separator, on classic MacOS it was <code>:</code> (old OS X apps that use Carbon instead of Cocoa still use <code>:</code> when showing file paths, iTunes did this up until the recent version 11!), and on Linux/Unix (including OS X), <code>/</code> (the forward-slash) is used.</p>
</div>
<div class="paragraph">
<p>A single floppy disk and a single CD or DVD contain a single file system to hold all the data on a given disk, but that&#8217;s not true for hard drives, thumb drives, or networks.
When formatting our hard drives or thumb drives we can choose to sub-divide a single physical device into multiple so-called partitions, each of which will then contain a single filesystem.</p>
</div>
<div class="paragraph">
<p>You&#8217;ve probably guessed by now that on our modern computers we tend to have more than one filesystem.
Even if we only have one internal hard disk in our computer that has been formatted to have only a single partition, every CD, DVD, or thumb drive we own contains a filesystem, and, each network share we connect to is seen by our OS as yet another file system.
In fact, we can even choose to store an entire filesystem (even an encrypted one) in a single file, e.g.
DMG files, or TrueCrypt vaults.</p>
</div>
<div class="paragraph">
<p>So, all operating systems have to merge lots of file systems into a single over-arching namespace for their users.
Or, put another way, even if two files have identical paths on two filesystems mounted by the OS at the same time, there has to be a way to distinguish them from each other.
There are lots of different ways you could combine multiple filesystems into a single unified namespace, and this is where the DOS/Windows designers parted ways with the Unix/Linux folks.
Microsoft combines multiple file systems together in a very different way to Unix/Linux/OS X.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start by looking at the approach Microsoft chose.
In DOS, and later Windows, each filesystem is presented to the user as a separate island of data named with a single letter, referred to as a <em>drive letter</em>.
This approach has an obvious limitation, you can only have 26 file systems in use at any one time!
For historical reasons, <code>A:\</code> and <code>B:\</code> were reserved for floppy drives, so, the first partition on the hard drive connected to the first IDE/SATA bus on the motherboard is given the drive letter <code>C:\</code>, the second one <code>D:\</code> and so on.
Whenever you plug in a USB thumb drive or a memory card from a camera it gets &#8216;mounted&#8217; on the next free drive letter.
Network shares also get mounted to drive letters.</p>
</div>
<div class="paragraph">
<p>Just like files and folders, filesystems themselves have names too, often referred to as <em>Volume Names</em>.
Windows makes very little use of these volume names though, they don&#8217;t show up in file paths, but, Windows Explorer will show them in some situations to help you figure out which of your USB hard drives ended up as K:\ today.</p>
</div>
<div class="paragraph">
<p>An analogy you can use for file systems is that of a tree.
The trunk of the tree is the base of the file system, each branch is a folder, and each leaf a file.
Branches &#8216;contain&#8217; branches and leaves, just like folders contain folders and files.
If you bring that analogy to Microsoft&#8217;s way of handling filesystems, then the global namespace is not a single tree, but a small copse of between 1 and 26 trees, each a separate entity, and each named with a single letter.</p>
</div>
<div class="paragraph">
<p>If we continue this analogy, Linux/Unix doesn&#8217;t plant a little copse of separate trees like DOS/Windows, instead, they construct one massive Franken-tree by grafting smaller trees onto the branches of a single all-containing master tree.
When Linux/Unix boots, one filesystem is considered to be the main filesystem and used as the master file system into which other file systems get inserted as folders.
In OS X parlance, we call the partition containing this master file system the <em>System Disk</em>.
Because the system disk becomes the root of the entire filesystem it is gets assigned the shortest possible file path, <code>/</code>.</p>
</div>
<div class="paragraph">
<p>If your system disk&#8217;s file system contained just two folders, <code>folder_1</code> and <code>folder_2</code>, they would get the file paths <code>/folder_1/</code> and <code>/folder_2/</code> in Linux/Unix/OS X.
The Unix/Linux command <code>mount</code> can then be used to &#8216;graft&#8217; filesystems into the master filesystem using any empty folder as the so-called <code>mount point</code>.</p>
</div>
<div class="paragraph">
<p>On Linux systems, it&#8217;s common practice to keep home folders on a separate partition, and to then mount that separate partition&#8217;s file system as <code>/home/</code>.
This means that the main filesystem has an empty folder in it called <code>home</code> and that as the computer boots, the OS mounts a specified partition&#8217;s file system into that folder.
A folder at the root of the that partition&#8217;s file system called just <code>allison</code> would then become <code>/home/allison/</code>.</p>
</div>
<div class="paragraph">
<p>On regular Linux/Unix distributions the file <code>/etc/fstab</code> (file system table) tells the OS what filesystems to mount to what mount points.
A basic version of this file will be created by the installer, but in the past, whenever you added a new disk to a Linux/Unix system you had to manually edit this file.
Thankfully, we now have something called <code>automount</code> to automatically mount any readable filesystems to a predefined location on the filesystem when they are connected.</p>
</div>
<div class="paragraph">
<p>The exact details will change from OS to OS, but on Ubuntu, the folder <code>/media/</code> is used to hold mount points for any file system you connect to the computer.
Unlike Windows, most Linux/Unix systems make use of filesystems&#8217; volume names and use them to give the mount points sensible names, rather than random letters.
If I connect a USB drive containing a single partition with a filesystem with the volume name <code>Allison_Pen_Drive</code>, Ubuntu will automatically mount the filesystem on that thumb drive when you plug it in, using the mount point <code>/media/Allison_Pen_Drive/</code>.
If that pen drive contained a single folder called <code>myFolder</code> containing a single file called <code>myFile.txt</code>, then <code>myFile.txt</code> would be added to the filesystem as <code>/media/Allison_Pen_Drive/myFolder/myFile.txt</code>.</p>
</div>
<div class="paragraph">
<p>Having the ability to mount any filesystem as any folder within a single master filesystem allows you to easily separate different parts of your OS across different drives.
This is very useful if you are a Linux/Unix sysadmin or power user, but it can really confuse regular users.
Because of this, OS X took a simpler route.
There is no <code>/etc/fstab</code> by default (though if you create one OS X will correctly execute it as it boots).
The OS X installer does not allow you to split OS X over multiple partitions. Everything belonging to the OS X system, including all the users home folders, are installed on a single partition, the system disk, and all other file systems, be they internal, external, network, or disk images, get automatically mounted in <code>/Volumes/</code> as folders named for the file systems&#8217; volume labels.</p>
</div>
<div class="paragraph">
<p>Going back to our imaginary thumb drive called <code>Allison_Pen_Drive</code> (which Ubuntu would mount as <code>/media/Allison_Pen_Drive/</code>), OS X will mount that as <code>/Volumes/Allison_Pen_Drive/</code> when you plug it in.
If you had a second partition, or a second internal drive, called, say, <code>Fatso</code> (a little in-joke for Allison), OS X would mount that as <code>/Volumes/Fatso/</code>.
Likewise, if you double-clicked on a DMG file you downloaded from the net, say with the Adium installer, OS X would mount that as something like <code>/Volumes/Adium/</code> until you eject the DMG.
The &#8216;disks&#8217; listed in the Finder sidebar in the section headed <code>Devices</code> are just links to the contents of <code>/Volumes/</code>.
You can see this for yourself by opening a Finder Window and either hitting the key-combo <span class="keyseq"><kbd>&#8984;</kbd>+<kbd>shift</kbd>+<kbd>g</kbd></span>, or navigating to <span class="menuseq"><b class="menu">Go</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Go To Folder &#8230;&#8203;</b></span> in the menubar to bring up the <code>Go To Folder</code> text box, and then typing the path <code>/Volumes</code> and hitting return.</p>
</div>
<div class="paragraph">
<p>OS X&#8217;s greatly simplified handling of mount points definitely makes OS X less confusing, but, the simplicity comes at a price.
If you DO want to do more complicated things like having your home folders on a separate partition, you are stepping outside of what Apple considers the norm, and into a world of pain.
On Linux/Unix separating out home folders is trivial, on OS X it&#8217;s a mine-field!</p>
</div>
<div class="paragraph">
<p>We&#8217;ll leave it here, for now, next time we&#8217;ll learn how to navigate around a Unix/Linux/OS X filesystem.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt04">TTT Part 4 of n &#8212; Navigation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In <a href="#ttt03">the previous segment</a>, we discussed the concept of a file system in detail.
We described how filesystems contain folders which contain files or folders, and we
described the different ways in which Windows and Linux/Unix/OS X combine all the
filesystems on our computers into a single name-space, within which every file has a
unique &#8216;path&#8217; (<code>F:\myFolder\myFile.txt</code> -v- <code>/Volumes/myThumbDrive/myFolder/myFile.txt</code>).</p>
</div>
<div class="paragraph">
<p>In this instalment, we&#8217;ll look at how to navigate around the Unix/Linux/OS X filesystem in
a Bash command shell.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 4</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 4</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT04Navigation/TTT_04_Navigation.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_04.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT04Navigation/TTT_04_Navigation.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_navigating_around">Navigating around</h3>
<div class="paragraph">
<p>Two instalments ago we learned that, just like a Finder window, a command prompt is &#8216;in&#8217; a single folder/directory at any time.
That folder is known as the <em>current working directory</em> or the <em>present working directory</em>.
Although the default Bash command prompt on OS X will show us the name of our current folder, it doesn&#8217;t show us the full path.
To see the full path of the folder you are currently in, you need the <code>pwd</code> (present working directory) command.
This is a very simple command that doesn&#8217;t need any arguments.</p>
</div>
<div class="paragraph">
<p>When you open an OS X Terminal, by default your current working directory will be your home directory, so, if you open a Terminal now and type just <code>pwd</code> you&#8217;ll see something like:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt4/Screen-Shot-2013-05-11-at-18.52.30.png" alt="pwd Command Example">
</div>
</div>
<div class="paragraph">
<p>Knowing where you are is one thing, the next thing you might want to do is look around to see what&#8217;s around you, and for that, you&#8217;ll need the <code>ls</code> (list) command.</p>
</div>
<div class="paragraph">
<p>If you run the command without any arguments you&#8217;ll see a listing of all the visible files and folders in the current directory.
On OS X, this default view is annoying in two ways.
Firstly, you&#8217;ll see your files and folders spread out over multiple columns, so scanning for a file name alphabetically becomes annoyingly confusing, especially if the list scrolls.
Secondly, on OS X (though not on most Linux distros), you won&#8217;t be able to tell what is a file and what is a folder at a glance, you&#8217;ll just see names, which is really dumb (even DOS does a better job by default!).</p>
</div>
<div class="paragraph">
<p>You can force <code>ls</code> to display the contents of a folder in a single column in two ways.
You can either use the <code>-l</code> flag to request a long-form listing, showing lots of metadata along with each file name, or, you can use the <code>-1</code> flag to specify that you just want the names but in a single column.
For now, most of the metadata shown in the long-form listing is just confusing garbage, so you are probably better off using <code>-1</code>.
If you do want to use the long-form listing, I suggest adding the <code>-h</code> flag to convert the file size column to human-readable file sizes like 100K, 5M, and 64G.
I&#8217;ve trained myself to always use <code>ls -lh</code> and never to use just <code>ls -l</code>.</p>
</div>
<div class="paragraph">
<p>You have two options for making it easy to distinguish files from folders in the output from <code>ls</code> on OS X.
You can either use the <code>-F</code> flag to append a <code>/</code> to the end of every folder&#8217;s name, or, the <code>-G</code> flag to use colour outputs (folders will be in blue).
The <code>-F</code> flag will work on Linux and Unix, but the <code>-G</code> flag is a BSD Unix thing and doesn&#8217;t work on Linux.
Linux users need to use the more logical <code>--color</code> instead.</p>
</div>
<div class="paragraph">
<p>I said that <code>ls</code> shows you all the <em>visible</em> files in your current directory, what if you want to see all the files, including hidden files?
Simple, just use the <code>-a</code> flag.</p>
</div>
<div class="paragraph">
<p>Finally, before we move away from <code>ls</code> (for now), I should mention that you can use <code>ls</code> to show you the content of any folder, not just the content of your current folder.
To show the content of any folder or folders, use the path(s) as regular arguments to <code>ls</code>.
E.g.
to see what is in your system-level library folder you can run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">ls</span> <span style="color: #000080">-1G</span> /Library</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that we can see where we are with <code>pwd</code>, and look around us with <code>ls</code>, the next obvious step is moving around the filesystem, but, we need to take a small detour before we&#8217;re ready to talk about that.</p>
</div>
<div class="paragraph">
<p>In the last instalment, we talked about file paths like the imaginary file on Allison&#8217;s thumb drive with the path <code>/Volumes/Allison_Pen_Drive/myFolder/myFile.txt</code>.
That type of path is called an <em>absolute path</em> and is one of two types of path you can use as arguments to Linux/Unix commands.</p>
</div>
<div class="paragraph">
<p>Absolute paths (AKA full paths) are like full addresses, or phone numbers starting with the <code>+</code> symbol, they describe the location of a file without reference to anything but the root of the filesystem.
They will work no matter what your present working directory is.
When you need to be explicit, like say when you&#8217;re doing shell scripting, you probably want to use absolute paths, but, they can be tediously long and unwieldy.</p>
</div>
<div class="paragraph">
<p>This is where relative paths come in, relative paths don&#8217;t describe where a file or folder is relative to the root of the file system, but, instead, relative to your present working directory.
If you are stopped for directions and someone wants to know where the nearest gas station is, you don&#8217;t give them the full address, you give them directions relative to where they are at that moment.
Similarly, if you want to phone someone in the same street you don&#8217;t dial <code>+</code> then the country code then the area code then their number, you just dial the number because, like your command shell is in a current working directory, your telephone is in an area code.</p>
</div>
<div class="paragraph">
<p>With phone numbers, you can tell whether something is a relative or an absolute phone number by whether or not it starts with a <code>+</code>.
With Unix/Linux paths the magic character is <code>/</code>.
Any path that starts with a <code>/</code> will be interpreted as an absolute path by the OS, and conversely, any path that does not begin with a <code>/</code> will be interpreted as a relative path.</p>
</div>
<div class="paragraph">
<p>If you are in your home folder, you can describe the relative path to your iTunes library file as <code>Music/iTunes/iTunes\ Library.xml</code> (note the backslash to escape the space in the path).
That means that your home folder contains a folder called <code>Music</code>, which contains a folder called <code>iTunes</code>, which contains a file called <code>iTunes Library.xml</code>.</p>
</div>
<div class="paragraph">
<p>Describing relative paths to items deeper in the file system hierarchy from you is easy, but what if you need to go the other way, not to folders contained in your current folder, but instead to the folders that contain your current folder?
Have another look at the output of <code>ls -aG1</code> in any folder.
What are the top two entries?
I don&#8217;t have to know what folder you are in to know the answer, the first entry will be a folder called <code>.</code>, and the second entry will be a folder called <code>..</code>.
These are the key to allowing relative paths that go up the chain.</p>
</div>
<div class="paragraph">
<p>The folder <code>.</code> is a hard link to the current folder.
If you are in your home folder, <code>ls ./Documents</code> and <code>ls Documents</code> will do the same thing, show you the contents of a folder called <code>Documents</code> in your current folder.
This seems pointless, but trust me, it will prove to be important and useful in the future.</p>
</div>
<div class="paragraph">
<p>For now, the more interesting folder is <code>..</code>, which is a hard link to the folder that contains the current folder.
I.e.
it allows you to specify relative paths that move back towards <code>/</code> from where you are.</p>
</div>
<div class="paragraph">
<p>In OS X, home directories are stored in a folder called <code>/Users</code>.
As well as one folder for each user (named for the user), <code>/Users</code> also contains a folder called <code>Shared</code> which is accessible by every user to facilitate easy local file sharing.
Regardless of your username, the relative path from your home folder to <code>/Users/Shared</code> is always <code>../Shared</code> (unless you moved your home folder to a non-standard location of course).
<code>..</code> means go back one level, then move forward to Shared.
You can go back as many levels as you want until you hit <code>/</code> (where <code>..</code> is hard-linked to itself), e.g.
the relative path from your home folder to <code>/</code> is <code>../../</code>.</p>
</div>
<div class="paragraph">
<p>Finally, the Bash shell (and all other common Unix/Linux shells) provides one other very special type of path, home folders.
We have mentioned in passing in previous instalments that <code>~</code> means &#8216;your home directory&#8217;.
No matter where on the filesystem you are, <code>~/Music/iTunes/iTunes\ Library.xml</code> is always a relative path to your iTunes library file.
But, the <code>~</code> character does a little more than that, it can take you to ANY user&#8217;s home folder simply by putting their username after the <code>~</code>.
Imagine Allison &amp; Steve share a computer.
Allison&#8217;s username is <code>allison</code>, and Steve&#8217;s is <code>steve</code>.
Allison and Steve can each access their own iTunes libraries at <code>~/Music/iTunes/iTunes\ Library.xml</code>, but, Allison can also access Steve&#8217;s at <code>~steve/Music/iTunes/iTunes\ Library.xml</code>, and likewise, Steve can access Allison&#8217;s at <code>~allison/Music/iTunes/iTunes\ Library.xml</code> (all assuming the file permissions we are ignoring for now, are set appropriately of course).</p>
</div>
<div class="paragraph">
<p>So&#8201;&#8212;&#8201;now that we understand that we can have absolute or relative paths, we are finally ready to start navigating the file system by changing our current directory.
The command to do this is <code>cd</code> (change directory).</p>
</div>
<div class="paragraph">
<p>Firstly, if you ever get lost and you want to get straight back to your home directory, just run the <code>cd</code> command with no arguments and it will take you home!</p>
</div>
<div class="paragraph">
<p>Generally, though we want to use the <code>cd</code> command to navigate to a particular folder, to do that, simply use either the absolute or relative path to the folder you want to navigate to as the only argument to the <code>cd</code> command, and assuming the path you entered is free of typos, off you&#8217;ll go!</p>
</div>
<div class="paragraph">
<p>Finally, for this instalment, I just want to mention one other nice trick the cd command has up its sleeve, it has a (very short) memory.
If you type <code>cd -</code> you will go back to where ever you were before you last used <code>cd</code>.</p>
</div>
<div class="paragraph">
<p>As an example, let&#8217;s say you spent ages navigating a very complex file system and are now 20 folders deep.
You&#8217;ve forgotten how you got there, but you&#8217;ve finally found that obscure system file you need to edit to make some app do some non-standard thing.
Then, you make a boo boo, and you accidentally type just <code>cd</code> on its own, all of a sudden, you are back in your home folder.
Don&#8217;t panic, you won&#8217;t have to find that complicated path again, just type <code>cd -</code> and you&#8217;ll be right back where you were before your rubber-fingered the <code>cd</code> command!</p>
</div>
<div class="paragraph">
<p>That&#8217;s where we&#8217;ll leave things for this instalment.
We now understand the structure of our file systems and how to navigate around them. Next time we&#8217;ll dive head-long into these file permissions we&#8217;ve been ignoring for the last two instalments.</p>
</div>
<div class="paragraph">
<p>For any Windows users out there, the DOS equivalents are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>instead of <code>pwd</code>, use <code>cd</code> with no arguments</p>
</li>
<li>
<p>instead of <code>ls</code>, use <code>dir</code> (though it has way less cool options)</p>
</li>
<li>
<p><code>cd</code> is <code>cd</code>, though again, it has way fewer cool options</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt05">TTT Part 5 of n &#8212; File Permissions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this instalment, it&#8217;s time to make a start on one of the most important Unix/Linux concepts, file permissions.
This can get quite confusing, but it&#8217;s impossible to overstate the importance of understanding how to read and set permissions on files and folders.
To keep things manageable, I&#8217;m splitting understanding and altering permissions into two separate instalments.</p>
</div>
<div class="paragraph">
<p>Linux and Unix (and hence OS X) all share a common file permissions system, but while they share the same common core, they do each add their own more advanced permissions systems on top of that common core.
In this first instalment, we&#8217;re only going to look at the common core, so everything in this instalment applies equally to Linux, Unix, and OS X.
In future instalments, we&#8217;ll take a brief look at the extra file information and permissions OS X associates with files, but we won&#8217;t be looking at the Linux side of things, where more granular permissions are provided through kernel extensions like SELinux.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 5</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 5</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT05FilePermissions/TTT_05_File_Permissions.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_05.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT05FilePermissions/TTT_05_File_Permissions.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_files_and_permissions">Files and permissions</h3>
<div class="paragraph">
<p>Let&#8217;s start with some context.
Just like every command shell has a present working directory, every process on a Linux/Unix system is also owned by a user, including shell processes.
So, when you execute a command in a command shell, that process has a file system location associated with it and a username.
By default your shell will be running as the user you logged into your computer as, though you can become a different user if and when you need to (more on that in future instalments).
You can see which user you are running as with the very intuitive command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">whoami</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Secondly, users on Unix/Linux systems can be members of one or more groups.
On OS X there are a number of system groups to which your user account may belong, including one called <code>staff</code> to which all admin users belong.
You can see what groups you belong to with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">groups</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>(You can even see the groups any username belongs to by adding the username as an argument.)</p>
</div>
<div class="paragraph">
<p>On older versions of OS X creating your own custom groups was hard.
Thankfully Apple has addressed this shortcoming in more recent versions of the OS, and you can now create and manage your own custom groups in the <code>Users &amp; Groups</code> preference pane (click the <code>+</code> button and choose <code>group</code> as the user type, then use the radio buttons to add or remove people from the group).</p>
</div>
<div class="paragraph">
<p>Unix/Linux file systems like EXT and HFS+ store metadata about each file and folder as part of that file or folder&#8217;s entry in the file system.
Some of that metadata is purely informational, things like the date the file was created, and the date it was last modified, but that metadata also includes ownership information and a so-called <em>Unix File Permission Mask</em>.</p>
</div>
<div class="paragraph">
<p>There are two pieces of ownership information stored about every file and folder: a UID, and a GID.
What this means is that every file and folder belongs to one user and one group.</p>
</div>
<div class="paragraph">
<p>In the standard Linux/Unix file permissions model there are only three permissions that can be granted on a file or folder:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Read (<code>r</code>):</strong> if set on a file it means the contents of the file can be read.
If set on a folder it means the contents of the files and folders contained in within the folder can be read, assuming the permissions masks further down the filesystem tree also allow that.
If you are trying to access a file, and read permission is blocked at even one point along the absolute path to the file, access will be denied.</p>
</li>
<li>
<p><strong>Write (<code>w</code>):</strong> if set on a file it means the contents can be altered, or the file deleted.
If set on a folder it means new files or folders can be created within the folder.</p>
</li>
<li>
<p><strong>Execute (<code>x</code>):</strong> if set on a file it means the file can be run.
The OS will refuse to run any file, be it a script or a binary executable, if the user does not have execute permission.
When set on a folder, execute permission controls whether or not the user has the right to list the contents of a directory.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All permutations of these three permissions are possible on any file, even if some of them are counter-intuitive and rarely needed.</p>
</div>
<div class="paragraph">
<p>The Unix file Permission Mask ties all these concepts together.
The combination of the context of the executing process and the metadata in a file or folder determines the permissions that apply.
You can use the <code>ls -l</code> command to see the ownership information and file permission mask associated with any file or folder.</p>
</div>
<div class="paragraph">
<p>The hard part is interpreting the meaning of the file permission mask.</p>
</div>
<div class="paragraph">
<p>On standard Unix/Linux systems this mask contains ten characters, though on OS X it can contain an optional 11th or even 12th character appended to the end of the mask (we&#8217;ll be ignoring these for this instalment).</p>
</div>
<div class="paragraph">
<p>The first character specifies the &#8216;type&#8217; of the file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-</code> signifies a regular file</p>
</li>
<li>
<p><code>d</code> signifies a directory (i.e. a folder)</p>
</li>
<li>
<p><code>l</code> signifies a symbolic link (more on these in a later instalment)</p>
</li>
<li>
<p><code>b</code> <code>c</code> <code>d</code> and <code>p</code> are also valid file types, but they are used to represent things like block devices and sockets rather than &#8216;normal&#8217; files, and we&#8217;ll be ignoring them in this series.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The remaining nine characters represent three sets of read, write, and execute permissions (<code>rwx</code>), specified in that order.
If a permission is present then it is represented by an <code>r</code>, <code>w</code>, or <code>x</code>, and if it&#8217;s not present, it&#8217;s represented by a <code>-</code>.</p>
</div>
<div class="paragraph">
<p>The first group of three permission characters are the permissions granted to the user who owns the file, the second three are the permissions granted to all users who are members of the group that owns the file, and the last three are the permissions granted to everyone, regardless of username or group membership.</p>
</div>
<div class="paragraph">
<p>To figure out what permissions you have on a file you need to know the following things:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>your username</p>
</li>
<li>
<p>what groups you belong to</p>
</li>
<li>
<p>what user the file or folder belongs to</p>
</li>
<li>
<p>what group the file or folder belongs to</p>
</li>
<li>
<p>the file or folder&#8217;s permission mask</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When you try to read the contents of a file, your OS will figure out whether or not to grant you that access using the following algorithm:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>is the user trying to read the file the owner of the file?
If so, check if the owner is granted read permission, if yes, allow to read, if no, continue.</p>
</li>
<li>
<p>is the user trying to read the file a member of the group that owns the file?
If so, check if the group is granted read permission, if yes, allow read, if no, continue.</p>
</li>
<li>
<p>check the global read permission, and allow or deny access as specified.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Write and execute permissions are processed in exactly the same way.</p>
</div>
<div class="paragraph">
<p>When you see the output of <code>ls -l</code>, you need to mentally follow the same algorithm to figure out whether or not you have a given permission on a given file or folder.
The three columns to look at are the mask, the file owner, and the file group.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll stop here for now.
In the next instalment, we will explain the meaning of the <code>+</code> and <code>@</code> characters which can show up at the end of a file permission masks on OS X, and we&#8217;ll look at the commands for altering the permissions on a file or folder.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt06">TTT Part 6 of n &#8212; More File Permissions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In <a href="#ttt05">the previous instalment</a> of this series, we had a look at how standard Unix File Permissions worked.
We looked at how to understand the permissions on existing files and folders, but not at how to change them.
We also mentioned that the standard Unix file permissions are now only a subset of the file permissions on OS X and Linux (OS X also supports file ACLs, and Linux has SELinux as an optional extra layer of security).</p>
</div>
<div class="paragraph">
<p>In this instalment, we&#8217;ll start by biting the bullet and dive into how to alter standard Unix File permissions.
This could well turn out to be the most difficult segment in this entire series, regardless of how big 'n' gets, but it is very important, so if you have trouble with it, please don&#8217;t give up.
After we do all that hard work we&#8217;ll end with a simpler topic, reading OS X file ACLs, and OS X extended file attributes.
We&#8217;ll only be looking at how to read these attributes though, not how to alter them.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 6</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 6</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT06MoreFilePermissions/TTT_06_More_File_Permissions.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_06.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT06MoreFilePermissions/TTT_06_More_File_Permissions.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>As a reminder, last time we learned that every file and folder in a Unix/Linux file system has three pieces of metadata associated with it that control the standard Unix file permissions that apply to that file or folder. Files have an owner (a user), a group, and a Unix File Permission Mask associated with them, and all three of these pieces of information can be displayed with <code>ls -l</code>.
We&#8217;ll be altering each of these three pieces of metadata in this instalment.</p>
</div>
<div class="sect2">
<h3 id="_altering_unix_file_permissions_setting_the_file_ownership">Altering Unix File Permissions &#8212; Setting the File Ownership</h3>
<div class="paragraph">
<p>The command to change the user that owns one or more files or folders is <code>chown</code> (change owner).
The command takes a minimum of two arguments, the username to change the ownership to, and one or more files or folders to modify.
E.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">chown </span>bart myFile.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command can also optionally take a <code>-R</code> flag to indicate that the changes should be applied &#8216;recursively&#8217;, that is that if the ownership of a folder is changed, the ownership of all files and folders contained within that folder should also be changed.
The <code>chown</code> command is very picky about the placement of the flag though, it MUST come before any other arguments E.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">chown</span> <span style="color: #000080">-R</span> bart myFolder</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, the command to change the group that a file belongs to is <code>chgrp</code> (change group). It behaves in the same way as <code>chown</code>, and also supports the <code>-R</code> flag to recursively change the group.
E.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">chgrp</span> <span style="color: #000080">-R</span> staff myFolder</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, if you want to change both user and group ownership of files or folders at the same time, the <code>chown</code> command provides a handy shortcut. Instead of passing just a username as the first argument, you can pass a username and group name pair separated by a :, so the previous two examples can be rolled into the one example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">chown</span> <span style="color: #000080">-R</span> bart:staff myFolder</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_altering_unix_file_permissions_setting_the_permission_mask">Altering Unix File Permissions &#8212; Setting the Permission Mask</h3>
<div class="paragraph">
<p>The command to alter the permission mask, or file mode, is <code>chmod</code> (change mode).
In many ways it&#8217;s similar to the <code>chown</code> and <code>chgrp</code> commands. It takes the same basic form, and supports the <code>-R</code> flag, however, the formatting of the first argument&#8201;&#8212;&#8201;the permission you want to set&#8201;&#8212;&#8201;can be very confusing.</p>
</div>
<div class="paragraph">
<p>The command actually supports two entirely different approaches to setting the permissions.
I find both of them equally obtuse, and my advice to people is to pick one and stick with it.
Long ago I chose the numeric approach to setting file permissions, so that&#8217;s the approach we&#8217;ll use here.</p>
</div>
<div class="paragraph">
<p>This approach is based on treating the three permissions, read, write, and execute as a three-digit binary number, if you have read permission, the first digit is a <code>1</code>, if not, it&#8217;s a <code>0</code>, and the same for the write and execute permissions.
So, the permissions <code>rwx</code> would be represented by the binary number <code>111</code>, the permissions <code>r-x</code> by <code>101</code>, and <code>r--</code> by <code>100</code>.
Since there are three sets of <code>rwx</code> permissions (user, group, everyone), a full Unix file permission mask is defined by three three-digit binary numbers.</p>
</div>
<div class="paragraph">
<p>Unfortunately, the <code>chmod</code> command doesn&#8217;t take the binary numbers in binary form, it expects you to convert them to decimal <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> first, and pass it the three sets of permissions as three digits.
This sounds hard, but with a little practice, it&#8217;ll soon become second-nature.</p>
</div>
<div class="paragraph">
<p>The key to reading off the permissions is this table:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt6/Basic_Unix_File_Permission_Masks.png" alt="Unix File Permissions Conversion Table">
</div>
</div>
<div class="paragraph">
<p>Rather than trying to memorise the table itself, you should try to learn the process for creating it instead.
The lighter coloured cells in the centre of the table are the important ones to be able to re-create on demand.
They are not random, they are a standard binary to decimal conversion table, and you should notice that the three columns have a distinct pattern. The right-most column alternates from <code>0</code> to <code>1</code> as you go down, the column second from the right has two <code>0</code>s, then two <code>1</code>s, then two <code>0</code>s etc, and finally the third column from the right has four <code>0</code>s, then four <code>1</code>s.
If you wanted to convert a 4 digit binary number to decimal you would add a fourth column that has 8 <code>0</code>s then <code>1</code>s, if you wanted to convert a 5-bit binary number you&#8217;d add yet another column where it&#8217;s eight <code>0</code>s then eight <code>1</code>s, and so on&#8201;&#8212;&#8201;each column you go to the left doubles the number of <code>0</code>s and <code>1</code>s before repeating.</p>
</div>
<div class="paragraph">
<p>If you can reproduce this table on demand you&#8217;ll have learned two things&#8201;&#8212;&#8201;how to do Unix file permissions, and how to convert any arbitrary binary number to decimal (though there are better ways if the binary number has many digits).</p>
</div>
<div class="paragraph">
<p>Even if you don&#8217;t want to learn how to create the table, you&#8217;ll probably still be fine if you remember just the most common permissions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>4</code> = read-only</p>
</li>
<li>
<p><code>5</code> = read and execute</p>
</li>
<li>
<p><code>6</code> = read and write</p>
</li>
<li>
<p><code>7</code> = full access</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you run a website, for example, regular files like images or HTML pages and images should have permissions <code>644</code> (<code>rw-r--r--</code>: you get read and write, everyone gets read). Executable files and folders should have 755 (<code>rwxr-xr-x</code>: you get full permission, everyone can list the folder contents and read the files within).</p>
</div>
<div class="paragraph">
<p>Let&#8217;s end with a few examples.
If you want to alter a file you own so that you have read, write and execute permission, but no one else can access the file in any way you would use the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">chmod </span>700 myFile.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the file should not be executable even by you, then you would use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">chmod </span>600 myFile.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Clearly, this is not intuitive, and it&#8217;s understandably very confusing to most people at first.
Everyone needs to go over this a few times before it sinks in, so if it doesn&#8217;t make sense straight away, you&#8217;re not alone.
Do please keep at it though, this is very important stuff.</p>
</div>
</div>
<div class="sect2">
<h3 id="_reading_os_x_file_acls">Reading OS X File ACLs</h3>
<div class="paragraph">
<p>We said last time that on OS X, a <code>+</code> at the end of a file permission mask signifies that the file has ACLs (access control lists) associated with it.
These ACLs allow more granular permissions to be applied to files on top of the standard Unix File Permissions.
If either the ACLs OR the standard Unix permissions deny you the access you are requesting, OS X will block you.</p>
</div>
<div class="paragraph">
<p>You can read the ACLs associated with files by adding the <code>-le</code> flags to the <code>ls</code> command.
If a file in the folder you are listing the contents of has file ACLs, they will be listed underneath the file, one ACL per line, and indented relative to the files in the list.
Each ACL associated with a file is numbered, and the numbering starts from 0.</p>
</div>
<div class="paragraph">
<p>The ACLs read as quite Englishy, so you should be able to figure out what they mean just by looking at them.
As an example, let&#8217;s have a look at the extended permissions on OS X home directories:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac:~ bart$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">ls</span> <span style="color: #000080">-le</span> /Users
<span style="color: #888888">total 0
drwxrwxrwt  10 root   wheel   340 22 Feb 21:42 Shared
drwxr-xr-x+ 12 admin  staff   408 26 Dec  2011 admin
 0: group:everyone deny delete
drwxr-xr-x+ 53 bart   staff  1802 13 Jul 14:35 bart
 0: group:everyone deny delete
</span><span style="color: #555555">bart-imac:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, all OS X home folders are in the folder <code>/Users</code>, which is the folder the above commands lists the contents of.
You can see here that my home folder (<code>bart</code>) has one or more file ACLs associated with it because it has a <code>+</code> at the end of the permissions mask.
On the lines below you can see that there is only one ACL associated with my home folder and that it&#8217;s numbered <code>0</code>.
The contents of the ACL are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">group:everyone deny delete</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you might expect, this means that the group everyone is denied permission to delete my home folder.
Everyone includes me, so while the Unix file permissions (<code>rwxr-xr-x</code>) give me full control over my home folder, the ACL stops me deleting it.
The same is true of the standard folders within my account like <code>Documents</code>, <code>Downloads</code>, <code>Library</code>, <code>Movies</code>, <code>Music</code>, etc..</p>
</div>
<div class="paragraph">
<p>If you&#8217;re interested in learning to add ACLs to files or folders, you might find this link helpful: <a href="https://www.techrepublic.com/blog/mac/introduction-to-os-x-access-control-lists-acls/1048">www.techrepublic.com/blog/mac/&#8230;&#8203;</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_reading_os_x_extended_file_attributes">Reading OS X Extended File Attributes</h3>
<div class="paragraph">
<p>In the last instalment, we mentioned that all files in a Linux/Unix file system have metadata associated with them such as their creation date, last modified date, and their ownership and file permission information.
OS X allows arbitrary extra metadata to be added to any file.
This metadata can be used by applications or the OS when interacting with the file.</p>
</div>
<div class="paragraph">
<p>For example, when you give a file a colour label, that label is stored in an extended attribute.
If you give a file or folder a custom Finder icon, that gets stored in an extended attribute (this is how DropBox.app makes your DropBox folder look different even though it&#8217;s a regular folder.)
Similarly, spotlight comments are stored in an extended attribute, and third-party tagging apps also use extended attributes to store the tags you associate with a given file (presumably OS X Mavericks will adopt the same approach for the new standard file tagging system it will introduce to OS X).</p>
</div>
<div class="paragraph">
<p>Extended attributes take the form of name-value-pairs.
The name, or key, is usually quite long to prevent collisions between applications, and, like plist files, is usually named in reverse-DNS order.
E.g., all extended attributes set by Apple have names that start with <code>com.apple</code>, which is the reverse of Apple&#8217;s domain name, <code>apple.com</code>.
So, if I were to write an OS X app that used extended file attributes, the correct thing for me to do would be for me to prefix all my extended attribute names with <code>ie.bartb</code>, and if Allison were to do the same she should prefix hers with <code>com.podfeet</code>.
(Note that this is a great way to avoid name-space collisions since every domain only has one owner.
This approach is used in many places, including Java package naming.)
The values associated with the keys are stored as strings, with complex data and binary data stored as 64bit encoded (i.e.
HEX) strings.
This means the contents of many extended attributes is not easily human-readable.</p>
</div>
<div class="paragraph">
<p>Any file that has extended attributes will have an <code>@</code> symbol appended to its Unix file permission mask in the output of <code>ls -l</code>.
To see the list of the names/keys for the extended attributes belonging to a file you can use <code>ls -l@</code>.</p>
</div>
<div class="paragraph">
<p>You can&#8217;t use <code>ls</code> to see the actual contents of the extended attributes though, only to get their names.
To see the names and values of all extended attributes on one or more files use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">xattr <span style="color: #000080">-l</span> <span style="color: #000000;font-weight: bold">[</span>file list]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The nice thing about the <code>-l</code> flag is that if the value stored in an extended attribute looks like it&#8217;s a base 64 encoded HEX string it automatically does a conversion to ASCII for you and displays the ASCII value next to the HEX value.</p>
</div>
<div class="paragraph">
<p>Apple uses extended attributes to track where files have been downloaded from, by what app, and if they are executable, and whether or not you have dismissed the warning you get the first time you run a downloaded file.
Because of this, every file in your <code>Downloads</code> folder will contain extended attributes, so <code>~/Downloads</code> is a great place to experiment with <code>xattr</code>.</p>
</div>
<div class="paragraph">
<p>As an example, I downloaded the latest version of the XKpasswd library from my website (<code>xkpasswd-v0.2.1.zip</code>).
I can now use <code>xattr</code> to see all the extended attributes OS X added to that file like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac:~ bart$</span><span style="color: #bbbbbb"> </span>xattr <span style="color: #000080">-l</span> ~/Downloads/xkpasswd-v0.2.1.zip
<span style="color: #888888">com.apple.metadata:kMDItemDownloadedDate:
00000000  62 70 6C 69 73 74 30 30 A1 01 33 41 B7 91 BF D6  |bplist00..3A....|
00000010  37 DB A1 08 0A 00 00 00 00 00 00 01 01 00 00 00  |7...............|
00000020  00 00 00 00 02 00 00 00 00 00 00 00 00 00 00 00  |................|
00000030  00 00 00 00 13                                   |.....|
00000035
com.apple.metadata:kMDItemWhereFroms:
00000000  62 70 6C 69 73 74 30 30 A2 01 02 5F 10 39 68 74  |bplist00..._.9ht|
00000010  74 70 3A 2F 2F 77 77 77 2E 62 61 72 74 62 75 73  |tp://www.bartbus|
00000020  73 63 68 6F 74 73 2E 69 65 2F 64 6F 77 6E 6C 6F  |schots.ie/downlo|
00000030  61 64 73 2F 78 6B 70 61 73 73 77 64 2D 76 30 2E  |ads/xkpasswd-v0.|
00000040  32 2E 31 2E 7A 69 70 5F 10 2E 68 74 74 70 3A 2F  |2.1.zip_..http:/|
00000050  2F 77 77 77 2E 62 61 72 74 62 75 73 73 63 68 6F  |/www.bartbusscho|
00000060  74 73 2E 69 65 2F 62 6C 6F 67 2F 3F 70 61 67 65  |ts.ie/blog/?page|
00000070  5F 69 64 3D 32 31 33 37 08 0B 47 00 00 00 00 00  |_id=2137..G.....|
00000080  00 01 01 00 00 00 00 00 00 00 03 00 00 00 00 00  |................|
00000090  00 00 00 00 00 00 00 00 00 00 78                 |..........x|
0000009b
com.apple.quarantine: 0002;51e18856;Safari;6425B1FC-1E4C-4DB1-BD0D-6161A2DE0593
</span><span style="color: #555555">bart-imac:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see that OS X has added three extended attributes to the file, <code>com.apple.metadata:kMDItemDownloadedDate</code>, <code>com.apple.metadata:kMDItemWhereFroms</code> and <code>com.apple.quarantine</code>.</p>
</div>
<div class="paragraph">
<p>All three of these attributes are base 64 encoded HEX.
The HEX representation of the data looks meaningless to us humans of course, but OS X understands what it all means, and the <code>xattr</code> command is nice enough to display the ASCII next to the HEX for us.
In the case of the download date, it&#8217;s encoded in such a way that even the ASCII representation of the data is of no use to us, but we can read the URL from the second extended attribute, and we can see that Safari didn&#8217;t just save the URL of the file (<code>https://www.bartbusschots.ie/downloads/xkpasswd-v0.2.1.zip</code>), but also the URL of the page we were on when we clicked to download the file (<code>https://www.bartbusschots.ie/blog/?page_id=2137</code>).
Finally, the quarantine information is mostly meaningless to humans, except that we can clearly see that the file was downloaded by Safari.</p>
</div>
<div class="paragraph">
<p>The <code>xattr</code> command can also be used to add, edit, or remove extended attributes from a file, but we won&#8217;t be going into that here.</p>
</div>
</div>
<div class="sect2">
<h3 id="_wrapup">Wrapup</h3>
<div class="paragraph">
<p>That&#8217;s where we&#8217;ll leave things for this instalment.
Hopefully, you can now read all the metadata and security permissions associated with files and folders in OS X, and you can alter the Unix file permissions on files and folders.</p>
</div>
<div class="paragraph">
<p>We&#8217;ve almost covered all the basics when it comes to dealing with files in the Terminal now.
We&#8217;ll finish up with files next time when we look at how to copy, move, delete, and create files from the Terminal.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt07">TTT Part 7 of n &#8212; Managing Files</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So far in this series we&#8217;ve focused mostly on the file system, looking at the details of file systems, how to navigate them, and at file permissions and metadata.
We&#8217;re almost ready to move on and start looking at how processes work in Unix/Linux/OS X, but we have a few more file-related commands to look at before we do.</p>
</div>
<div class="paragraph">
<p>In this instalment, we&#8217;ll be looking at how to manipulate the file system. In other words, how to create files and folders, how to copy them, how to move them, how to rename them, and finally how to delete them.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 7</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 7</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT07ManagingFiles/TTT_07_Managing_Files.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_07.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT07ManagingFiles/TTT_07_Managing_Files.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_folders_files">Creating Folders &amp; Files</h3>
<div class="paragraph">
<p>This is one of those topics that I think is best taught through example, so let&#8217;s start by opening a Terminal window and navigating to our Documents folder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">cd</span> ~/Documents</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ll then create a folder called <code>TtT6n</code> in our <code>Documents</code> folder with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">mkdir </span>TtT6n</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, directories/folders are created using the <code>mkdir</code> (make directory) command.
When used normally the command can only create folders within existing folders.
A handy flag to know is the <code>-p</code> (for <em>path</em>) flag which will instruct <code>mkdir</code> to create all parts of a path that do not yet exist in one go, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">mkdir</span> <span style="color: #000080">-p</span> TtT6n/topLevelFolder/secondLevelFolder</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since the <code>TtT6n</code> folder already existed the command will have no effect on it, however, within that folder it will first create a folder called <code>topLevelFolder</code>, and then within that folder, it will create a folder called <code>secondLevelFolder</code>.</p>
</div>
<div class="paragraph">
<p>At this stage let&#8217;s move into the TtT6n folder from where we&#8217;ll execute the remainder of our examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">cd </span>TtT6n</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can now use the <code>-R</code> (for recursive) flag for <code>ls</code> to verify that the <code>mkdir -p</code> command did what we expect it to. I like to use the <code>-F</code> flag we met before with <code>-R</code> so that folder names have a trailing <code>/</code> appended:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">ls</span> <span style="color: #000080">-RF</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When using <code>ls -R</code> the contents of each folder is separated by a blank line, and for folders deeper down than the current folder each listing is prefixed with the relative path to the folder about to be listed followed by a <code>:</code>.</p>
</div>
<div class="paragraph">
<p>In other words, we are expecting to see just a single entry in the first segment, a folder called <code>topLevelFolder</code>, then we expect to see a blank line followed by the name of the next folder to be listed, which will be the aforementioned <code>topLevelFolder</code>, followed by the listing of its contents, which is also just one folder, this time called <code>secondLevelFolder</code>.
This will then be followed by a header and listing of the contents of <code>secondLevelFolder</code>, which is currently empty.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s now create two empty files in the deepest folder within our test folder (<code>secondLevelFolder</code>).
There are many ways to create a file in Unix/Linux, but one of the simplest is to use the <code>touch</code> command. The main purpose of this command is to change the last edited date of an existing file to the current time, but if you try to <code>touch</code> a file that doesn&#8217;t exist, <code>touch</code> creates it for you:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">touch </span>topLevelFolder/secondLevelFolder/file1.txt topLevelFolder/secondLevelFolder/file2.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use <code>ls -RF</code> to verify that these files have indeed been created (you can use the <code>-lh</code> flags along with the <code>-RF</code> flags to see that the files are indeed empty&#8201;&#8212;&#8201;i.e.
0 bytes in size).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">ls</span> <span style="color: #000080">-RFlh</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_copying_filesfolders">Copying Files/Folders</h3>
<div class="paragraph">
<p>Let&#8217;s now create a second top-level folder, and copy the files to it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">mkdir </span>topLevelFolder2
<span style="color: #0086B3">cp </span>topLevelFolder/secondLevelFolder/file1.txt topLevelFolder2
<span style="color: #0086B3">cp </span>topLevelFolder/secondLevelFolder/file2.txt topLevelFolder2</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the command to copy a file is <code>cp</code>.
Here we have used <code>cp</code> in its simplest form, with just two arguments, the first being what to copy, the second being where to copy it to.
The first argument must be a file and the last a folder.</p>
</div>
<div class="paragraph">
<p>The <code>cp</code> command is a cleverer than this though&#8201;&#8212;&#8201;it can take any number of arguments greater than two. All arguments but the last one will be treated as sources, and the last one will be treated as the destination to copy all these sources to.
So, we can re-write our two <code>cp</code> commands above as simply:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">cp </span>topLevelFolder/secondLevelFolder/file1.txt topLevelFolder/secondLevelFolder/file2.txt topLevelFolder2</code></pre>
</div>
</div>
<div class="paragraph">
<p>(You can verify that the copy has worked with the <code>ls -RF</code> command.)</p>
</div>
<div class="paragraph">
<p>We can be even more efficient though&#8201;&#8212;&#8201;we can use the shell&#8217;s wild card completion functionality to simplify things even further:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">cp </span>topLevelFolder/secondLevelFolder/<span style="color: #000000;font-weight: bold">*</span>.txt topLevelFolder2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>cp</code> command will happily work with either full or relative paths.
Also, you may remember that a few instalments back I mentioned that every folder contains a file called <code>.</code> that&#8217;s a reference to the folder containing it, and that while this sounds useless, it&#8217;s actually very useful.
Well, the <code>cp</code> command provides a great example to illustrate this point.
To copy a file to the folder you are currently in, you can use <code>.</code> as the destination path.</p>
</div>
<div class="paragraph">
<p>By default, <code>cp</code> will only copy files, but, it can copy folders (and their contents) if you use the <code>-R</code> (recursive) flag.
The flag should precede the argument list.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s now create yet another empty folder and copy the folder <code>secondLevelFolder</code>, and all its contents, into the new folder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">mkdir </span>topLevelFolder3
<span style="color: #0086B3">cp</span> <span style="color: #000080">-R</span> topLevelFolder/secondLevelFolder topLevelFolder3</code></pre>
</div>
</div>
<div class="paragraph">
<p>(Again, you can use <code>ls -RF</code> to verify that the copy has worked as expected.)</p>
</div>
</div>
<div class="sect2">
<h3 id="_moving_filesfolders">Moving Files/Folders</h3>
<div class="paragraph">
<p>The <code>mv</code> (move) command works in a similar way to <code>cp</code>, but, it removes the source files and folders after it has copied them to the destination folder.
The <code>mv</code> command can move folders without needing to specify any flags.
As an example, let&#8217;s create yet another folder, and move our original <code>secondLevelFolder</code> and its contents to it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">mkdir </span>topLevelFolder4
<span style="color: #0086B3">mv </span>topLevelFolder/secondLevelFolder topLevelFolder4</code></pre>
</div>
</div>
<div class="paragraph">
<p>(Again, we can use <code>ls -RF</code> to verify that the folder and the files within it have indeed been moved.)</p>
</div>
<div class="paragraph">
<p>Users of DOS may remember that in DOS the commands to copy and move were simply <code>copy</code> and <code>move</code>, and, that there was a separate command to rename a file or folder which was simply <code>rename</code>.
Unix/Linux does not have a separate rename command, instead, you rename a file or folder by moving it from its old name to its new name.
As an example, let&#8217;s rename our first folder (<code>topLevelFolder</code>) to <code>topLevelFolder0</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">mv </span>topLevelFolder topLevelFolder0</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use a simple <code>ls</code> command to verify that the folder has indeed been renamed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_deleting_files_folders">Deleting Files &amp; folders</h3>
<div class="paragraph">
<p>Finally, I want to briefly mention the <code>rm</code> (remove) command, which can be used to delete files and/or folders.
The <code>rm</code> command simply takes the list of files to be nuked as arguments.
Unlike deleting files in the Finder, the <code>rm</code> command doesn&#8217;t have any kind of safety net&#8201;&#8212;&#8201;it does not use the recycle bin. If you mess it up, you&#8217;d better hope you have a recent backup because your files are GONE!
This is why I advise people to avoid using deleting files/folders from the command line unless you absolutely have to, or, are very comfortable on the Terminal.
It&#8217;s much safer to delete things in the Finder.
Whenever you do use the <code>rm</code> command, ALWAYS check over your command before hitting enter!
To adapt the older carpentry adage that you should <em>always measure twice and cut once</em>, my advice when using <code>rm</code> is to <em>think twice and execute once</em>.</p>
</div>
<div class="paragraph">
<p>By default, the <code>rm</code> command will only allow you to delete regular files, but if you add the <code>-r</code> flag it will delete folders and their contents too.
A great additional safety net when using <code>rm</code> either in recursive mode or with shell wild card completion is the use the <code>-i</code> flag to enter interactive mode&#8201;&#8212;&#8201;in this mode, you will be asked to confirm the deletion of each file and folder.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s end by going back up one level, and then deleting our digital playpen recursively:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">cd</span> ..
<span style="color: #0086B3">rm</span> <span style="color: #000080">-ri</span> TtT6n</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion">Conclusion</h3>
<div class="paragraph">
<p>Today we learned how to create files and folders with <code>touch</code> and <code>mkdir</code>, to copy files with <code>cp</code>, move and rename them with <code>mv</code>, and delete them with <code>rm</code>.
Next time we&#8217;ll move on to looking at how Unix/Linux/OS X handled processes.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt08">TTT Part 8 of n &#8212; Processes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For various reasons, there&#8217;s been a bit of a gap between the previous instalment and this one.
A big part of the reason is that I&#8217;d been putting off a lot of topics I wanted to talk about on Chit Chat Across the Pond until there was a logical break in this Terminal series.
Having finished with the file system at the end of part 7, I had my logical breakpoint.
Now it&#8217;s time to get stuck back in though, and start a whole new topic&#8201;&#8212;&#8201;processes.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll start with a little history for context, then have a look at the model OS X uses to represent processes and finish by looking at some commands for listing the currently-running processes on your system.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 8</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 8</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT08Processes_201509/TTT_08_Processes.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_08.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT08Processes_201509/TTT_08_Processes.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_a_little_history_for_context">A Little History for Context</h3>
<div class="paragraph">
<p>We now live in a world where multitasking is a normal and expected part of our computing experiences, be that on our servers, desktops, laptops, tablets, or phones.
Multitasking is not something that comes naturally to our computers though.
Until relatively recently, our home computers had a single CPU that could execute only a single task at a time.
Or, in computer-science-speak, our computers could only execute a single simultaneous thread of execution.
In the days of DOS that was true of the hardware as well as the software.
You booted DOS, it then handed control over to the program you launched with it, which then had full control of your computer until it exited and handed control back to DOS.
You could not run two programs at the same time.</p>
</div>
<div class="paragraph">
<p>Many of us got our first introduction to the concept of multitasking with Windows 3.1.
Windows ran on the same single-CPU hardware as DOS, so how could it do many things at once on hardware that could only do a single thing at a time?
Well, it didn&#8217;t, it just looked like it did.
Even back in the early 90s, our computers were doing millions of calculations per second, so the way Windows 3.1 did multitasking was through a software abstraction.
Every task that wanted to use the CPU was represented in software as a &#8220;process&#8221;.
This representation could store the entire CPU-state of the thread of execution, allowing Windows to play and pause it at will.
A few thousand times a second, Windows would use hardware interrupts to wrest control of the CPU from the running process, take a snap-shot of its state, save it, then load the last saved state of the next process in the queue, and let it run for a bit.
If you had 10 processes and a 1 MHz CPU, then each process got about 100,000 CPU cycles to work with per second, enough to give you the impression that all your programs were all running at the same time.</p>
</div>
<div class="paragraph">
<p>Our modern hardware can do more than one thing at once, even on many of our phones.
Firstly, modern CPUs are <em>hyper-threaded</em>. That means that they support more than one thread of execution at the same time on a single CPU (more than 1 does not mean 100s, it usually means two).
Secondly, many of our CPUs now have multiple <em>cores</em> on the same piece of silicon.
This means that they are effectively two, or even four, CPUs in one, and each one of those cores can be hyper-threaded too!
Finally, many of our computers now support multiple CPUs, so if you have four quad-core multi-threaded CPUs (like the much-loved octo-macs), you have the ability to execute 4x4x2, i.e., 32 threads, at the same time.
Mind you, your average Mac has many fewer than that; a dual-core hyper-threaded CPU is common, giving you &#8216;just&#8217; four actually simultaneous threads of execution.</p>
</div>
<div class="paragraph">
<p>Clearly, being able to run just 4 processes at the same time is just not enough, hence, even our modern computers use the same software trick as Windows 3.1 to appear to run many tens or even hundreds of processes at the same time.</p>
</div>
<div class="paragraph">
<p><!-- vale Vale.Repetition = NO --></p>
</div>
<div class="paragraph">
<p>There is literally an entire university semester of material in designing strategies for efficiently dividing up available CPU-time between processes.
All we&#8217;ll say on the topic for now, is that the OS gets to arbitrate which process gets how much time, and that that arbitration is a lot more involved than a simple queuing system.
The OS can associate priorities with processes, and it can use those priorities to give some processes preferential access over others.</p>
</div>
<div class="paragraph">
<p><!-- vale Vale.Repetition = YES --></p>
</div>
<div class="paragraph">
<p>We should also clarify that there is not a one-to-one mapping between processes and applications.
Each app does have at least one process associated with it, but once an app is running it can <em>fork</em> or <em>spawn</em> as many <em>child processes</em> as it wants/needs.
You could imagine a word processing app having one process to deal with the UI and another separate process for doing spell checking simultaneously in the background.</p>
</div>
<div class="paragraph">
<p>We should also note that on modern operating systems there are two broad classes of processes, those used by the OS to provide system services (often referred to as <em>system processes</em>), and those instigated by users to do tasks for them (often called <em>user processes</em>).
There is no fundamental difference between these two groups of processes though, it&#8217;s just a taxonomy thing really.
If you boot up your Mac and leave it at the login screen, there will already be tens of system processes running.
Exactly how many will vary from user to user depending on how many or few services are enabled.</p>
</div>
<div class="paragraph">
<p>Finally, we should note that not all running processes are represented in the UI we see in front of us.
When we launch an app there is a clear mapping between the process we started and one or more windows on our screen or icons in our menubar, but there are many processes that don&#8217;t have any windows, don&#8217;t show up in the dock, and don&#8217;t have an icon in the menubar.
These hidden processes are often referred to as <em>background processes</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_unixlinuxos_x_processes">Unix/Linux/OS X Processes</h3>
<div class="paragraph">
<p>Each running process on a Unix/Linux/OS X computer has an associated <em>process ID</em> or PID.
This is simply an integer number that the OS uses to identify the process.
The very first process (the OS kernel), gets the PID 0, and every process that starts after that gets the next free PID.
On Linux systems, the process with the PID 1 is usually <code>init</code>, which is the process Linux uses to manage system services, so the Kernel will start <code>init</code> which then starts all the other system processes.
OS X uses the same idea, but instead of using <code>init</code>, it uses something called <code>launchd</code> (the launch daemon) to manage system processes.
If your system has been running for a long time it&#8217;s normal to see PIDs with 5 digits or more.</p>
</div>
<div class="paragraph">
<p>As well as having a PID, each Linux/Unix/OS X process (except for the kernel), also has a reference to the process that started it, called a <em>Parent Process ID</em>, or a PPID.
This gives us the concept of a hierarchy of processes, with the kernel at the top of the pyramid.</p>
</div>
<div class="paragraph">
<p>As well as a PID and PPID, each process also runs as a particular user.
Whether a given file can or can&#8217;t be accessed by a given process is determined by the user the process is running as, and the permissions set on the file.</p>
</div>
<div class="paragraph">
<p>Now it&#8217;s time to open up the Terminal and get stuck in with some real-world commands.</p>
</div>
</div>
<div class="sect2">
<h3 id="_some_terminal_commands">Some Terminal Commands</h3>
<div class="paragraph">
<p>Let&#8217;s start with the most basic process-related command, <code>ps</code>, which lists running processes.
Note that <code>ps</code> is one of the few basic terminal commands that behave differently on Linux and Unix.</p>
</div>
<div class="paragraph">
<p>On a Mac, if you run the <code>ps</code> command without arguments, all that will be listed are the terminal-based processes owned by the user running the shell.
In all likelihood, all you&#8217;ll see is just a single <code>bash</code> process, which is your current shell (if you have multiple Terminal windows/tabs open you&#8217;ll probably see a <code>bash</code> processes for each one).</p>
</div>
<div class="paragraph">
<p>The columns you&#8217;ll see listed are PID (process ID), TTY (ignore this for now, it&#8217;s not really relevant on modern computers), TIME (how much CPU time the process is currently using), and CMD, the running command (including arguments if any).</p>
</div>
<div class="paragraph">
<p>Most of the time, the output of <code>ps</code> without arguments is of little to no interest. you need to use one or more arguments to get anything useful from <code>ps</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start by listing all the processes owned by a given user, regardless of whether or not they are terminal-based processes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ps <span style="color: #000080">-u</span> <span style="color: #000000;font-weight: bold">[</span>username]</code></pre>
</div>
</div>
<div class="paragraph">
<p>e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ps <span style="color: #000080">-u</span> allison</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you&#8217;re a big multitasker like me, you may be surprised by just how many processes you have spawned.
If you use Chrome as your browser you may also notice that it uses a separate process for each open tab.</p>
</div>
<div class="paragraph">
<p>Something else you&#8217;re likely to want to do is to see all current processes, regardless of who they belong to.
On Linux, we would do that with the <code>-e</code> (for everyone) flag, while on Unix we would do that with the <code>-A</code> (for ALL) flag.
OS X conveniently supports both, so just use whichever one you find easiest to remember.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ps <span style="color: #000080">-e</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ps <span style="color: #000080">-A</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>At this stage, you&#8217;ll be seeing a very long list, but for each entry, all you&#8217;re seeing is the standard four headers.
You&#8217;re viewing the list of all processes for all users, but there is no column to tell you which process belongs to which user!
For this list to be useful you need to ask <code>ps</code> to give you more information about each process.</p>
</div>
<div class="paragraph">
<p>Your first instinct might well be to try the <code>-l</code> flag in the hope that <code>ps</code> behaves like <code>ls</code>.
Give it a go:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ps <span style="color: #000080">-el</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, you now get much more information about each process, but it&#8217;s not actually particularly useful information!
While giving you too much irrelevant information, <code>-l</code> doesn&#8217;t actually give you all the information you probably do want.
For example, <code>-l</code> gives the UID number of the user who owns the process, rather than the username.</p>
</div>
<div class="paragraph">
<p>A better, though still imperfect, option is the <code>-j</code> flag (no idea what it stands for).
Try it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ps <span style="color: #000080">-ej</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This still gives you more information than you need, but it does at least give you usernames rather than UIDs.</p>
</div>
<div class="paragraph">
<p>Thankfully there is a better option, you can use the <code>-o</code> flag to specify the list of headings you want in the output from <code>ps</code>.
To see a list of all the possible headings, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ps <span style="color: #000080">-L</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To specify the headings you want, use the <code>-o</code> flag followed by a comma-separated list of headings <strong>without spaces after the commas</strong>.
In my opinion, the following gives the most useful output format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ps <span style="color: #000080">-e</span> <span style="color: #000080">-o</span> user,pid,%cpu,%mem,command</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, you can also use flags to sort the output in different ways.
Of particular use are <code>-m</code> to sort by memory usage, and <code>-r</code> to sort by CPU usage.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ps <span style="color: #000080">-er</span> <span style="color: #000080">-o</span> user,pid,%cpu,%mem,command

ps <span style="color: #000080">-em</span> <span style="color: #000080">-o</span> user,pid,%cpu,%mem,command</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ps</code> command is a good way to get an instantaneous snapshot of the processes running on your system, but usually, what you really want is a real-time sorted list of processes, and for that, we have the top command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">top</code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll now see real-time statistics on memory and CPU usage as well as a list of your top processes.
On most Linux distributions the default sorting for <code>top</code> is by CPU usage, which is actually very useful, but Apple didn&#8217;t think like that. Instead, Apple chose a default sort order of descending PID, i.e.
the most recently started processes.</p>
</div>
<div class="paragraph">
<p>You can either re-sort after starting <code>top</code> by hitting <code>o</code> and then typing something like <code>-cpu</code> (for descending CPU sorting), or <code>-vsize</code> (for descending memory usage), and hitting enter.</p>
</div>
<div class="paragraph">
<p>Or, you can pass the same arguments when starting <code>top</code> from the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">top <span style="color: #000080">-o</span> <span style="color: #000080">-cpu</span>

top <span style="color: #000080">-o</span> <span style="color: #000080">-vsize</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, to exit out of <code>top</code> just type <code>q</code>.</p>
</div>
<div class="paragraph">
<p>When looking at <code>top</code>, a very important thing to look at is the so-called <em>load averages</em>, which are shown in the metadata above the process list at the top of the <code>top</code> screen.
There will be three of them, the first is the average over the last minute, the second is the average over the last 5 minutes, and the third is the average over the last 15 minutes.
The actual definition of the load average is a bit esoteric, so we&#8217;re not going to go into it here.
What you should know is that the load average is a pretty good metric for the amount of stress a computer is under.
If any bottleneck starts to slow processes down, the result will be increased load averages.
If your CPU is stressed, load averages will go up, if you&#8217;ve run out of RAM and your system is having to do a lot of swapping, load averages will go up, if you&#8217;re doing a lot of IO and your disk is too slow to keep up, your load averages will go up.</p>
</div>
<div class="paragraph">
<p>The next obvious question is, how high a load average is too high?
A good metric is that ideally none of your load averages should cross the number of logical CPUs you have during regular user.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can find out how many effective CPUs you have with the command:</p>
</div>
<div class="paragraph">
<p><code>sysctl hw.ncpu | awk '{print $2}'</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It&#8217;s OK for the 1-minute average to cross the number of CPUs you have occasionally, but if the 15-minute average crosses the number of CPUs you have when you&#8217;re not doing something unusually stressful like transcoding video, then your computer is probably in need of an upgrade.</p>
</div>
<div class="paragraph">
<p>Clearly, <code>ps</code> and <code>top</code> can give you a lot of information about the processes that are running on your system, but they are both quite clunky because to get the most out of them you have to use a lot of flags.
On OS X, a much better choice is to use the built-in <code>Activity Monitor</code> app (<span class="menuseq"><b class="menu">Applications</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Utilities</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Activity Monitor</b></span>).
This will show you all the same information but in a nice easy-to-use GUI.
You can choose which processes you see with a drop-down at the top right of the window, and you can sort on any column by clicking on its header.</p>
</div>
<div class="paragraph">
<p>To visually see the hierarchy of processes, you can choose <code>All Processes, Hierarchically</code> from the drop-down.
Bear in mind though that this view is not good for sorting or filtering.
If you&#8217;re trying to figure out which apps are using the most CPU or RAM, it&#8217;s best to stick with the <code>All Processes</code> option.</p>
</div>
</div>
<div class="sect2">
<h3 id="_final_thoughts">Final Thoughts</h3>
<div class="paragraph">
<p>So far we&#8217;ve looked at commands for listing processes. Next time we&#8217;ll move on to commands for interacting with processes, particularly, for stopping processes that are causing problems.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt09">TTT Part 9 of n &#8212; Controlling Processes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the <a href="#ttt08">previous instalment</a>, we looked at how Unix-like operating systems such as Linux and Mac OS X represent processes.
We then went on to look at the commands for listing running processes and filtering and sorting them in various ways.
This time we&#8217;ll move on to controlling processes, specifically starting and stopping them.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 9</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 9</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT09ControllingProcesses/TTT_09_Controlling_Processes.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_09.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT09ControllingProcesses/TTT_09_Controlling_Processes.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_starting_processes">Starting Processes</h3>
<div class="paragraph">
<p>Whether or not you think of it in this way, you&#8217;re always starting processes.
Each time you launch an app, you&#8217;ve started a process.
Also, each time you issue a command on the Terminal, you&#8217;re starting a process.</p>
</div>
<div class="paragraph">
<p>So far, each time we&#8217;ve started a process from the command shell, it&#8217;s been a so-called <em>foreground process</em>.
We enter the command, this starts a new process, and that new process gets control of our terminal until it finishes, at which time we get returned to the command shell.
When we run very simple commands like <code>ps</code> or <code>ls</code>, the processes take just milliseconds to run, so we don&#8217;t really notice that we lose our prompt for a moment while the new process takes charge, does its thing, and then hands control back.</p>
</div>
<div class="paragraph">
<p>However, sometimes you want to start a process from the command shell, and not have it take control of your Terminal.
A good example might be using a command shell to start a GUI app.
You want the app to start, and to stay running, but you also want your command prompt back!
We can do this using something called a <em>background process</em>.
Should that process produce any text output, it will still show in our Terminal window, but as soon as we hit enter we&#8217;ll have our command prompt back.</p>
</div>
<div class="paragraph">
<p>Backgrounding a process is actually very easy to do, just add an <code>&amp;</code> to the end of the command, and it will start in the background!</p>
</div>
<div class="paragraph">
<p>Let&#8217;s illustrate this with a quick example.
For this to work you&#8217;ll need to be on OS X, have FireFox installed, and have it not be running when we start.</p>
</div>
<div class="paragraph">
<p>First, let&#8217;s start FireFox from the Terminal as a regular foreground process:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">/Applications/Firefox.app/Contents/MacOS/firefox-bin</code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll see that the FireFox GUI launches as normal and that it outputs some information on what it&#8217;s doing to the Terminal.
You&#8217;ll also notice that you have lost your command prompt.
You can hammer the enter key all you want, but you&#8217;re not getting that command prompt back until the FireFox process exits and hands control back to your command shell.
Go ahead and do that through the GUI as normal.
Notice how the moment FireFox quits you get your command prompt back.</p>
</div>
<div class="paragraph">
<p>Now, let&#8217;s start FireFox as a background process:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">/Applications/Firefox.app/Contents/MacOS/firefox-bin &amp;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The FireFox GUI will start just like before, and the same debugging information will be displayed in the Terminal window, but this time you just have to hit enter to get your command prompt back.
Firefox is still running, but you have your command prompt back.</p>
</div>
<div class="paragraph">
<p>If you scroll up you&#8217;ll see that the very first piece of output when you ran the command was a line consisting of a number in square brackets, followed by another number, something like: <code>[1] 1714</code></p>
</div>
<div class="paragraph">
<p>The number in square brackets is a counter for the number of background processes the current command shell is running, and the second number is the PID of the new background processes, in this case, FireFox&#8217;s PID.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can use a command prompt to quickly check your FireFox version number without even having to launch the FireFox GUI with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">/Applications/Firefox.app/Contents/MacOS/firefox-bin <span style="color: #000080">--version</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, when you launch FireFox from a command shell you can pass it flags and arguments to alter its behaviour, for a list of valid options run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">/Applications/Firefox.app/Contents/MacOS/firefox-bin <span style="color: #000080">-h</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On Unix and Linux it&#8217;s normal to launch GUI apps from the command line by backgrounding them, and as you can see, it works on the Mac too.
However, the Mac has another, better, way of opening things from the command line that other versions of Linux and Unix don&#8217;t have: the <code>open</code> command.</p>
</div>
<div class="paragraph">
<p>The best way to think of <code>open</code> is as the command-line equivalent of double-clicking something in the Finder.
When you pass <code>open</code> one or more files as arguments it will open those files using the default app for their file type. As an added bonus, it will automatically background any apps it starts, so you don&#8217;t even have to remember the <code>&amp;</code>!
Note that if you pass <code>open</code> a folder rather than a file it will open the folder in a new Finder window.</p>
</div>
<div class="paragraph">
<p>A very handy trick is to use <code>open</code> to get a Finder window showing the contents of your command shell&#8217;s present working directory as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">open .</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another useful tip is to use <code>open</code> to quickly view hidden folders in the Finder.
On recent versions of OS X, where the Library folder is hidden, I often use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">open ~/Library</code></pre>
</div>
</div>
<div class="paragraph">
<p>As well as opening things with the default app for their type, <code>open</code> can also open files or folders with any other app that supports the given type.
The <code>-a</code> flag allows you to specify the app the item should be opened with.</p>
</div>
<div class="paragraph">
<p>I do a lot of Perl programming, and I have two apps installed that I regularly use to edit Perl code.
I have OS X configured to open <code>.pl</code> and <code>.pm</code> files with <a href="https://www.activestate.com/komodo-edit">Komodo Edit</a> by default.
Komodo Edit is a nice free Perl IDE, and I do all my big programming jobs in it.
However, being a big IDE, it&#8217;s a bit of a hog&#8201;&#8212;&#8201;it takes so long to open that it has a splash screen!
So, when I just want to make a quick edit, I prefer to use the light-weight <a href="https://www.peterborgapps.com/smultron/">Smultron</a> editor instead.
I can use <code>open</code> with the <code>-a</code> flag to specify that I want my Perl file opened with Smultron using a command something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">open my_perl_file.pl <span style="color: #000080">-a</span> /Applications/Smultron<span style="color: #d14">\ </span>5.app/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, if I was using a computer that didn&#8217;t have Smultron installed I could open the Perl file with TextEdit using a command like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">open my_perl_file.pl <span style="color: #000080">-a</span> /Applications/TextEdit.app/</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s all we really need to know about starting processes, so let&#8217;s move on to ending them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ending_processes">Ending Processes</h3>
<div class="paragraph">
<p>The command to quit a process is <code>kill</code>, which sounds very draconian indeed.
Despite how scary it sounds, you don&#8217;t have to be overly afraid of it, because if used without flags, all it does is politely ask the process if it would please quit.
In other words, it&#8217;s the command-line equivalent of
 <span class="keyseq"><kbd>&#8984;</kbd>+<kbd>Q</kbd></span>
 or selecting <em>Quit</em> from an app&#8217;s menu.</p>
</div>
<div class="paragraph">
<p>The <code>kill</code> command needs at least one argument: the PID of the process you&#8217;d like to end.
This is where the <code>ps</code> and <code>top</code> commands we learned about last time come in very handy (or indeed the Activity Monitor app if you are on a Mac).
Note that you can use kill to end as many processes at once as you like; just keep adding more PIDs as arguments.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s work through another example, using FireFox again.
We&#8217;ll start by opening FireFox and backgrounding it with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">/Applications/Firefox.app/Contents/MacOS/firefox-bin &amp;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before we can quit FireFox with the <code>kill</code> command we need to know its PID.
We can either scroll up and read it from the first line of output or, we can use the <code>ps</code> command to get it.
Since we started FireFox from the terminal, it will show up when we use <code>ps</code> without any arguments at all.</p>
</div>
<div class="paragraph">
<p>Once you have the PID you can quit FireFox with (replacing <code>[the_PID]</code> with the actual PID of course):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">kill</span> <span style="color: #000000;font-weight: bold">[</span>the_PID]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see FireFox exit, and the next time you hit enter on your Terminal you should see a message telling you that a process you started and backgrounded has ended.</p>
</div>
<div class="paragraph">
<p>Finding PIDs can be a bit of a pain, so you&#8217;ll be happy to know that you don&#8217;t have to!
There is another command for ending processes that uses process names rather than PIDs, it&#8217;s the even more scary-sounding <code>killall</code> command.</p>
</div>
<div class="paragraph">
<p>For what seems like the millionth time today, let&#8217;s start FireFox and background it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">/Applications/Firefox.app/Contents/MacOS/firefox-bin &amp;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Rather than looking up its PID, let&#8217;s now exit it with the <code>killall</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">killall firefox-bin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you need to be careful with <code>killall</code> because, as its name suggests, it will kill ALL processes with a given name, not just one!</p>
</div>
</div>
<div class="sect2">
<h3 id="_dealing_with_stubborn_processes">Dealing with Stubborn Processes</h3>
<div class="paragraph">
<p>Up until now, we&#8217;ve been polite, and we&#8217;ve used <code>kill</code> and <code>killall</code> to ask processes to please quit themselves.
When an app crashes or hangs, that won&#8217;t get you very far.
If the app is so messed up it can&#8217;t deal with mouse input anymore, it&#8217;s also not going to respond when <code>kill</code> or <code>killall</code> politely ask it to stop.</p>
</div>
<div class="paragraph">
<p>When this happens, it&#8217;s time to bring out the big guns!
Both <code>kill</code> and <code>killall</code> take an optional argument <code>-KILL</code>, which tells <code>kill</code>/<code>killall</code> to instruct the OS to terminate the process, rather than asking the process to terminate itself.
<strong>ONLY DO THIS AS A LAST RESORT, YOU CAN LOSE UNSAVED DATA THIS WAY!</strong></p>
</div>
<div class="paragraph">
<p>Note that on older Unix systems <code>killall</code> didn&#8217;t exist at all, and <code>kill</code> only took numeric arguments.
The old numeric equivalent of <code>-KILL</code> is <code>-9</code>, and both <code>kill</code> and <code>killall</code> on OS X (and Linux) will accept this old-fashioned flag as well as the more modern <code>-KILL</code>.</p>
</div>
<div class="paragraph">
<p>Before we finish I want to reiterate how important it is to always try <code>kill</code> and <code>killall</code> without the <code>-KILL</code> option first.
Think of it this way, it&#8217;s basic good manners to ask the process to please leave before you call the bouncers over to eject it!</p>
</div>
</div>
<div class="sect2">
<h3 id="_next_time">Next Time &#8230;&#8203;</h3>
<div class="paragraph">
<p>We&#8217;ll be revisiting processes again later in the series, but we&#8217;re done with them for now.</p>
</div>
<div class="paragraph">
<p>In the next instalment, we&#8217;ll be taking a look at the built-in manual that comes with every Unix/Linux OS, including Mac OS X.
You don&#8217;t need a book to tell you what flags or arguments a command expects, or what exactly they mean, you can find it all out right from the command shell, even if it takes a little practice to learn to interpret the information.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt10">TTT Part 10 of n &#8212; man</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Like with so many things in tech, it doesn&#8217;t matter if you don&#8217;t know everything. What matters is that you have the skills to quickly find the information you need when you need it.
Programmers don&#8217;t memorise entire APIs, they simply learn how to search them, and how to interpret the results of their searches.</p>
</div>
<div class="paragraph">
<p>This is an area where the Linux/Unix command-line environment really shines.
All Linux &amp; Unix distributions, including OS X, have a built-in manual that allows you to quickly find the documentation you need, when you need it.
Every command-line command/program can add its documentation to the system manual.
In fact, each command/program can actually add multiple documents to the manual.
Tools that make use of configuration files will often add a separate document to describe the structure of the configuration file for example.</p>
</div>
<div class="paragraph">
<p>Every built-in command will have an entry in the manual, and any software you install via the standard package management tools for your distribution will almost certainly bundle the related manual entries as part of the package.
This is also true on OS X, where package mangers like <a href="https://www.macports.org">Mac Ports</a> will also bundle manual pages with the software they install, and even stand-alone <code>.pkg</code> installers for command-line tools will usually also install manual entries.
If you run it from the command line, the chances are very high that there will be a manual entry for it on Linux, Unix and OS X.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 10</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 10</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT10Man/TTT_10_man.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_10.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT10Man/TTT_10_man.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>I&#8217;m getting tired of typing &#8216;manual entry&#8217;, so let&#8217;s introduce a little jargon.
The command to read a manual entry is <code>man</code>, so command-line aficionados will almost always refer to manual entries simply as <em>man pages</em>. I&#8217;m going to do the same from here on.</p>
</div>
<div class="paragraph">
<p>In theory, the authors of man pages are free to write in any style they wish and to organise their pages into any structure they see fit.
Thankfully, a very strong convention has established itself, so just about every man page in existence is written in the same style and organised in approximately the same way.
Initially, you&#8217;ll find the style odd, and perhaps even off-putting, but you&#8217;ll soon get used to it.
Sadly there is no shortcut&#8201;&#8212;&#8201;the only way to get good at reading man pages, is to read man pages!</p>
</div>
<div class="sect2">
<h3 id="_navigation">Navigation</h3>
<div class="paragraph">
<p>Let&#8217;s start with the practicalities of opening, closing, and navigating a man page before we look at the structure and formatting.</p>
</div>
<div class="paragraph">
<p>To open a man page simply use the <code>man</code> command with a single argument, the name of the command or config file you would like to read the entry for.</p>
</div>
<div class="paragraph">
<p>As an example, let&#8217;s call up the documentation for the <code>ls</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">man <span style="color: #0086B3">ls</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll immediately notice that you&#8217;ve lost your command prompt, and are viewing a text document in your terminal window.
The most important thing to learn is how to exit out of the man page and get back to your command prompt.
To get out, simply hit the <kbd>q</kbd> key (for quit)!</p>
</div>
<div class="paragraph">
<p>OK, now that we know to get back out, let&#8217;s re-open the man page for <code>ls</code> and have a look around.</p>
</div>
<div class="paragraph">
<p>You can navigate up and down in a man page with the up and down arrow keys.
You can also scroll down a single line by hitting enter, or a whole page at once with the spacebar.
To scroll up a whole page at once hit <kbd>b</kbd> (for back).
You can also go back half a page with the <kbd>u</kbd> key (for up).</p>
</div>
<div class="paragraph">
<p>You can search in a document by typing <code>/</code> followed by your search pattern, and then hitting enter.
To get to the next result hit the <kbd>n</kbd> key (and to get to the previous result, <span class="keyseq"><kbd>Shift</kbd>+<kbd>n</kbd></span>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_structure">Structure</h3>
<div class="paragraph">
<p>Now that we can navigate around, let&#8217;s have a closer look at the structure of a man page.
The first thing to note is that each man page is divided into sections, which are labelled in all capitals, and their content is indented by one tab.
Sections can contain sub-sections who&#8217;s content is indented by two tabs, and so on.</p>
</div>
<div class="paragraph">
<p>Just about every man page you&#8217;ll ever see will have the following three sections:</p>
</div>
<div class="paragraph">
<p><strong>NAME</strong>&#8201;&#8212;&#8201;this will be the first section, and will simply contain the name of the thing the man page is documenting, perhaps with a very short description.
E.g.
the name section in the <code>ls</code> man page contains <code>ls -- list directory contents</code>.</p>
</div>
<div class="paragraph">
<p><strong>SYNOPSIS</strong>&#8201;&#8212;&#8201;this is a very important section and one we&#8217;ll look at in a lot more detail below.
This section uses a somewhat cryptic notation to describe the structure of the arguments a command expects.</p>
</div>
<div class="paragraph">
<p><strong>DESCRIPTION</strong>&#8201;&#8212;&#8201;this is where the main body of the documentation will be contained.
The description is usually the longest section by far, and often contains sub-sections.
This is where you expect to find a list of all the options a command accepts and a description of what they do.</p>
</div>
<div class="paragraph">
<p>Just to reiterate, there is no formal structure every man page has to follow, but there are conventions, so most man pages will contain at least some of the sections listed below, in addition to the three above.
A man page may contain custom sections though, so the list below is not exhaustive.</p>
</div>
<div class="paragraph">
<p><strong>OVERVIEW</strong>&#8201;&#8212;&#8201;very long man pages sometimes contain a one-paragraph summary of what the command does between the SYNOPSIS and DESCRIPTION sections.</p>
</div>
<div class="paragraph">
<p><strong>OPTIONS</strong>&#8201;&#8212;&#8201;more complicated commands may separate their list of command-line flags into a separate OPTIONS section immediately after the DESCRIPTION section.</p>
</div>
<div class="paragraph">
<p><strong>EXAMPLES</strong>&#8201;&#8212;&#8201;many man pages contain annotated examples of how the command being documented can be used.
If present, this is usually a very helpful section, and often worth jumping straight to.</p>
</div>
<div class="paragraph">
<p><strong>TIPS</strong>&#8201;&#8212;&#8201;some man pages use this section to offer some useful advice to users.</p>
</div>
<div class="paragraph">
<p><strong>SEE ALSO</strong>&#8201;&#8212;&#8201;this section is used to list related man pages, often describing related commands or associated configuration files.</p>
</div>
<div class="paragraph">
<p><strong>FILES</strong>&#8201;&#8212;&#8201;if a command&#8217;s function is affected by one or more configuration files, the default file system locations for these files are often listed in this section.
E.g.
the FILES section from the <code>ntpdate</code> man page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">FILES
     /etc/ntp.keys  contains the encryption keys used by ntpdate.</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>STANDARDS</strong>&#8201;&#8212;&#8201;if the command conforms to some kind of standard set out by some sort of standards authority (perhaps the IEEE or the ISO), then the relevant standards may be listed in this section.
E.g.
the STANDARDS section from the <code>ls</code> man page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">STANDARDS
	The <span style="color: #0086B3">ls </span>utility conforms to IEEE Std 1003.1-2001 <span style="color: #000000;font-weight: bold">(</span><span style="color: #d14">``</span>POSIX.1<span style="color: #d14">''</span><span style="color: #000000;font-weight: bold">)</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>DIAGNOSTICS</strong>&#8201;&#8212;&#8201;for now, you can probably ignore this section.
If it&#8217;s present it contains information that&#8217;s usually only useful when writing or debugging scripts.</p>
</div>
<div class="paragraph">
<p><strong>ENVIRONMENT</strong>&#8201;&#8212;&#8201;we haven&#8217;t discussed the command-line environment yet in this series, although it is next on the list.
For now, you can ignore this section.</p>
</div>
<div class="paragraph">
<p><strong>COMPATIBILITY</strong>&#8201;&#8212;&#8201;this section will only be present if the command has potential compatibility problems; perhaps it doesn&#8217;t quite comply with a standard or something like that.</p>
</div>
<div class="paragraph">
<p><strong>LEGACY DESCRIPTION</strong>&#8201;&#8212;&#8201;some commands have changed their behaviour over time.
This section is where the old behaviours will be documented.
This is really only useful when working with old scripts which might still be assuming the command&#8217;s old behaviour.</p>
</div>
<div class="paragraph">
<p><strong>BUGS</strong>&#8201;&#8212;&#8201;if there are known problems with the command or known conditions which cause unusual or undesirable behaviour, they may be listed in this section.</p>
</div>
<div class="paragraph">
<p><strong>HISTORY</strong>&#8201;&#8212;&#8201;this can be a fun section, and is usually very short, and details the origins of the command.
E.g.
the HISTORY section of the <code>ls</code> man page tells us that &#8220;An ls command appeared in Version 1 AT&amp;T UNIX&#8221;.</p>
</div>
<div class="paragraph">
<p><strong>AUTHOR</strong>&#8201;&#8212;&#8201;details the authors of the command being documented.</p>
</div>
<div class="paragraph">
<p><strong>COPYRIGHT</strong>&#8201;&#8212;&#8201;the copyright information for the command being documented.</p>
</div>
</div>
<div class="sect2">
<h3 id="_understanding_the_synopsis_section">Understanding the SYNOPSIS Section</h3>
<div class="paragraph">
<p>When you&#8217;re first learning about a command, the DESCRIPTION section is probably the most useful to you, but when it comes to relearning something you were once familiar with, the SYNOPSIS section is often the most useful.
Although it&#8217;s short, it&#8217;s very dense with information.
However, to be able to extract the meaning from this short section you need to understand the meaning of the formatting:</p>
</div>
<div class="paragraph">
<p><strong><code>BOLD TEXT</code></strong>&#8201;&#8212;&#8201;any text in bold should be entered verbatim</p>
</div>
<div class="paragraph">
<p><span class="underline"><code>UNDERLINED</code></span> /<code><em>ITALIC</em></code>&#8201;&#8212;&#8201;any text that is either in italics or underlined (depending on your version of man, usually underline in modern OSes) needs to be replaced with a real value as described by the text.
E.g.
<code class="underline">file</code> should be replaced with the path to an actual file.</p>
</div>
<div class="paragraph">
<p><code>&#8230;&#8203;</code>&#8201;&#8212;&#8201;anything followed by an ellipsis (three dots) can be optionally repeated</p>
</div>
<div class="paragraph">
<p><code>[]</code>&#8201;&#8212;&#8201;anything contained within square brackets is optional</p>
</div>
<div class="paragraph">
<p><code>|</code>&#8201;&#8212;&#8201;the pipe symbol should be read as &#8216;or&#8217;</p>
</div>
</div>
<div class="sect2">
<h3 id="_final_thoughts_2">Final Thoughts</h3>
<div class="paragraph">
<p>The most important thing is not to be afraid of man pages.
At first, they will seem archaic and confusing, but you&#8217;ll soon get used to their style, and you might even come to like it!
There is no substitute for practice though&#8201;&#8212;&#8201;the only way to learn to read man pages is to read man pages!</p>
</div>
<div class="paragraph">
<p>Finally, let&#8217;s end on a really bad nerd joke!</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Q: How do you know woman are more complicated than men?</p>
</div>
<div class="paragraph">
<p>A: Because you can man man, but you can&#8217;t man woman!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">$</span><span style="color: #bbbbbb"> </span>man woman
<span style="color: #888888">No manual entry for woman
</span><span style="color: #555555">$</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt11">TTT Part 11 of n &#8212; Text Files</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the next instalment we&#8217;ll be moving on to look at the so-called <em>Environment</em> within a command shell, but before we do that we need to lay some groundwork.
Specifically, we need to learn how to read and edit text files from the command line.</p>
</div>
<div class="paragraph">
<p>In this instalment, we&#8217;ll start with the most common commands for reading files, and then move on to look at the simplest of the command-line editors.
For those interested in learning a little more I&#8217;ll also give a very quick overview of one of the more powerful command-line editors, but feel free to skip over that section if you like. Future instalments won&#8217;t assume that knowledge.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 11</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 11</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT11TextFiles/TTT_11_Text_Files.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_11.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT11TextFiles/TTT_11_Text_Files.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_reading_text_files">Reading Text Files</h3>
<div class="paragraph">
<p>The simplest command for dealing with text files is <code>cat</code>.
You can use <code>cat</code> to print the contents of a text file to the screen by calling it with one argument, the path to the text file you&#8217;d like printed out.</p>
</div>
<div class="paragraph">
<p>E.g., using <code>cat</code> to read the content of your computer&#8217;s network time configuration (definitely works on OS X, should work on most other Linux and Unix distros too):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">cat</span> /etc/ntp.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>cat</code> works great for short files, but it&#8217;s not well suited for reading longer files.
For example, using cat to show the config for <code>man</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">cat</span> /etc/man.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p>While it&#8217;s useful to be able to print out the contents of a file, what would be much more useful is a command to allow us to read a file at our own pace.
In Unix-speak, what we want is a pager.</p>
</div>
<div class="paragraph">
<p>Historically the pager of choice on Unix and Linux systems was <code>more</code>.
Like <code>cat</code>, you invoke <code>more</code> by passing it a file as an argument, but unlike <code>cat</code>, after <code>more</code> has printed a screen-full of text, it will stop.
You can then use the enter key or the down arrow key to move down one line at a time, or the spacebar to move down a whole screen at a time.
E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">more /etc/man.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p>While you&#8217;ll find <code>more</code> included in just about every modern Unix or Linux OS, it&#8217;s only there for legacy reasons.
<code>more</code> has been superseded by a newer and more feature-rich pager, which is humorously called <code>less</code> (because we all know less is more).</p>
</div>
<div class="paragraph">
<p>We&#8217;re actually already familiar with <code>less</code> because it&#8217;s the pager used by the <code>man</code> command.
All the commands we learned in <a href="#ttt10">the previous instalment</a> for navigating around man pages are actually commands for navigation around text files with <code>less</code>!</p>
</div>
<div class="paragraph">
<p>The <code>less</code> command is invoked in the same way as <code>cat</code> and <code>more</code>, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">less /etc/man.conf</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>On OS X <code>less</code> has literally replaced <code>more</code>.
While there is a <code>more</code> command, it&#8217;s actually a copy of <code>less</code>, as can be seen by running: <code>more --version</code> (CentOS &amp; Ubuntu Linux still ship with both <code>more</code> and <code>less</code>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>less</code> command is very powerful, and it can deal with very large files without getting bogged down. As an example, most Linux and Unix distributions contain a dictionary file, usually located at <code>/usr/share/dict/words</code>.
This file is 235,886 lines long on OS X, and <code>less</code> has no problems searching or navigating it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">less /usr/share/dict/words</code></pre>
</div>
</div>
<div class="paragraph">
<p>While <code>less</code> is, without doubt, the best pager on modern Unix/Linux systems, and while it should be your command of choice for reading most text files, there is another pair of text-file-related commands every command-line user should know&#8201;&#8212;&#8201;<code>head</code> and <code>tail</code>.</p>
</div>
<div class="paragraph">
<p>The <code>head</code> and <code>tail</code> commands really come into their own when it comes to dealing with log files.
The <code>head</code> command will show you the first 10 lines of a file, and the <code>tail</code> command the last 10.
Simply using <code>head</code> and <code>tail</code> on a log file will quickly answer a very simple but very important question&#8201;&#8212;&#8201;what date range does my log file span?
(Note&#8201;&#8212;&#8201;Linux and most Unix users will find the system log at <code>/var/log/messages</code>, OS X is unusual in storing its system log in <code>system.log</code>)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">head</span> /var/log/system.log
<span style="color: #0086B3">tail</span> /var/log/system.log</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both <code>head</code> and <code>tail</code> can actually show any number of lines at the beginning or end of a file by using a rather strange flag, <code>-</code> followed by an integer number.
E.g.
to see the last 50 lines of the system log use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">tail</span> <span style="color: #000080">-50</span> /var/log/system.log</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, to see just the first line use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">head</span> <span style="color: #000080">-1</span> /var/log/system.log</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, the <code>tail</code> command has one more very useful trick up its sleeve, it can continue to print out new lines at the end of a file in real-time as they are added.
This is perfect for monitoring log files while you&#8217;re troubleshooting.
To enter this real-time mode invoke <code>tail</code> with the <code>-f</code> flag.
Remember that the only way out of a <code>tail -f</code> is with <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>c</kbd></span>.</p>
</div>
<div class="paragraph">
<p>You could run the command below to get a live view of the system log, but it&#8217;s hard to force log entries to appear there.
On OS X, a nice example to use is the WiFi log file.
If you run the command below in a Terminal window and then switch networks, you should see entries appear in the log file in real-time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">tail</span> <span style="color: #000080">-f</span> /var/log/wifi.log</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_editing_files_the_easy_way">Editing Files &#8212; The Easy Way</h3>
<div class="paragraph">
<p>You can roughly divide the command-line text editors into two categories, the quick and simple editors, and the power editors.
The simpler editors are much easier to learn but much less powerful.
If you spend a lot of time on the command line, learning at least one of the power editors is worth the effort in my opinion.</p>
</div>
<div class="paragraph">
<p>Anyway, let&#8217;s start simple.
There are two common, quick and simple command-line text editors, <code>pico</code> and <code>nano</code>, and the chances are very high that no matter what modern Linux or Unix OS you are using, one of these two will be available.
(OS X comes with <code>nano</code>, but like with <code>more</code>, it pretends to have <code>pico</code> too, until you run <code>pico --version</code> when it fesses up to really being <code>nano</code>.)</p>
</div>
<div class="paragraph">
<p>Once opened <code>pico</code> and <code>nano</code> are virtually indistinguishable anyway, so which you have really doesn&#8217;t matter.
If you want to edit an existing file, you invoke <code>nano</code> (or <code>pico</code>) with the path to the file you want to edit.
If you want to create a new file, you invoke <code>nano</code> with the path you&#8217;d like the new file to be created at.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s play it safe and start a new file for our experimentations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">nano ~/Documents/nanoTest.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>(On OSes other than OS X use <code>nano ~/nanoTest.txt</code> instead.)</p>
</div>
<div class="paragraph">
<p>Once in <code>nano</code>, you&#8217;ll see a cursor where you can start to type, and along the bottom a list of possible commands with their key combinations next to them (remember, <code>^</code> is short-hand for the <kbd>Ctrl</kbd> key).</p>
</div>
<div class="paragraph">
<p>Let&#8217;s keep this simple and just type the utterly clicheéd sentence:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">Hello World!</code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;re probably guessing that to save a file you&#8217;d use some kind of save option, perhaps <code>^s</code>, but that would be much too simple.
Instead, in nano-speak, you want to <em>write the file out</em>, so you use the command <code>^o</code>.
After hitting <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>o</kbd></span>, <code>nano</code> will then show you the path it&#8217;s about to write the file to (which is editable should you change your mind about the destination of your edits.) When you&#8217;re happy with the path, you hit <kbd>enter</kbd> to actually save the file.
Note that if you try to exit <code>nano</code> without writing out first, <code>nano</code> will offer to save the file for you, so you can also save with the sequence <span class="keyseq"><kbd>^</kbd>+<kbd>x</kbd></span>, <kbd>y</kbd>, <kbd>Enter</kbd>.</p>
</div>
<div class="paragraph">
<p>At this stage, you actually have all the skills you&#8217;re likely to truly need, so feel free to tune out at this point.
However, if you&#8217;re interested, I&#8217;m also going to give a very brief and very superficial overview of one of the two most popular modal editors.</p>
</div>
</div>
<div class="sect2">
<h3 id="_a_quick_taste_of_advanced_editing_with_vi_optional">A Quick Taste of Advanced Editing with vi &#8212; OPTIONAL</h3>
<div class="paragraph">
<p>There are two leviathans in the command-line text editing world, and both have been around since the 1970s.
In nerd circles, your choice of text editor is about as polarising as the Republican and Democratic political parties in the US.
You almost never meet someone who excels at both of them, and every Unix nerd has their favourite of the two.
The two editors I&#8217;m talking about are <a href="https://en.wikipedia.org/wiki/Emacs"><code>Emacs</code></a> and <a href="https://en.wikipedia.org/wiki/Vi"><code>vi</code></a>.</p>
</div>
<div class="paragraph">
<p>As it happens I&#8217;m a <code>vi</code> guy, so it&#8217;s <code>vi</code> that I&#8217;m going to give a quick overview of.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There are actually two major variants of <code>vi</code>, the original <code>vi</code> and a more powerful enhanced version called <code>vim</code>.
Some older Linux and Unix distributions ship both <code>vi</code> and <code>vim</code>, so if you&#8217;re running an older OS, always open <code>vi</code> with the command <code>vim</code>.
However, on modern distributions (including OS X), the only version of <code>vi</code> installed is <code>vim</code>, and when you run <code>vi</code> you are actually running <code>vim</code>.
If in doubt, <code>vi --version</code> will tell you whether or not <code>vi</code> is <code>vim</code> on your OS.
This overview assumes you are using <code>vim</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The single most important thing to know about <code>vi</code> is that it is modal, that means that at any given time <code>vi</code> is in one mode OR another.
Specifically, <code>vi</code> is always in either <em>insert mode</em> OR <em>command mode</em>.
In insert mode, everything you type is entered into the file where the cursor is, and in command mode, nothing you type is entered into the file, and everything you type is interpreted as a command by <code>vi</code>.
This confuses the heck out of people, and it takes some getting used to!</p>
</div>
<div class="paragraph">
<p>You invoke <code>vi</code> in the same way you would <code>nano</code>, so for our example let&#8217;s do the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">vi ~/Documents/viTest.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>(on OSes other than OS X use <code>vi ~/viTest.txt</code> instead)</p>
</div>
<div class="paragraph">
<p>When the file opens we are in command mode.
If we were editing a pre-existing file instead of creating a new one, we would be able to move the cursor around, but anything we type would be treated as a command by <code>vi</code>, not as input for the file.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start by switching from command mode into insert mode.
To do this, hit the <kbd>i</kbd> key (i for insert).
Notice that at the bottom of the screen it now says INSERT in all caps&#8201;&#8212;&#8201;you&#8217;ll always see this when you are in insert mode.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s be boring and insert the same text as before:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">Hello World!</code></pre>
</div>
</div>
<div class="paragraph">
<p>To get back out of insert mode you use the <kbd>esc</kbd> key.
You&#8217;ll see that when you hit escape the INSERT at the bottom of the screen goes away and there is actually a prompt down there for you to enter commands into.</p>
</div>
<div class="paragraph">
<p>The most important commands to know are the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>:w</code></strong>&#8201;&#8212;&#8201;write the current buffer to the file (i.e.
save your changes)</p>
</li>
<li>
<p><strong><code>:q</code></strong>&#8201;&#8212;&#8201;quit <code>vi</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can combine those commands into one, so to save and exit you would use the command <code>:wq</code>.</p>
</div>
<div class="paragraph">
<p>If you start hammering away on the keyboard in command mode, erroneously assuming you are in insert mode, it&#8217;s inevitable that you&#8217;ll accidentally invoke a command you REALLY didn&#8217;t want to invoke.
This is why the most important <code>vi</code> command to know after <code>:wq</code> is <code>:q!</code>, which is exit without saving (if you try <code>:q</code> without the <code>!</code> when there are unsaved changes <code>vi</code> won&#8217;t let you exit).</p>
</div>
<div class="paragraph">
<p>So far this all sounds needlessly complex, so let&#8217;s step things up a gear, and start to make real use of the command mode in <code>vi</code>.
Let&#8217;s start by copying a line of text, or, in <code>vi</code>-speak, let&#8217;s <em>yank</em> a line of text.</p>
</div>
<div class="paragraph">
<p>While in command mode (hit <kbd>esc</kbd> to make double-sure), move the cursor (with the arrow keys) so it&#8217;s somewhere on the line that says &#8216;Hello World!&#8217;, then type <code>yy</code>.
You have now yanked the current line.</p>
</div>
<div class="paragraph">
<p>Now that we have a line yanked, we can paste a copy of it by hitting the <kbd>p</kbd> key (for put).
You can keep hammering on the <kbd>p</kbd> key as often as you like to keep adding more copies of the line.</p>
</div>
<div class="paragraph">
<p>One of the things I like most about <code>vi</code> is that you can enter a number before many of the commands to repeat them that many times.
To put our yanked line 500 times the command is <code>500p</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say our aspirations have expanded, we&#8217;d like to greet the entire universes, not just the world!
We could make over 500 edits, or, we could ask <code>vi</code> to do a global find and replace for us with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">:%s/World/UNIVERSE</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use <code>vi</code> commands to navigate around a file.
E.g.
<code>:n</code> (where <code>n</code> is a number) will take you to the nth line.
So to get to the 25th line you would enter the command <code>:25</code>.</p>
</div>
<div class="paragraph">
<p>Similarly, <code>$</code> jumps the cursor to the end of the current line, and <code>0</code> jumps the cursor to the start of the current line.</p>
</div>
<div class="paragraph">
<p><code>vi</code> will of course also let you easily delete content.
To delete the current line just enter <code>dd</code>.
You can probably guess how to delete 400 lines in one go, it is of course <code>400dd</code>.
To delete everything from the cursor to the end of the line enter <code>D</code>, and to delete one character use <code>x</code>.</p>
</div>
<div class="paragraph">
<p>One final thing to mention in this VERY brief overview is that there are multiple ways to enter into insert mode from command mode.
We already know that <code>i</code> will start you inserting at the cursor, but it&#8217;s often useful to start inserting one character after the cursor, which you do with <code>a</code> (for append).
You can also enter insert mode on a new blank line after the line containing the cursor with <code>o</code> (for open line).
Similarly, <code>O</code> opens a new line before the line with the cursor on it.</p>
</div>
<div class="paragraph">
<p><!-- vale Vale.Repetition = NO --></p>
</div>
<div class="paragraph">
<p>This is just the tip of the <code>vi</code>-iceberg, it can do much much more.
There are literally books written about it.
However, in my opinion once you understand the modal nature of <code>vi</code>, all you really need is a good cheat sheet to help you find the commands you need until they become second nature.
(I have a printout of the first diagram on <a href="http://www.viemu.com/a_vi_vim_graphical_cheat_sheet_tutorial.html">this page</a> hanging on my wall at work).</p>
</div>
<div class="paragraph">
<p><!-- vale Vale.Repetition = YES --></p>
</div>
</div>
<div class="sect2">
<h3 id="_final_thoughts_3">Final Thoughts</h3>
<div class="paragraph">
<p>It&#8217;s very important to be able to read the content of text files from the command line, and also to be able to do at least basic edits from there.
Every command-line user needs to at least remember <code>less</code> and <code>tail -f</code>.
Every command-line user also needs to familiarise themselves with <code>pico</code>/<code>nano</code> at the very least.
If you spend a lot of time on the command line, I think it&#8217;s definitely worth investing the time to learn <code>vi</code> or <code>Emacs</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt12">TTT Part 12 of n &#8212; the Environment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Given the times we live in, the word &#8216;environment&#8217; probably invokes images of polar bears and melting ice, but the Al Gore definition of the word &#8216;environment&#8217; is a relatively recent narrow definition of a much broader word.
The first definition of the word in the OS X dictionary is:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>The surroundings or conditions in which a person, animal, or plant lives or operates.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>In this instalment, we&#8217;ll introduce a digital extension of this concept&#8201;&#8212;&#8201;the digital conditions within which a process exists, and specifically, in which a Bash command shell exists.
Although this might sound like a simple topic, there&#8217;s actually a lot to cover, so we&#8217;ll be spreading it out over a few instalments.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 12</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 12</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT12TheEnvironment/TTT_12_The_Environment.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_12.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT12TheEnvironment/TTT_12_The_Environment.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_basic_environment">The Basic Environment</h3>
<div class="paragraph">
<p>Although we&#8217;ve not used the word &#8216;environment&#8217; before, we have already discussed some elements that make up a process&#8217;s environment.
Specifically, we know that every process has a user ID associated with it (we say
that every process <em>runs as</em> a user), and we have come across the concept of the <em>present working directory</em>.
Both of these elements make up part of the basic environment that every process on your computer executes within, not just command shells.
The third major pillar in the basic environment is environment variables.
These are name-value pairs that can be accessed by running processes.</p>
</div>
<div class="paragraph">
<p>When one process starts another process, the child process inherits a <strong>copy</strong> of the parent process&#8217;s environment.
The child process runs as the same user the parent process was running as, it starts with the same present working directory, and it gets a copy of all the environment variables that existed in the parent&#8217;s environment at the moment the child was spawned.
The important thing to note is that child processes do not share a single environment with their parents, they get a duplicate that they are then free to alter without affecting the parent process&#8217;s environment.
When a child process changes its present working directory, that has no effect on the parent process&#8217;s present working directory, and similarly, when a child process changes the value stored in a given environment variable, that has no effect on the value stored in the same environment variable within the parent process&#8217;s environment.</p>
</div>
<div class="paragraph">
<p>While all processes have access to a basic environment, command shells extend this basic foundation to provide a much richer environment for their users.
Until now very little that we have looked at has been shell-specific, but that changes with this instalment.
Each command shell gets to create its own environment and to define its own mechanisms for interacting with it.
What works in Bash will not necessarily work in Ksh, Zsh, etc.
In this series we&#8217;ll only be dealing with the default command shell on most modern Unix and Linux OSes (including OS X): Bash.
Note that Bash is an extended version of SH, so what works in SH works in Bash, and much, though not all, of what works in Bash also works in SH.</p>
</div>
</div>
<div class="sect2">
<h3 id="_environment_variables">Environment Variables</h3>
<div class="paragraph">
<p>In this instalment, we&#8217;ll be focusing on Environment Variables, and specifically, how Bash interacts with them.</p>
</div>
<div class="paragraph">
<p>The command to list the names and values of all currently set environment variables is simply <code>env</code> (or <code>printenv</code> on some systems).
E.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac2013:~ bart$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">env</span>
<span style="color: #888888">TERM_PROGRAM=Apple_Terminal
SHELL=/bin/bash
TERM=xterm-256color
TMPDIR=/var/folders/_8/s3xv9qg94dl9cbrqq9x3ztwm0000gn/T/Apple_PubSub_Socket_Render=/tmp/launch-MLs1hi/Render
TERM_PROGRAM_VERSION=326
TERM_SESSION_ID=7661AF3B-0D62-435F-B880-C5428000E9D8
USER=bart
SSH_AUTH_SOCK=/tmp/launch-hwTXSO/Listeners
__CF_USER_TEXT_ENCODING=0x1F5:0:2
PATH=/opt/local/bin:/opt/local/sbin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin
__CHECKFIX1436934=1
PWD=/Users/bart
LANG=en_IE.UTF-8
SHLVL=1
HOME=/Users/bart
LOGNAME=bart
_=/usr/bin/env
</span><span style="color: #555555">bart-imac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>env</code> lists the environment variables one per line.
On each line, the name of the variable is the text before the first <code>=</code>, and the value is everything after it.</p>
</div>
<div class="paragraph">
<p>Some of these variables are purely informational, while others are used to affect how a process behaves.</p>
</div>
</div>
<div class="sect2">
<h3 id="_environment_variables_bash_shell_variables">Environment Variables &amp; Bash Shell Variables</h3>
<div class="paragraph">
<p>Bash, like every other process, has access to all the variables set within its environment.
However, Bash extends the concept and of variables into shell variables, of which the environment variables are just a subset.
Bash shell variables can be local to the shell, or can exist within the shell and the environment.
We already know that <code>env</code> lets us see all the environment variables which exist in our shell but there is another command to let us see all the variables in our shell, both those in the environment and the local ones, and that command is <code>set</code>.
To see all the shell variables that exist, call <code>set</code> with no arguments.
E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac2013:~ bart$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">set</span>
<span style="color: #888888">Apple_PubSub_Socket_Render=/tmp/launch-MLs1hi/Render
BASH=/bin/bash
BASH_ARGC=()
BASH_ARGV=()
BASH_LINENO=()
BASH_SOURCE=()
BASH_VERSINFO=([0]="3" [1]="2" [2]="51" [3]="1" [4]="release" [5]="x86_64-apple-darwin13")
BASH_VERSION='3.2.51(1)-release'
CCATP=rocks
COLUMNS=80
DIRSTACK=()
EUID=501
GROUPS=()
HISTFILE=/Users/bart/.bash_history
HISTFILESIZE=500
HISTSIZE=500
HOME=/Users/bart
HOSTNAME=bart-imac2013.localdomain
HOSTTYPE=x86_64
IFS=$' \t\n'
LANG=en_IE.UTF-8
LINES=24
LOGNAME=bart
MACHTYPE=x86_64-apple-darwin13
MAILCHECK=60
OPTERR=1
OPTIND=1
OSTYPE=darwin13
PATH=/opt/local/bin:/opt/local/sbin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin
PIPESTATUS=([0]="0")
PPID=17153
PROMPT_COMMAND='update_terminal_cwd; '
PS1='\h:\W \u\$ '
PS2='&gt; '
PS4='+ '
PWD=/Users/bart
SHELL=/bin/bash
SHELLOPTS=braceexpand:emacs:hashall:histexpand:history:interactive-comments:monitor
SHLVL=1
SSH_AUTH_SOCK=/tmp/launch-hwTXSO/Listeners
TERM=xterm-256color
TERM_PROGRAM=Apple_Terminal
TERM_PROGRAM_VERSION=326
TERM_SESSION_ID=41E9B4E3-BC9B-4FC0-B934-E2607FF6DC35
TMPDIR=/var/folders/_8/s3xv9qg94dl9cbrqq9x3ztwm0000gn/T/
UID=501
USER=bart
_=PATH
__CF_USER_TEXT_ENCODING=0x1F5:0:2
__CHECKFIX1436934=1
update_terminal_cwd ()
{
    local SEARCH=' ';
    local REPLACE='%20';
    local PWD_URL="file://$HOSTNAME${PWD//$SEARCH/$REPLACE}";
    printf '\e]7;%s\a' "$PWD_URL"
}
</span><span style="color: #555555">bart-imac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you compare the output of <code>env</code> and <code>set</code> you&#8217;ll see that every environment variable is a shell variable, but, there are many more shell variables than there are environment variables.
Remember, when a child process is created <strong>only</strong> the environment variables get copied into the child process&#8217;s environment, even if the child process is another Bash process.
Shell variables are local to a single command shell, hence they are often called local variables.</p>
</div>
<div class="paragraph">
<p>Shell variables can be used when invoking shell commands.
To access the content of a variable you use the <code>$</code> operator.
When you enter <code>$VARIABLE_NAME</code> in the shell it will be replaced with the value of the variable named <code>VARIABLE_NAME</code>.
E.g.
to change to the <code>Desktop</code> directory in your home folder you could use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">cd</span> <span style="color: #008080">$HOME</span>/Desktop</code></pre>
</div>
</div>
<div class="paragraph">
<p>or (if you have a Mac configured in the default way)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">cd</span> /Users/<span style="color: #008080">$LOGNAME</span>/Desktop</code></pre>
</div>
</div>
<div class="paragraph">
<p>Way back in the <a href="#ttt02">second instalment</a> we discussed quoting strings in the shell, and we mentioned that there was a very important difference between using double and single quotes and that it would become important later. Well, this is where that difference becomes important.
If you use the <code>$</code> operator within a string enclosed by double quotes the variable name will get replaced by the variable&#8217;s value, if you use it within a string contained within single quotes it will not!</p>
</div>
<div class="paragraph">
<p>This is why the following do work (this is an OS X-specific example):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">cd</span> <span style="color: #008080">$HOME</span>/Library/Application<span style="color: #d14">\ </span>Support
<span style="color: #0086B3">cd</span> <span style="color: #d14">"</span><span style="color: #008080">$HOME</span><span style="color: #d14">/Library/Application Support"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But the following does not:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">cd</span> <span style="color: #d14">'$HOME/Library/Application Support'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can also inhibit the <code>$</code> operator by escaping it with a <code>\</code> character.
Hence, the following has exactly the same effect as the previous command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">cd</span> <span style="color: #d14">\$</span>HOME/Library/Application<span style="color: #d14">\ </span>Support</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sometimes when we type the <code>$</code> symbol we mean the <code>$</code> operator, and sometimes we just mean the character <code>$</code>.
If we mean the character, we have to inhibit the operator either by escaping it or by using single quotes around the string containing it.
Whenever you find yourself typing the <code>$</code> character, pause and think which you mean before hitting <kbd>Enter</kbd>, and be sure you have it escaped or not as appropriate.</p>
</div>
<div class="paragraph">
<p>While we can list the values stored in all variables with <code>set</code>, it&#8217;s also helpful to know how to show the value stored in a single variable.
The easiest way to do this is to make use of the initially useless-seeming command <code>echo</code>.
All echo does is print out the argument you pass to it, so, a simple example would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">echo</span> <span style="color: #d14">'Hello World!'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This seems pretty dull, but, when you combine <code>echo</code> with the <code>$</code> operator it becomes much more useful:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">echo</span> <span style="color: #008080">$LOGNAME</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can even get a little more creative:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">echo</span> <span style="color: #d14">"I am logged in as the user </span><span style="color: #008080">$LOGNAME</span><span style="color: #d14"> with the home directory </span><span style="color: #008080">$HOME</span><span style="color: #d14">"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that we can use variables, let&#8217;s look at how we create them and alter their values.
You create variables simply by assigning them a value, and you alter their value by assigning them a new value.
The <code>=</code> operator assigns a value to a variable.
In our examples, we won&#8217;t use a variable set by the system, but we&#8217;ll create our own one called <code>MY_FIRST_VAR</code>.</p>
</div>
<div class="paragraph">
<p>Before we start, we can verify that our variable does not exist yet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">echo</span> <span style="color: #008080">$MY_FIRST_VAR</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s create our variable by giving it a value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #008080">MY_FIRST_VAR</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'Hello World!'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s verify that we did indeed initialise our new variable with the value we specified:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">echo</span> <span style="color: #008080">$MY_FIRST_VAR</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s get a little more creative and change the value stored in our variable using values stored in two variables inherited from the environment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #008080">MY_FIRST_VAR</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">"Hi, my name is </span><span style="color: #008080">$LOGNAME</span><span style="color: #d14"> and my home directory is </span><span style="color: #008080">$HOME</span><span style="color: #d14">"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Because we used double quotes, it is the value stored in the variables <code>LOGNAME</code> and <code>HOME</code> that have been stored in <code>MY_FIRST_VAR</code>, not the strings <code>$LOGNAME</code> and <code>$HOME</code>.</p>
</div>
<div class="paragraph">
<p>At this stage our new variable exists only as a local shell variable, it is not stored in our process&#8217;s environment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">env</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>export</code> command can be used to 'promote' a variable into the environment.
Simply call the command with the name of the variable to be promoted as an argument, e.g.
to push our variable to the environment use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">export </span>MY_FIRST_VAR</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can now verify that we really have pushed our new variable to the environment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">env</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_environment_variables_and_subshells_optional">Environment Variables and subshells &#8212; OPTIONAL</h4>
<div class="paragraph">
<p>As mentioned, when one process starts another, the child process inherits a copy of the parent&#8217;s environment.
If a child makes a change to an environment variable, that change is not seen by the parent.
We can illustrate this easily using what are called subshells.</p>
</div>
<div class="paragraph">
<p>When one Bash process starts another Bash process, that child process is called a subshell.
The most common way to create a subshell is by executing a shell script.
A shell script is simply a text file that contains a list of shell commands.
While we won&#8217;t be looking at shell scripting in detail until much later in this series, we&#8217;ll use some very simple shell scripts here to illustrate how child processes inherit their parent&#8217;s environment.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start by creating a very simple shell script that will print the value of an environment variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">nano ~/Documents/ttt12script1.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the following into the file and then save and exit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #999988;font-style: italic">#!/bin/bash</span>

<span style="color: #0086B3">echo</span> <span style="color: #d14">"TTT_VAR=</span><span style="color: #008080">$TTT_VAR</span><span style="color: #d14">"</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The first line of this script is called the &#8220;shebang line&#8221;, and it tells Bash what interpreter it should use to run the file.
If we were writing a Perl script instead of a Bash script we would start our file with the line:</p>
</div>
<div class="paragraph">
<p><code>#!/usr/bin/perl</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Before we can run our new script we need to make it executable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">chmod </span>755 ~/Documents/ttt12script1.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>The environment variable <code>TTT_VAR</code> does not exist yet, so running our shell script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">~/Documents/ttt12script1.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>will return:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #008080">TTT_VAR</span><span style="color: #000000;font-weight: bold">=</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can now give our variable a value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #008080">TTT_VAR</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'Hello World!'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And if we run our script again, we can see that it still does not print out the value because we have only created a local shell variable, not an environment variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #008080">TTT_VAR</span><span style="color: #000000;font-weight: bold">=</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s push our variable to the environment and run our script again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">export </span>TTT_VAR
~/Documents/ttt12script1.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>will now return</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #008080">TTT_VAR</span><span style="color: #000000;font-weight: bold">=</span>Hello World!</code></pre>
</div>
</div>
<div class="paragraph">
<p>To prove that the subshell is working on a copy of the environment variable, let&#8217;s copy our first script and create a new script that alters the value of the variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">cp</span> ~/Documents/ttt12script1.sh ~/Documents/ttt12script2.sh
nano ~/Documents/ttt12script2.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Update the new script so it contains the following code, then save and exit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="code"><pre><span style="color: #999988;font-style: italic">#!/bin/bash</span>

<span style="color: #0086B3">echo</span> <span style="color: #d14">"Initially: TTT_VAR=</span><span style="color: #008080">$TTT_VAR</span><span style="color: #d14">"</span>
<span style="color: #0086B3">echo</span> <span style="color: #d14">"Altering TTT_VAR in script"</span>
<span style="color: #008080">TTT_VAR</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'new value!'</span>
<span style="color: #0086B3">echo</span> <span style="color: #d14">"Now: TTT_VAR=</span><span style="color: #008080">$TTT_VAR</span><span style="color: #d14">"</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now run the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">echo</span> <span style="color: #008080">$TTT_VAR</span>
~/Documents/ttt12script2.sh
<span style="color: #0086B3">echo</span> <span style="color: #008080">$TTT_VAR</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You should get output that looks something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac2013:~ bart$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">echo</span> <span style="color: #008080">$TTT_VAR</span>
<span style="color: #888888">Hello World!
</span><span style="color: #555555">bart-imac2013:~ bart$</span><span style="color: #bbbbbb"> </span>~/Documents/ttt12script2.sh
<span style="color: #888888">Initially: TTT_VAR=Hello World!
Altering TTT_VAR in script
Now: TTT_VAR=new value!
</span><span style="color: #555555">bart-imac2013:~ bart$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">echo</span> <span style="color: #008080">$TTT_VAR</span>
<span style="color: #888888">Hello World!
</span><span style="color: #555555">bart-imac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the subshell inherited the value of the environment variable <code>TTT_VAR</code>, but changing it in the subshell had no effect on the value seen in the parent shell, even though it was exported to the child shell&#8217;s environment.</p>
</div>
<div class="paragraph">
<p>You might expect that this means that you can&#8217;t use scripts to build or alter your environment, but, actually, you can.
You just can&#8217;t do it by accident, you must be explicit about it and use the <code>source</code> command.
To see this in action run the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">echo</span> <span style="color: #008080">$TTT_VAR</span>
<span style="color: #0086B3">source</span> ~/Documents/ttt12script2.sh
<span style="color: #0086B3">echo</span> <span style="color: #008080">$TTT_VAR</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This should give you output something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac2013:~ bart$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">echo</span> <span style="color: #008080">$TTT_VAR</span>
<span style="color: #888888">Hello World!
</span><span style="color: #555555">bart-imac2013:~ bart$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">source</span> ~/Documents/ttt12script2.sh
<span style="color: #888888">Initially: TTT_VAR=Hello World!
Altering TTT_VAR in script
Now: TTT_VAR=new value!
</span><span style="color: #555555">bart-imac2013:~ bart$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">echo</span> <span style="color: #008080">$TTT_VAR</span>
<span style="color: #888888">new value!
</span><span style="color: #555555">bart-imac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What the <code>source</code> command does is to run each command in the shell script within the current shell&#8217;s environment, hence, all changes made within the script are made within the shell that executes the script.
As we&#8217;ll see in a future instalment, the <code>source</code> command plays a pivotal role in the initialisation of every Bash shell.</p>
</div>
</div>
<div class="sect3">
<h4 id="_conclusions">Conclusions</h4>
<div class="paragraph">
<p>In this introductory instalment, we focused mainly on how processes inherit their environment, and on the concept of shell and environment variables, in particular how they are inherited, and how they can be accessed and altered.
In the next instalment, we&#8217;ll start by focusing on one of the most important environment variables of all&#8201;&#8212;&#8201;<code>PATH</code>.
We&#8217;ll also go on to look at how a new Bash shell assembles its environment, and how to make permanent customisations to that environment, including things like customising your shell prompt and creating command shortcuts called <em>aliases</em>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt13">TTT Part 13 of n &#8212; PATH</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In <a href="#ttt12">the previous instalment</a>, we introduced the concept of the command shell environment, and we looked in detail at how shell and environment variables work.
In this instalment, we&#8217;ll focus on probably the single most important environment variable, <code>PATH</code>.
We&#8217;ll look at what it does, how it&#8217;s initialised, and, in the process, we&#8217;ll learn how to make persistent customisations to our shell environment.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 13</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 13</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT13PATH/TTT_13_PATH.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_13.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT13PATH/TTT_13_PATH.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_paths">Paths</h3>
<div class="paragraph">
<p>So far in this series I have been a little loose with the term <em>command</em>, I&#8217;ve avoided putting too fine a point on exactly what a terminal command is, but we&#8217;ll remedy that today.
If you remember right back to <a href="#ttt02">the second instalment</a>, we said that when entering commands on the command line, the first word is the command, and the other words (separated by spaces) formed the arguments to that command.
We spent a lot of time discussing the vagaries of quoting the arguments, but we didn&#8217;t discuss the command itself in any detail.</p>
</div>
<div class="paragraph">
<p>In Bash, when you enter a command, that command can actually be one of two things, a builtin Bash command, or, an executable file which Bash will execute for you.
You can see the list of builtin commands on BSD-style Unixes (including OS X) with <code>man builtin</code>.
On Linux, you need to navigate to the <code>SHELL BUILTIN COMMANDS</code> section of the VERY long Bash man page for the same information.</p>
</div>
<div class="paragraph">
<p>When you enter a command in Bash, the first thing it does is figure out whether or not the command is a builtin.
If it is a builtin then Bash just does whatever it is you asked.
Where things get interesting is when you enter a command that is not a builtin.
What Bash does then is interpret the command as a request to run an executable file with that name.
If Bash finds such a file it runs it, and if not, it gives an error like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac2013:~ bart$</span><span style="color: #bbbbbb"> </span>donky
<span style="color: #888888">-bash: donky: command not found
</span><span style="color: #555555">bart-imac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The obvious question is, how does Bash find the executable files to run?
This is where <code>PATH</code> comes in.</p>
</div>
<div class="paragraph">
<p>Before we continue, let&#8217;s print out the current value of <code>PATH</code> with the <code>echo</code> command and <code>$</code> operator we learned about in the previous instalment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">echo</span> <span style="color: #008080">$PATH</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see a value that looks something like the following (though yours may well be shorter, mine is extra long because I use <a href="https://www.macports.org">MacPorts</a> to install Linux command-line tools onto my Mac):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">/opt/local/bin:/opt/local/sbin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>The value of <code>PATH</code> is a <code>:</code> delimited ordered list of folders.</strong></p>
</div>
<div class="paragraph">
<p>Each time you enter a command that is not a builtin, what Bash does is search each of the folders listed in <code>PATH</code> in order until it finds an executable file with the name you entered.
The order is important, if two folders in your path contain files with the same names, it&#8217;s the files in the folders nearest the front of the list that will get executed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Notice that the folder <code>.</code> is not in the standard <code>PATH</code> on Unix or Linux.
This means that executable files in the present working directory are not searched.
This is different from Windows/DOS where <code>.</code> is included in the standard path.
Not including <code>.</code> in the path is a security feature, it stops malicious versions of common commands dropped into folders being inadvertently executed.</p>
</div>
<div class="paragraph">
<p>You can of course still run executable files in the present working directory on Unix/Linux, but you need to be explicit about it by prefixing the command with <code>./</code>, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">cd</span> /bin
./pwd</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>which</code> command can be used to show you which file will be executed when you use a given command, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">which bash</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The location of common commands on the file system may seem random at first, but there is a logic to it.</p>
</div>
<div class="paragraph">
<p>Firstly, commands regular users can run are usually in folders ending in <code>bin</code> (short for binary), while commands which require root/admin privileges are usually in folders ending in <code>sbin</code>.</p>
</div>
<div class="paragraph">
<p>Secondly, there is a hierarchy of importance:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Core OS commands will be in <code>/bin</code> and <code>/sbin</code>.
E.g.
<code>/bin/ls</code> &amp; <code>/bin/bash</code>, and <code>/sbin/mount</code></p>
</li>
<li>
<p>Commands that are supported as part of the OS, but not considered core are one step down the hierarchy in <code>/usr/bin</code> and <code>/usr/bin</code>.
E.g.
<code>/usr/bin/man</code>&amp; <code>/usr/bin/perl</code>, and <code>/usr/sbin/automount</code></p>
</li>
<li>
<p>Finally, third-party commands tend to show up in two distinct sets of locations, <code>/usr/local/bin</code> and <code>/usr/local/sbin</code> and/or <code>/opt/local/bin</code> and <code>/opt/local/sbin</code>.
E.g.
MacPorts installs all its binaries in <code>/opt/local/...</code>, so when I install <a href="https://www.imagemagick.org/">Image Magick</a> via MacPorts the <code>convert</code> binary is installed to <code>/opt/local/bin/convert</code>.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Something people often find confusing is that many of the builtin commands are actually executable files, as can be demonstrated with <code>which</code> (which is itself a builtin):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">which <span style="color: #0086B3">cd
</span>which <span style="color: #0086B3">pwd</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What makes these commands special is that Bash does not use <code>PATH</code> to figure out where they are, it maps to them directly, so, even if you delete your <code>PATH</code>, the builtins will continue to work.</p>
</div>
<div class="paragraph">
<p>In fact, let&#8217;s do just that (in a safe way that won&#8217;t do any harm to your computer)!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">export </span><span style="color: #008080">PATH</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">''</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We have now blanked the <code>PATH</code> environment variable in our command shell&#8201;&#8212;&#8201;note that we have ONLY altered the copy of <code>PATH</code> stored in this one command shell&#8201;&#8212;&#8201;all other command shells, including any new ones opened in the future, are totally unaffected by this change.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">cd</span> ~/Desktop
<span style="color: #0086B3">pwd</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But we can&#8217;t do things like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">ls</span> <span style="color: #000080">-alh</span>
nano testFile.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s not that the executable files have gone, or no longer work, it&#8217;s that our instance of Bash has lost the ability to find them because its <code>PATH</code> is blank.
We can still run the executables by using their full paths, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">/bin/ls <span style="color: #000080">-alh</span>
/usr/bin/nano testFile.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before we continue, let&#8217;s restore our <code>PATH</code> to its normal value by closing this command shell and opening a new one.</p>
</div>
<div class="paragraph">
<p>When you get to the stage of writing your own scripts (or downloading other people&#8217;s scripts), you&#8217;ll probably want your scripts to run without needing to give the full paths to the scripts each time.
As an example let&#8217;s create a new folder in our home directory and create a simple script within it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">mkdir</span> ~/myScripts
nano ~/myScripts/whereAmI</code></pre>
</div>
</div>
<div class="paragraph">
<p>Enter the following content into the file <code>whereAmI</code> and save:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="Perl">#!/usr/bin/perl

print "Hi $ENV{USER}, you are currently in $ENV{PWD}\n";</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the last instalment we used a Bash shell script for our example, this time, for some variety, I&#8217;m using a Perl script. The language used has no bearing on how all this works.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then make the script executable, and test it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">chmod </span>755 ~/myScripts/whereAmI
~/myScripts/whereAmI</code></pre>
</div>
</div>
<div class="paragraph">
<p>At the moment we have to enter the full path to <code>whereAmI</code> each time we want to use it. Let&#8217;s remedy that by adding our new <code>myScripts</code> folder to the end of our <code>PATH</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">export </span><span style="color: #008080">PATH</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">"</span><span style="color: #008080">$PATH</span><span style="color: #d14">:</span><span style="color: #008080">$HOME</span><span style="color: #d14">/myScripts"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note that we have to include the current value of <code>PATH</code> in the new value we set for <code>PATH</code> or we would be <em>replacing</em> the <code>PATH</code> rather than adding to it.</strong> This is a very common pitfall, and the effect would be that all non-builtin commands apart from those in the one new folder would break.
Note also that we used <code>$HOME</code> instead of <code>~</code> because you can&#8217;t use <code>~</code> in <code>PATH</code>.</p>
</div>
<div class="paragraph">
<p>Verify that <code>PATH</code> has been updated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">echo</span> <span style="color: #008080">$PATH</span>
which whereAmI</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can now use our script as a command without having to specify the full path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">whereAmI</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, close your command shell, and open a new one, and try to use your script as a command again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac2013:~ bart$</span><span style="color: #bbbbbb"> </span>whereAmI
<span style="color: #888888">-bash: whereAmI: command not found
</span><span style="color: #555555">bart-imac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Why was the command not found?
The answer is simply that the change we made to <code>PATH</code> in our previous shell&#8217;s environment vanished the moment we closed that shell.
What we need to do is make a permanent change, and to do that we need to understand how Bash initialises its environment.</p>
</div>
<div class="paragraph">
<p>When SH or Bash are initialising they start the environment building process by sourcing the file /etc/profile.
The out-of-the-box content of this file will be determined by your choice of OS.
On my Ubuntu server <code>/etc/profile</code> contains the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="code"><pre><span style="color: #999988;font-style: italic"># /etc/profile: system-wide .profile file for the Bourne shell (sh(1))</span>
<span style="color: #999988;font-style: italic"># and Bourne compatible shells (bash(1), ksh(1), ash(1), ...).</span>

<span style="color: #000000;font-weight: bold">if</span> <span style="color: #000000;font-weight: bold">[</span> <span style="color: #d14">"</span><span style="color: #008080">$PS1</span><span style="color: #d14">"</span> <span style="color: #000000;font-weight: bold">]</span><span style="background-color: #f8f8f8">;</span> <span style="color: #000000;font-weight: bold">then
  if</span> <span style="color: #000000;font-weight: bold">[</span> <span style="color: #d14">"</span><span style="color: #008080">$BASH</span><span style="color: #d14">"</span> <span style="color: #000000;font-weight: bold">]</span> <span style="color: #000000;font-weight: bold">&amp;&amp;</span> <span style="color: #000000;font-weight: bold">[</span> <span style="color: #d14">"</span><span style="color: #008080">$BASH</span><span style="color: #d14">"</span> <span style="color: #000000;font-weight: bold">!=</span> <span style="color: #d14">"/bin/sh"</span> <span style="color: #000000;font-weight: bold">]</span><span style="background-color: #f8f8f8">;</span> <span style="color: #000000;font-weight: bold">then</span>
    <span style="color: #999988;font-style: italic"># The file bash.bashrc already sets the default PS1.</span>
    <span style="color: #999988;font-style: italic"># PS1='\h:\w\$ '</span>
    <span style="color: #000000;font-weight: bold">if</span> <span style="color: #000000;font-weight: bold">[</span> <span style="color: #000080">-f</span> /etc/bash.bashrc <span style="color: #000000;font-weight: bold">]</span><span style="background-color: #f8f8f8">;</span> <span style="color: #000000;font-weight: bold">then</span>
      <span style="color: #0086B3">.</span> /etc/bash.bashrc
    <span style="color: #000000;font-weight: bold">fi
  else
    if</span> <span style="color: #000000;font-weight: bold">[</span> <span style="color: #d14">"</span><span style="color: #d14">`</span><span style="color: #0086B3">id</span> <span style="color: #000080">-u</span><span style="color: #d14">`</span><span style="color: #d14">"</span> <span style="color: #000080">-eq</span> 0 <span style="color: #000000;font-weight: bold">]</span><span style="background-color: #f8f8f8">;</span> <span style="color: #000000;font-weight: bold">then
      </span><span style="color: #008080">PS1</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'# '</span>
    <span style="color: #000000;font-weight: bold">else
      </span><span style="color: #008080">PS1</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'$ '</span>
    <span style="color: #000000;font-weight: bold">fi
  fi
fi</span>

<span style="color: #999988;font-style: italic"># The default umask is now handled by pam_umask.</span>
<span style="color: #999988;font-style: italic"># See pam_umask(8) and /etc/login.defs.</span>

<span style="color: #000000;font-weight: bold">if</span> <span style="color: #000000;font-weight: bold">[</span> <span style="color: #000080">-d</span> /etc/profile.d <span style="color: #000000;font-weight: bold">]</span><span style="background-color: #f8f8f8">;</span> <span style="color: #000000;font-weight: bold">then
  for </span>i <span style="color: #000000;font-weight: bold">in</span> /etc/profile.d/<span style="color: #000000;font-weight: bold">*</span>.sh<span style="background-color: #f8f8f8">;</span> <span style="color: #000000;font-weight: bold">do
    if</span> <span style="color: #000000;font-weight: bold">[</span> <span style="color: #000080">-r</span> <span style="color: #008080">$i</span> <span style="color: #000000;font-weight: bold">]</span><span style="background-color: #f8f8f8">;</span> <span style="color: #000000;font-weight: bold">then</span>
      <span style="color: #0086B3">.</span> <span style="color: #008080">$i</span>
    <span style="color: #000000;font-weight: bold">fi
  done
  </span><span style="color: #0086B3">unset </span>i
<span style="color: #000000;font-weight: bold">fi</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>While OS X comes with a much shorter and easier to understand <code>/etc/profile</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span style="color: #999988;font-style: italic"># System-wide .profile for sh(1)</span>

<span style="color: #000000;font-weight: bold">if</span> <span style="color: #000000;font-weight: bold">[</span> <span style="color: #000080">-x</span> /usr/libexec/path_helper <span style="color: #000000;font-weight: bold">]</span><span style="background-color: #f8f8f8">;</span> <span style="color: #000000;font-weight: bold">then
	</span><span style="color: #0086B3">eval</span> <span style="color: #d14">`</span>/usr/libexec/path_helper <span style="color: #000080">-s</span><span style="color: #d14">`</span>
<span style="color: #000000;font-weight: bold">fi

if</span> <span style="color: #000000;font-weight: bold">[</span> <span style="color: #d14">"</span><span style="color: #000000;font-weight: bold">${</span><span style="color: #008080">BASH</span><span style="background-color: #f8f8f8">-no</span><span style="color: #000000;font-weight: bold">}</span><span style="color: #d14">"</span> <span style="color: #000000;font-weight: bold">!=</span> <span style="color: #d14">"no"</span> <span style="color: #000000;font-weight: bold">]</span><span style="background-color: #f8f8f8">;</span> <span style="color: #000000;font-weight: bold">then</span>
	<span style="color: #000000;font-weight: bold">[</span> <span style="color: #000080">-r</span> /etc/bashrc <span style="color: #000000;font-weight: bold">]</span> <span style="color: #000000;font-weight: bold">&amp;&amp;</span> <span style="color: #0086B3">.</span> /etc/bashrc
<span style="color: #000000;font-weight: bold">fi</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this series we are focusing on OS X, so we&#8217;ll only look at how OS X initialises its Environment in detail.</p>
</div>
<div class="paragraph">
<p>What the above OS X /etc/profile does is two things:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>assuming it exists and is executable, it loads the output of <code>/usr/libexec/path_helper</code> into its environment</p>
</li>
<li>
<p>if the process starting up is a Bash process (rather than an SH process), it executes <code>/etc/bashrc</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As you might guess from the name, <code>path_helper</code> is a utility for constructing the default path.
You can run it yourself to see what it produces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">/usr/libexec/path_helper</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you&#8217;re curious, you can learn how it builds the path by reading the relevant man page with <code>man path_helper</code>.
The skinny version is that it reads the system-wide default path from <code>/etc/paths</code>, and then adds any extra paths defined in files contained in the folder <code>/etc/paths.d</code>.
To have a look at the default paths you can use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">cat</span> /etc/paths
<span style="color: #0086B3">cat</span> /etc/paths.d/<span style="color: #000000;font-weight: bold">*</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>(On a default OS X install the last command will fail because there are no files present in <code>/etc/paths.d</code> by default)</p>
</div>
<div class="paragraph">
<p>If we wanted to add our new scripts folder to the default path for all users on the system we could edit <code>/etc/paths</code>, or add a new file with the path or our scripts folder in <code>/etc/paths.d</code>, but don&#8217;t do that!
These system-level paths should only be used for system-level things, as we&#8217;ll see shortly, there is a better way to make user-specific customisations.</p>
</div>
<div class="paragraph">
<p>For completeness, let&#8217;s have a look at <code>/etc/bashrc</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="code"><pre><span style="color: #999988;font-style: italic"># System-wide .bashrc file for interactive bash(1) shells.</span>
<span style="color: #000000;font-weight: bold">if</span> <span style="color: #000000;font-weight: bold">[</span> <span style="color: #000080">-z</span> <span style="color: #d14">"</span><span style="color: #008080">$PS1</span><span style="color: #d14">"</span> <span style="color: #000000;font-weight: bold">]</span><span style="background-color: #f8f8f8">;</span> <span style="color: #000000;font-weight: bold">then
   return
fi

</span><span style="color: #008080">PS1</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'\h:\W \u\$ '</span>
<span style="color: #999988;font-style: italic"># Make bash check its window size after a process completes</span>
<span style="color: #0086B3">shopt</span> <span style="color: #000080">-s</span> checkwinsize
<span style="color: #999988;font-style: italic"># Tell the terminal about the working directory at each prompt.</span>
<span style="color: #000000;font-weight: bold">if</span> <span style="color: #000000;font-weight: bold">[</span> <span style="color: #d14">"</span><span style="color: #008080">$TERM_PROGRAM</span><span style="color: #d14">"</span> <span style="color: #000000;font-weight: bold">==</span> <span style="color: #d14">"Apple_Terminal"</span> <span style="color: #000000;font-weight: bold">]</span> <span style="color: #000000;font-weight: bold">&amp;&amp;</span> <span style="color: #000000;font-weight: bold">[</span> <span style="color: #000080">-z</span> <span style="color: #d14">"</span><span style="color: #008080">$INSIDE_EMACS</span><span style="color: #d14">"</span> <span style="color: #000000;font-weight: bold">]</span><span style="background-color: #f8f8f8">;</span> <span style="color: #000000;font-weight: bold">then
    </span>update_terminal_cwd<span style="color: #000000;font-weight: bold">()</span> <span style="color: #000000;font-weight: bold">{</span>
        <span style="color: #999988;font-style: italic"># Identify the directory using a "file:" scheme URL,</span>
        <span style="color: #999988;font-style: italic"># including the host name to disambiguate local vs.</span>
        <span style="color: #999988;font-style: italic"># remote connections. Percent-escape spaces.</span>
	<span style="color: #0086B3">local </span><span style="color: #008080">SEARCH</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">' '</span>
	<span style="color: #0086B3">local </span><span style="color: #008080">REPLACE</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'%20'</span>
	<span style="color: #0086B3">local </span><span style="color: #008080">PWD_URL</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">"file://</span><span style="color: #008080">$HOSTNAME</span><span style="color: #000000;font-weight: bold">${</span><span style="color: #008080">PWD</span><span style="background-color: #f8f8f8">//</span><span style="color: #008080">$SEARCH</span><span style="background-color: #f8f8f8">/</span><span style="color: #008080">$REPLACE</span><span style="color: #000000;font-weight: bold">}</span><span style="color: #d14">"</span>
	<span style="color: #0086B3">printf</span> <span style="color: #d14">'\e]7;%s\a'</span> <span style="color: #d14">"</span><span style="color: #008080">$PWD_URL</span><span style="color: #d14">"</span>
    <span style="color: #000000;font-weight: bold">}</span>
    <span style="color: #008080">PROMPT_COMMAND</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">"update_terminal_cwd; </span><span style="color: #008080">$PROMPT_COMMAND</span><span style="color: #d14">"</span>
<span style="color: #000000;font-weight: bold">fi</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>What&#8217;s going on here is mostly OS X-specific customisations to Bash.
The Ubuntu equivalent to this file is <code>/etc/bash.bashrc</code>, and just like with <code>/etc/profile</code>, the contents of the file is completely different to what you get on OS X.</p>
</div>
<div class="paragraph">
<p>There is really only one line in this file that I want to draw your attention to, and then, only as a preview of the next instalment.
The line in questions is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #008080">PS1</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'\h:\W \u\$ '</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It looks like gobbledegook, but, it&#8217;s actually the line that sets the format of the command prompt.
<code>\h</code> is the hostname, <code>\W</code> is the current folder, and <code>\u</code> the current user.
You should recognise that as the format of the command prompt in your OS X Terminal windows.
We&#8217;ll look at this in more detail next time.</p>
</div>
<div class="paragraph">
<p>So far there are two files doing the customisation of Bash for us, <code>/etc/profile</code> and <code>/etc/bashrc</code>.
These are both system files, and if you try to edit them as a regular user you&#8217;ll find you don&#8217;t have permission:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac2013:~ bart$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">ls</span> <span style="color: #000080">-l</span> /etc/profile /etc/bashrc
<span style="color: #888888">-r--r--r--  1 root  wheel  745 10 Nov 18:55 /etc/bashrc
-r--r--r--  1 root  wheel  189 10 Nov 18:55 /etc/profile
</span><span style="color: #555555">bart-imac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s with good reason that you don&#8217;t have editing rights to these files&#8201;&#8212;&#8201;you could do serious damage to your system if you make a mistake in these files.
Unless you really know what you are doing, never edit either of them!</p>
</div>
<div class="paragraph">
<p>The system-level configuration files are only the first half of Bash&#8217;s startup procedure. When a new Bash process has finished running those files, it moves on to a new phase where it checks the user&#8217;s home directory for certain specially-named files.</p>
</div>
<div class="paragraph">
<p>For reasons we won&#8217;t go into now, if you&#8217;re a Linux user the user-level file to create/edit is <code>~/.bashrc</code>, while Mac users should create/edit <code>~/.bash_profile</code>. (If you really care about why there is a difference, you can have a read of <a href="http://www.joshstaiger.org/archives/2005/07/bash_profile_vs.html">this short article</a>).</p>
</div>
<div class="paragraph">
<p>So, any customisations we wish to make to Bash on our Macs should be made in <code>~/.bash_profile</code>.
Let&#8217;s go ahead and set a custom <code>PATH</code> that includes the folder we created earlier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">nano ~/.bash_profile</code></pre>
</div>
</div>
<div class="paragraph">
<p>Enter the following and save the file (BE CAREFUL TO GET IT RIGHT):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #999988;font-style: italic"># print warning message (leave out the echo lines if you prefer)</span>
<span style="color: #0086B3">echo</span> <span style="color: #d14">"NOTE - applying customisations in ~/.bash_profile"</span>
<span style="color: #0086B3">echo</span> <span style="color: #d14">"       If you make a mistake and need to remove the customisations"</span>
<span style="color: #0086B3">echo</span> <span style="color: #d14">"       execute the following then restart your Terminal:"</span>
<span style="color: #0086B3">echo</span> <span style="color: #d14">"       /bin/mv ~/.bash_profile ~/bash_profile.disabled"</span>

<span style="color: #999988;font-style: italic"># update the path</span>
<span style="color: #0086B3">export </span><span style="color: #008080">PATH</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">"</span><span style="color: #008080">$PATH</span><span style="color: #d14">:</span><span style="color: #008080">$HOME</span><span style="color: #d14">/myScripts"</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that any line in a shell script starting with a <code>#</code> is a comment, so it is ignored by the computer and there purely for your information.
Also, note that the <code>echo</code> lines are there only as a helpful hint in case you make a mistake and break your <code>PATH</code>.
The command simply renames <code>~/.bash_profile</code> to <code>~/bash_profile.disabled</code>, hence disabling it, and, because the new name does not start with a <code>.</code>, making it visible in the Finder should you want to delete or edit it easily.
You can test any changes you make to try to fix whatever problem you were having by editing the file and then running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">source</span> ~/bash_profile.disabled</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you&#8217;re happy you&#8217;ve fixed the problem you can move it back into place with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">mv</span> ~/bash_profile.disabled ~/.bash_profile</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To test your newly customised environment simply open a new Terminal.
If you&#8217;ve done everything right you should see the warning message telling you <code>~/.bash_profile</code> has been executed, and, your path should have been updated to include <code>~/myScripts</code>.
You can verify this by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">echo</span> <span style="color: #008080">$PATH</span>
whereAmI</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should use <code>~/.bash_profile</code> to make all your Bash customisations, not just customisations to your <code>PATH</code>.
In the next instalment, we&#8217;ll have a look at some of the other customisations you might like to configure in your <code>~/.bash_profile</code> file.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt14">TTT Part 14 of n &#8212; Aliases &amp; Prompts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In <a href="#ttt13">the previous instalment</a>, we looked at how to make permanent changes to our environment.
We made a permanent change to the <code>PATH</code> environment variable to demonstrate how it&#8217;s done
(by editing <code>~/.bash_profile</code> on a Mac,
or <code>~/.bashrc</code> on Linux).
In this instalment we&#8217;ll look at two other kinds of environment changes you may wish to make by editing these files&#8201;&#8212;&#8201;specifically, aliases, and custom prompts.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 14</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 14</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT14AliasesAndPrompts/TTT_14_Aliases_and_Prompts.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_14.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT14AliasesAndPrompts/TTT_14_Aliases_and_Prompts.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_aliases">Aliases</h3>
<div class="paragraph">
<p>Aliases are basically command shortcuts.
When used as a command, the alias gets expanded to a longer string by Bash before execution.
Aliases can contain arguments as well as commands.
Aliases can be used to create short mnemonics for long complex commands or to add default arguments to existing commands.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start with an example of the first kind.
The command <code>ls -l</code> often results in very long output, so it would be nice to be able to automatically run this output through a pager so we can see it one page at a time instead of having to scroll back up to find the start of the output.
As we&#8217;ll learn in the next instalment, you can do this using the <code>|</code> (pronounced &#8216;pipe&#8217;) operator.
To run the output of <code>ls -l</code> through <code>less</code> the command is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">ls</span> <span style="color: #000080">-l</span> | less</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s create a short alias for this command, <code>ll</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">alias </span><span style="color: #008080">ll</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'ls -l | less'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, you create an alias using the <code>alias</code> command.
The bit before the <code>=</code> is the shortcut, and the bit after the <code>=</code> is what it will expand into.
If the expansion contains spaces or other special characters then either the entire replacement needs to be quoted, or each special character needs to be escaped.
The vast majority of aliases you create will contain spaces and/or at least one special character, so it&#8217;s best to get into the habit of always quoting your aliases.
In the above example, both the spaces and the <code>|</code> would need to be escaped, so the un-quoted version of the above alias would be the following difficult to read mess:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">alias </span><span style="color: #008080">ll</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #0086B3">ls</span><span style="color: #d14">\ </span><span style="color: #000080">-l</span><span style="color: #d14">\ \|\ </span>less</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another common use of aliases is to add default arguments to existing commands.
Let&#8217;s look at two common examples of this.</p>
</div>
<div class="paragraph">
<p>By default, the <code>ls</code> command does not clearly distinguish the types of the items it lists.
<code>ls -F</code> makes things quite a bit clearer by adding a trailing <code>/</code> to all folders in the listing, and <code>-G</code> makes things even clearer still by using colours to distinguish different types of files (remember that on Linux it&#8217;s <code>--color</code> rather than <code>-G</code>).
To have <code>ls</code> always show trailing slashes and use colours we can alias <code>ls</code> to <code>ls -FG</code> (or <code>ls -F --color</code> on Linux):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">alias ls</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'ls -FG'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Secondly, we can use aliases to make commands that might unintentionally remove or override files behave in a safer manner by automatically adding the <code>-i</code> flag to <code>rm</code>, <code>cp</code> &amp; <code>mv</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">alias rm</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'rm -i'</span> <span style="color: #0086B3">cp</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'cp -i'</span> <span style="color: #0086B3">mv</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'mv -i'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can use the <code>alias</code> command to add multiple aliases at once.
If you set these aliases then <code>rm</code>, <code>cp</code>, and <code>mv</code> will ask for your permission before deleting or overriding a file.
If you&#8217;re manipulating many files at once this will get tedious, so remember that even if you do this, you can over-ride the <code>-i</code> by adding a <code>-f</code> (for force) to the commands.
This means you have to be explicit about deleting or overriding files, instead of the commands implicitly assuming you are happy to have the files destroyed.</p>
</div>
<div class="paragraph">
<p>To see a list of all currently defined aliases, simply run the <code>alias</code> command without any arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span style="color: #555555">bart-imac2013:~ bart$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">alias</span>
<span style="color: #888888">alias cp='cp -i'
alias ll='ls -l | less'
alias ls='ls -FG'
alias mv='mv -i'
alias rm='rm -i'
</span><span style="color: #555555">bart-imac2013:~ bart$</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>To remove an alias, use the <code>unalias</code> command with the shortcut to be removed as an argument.
E.g.
to remove our <code>ll</code> alias, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">unalias </span>ll</code></pre>
</div>
</div>
<div class="paragraph">
<p>Aliases are part of the Bash environment and are not persistent.
If you create an alias and then close your command shell it will be gone.
To make aliases permanent we need to add them into our Bash startup scripts.
As we learned in the previous instalment, for Mac users that means adding our aliases to <code>~/.bash_profile</code>, while Linux users should add their aliases to <code>~/.bashrc</code>.</p>
</div>
<div class="paragraph">
<p>If we include the examples from the previous instalment an updated <code>~/.bash_profile</code> file to include the <code>ll</code> alias would look something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
</pre></td><td class="code"><pre><span style="color: #999988;font-style: italic"># print warning message (leave out the echo lines if you prefer)</span>
<span style="color: #0086B3">echo</span> <span style="color: #d14">"NOTE – applying customisations in ~/.bash_profile"</span>
<span style="color: #0086B3">echo</span> <span style="color: #d14">" If you make a mistake and need to remove the customisations"</span>
<span style="color: #0086B3">echo</span> <span style="color: #d14">" execute the following then restart your Terminal:"</span>
<span style="color: #0086B3">echo</span> <span style="color: #d14">" /bin/mv ~/.bash_profile ~/bash_profile.disabled"</span>

<span style="color: #999988;font-style: italic"># update the path</span>
<span style="color: #0086B3">export </span><span style="color: #008080">PATH</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">"</span><span style="color: #008080">$PATH</span><span style="color: #d14">:</span><span style="color: #008080">$HOME</span><span style="color: #d14">/myScripts"</span>

<span style="color: #999988;font-style: italic"># create our aliases</span>
<span style="color: #0086B3">alias </span><span style="color: #008080">ll</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'ls -l | less'</span>
<span style="color: #0086B3">alias ls</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'ls -FG'</span>
<span style="color: #0086B3">alias rm</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'rm -i'</span> <span style="color: #0086B3">cp</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'cp -i'</span> <span style="color: #0086B3">mv</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'mv -i'</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_customising_the_bashprompt">Customising the BashPrompt</h3>
<div class="paragraph">
<p>As we discussed right back in the first instalment, the format of your command prompt varies from system to system.
This variation is not just between command shells, but also within command shells, because many allow customisations to the format of the prompt.
Bash is one of the command shells that support command prompt customisation.</p>
</div>
<div class="paragraph">
<p>In BASH, the format of the prompt is defined in the shell variable <code>PS1</code>.
You can see the current format used with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">echo</span> <span style="color: #008080">$PS1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On OS X the default value of <code>PS1</code> is <code>\h:\W \u\$</code>, giving prompts that look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On the RedHat and CentOS variants of Linus the default is <code>[\u@\h \W]\$</code>, which give prompts that look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">[bart@www ~]$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>From the above, you should be able to deduce that any letter in the code prefixed with a <code>\</code> is replaced with a value.
Below is a list of some of the variables at your disposal:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>\h</code>&#8201;&#8212;&#8201;your computer&#8217;s hostname (e.g.
<code>bart-imac2013</code>)</p>
</li>
<li>
<p><code>\H</code>&#8201;&#8212;&#8201;your computer&#8217;s FQDN, or fully qualified domain name (e.g.
<code>bart-imac2013.localdomain</code>)</p>
</li>
<li>
<p><code>\d</code>&#8201;&#8212;&#8201;the current date</p>
</li>
<li>
<p><code>\t</code>&#8201;&#8212;&#8201;the current time in 24 hour HH:MM:SS format</p>
</li>
<li>
<p><code>\T</code>&#8201;&#8212;&#8201;the current time in 12 hour HH:MM:SS format</p>
</li>
<li>
<p><code>\@</code>&#8201;&#8212;&#8201;the current time in 12 hour am/pm format</p>
</li>
<li>
<p><code>\A</code>&#8201;&#8212;&#8201;the current time in 24-hour HH:MM format</p>
</li>
<li>
<p><code>\u</code>&#8201;&#8212;&#8201;the username of the current user</p>
</li>
<li>
<p><code>\w</code>&#8201;&#8212;&#8201;the complete path of the present working directory (<code>$HOME</code> abbreviated to <code>~</code>)</p>
</li>
<li>
<p><code>\W</code>&#8201;&#8212;&#8201;the current folder, i.e.
the last part of the print working directory (<code>$HOME</code> abbreviated to <code>~</code>)</p>
</li>
<li>
<p><code>\$</code>&#8201;&#8212;&#8201;if running as root a <code>#</code> symbol, otherwise, a <code>$</code> symbol</p>
</li>
<li>
<p><code>\n</code>&#8201;&#8212;&#8201;a new line (yes, your prompt can span multiple lines if you like)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As an example, let&#8217;s create a very descriptive Bash prompt:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #008080">PS1</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'\d \t - \u@\H:\w\n\$ '</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Like with any shell variable, any changes we made to <code>PS1</code> are confined to our current command shell.
Opening a new Terminal window will restore <code>PS1</code> to its default value.
If we want to make the change permanent, we need to add it to our bash startup file (<code>~/.bash_profile</code> on OS X or <code>~/.bashrc</code> on Linux).</p>
</div>
<div class="paragraph">
<p>A <code>~/.bash_profile</code> file setting all the customisations we&#8217;ve discussed in this instalment and the previous instalment would look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre><span style="color: #999988;font-style: italic"># print warning message (leave out the echo lines if you prefer)</span>
<span style="color: #0086B3">echo</span> <span style="color: #d14">"NOTE – applying customisations in ~/.bash_profile"</span>
<span style="color: #0086B3">echo</span> <span style="color: #d14">" If you make a mistake and need to remove the customisations"</span>
<span style="color: #0086B3">echo</span> <span style="color: #d14">" execute the following then restart your Terminal:"</span>
<span style="color: #0086B3">echo</span> <span style="color: #d14">" /bin/mv ~/.bash_profile ~/bash_profile.disabled"</span>

<span style="color: #999988;font-style: italic"># update the path</span>
<span style="color: #0086B3">export </span><span style="color: #008080">PATH</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">"</span><span style="color: #008080">$PATH</span><span style="color: #d14">:</span><span style="color: #008080">$HOME</span><span style="color: #d14">/myScripts"</span>

<span style="color: #999988;font-style: italic"># create our aliases</span>
<span style="color: #0086B3">alias </span><span style="color: #008080">ll</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'ls -l | less'</span>
<span style="color: #0086B3">alias ls</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'ls -FG'</span>
<span style="color: #0086B3">alias rm</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'rm -i'</span> <span style="color: #0086B3">cp</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'cp -i'</span> <span style="color: #0086B3">mv</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'mv -i'</span>

<span style="color: #999988;font-style: italic"># set a custom prompt</span>
<span style="color: #008080">PS1</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'\d \t – \u@\H:\w\n\$ '</span><span style="background-color: #f8f8f8">;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Personally, I like to keep my prompts set to their default values&#8201;&#8212;&#8201;it helps me recognise the OS I&#8217;m on at a glance.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conclusions_2">Conclusions</h3>
<div class="paragraph">
<p>Over the past few instalments, we have looked at what the shell environment is, how we can manipulate shell and environment variables and aliases.
We looked at two variables in particular, <code>PATH</code> and <code>PS1</code>.
We also discussed Bash aliases, and how to make permanent changes to your Bash environment, allowing you to customise your PATH and prompt and define aliases.</p>
</div>
<div class="paragraph">
<p>This is where we&#8217;ll leave the concept of the environment for now.
In the next instalment, we&#8217;ll move on to look at what I jokingly call &#8216;plumbing&#8217;&#8201;&#8212;&#8201;how commands can be chained together, and how files can be used for input to and output from commands.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt15">TTT Part 15 of n &#8212; 'Plumbing'</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Right back in the very <a href="#ttt01">first instalment</a>, we described the Unix philosophy as being Lego-like,
that is, having lots of simple commands that do one thing well, and then assembling them together to do something really powerful.</p>
</div>
<div class="paragraph">
<p>So far, we&#8217;ve only been working with a single command at a time, but that changes with this instalment.
We&#8217;ll be introducing the concept of streams, which can be used to connect commands and files together.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 15</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 15</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT15Plumbing/TTT_15_Plumbing.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_15.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT15Plumbing/TTT_15_Plumbing.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_streams">Streams</h3>
<div class="paragraph">
<p>Before we can get into the nitty-gritty of chaining commands together, we need to introduce a new concept, that of a stream of data.
Quite simply, a stream is a sequential flow of data&#8201;&#8212;&#8201;everything that goes in one end comes out the other, and it always comes out in the same order it went in.</p>
</div>
<div class="paragraph">
<p>In a Unix/Linux environment there are three standard streams:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>STDOUT</code> (Standard Out):</strong> when working on the command line this stream is usually connected to the terminal&#8201;&#8212;&#8201;anything written to that stream is printed in the terminal window.
Within applications, this stream is usually connected to a log file.</p>
</li>
<li>
<p><strong><code>STDERR</code> (Standard Error):</strong> this is another output stream, but one reserved for error messages.
When working at the command line, this stream is usually also connected to the terminal in the same way that <code>STDOUT</code> is.
Within applications, this stream is usually connected to a log file, though often a different log file to <code>STDOUT</code>.</p>
</li>
<li>
<p><strong><code>STDIN</code> (Standard In):</strong> this stream is used for input rather than output.
When working at the command line, it is usually connected to the keyboard.
Within applications, this stream could be attached to anything really.
E.g.
within a web server it is connected to the HTTP request data sent to the server by the browser.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Many Unix/Linux commands can take their input from <code>STDIN</code>, and just about every command will write its output to <code>STDOUT</code> and/or <code>STDERR</code>.
This allows commands to be strung together by the simple act of redirecting these streams&#8201;&#8212;&#8201;if you redirect the output of one command to the input of another, you have chained them together!</p>
</div>
<div class="paragraph">
<p>Remember that every process has its own environment, and therefore, its own version of the three standard streams.
The redirection operators alter the copies of these three variables within individual processes, so, from the command&#8217;s point of view, it always reads from <code>STDIN</code>, and always writes to <code>STDOUT</code> and/or <code>STDERR</code>, but where those streams flow to is determined by their environment.</p>
</div>
</div>
<div class="sect2">
<h3 id="_stream_redirection">Stream Redirection</h3>
<div class="paragraph">
<p>Bash provides a number of stream redirection operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>|</code> (the &#8216;pipe&#8217; operator)</strong>&#8201;&#8212;&#8201;this operator connects <code>STDOUT</code> in the environment of the command to its left to <code>STDIN</code> in the environment of the command to its right.</p>
</li>
<li>
<p><strong><code>&gt;</code> and <code>&gt;&gt;</code></strong>&#8201;&#8212;&#8201;these operators connect <code>STDOUT</code> in the environment of the command to their left to a file at the path specified to their right</p>
</li>
<li>
<p><strong><code>&lt;</code></strong>&#8201;&#8212;&#8201;this operator connects the contents of the file at the path specified to its right to <code>STDIN</code> in the environment of the command to its left</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>|</code> operator is probably the most used of the three, as it allows straight-forward command chaining.
It&#8217;s also the simplest.
For that reason we&#8217;re going to focus solely on the <code>|</code> operator in this instalment, leaving the file-related operators until the next instalment.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_operator_in_action">The <code>|</code> Operator in Action</h3>
<div class="paragraph">
<p>To facilitate an example, let&#8217;s introduce a simple command for counting words, characters, or lines&#8201;&#8212;&#8201;<code>wc</code> (word count).</p>
</div>
<div class="paragraph">
<p>A quick look at the man page for <code>wc</code> shows that it counts lines when used with the <code>-l</code> flag.
Something else you might notice is that the command OPTIONALLY takes an argument of one or more file paths as input.
This means we can count the number of lines in the standard Unix/Linus hosts file with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">wc</span> <span style="color: #000080">-l</span> /etc/hosts</code></pre>
</div>
</div>
<div class="paragraph">
<p>But why is the list of file paths optional?
What could the command possibly count if you don&#8217;t point it at a file?
The answer can be found further down in the man page:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>The <code>wc</code> utility displays the number of lines, words, and bytes contained in each input file, or standard input (if no file is specified) to the standard output.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>In other words, <code>wc</code> will read its input from <code>STDIN</code> if no file is specified, and, no matter what the input source, it will write its results to <code>STDOUT</code>.</p>
</div>
<div class="paragraph">
<p>Now that you know about the three standard streams, you&#8217;ll start to see them in man pages all over the place.
E.g., you&#8217;ll find the following in the man page for <code>ls</code>:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>By default, <code>ls</code> lists one entry per line to standard output;
the exceptions are to terminals or when the <code>-C</code> or <code>-x</code> options are specified.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s combine our knowledge of <code>ls</code>, <code>wc</code>, streams, and stream redirection to build a command to determine how many files or folders there are on our Desktop:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">ls</span> <span style="color: #000080">-l</span> ~/Desktop | <span style="color: #0086B3">wc</span> <span style="color: #000080">-l</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>NOTE</strong>&#8201;&#8212;&#8201;the <code>|</code> operator ONLY redirects <code>STDOUT</code> to <code>STDIN</code>, it has no effect on <code>STDERR</code>, so if there is an error generated by the <code>ls</code> command that error message will go to the screen, and not to the <code>wc</code> command.
To illustrate this point, let&#8217;s try to count the number of files in a folder that does not exist:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">ls</span> <span style="color: #000080">-l</span> ~/DesktopDONKEY | <span style="color: #0086B3">wc</span> <span style="color: #000080">-l</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We see the error message generated by <code>ls</code> on the screen, and it is one line long, but, <code>wc</code> never saw that line because it was printed to <code>STDERR</code>, so instead of saying there is 1 file in this fictitious folder, it tells us, correctly, that there are no files in that folder.</p>
</div>
</div>
<div class="sect2">
<h3 id="_special_stream_files">Special Stream Files</h3>
<div class="paragraph">
<p>You&#8217;ll often hear Unix nerds tell you that in Unix, everything is a stream.
This is because deep down, Unix (and Linux) treat files as streams.
This is especially true of some special files which really are streams of data rather than pointers to data on a hard disk.
Special files of this type have a <code>c</code> (for character special file, i.e.
a character stream) as the first letter in their permission mask in the output of <code>ls -l</code>.
E.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">ls</span> <span style="color: #000080">-l</span> /dev/null</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are many such files in <code>/dev/</code> on a Unix/Linux machine, but it is a VERY bad idea to write to or read from any you don&#8217;t understand.
These files are generally connected directly to some piece of hardware in your system, including low-level access to your hard drives, so you could destroy important data very easily. (Thankfully you need to be root to write to the hard drive connected &#8216;files&#8217;).</p>
</div>
<div class="paragraph">
<p>There are a few safe special files that I want to mention though:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>/dev/null</code></strong>: this is effectively a black hole&#8201;&#8212;&#8201;you use this file to redirect the output into oblivion.
(More on this in the next instalment.)</p>
</li>
<li>
<p><strong><code>/dev/random</code> or <code>/dev/urandom</code></strong>: both of these streams output random data 8 bytes at a time.
The difference between the two is that <code>/dev/random</code> does not care how much entropy the OS has built up (i.e.
how good the randomness is), it will output what it has, while <code>/dev/urandom</code> will pause output when the level of entropy gets too low, and only resume when the entropy pool has built up again.
In other words, <code>/dev/random</code> promises speed, but not quality, while <code>/dev/urandom</code> promises quality but not speed.</p>
</li>
<li>
<p><code>/dev/zero</code>: this stream outputs a constant flow of zeros.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As an example, let&#8217;s use <code>/dev/urandom</code> to generate 10 random characters.</p>
</div>
<div class="paragraph">
<p>Before we can begin there are two complications that we need to understand.
Firstly, these special streams have no beginning or end, so we have to be sure to always read from then in a controlled way&#8201;&#8212;&#8201;if you ask a command like <code>cat</code> to print out the contents of such a file it will never stop, because cat continues until it reaches the end of file marker, and these special &#8216;files&#8217; have no end!
Also, <code>/dev/urandom</code> does not output text characters, it outputs binary data, and while some combinations of binary data map to characters on our keyboards, most don&#8217;t, so we will need to convert this stream of binary data into a stream of text characters.</p>
</div>
<div class="paragraph">
<p>We can overcome the first of these limitations by using the <code>head</code> command we met in <a href="#ttt11">part 11 of this series</a>.
Previously we&#8217;ve used <code>head</code> to show us the first n lines of a file, but we can use the <code>-c</code> flag to request a specific number of characters rather than lines.</p>
</div>
<div class="paragraph">
<p>The second problem can be overcome with the <code>base64</code> command, which converts binary data to text characters using the <a href="https://en.wikipedia.org/wiki/Base64">Base64 encoding algorithm</a>.
A quick look at the man page for <code>base64</code> shows that it can use streams as well as files:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>With no options, <code>base64</code> reads raw data from <code>stdin</code> and writes encoded data as a continuous block to <code>stdout</code>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>putting it all this together we can assemble the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">head</span> <span style="color: #000080">-c</span> 10 /dev/random | <span style="color: #0086B3">base64</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is nearly perfect, but, you&#8217;ll notice that the output always ends with <code>==</code>, this is the Base64 code for &#8216;end of input&#8217;.
We can chop that off by piping our output through <code>head</code> one more time to return only the first 10 characters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">head</span> <span style="color: #000080">-c</span> 10 /dev/random | <span style="color: #0086B3">base64</span> | <span style="color: #0086B3">head</span> <span style="color: #000080">-c</span> 10</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will print only the 10 random characters, and nothing more.
Since this command does not print a newline character, it leaves the text stuck to the front of your prompt which is messy.
To get around this you can run <code>echo</code> with no arguments straight after the above command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">head</span> <span style="color: #000080">-c</span> 10 /dev/random | <span style="color: #0086B3">base64</span> | <span style="color: #0086B3">head</span> <span style="color: #000080">-c</span> 10<span style="background-color: #f8f8f8">;</span> <span style="color: #0086B3">echo</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note we are NOT piping the output to <code>echo</code>, the symbol used is <code>;</code>, which is the command separator, it denotes the end of the previous command and the start of the next one, allowing multiple separate commands to be written on one line.
The commands will be executed in order, one after the other.</p>
</div>
<div class="paragraph">
<p>Finally, because we need to use the same number of characters in both <code>head</code> commands, we could use command-line variables to make this command more generic and to make it easier to customise the number of characters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #008080">N</span><span style="color: #000000;font-weight: bold">=</span>10<span style="background-color: #f8f8f8">;</span> <span style="color: #0086B3">head</span> <span style="color: #000080">-c</span> <span style="color: #008080">$N</span> /dev/random | <span style="color: #0086B3">base64</span> | <span style="color: #0086B3">head</span> <span style="color: #000080">-c</span> <span style="color: #008080">$N</span><span style="background-color: #f8f8f8">;</span> <span style="color: #0086B3">echo</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusions_3">Conclusions</h3>
<div class="paragraph">
<p>In this instalment, we have introduced the concept of streams, particularly the three standard streams provided by the environment, <code>STDOUT</code>, <code>STDERR</code>, and <code>STDIN</code>.
We&#8217;ve seen that these streams can be redirected using a set of operators and that this redirection provides a mechanism for chaining commands together to form more complex and powerful commands.
We&#8217;ve been introduced to the concept of using files as input and output, but have not looked at that in detail yet.
We&#8217;ve also not yet looked at merging streams together, or independently redirecting <code>STDOUT</code> and <code>STDERR</code> to separate destinations&#8201;&#8212;&#8201;this is what&#8217;s on the agenda for the next instalment.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt16">TTT Part 16 of n &#8212; Crossing the Streams</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In <a href="#ttt15">the previous instalment</a>, we introduced the concepts of streams and looked at how every process has references to three streams as part of their environment&#8201;&#8212;&#8201;<code>STDIN</code>, <code>STDOUT</code> &amp; <code>STDERR</code>.
We went on to introduce the concept of operators that manipulate these streams, and we focused on the so-called &#8216;pipe&#8217; operator which connects <code>STDOUT</code> in one process to <code>STDIN</code> in another, allowing commands to be chained together to perform more complex tasks.
We mentioned the existence of operators for connecting streams to files, and the possibility of streams being merged together, but didn&#8217;t go into any detail.
Well, that&#8217;s what we&#8217;ll be doing in this instalment.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 16</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 16</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT16CrossingTheStreams/TTT_16_Crossing_the_Streams.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_16.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT16CrossingTheStreams/TTT_16_Crossing_the_Streams.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_turning_files_into_streams">Turning Files into Streams</h3>
<div class="paragraph">
<p>So far we&#8217;ve been redirecting the output of one command to the input of another, but we can also use files as the source of our streams using the <code>&lt;</code> operator.
The operator works by connecting the content of the file to the right of the operator to <code>STDIN</code> in the command to the left of the operator.</p>
</div>
<div class="paragraph">
<p>As an example, let&#8217;s use the <code>wc</code> command we learned about in the previous instalment to count the number of lines in the standard Unix/Linux hosts file again, but this time, we&#8217;ll use the <code>&lt;</code> operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">wc</span> <span style="color: #000080">-l</span> &lt; /etc/hosts</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because the <code>wc</code> command can take its input either from <code>STDIN</code> or from one or more files passed as arguments, the above command achieves the same things as the command we saw in the previous instalment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">wc</span> <span style="color: #000080">-l</span> /etc/hosts</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>wc</code> command is not in any way unusual in this, the vast majority of Unix/Linux commands which operate on text or binary data can accept that data either from <code>STDIN</code> or from a file path passed as an argument.
For example, all the following commands we have met before can take their input from <code>STDIN</code> rather than by specifying a file path as an argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">less &lt; /etc/hosts
<span style="color: #0086B3">cat</span> &lt; /etc/hosts
<span style="color: #0086B3">head</span> <span style="color: #000080">-3</span> &lt; /etc/hosts</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s easier to just pass paths as arguments through, hence the <code>&lt;</code> operator is probably the least-used of the stream redirection operators.
However, just because it&#8217;s the least-used, doesn&#8217;t mean it&#8217;s never needed!
There are some commands that will only accept input via <code>STDIN</code>, and for such commands, it&#8217;s vital to have an understanding of the <code>&lt;</code> operator in your command-line toolkit.
In my professional life, the one example I meet regularly is the <code>mysql</code> command, which does not take a file path as an argument (Note that MySQL is not installed by default on OS X).
To load an SQL file into a MySQL database from the command line you have to do something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">mysql <span style="color: #000080">-h</span> db_server <span style="color: #000080">-u</span> db_username <span style="color: #000080">-p</span> db_name &lt; sql_file.sql</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sending_streams_to_a_file">Sending Streams to a File</h3>
<div class="paragraph">
<p>While you&#8217;re not likely to find yourself using files as input streams very often, you are quite likely to find yourself using files as output streams.
There are two operators which perform this task, and the difference between them is subtle but very important.</p>
</div>
<div class="paragraph">
<p>The first of these operators is <code>&gt;</code>.
This operator directs the output from the command to its left to a <strong>NEW</strong> file at the path specified to its right.
If a file already exists at the specified path, it will be <strong>REPLACED</strong>.
This means that after the command finishes the file will only contain the output from that one command execution.
Because of this overwriting behaviour, always use the <code>&gt;</code> operator with great care!</p>
</div>
<div class="paragraph">
<p>The second of the file output operators is <code>&gt;&gt;</code>.
This operates in a very similar way to <code>&gt;</code>, directing the output of the command to its left to the file specified to its right, but with one very important difference&#8201;&#8212;&#8201;if a file already exists at the specified path it will not be replaced, instead, the new output will be appended to the end of the file.
This makes the <code>&gt;&gt;</code> operator much safer, but, it means you cannot easily see which content in the file came from the latest execution of the command.</p>
</div>
<div class="paragraph">
<p>As a practical example, let&#8217;s revisit our command for generating random characters from the previous instalment, but this time, rather than outputting the random characters to the terminal, we&#8217;ll send them to a file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #008080">N</span><span style="color: #000000;font-weight: bold">=</span>256
<span style="color: #0086B3">head</span> <span style="color: #000080">-c</span> <span style="color: #008080">$N</span> /dev/random | <span style="color: #0086B3">base64</span> | <span style="color: #0086B3">head</span> <span style="color: #000080">-c</span> <span style="color: #008080">$N</span> <span style="color: #000000;font-weight: bold">&gt;</span> random.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can verify that we have generated 256 random characters by using the <code>wc</code> command with the <code>-c</code> flag to get it to count characters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">wc</span> <span style="color: #000080">-c</span> random.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we re-run the command we can verify that the file still only contains 256 characters because the original version of the file was simply replaced by a new version because we used the <code>&gt;</code> operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">head</span> <span style="color: #000080">-c</span> <span style="color: #008080">$N</span> /dev/random | <span style="color: #0086B3">base64</span> | <span style="color: #0086B3">head</span> <span style="color: #000080">-c</span> <span style="color: #008080">$N</span> <span style="color: #000000;font-weight: bold">&gt;</span> random.txt
<span style="color: #0086B3">wc</span> <span style="color: #000080">-c</span> random.txt
<span style="color: #0086B3">head</span> <span style="color: #000080">-c</span> <span style="color: #008080">$N</span> /dev/random | <span style="color: #0086B3">base64</span> | <span style="color: #0086B3">head</span> <span style="color: #000080">-c</span> <span style="color: #008080">$N</span> <span style="color: #000000;font-weight: bold">&gt;</span> random.txt
<span style="color: #0086B3">wc</span> <span style="color: #000080">-c</span> random.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s change things up and generate 8 random characters at a time, but append them to a file with the <code>&gt;&gt;</code> operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #008080">N</span><span style="color: #000000;font-weight: bold">=</span>8
<span style="color: #0086B3">head</span> <span style="color: #000080">-c</span> <span style="color: #008080">$N</span> /dev/random | <span style="color: #0086B3">base64</span> | <span style="color: #0086B3">head</span> <span style="color: #000080">-c</span> <span style="color: #008080">$N</span> <span style="color: #000000;font-weight: bold">&gt;&gt;</span> randomAccumulator.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>As before we can verify the amount of characters in the file using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">wc</span> <span style="color: #000080">-c</span> randomAccumulator.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, each time we repeat the command we will add 8 more characters to the file rather than replacing its contents each time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">head</span> <span style="color: #000080">-c</span> <span style="color: #008080">$N</span> /dev/random | <span style="color: #0086B3">base64</span> | <span style="color: #0086B3">head</span> <span style="color: #000080">-c</span> <span style="color: #008080">$N</span> <span style="color: #000000;font-weight: bold">&gt;&gt;</span> randomAccumulator.txt
<span style="color: #0086B3">wc</span> <span style="color: #000080">-c</span> randomAccumulator.txt
<span style="color: #0086B3">head</span> <span style="color: #000080">-c</span> <span style="color: #008080">$N</span> /dev/random | <span style="color: #0086B3">base64</span> | <span style="color: #0086B3">head</span> <span style="color: #000080">-c</span> <span style="color: #008080">$N</span> <span style="color: #000000;font-weight: bold">&gt;&gt;</span> randomAccumulator.txt
<span style="color: #0086B3">wc</span> <span style="color: #000080">-c</span> randomAccumulator.txt</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_redirecting_streams_other_than_stdin_stdout">Redirecting Streams Other Than <code>STDIN</code> &amp; <code>STDOUT</code></h3>
<div class="paragraph">
<p>So far we have always operated on <code>STDIN</code> and <code>STDOUT</code>.
This is true for our use of all four of the operators we&#8217;ve met so far (<code>|</code>, <code>&lt;</code>, <code>&gt;</code> &amp; <code>&gt;&gt;</code>).
However, there is often a need to control other streams, particularly <code>STDERR</code>.</p>
</div>
<div class="paragraph">
<p>Unfortunately, we now have no choice but to take a look at some rather deep Unix/Linux internals.
We&#8217;ve already learned that each process has a reference to three streams within its environment which we&#8217;ve been calling by their Englishy names <code>STDIN</code>, <code>STDOUT</code> &amp; <code>STDERR</code>.
We now need to remove this abstraction.
What the process&#8217;s environment actually contains is something called a &#8220;File Descriptor Table&#8221;, which contains a numbered table of streams.
Three of these streams are created by default, and always present, but processes can add as many more streams as they wish.
Within the file descriptor table, all streams are referenced by number, rather than with nice Englishy names, and the numbers start counting from zero.
To make use of the file descriptor table, we need to know the following mappings:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">File Descriptor</th>
<th class="tableblock halign-left valign-top">Maps to</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STDIN</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STDOUT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STDERR</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If we were to define our own streams, the first stream we defined would get the file descriptor <code>3</code>, the next one <code>4</code> and so on.
We are not going to be defining our own streams in this series, so all we have to remember is the contents of the small table above.</p>
</div>
<div class="paragraph">
<p>We can use the numbers in the file descriptor table in conjunction with the <code>&lt;</code>, <code>&gt;</code> &amp; <code>&gt;&gt;</code> operators to specify which streams the files should be connected to.
For example, we could re-write the examples from today as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">wc</span> <span style="color: #000080">-l</span> 0&lt; /etc/hosts
<span style="color: #0086B3">head</span> <span style="color: #000080">-c</span> <span style="color: #008080">$N</span> /dev/random | <span style="color: #0086B3">base64</span> | <span style="color: #0086B3">head</span> <span style="color: #000080">-c</span> <span style="color: #008080">$N</span> 1&gt; random.txt
<span style="color: #0086B3">head</span> <span style="color: #000080">-c</span> <span style="color: #008080">$N</span> /dev/random | <span style="color: #0086B3">base64</span> | <span style="color: #0086B3">head</span> <span style="color: #000080">-c</span> <span style="color: #008080">$N</span> 1&gt;&gt; randomAccumulator.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since these operators use <code>0</code> and <code>1</code> by default, you&#8217;d never write the above commands with the <code>0</code>s and <code>1</code>s included, but, you have to use the file descriptor table to redirect <code>STDERR</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s revisit the command we used to intentionally trigger output to <code>STDERR</code> in the previous instalment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">ls</span> <span style="color: #000080">-l</span> ~/DesktopDONKEY | <span style="color: #0086B3">wc</span> <span style="color: #000080">-l</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This command tries to count the files in a non-existent folder.
Because the folder does not exist, the <code>ls</code> command writes nothing to <code>STDOUT</code>.
Because the <code>|</code> only operates on <code>STDOUT</code> the <code>wc</code> command counts zero lines, and the error message which was written to <code>STDERR</code> is printed to the screen.
We could now redirect the error message to a file as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">ls</span> <span style="color: #000080">-l</span> ~/DesktopDONKEY 2&gt; error.txt | <span style="color: #0086B3">wc</span> <span style="color: #000080">-l</span>
<span style="color: #0086B3">cat </span>error.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that we have to redirect <code>STDERR</code> before the <code>|</code> operator, otherwise we would be redirecting <code>STDERR</code> from the <code>wc</code> command rather than the <code>ls</code> command.</p>
</div>
</div>
<div class="sect2">
<h3 id="_multiple_redirects">Multiple Redirects</h3>
<div class="paragraph">
<p>You can use multiple redirects in the one command.
For example, you could use one redirect to send data from a file to a command, and another redirect the send the output to a different file.
This is not something you&#8217;ll see very often, but again, it&#8217;s something MySQL command-line users will know well, where this is a common construct:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">mysql <span style="color: #000080">-h</span> db_server <span style="color: #000080">-u</span> db_username <span style="color: #000080">-p</span> db_name &lt; query.sql <span style="color: #000000;font-weight: bold">&gt;</span> query_result.tab</code></pre>
</div>
</div>
<div class="paragraph">
<p>You might also want to send <code>STDOUT</code> to one file, and <code>STDERR</code> to a different file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">ls</span> <span style="color: #000080">-l</span> ~/DesktopDONKEY 2&gt; error.txt | <span style="color: #0086B3">wc</span> <span style="color: #000080">-l</span> <span style="color: #000000;font-weight: bold">&gt;</span> fileCount.txt</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_crossing_the_streams">Crossing the Streams</h3>
<div class="paragraph">
<p>Unlike in the Ghostbusters universe, in the Unix/Linux universe, it&#8217;s often desirable to cross the streams&#8201;&#8212;&#8201;i.e.
to merge two streams together.
The most common reason to do this is to gather all output, regular and error, into a single stream for writing to a file.
The way this is usually done is to divert <code>STDERR</code> to <code>STDOUT</code> and then redirect <code>STDOUT</code> to a file.</p>
</div>
<div class="paragraph">
<p>In order to construct a meaningful example, let&#8217;s preview a command we&#8217;re going to be returning to in great detail in a future instalment, the <code>find</code> command.
This command often writes to both <code>STDOUT</code> and <code>STDERR</code> during normal operation.</p>
</div>
<div class="paragraph">
<p>As its name suggests, the <code>find</code> command can be used to search for files that meet certain criteria.
If you run the command as a regular user and ask it to search your entire hard drive or a system folder, it will run into a lot of permission errors interspersed with the regular output as the OS prevents it from searching some protected system folders.
As a simple example, let&#8217;s use find to search for <code>.pkg</code> files in the system library folder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find /Library <span style="color: #000080">-name</span> <span style="color: #000000;font-weight: bold">*</span>.pkg</code></pre>
</div>
</div>
<div class="paragraph">
<p>Almost straight away you&#8217;ll see a mix of permission errors and files with the <code>.pkg</code> extension.
The key point is that there is a mix of errors and results.
If we try to capture all the output with the command below we&#8217;ll see that the error messages are not sent to the file, instead, they are sent to our screen (as expected):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find /Library <span style="color: #000080">-name</span> <span style="color: #000000;font-weight: bold">*</span>.pkg <span style="color: #000000;font-weight: bold">&gt;</span> findOutput.txt
<span style="color: #0086B3">cat </span>findOutput.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we&#8217;ve just learned, we could send the errors to one file and the files to another with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find /Library <span style="color: #000080">-name</span> <span style="color: #000000;font-weight: bold">*</span>.pkg <span style="color: #000000;font-weight: bold">&gt;</span> findOutput.txt 2&gt; findErrors.txt
<span style="color: #0086B3">cat </span>findOutput.txt
<span style="color: #0086B3">cat </span>findErrors.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>But how could we capture all the output together?</p>
</div>
<div class="paragraph">
<p>To do this we need to introduce one more operator, the <code>&amp;</code> operator.
This operator allows a file descriptor table entry to be used in place of a file path by the <code>&lt;</code>, <code>&gt;</code> &amp; <code>&gt;&gt;</code> operator.
Hence, we can redirect <code>STDERR</code> (<code>2</code>) to <code>STDOUT</code> (<code>1</code>) as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find /Library <span style="color: #000080">-name</span> <span style="color: #000000;font-weight: bold">*</span>.pkg 2&gt;&amp;1</code></pre>
</div>
</div>
<div class="paragraph">
<p>This has no noticeable effect until you send <code>STDOUT</code> to a file, then you can see that we have indeed diverted <code>STDERR</code> to <code>STDOUT</code>, and the combined stream to a file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find /Library <span style="color: #000080">-name</span> <span style="color: #000000;font-weight: bold">*</span>.pkg <span style="color: #000000;font-weight: bold">&gt;</span> findCombinedOutput.txt 2&gt;&amp;1
<span style="color: #0086B3">cat </span>findCombinedOutput.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>IMPORTANT:</strong> notice the counter-intuitive ordering of the above command, although the redirect happens first, it MUST be specified at the end of the command or it will not work.</p>
</div>
<div class="paragraph">
<p><!-- vale Vale.Repetition = NO --></p>
</div>
<div class="paragraph">
<p>There is much much more than can be done with streams, but, this is all most people are likely to need in their day-to-day life on the command line, so we&#8217;ll stop here before we confuse everyone too much 🙂</p>
</div>
<div class="paragraph">
<p><!-- vale Vale.Repetition = YES --></p>
</div>
</div>
<div class="sect2">
<h3 id="_conclusions_4">Conclusions</h3>
<div class="paragraph">
<p>We have now seen how streams, and a process&#8217;s file descriptor table, can be manipulated using the stream redirection commands to chain commands together and funnel input and output to and from files in a very flexible way.
This ability to manipulate streams opens up a whole new world to us, allowing us to build up complex commands from simple commands.
This ability to chain commands is a pre-requisite for our next topic&#8201;&#8212;&#8201;searching at the command line.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt17">TTT Part 17 of n &#8212; Regular Expressions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This instalment is the start of a series of instalments relating to searching from the command line.
Searching is all about patterns, and that means getting to grips with Regular Expressions (also called RegExps, RegExes or REs for short).
Regular Expressions are languages for representing patterns and are used throughout Information Technology, not just on the command line.
While this series focuses on the Terminal, an understanding of regular expressions will be helpful in many other places, from programming languages to GUI apps like programming editors, search utilities or file renamers.</p>
</div>
<div class="paragraph">
<p>It&#8217;s going to take us two instalments to properly describe regular expressions, but when we&#8217;re done we&#8217;ll have gained a very useful skill.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 17</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 17</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT17RegularExpressions/TTT_17_Regular_Expressions.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_17.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT17RegularExpressions/TTT_17_Regular_Expressions.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_what_are_regular_expressions">What Are Regular Expressions?</h3>
<div class="paragraph">
<p>If you want to get scientific about it, regular expressions are languages for describing regular grammars, which are the simplest type of grammar in the <a href="https://en.wikipedia.org/wiki/Chomsky_hierarchy">Chomsky Hierarchy</a>.
You could easily dedicate an entire university-level course to explaining the meaning and importance of that last sentence, and in fact, if you take a degree in Computer Science, you will!
However, that&#8217;s not much use to us for the purpose of this series.
In effect, what it means is that regular expressions provide a means for representing patterns that can be described as a series of elements following one after the other.
That means regular expressions can do a lot. They can find all currency amounts in a document (a currency symbol followed by either an integer or a decimal number), they can find percentages (an integer or decimal number followed by a percentage symbol), they can find temperatures (an integer or decimal number followed by a <code>C</code>, <code>F</code>, or <code>K</code>), and so on.
That includes quite complex things like recognising URLs, which could be described something like:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>A valid URL consists of a protocol specifier followed by the colon symbol, then two forward slashes, then a domain name, then, optionally, a port number, then optionally a path starting with a /, then, optionally an anchor starting with a pound/hash symbol, and then finally an optional query string starting with a question mark symbol.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>That description is actually incomplete because you would need to describe what some of those parts mean in more detail before you could write a regular expression for them, but that&#8217;s no problem because those parts too can be described as a series of elements following each other.
For example, you&#8217;d have to further break down the domain name part into something like:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>A domain name consists of one or more segments separated by a period symbol.
Each segment can only contain letters, digits, and dashes, and must start with a letter or a digit.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The key point is that if you can describe a pattern as a series of elements that follow one after the other, then you should be able to write a regular expression to represent that pattern.</p>
</div>
<div class="paragraph">
<p>So, regular expressions are without a doubt powerful, but, they are not all-powerful&#8201;&#8212;&#8201;there are entire classes of problems regular expressions are powerless to help with.
In fact, to get scientific again for a moment, there are three entire grammar classes in the Chomsky Hierarchy that REs are powerless to help with.
In practical terms that means that REs can&#8217;t help when some kind of memory is needed to know what has gone before, or when the elements in the pattern can be arbitrarily ordered and/or nested.
For example, it would be impossible to write a regular expression to test if an arbitrary piece of text contained a matched set of arbitrarily nested brackets, because, to know if a given closing bracket is or is not valid, you need to know how many opening brackets have proceeded it.
Also, REs can&#8217;t be used to validate something like XML (or HTML for that matter), because tags can come in any order, and be validly nested in all sorts of different ways.</p>
</div>
<div class="paragraph">
<p>Not understanding the limits of REs leads to a lot of frustration, and a lot of very unreliable code.
<strong>If you can&#8217;t describe it as a series of elements that follow each other in a given order, a regular expression is not the answer!</strong></p>
</div>
<div class="paragraph">
<p>The fact that many programmers don&#8217;t understand the limitations of regular expressions has led to the incorrect maxim that if you have a problem and try to solve it with regular expressions you then have two problems, your original problem and a regular expression.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dont_be_intimidated">Don&#8217;t Be Intimidated!</h3>
<div class="paragraph">
<p>Regular expressions can look very intimidating, but, once you know the language they are written in, they are actually very simplistic things.
Think of it as a mathematical equation, until you know what all the symbols mean, it&#8217;s a big pile of intimidating gobbledegook, but, once you understand the meanings of the symbols, you can work your way through an equation logically.</p>
</div>
<div class="paragraph">
<p>The following apparent gibberish is a regular expression describing the domain name pattern described above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #000000;font-weight: bold">[</span>a-zA-Z0-9][-a-zA-Z0-9]<span style="color: #000000;font-weight: bold">*</span><span style="color: #000000;font-weight: bold">([</span>.][a-zA-Z0-9][-a-zA-Z0-9]<span style="color: #000000;font-weight: bold">*</span><span style="color: #000000;font-weight: bold">)</span><span style="color: #000000;font-weight: bold">*</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For now, that looks horrific, but, when we&#8217;ve finished this instalment and the one after, I promise it&#8217;ll make sense!</p>
</div>
<div class="paragraph">
<p>Also, I promise the following is a really funny joke&#8201;&#8212;&#8201;when you get it, you&#8217;ll know you get REs!
(I have this on a T-shirt, and it works as a great nerd ––test.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #000000;font-weight: bold">(</span>bb<span style="color: #000000;font-weight: bold">)</span>|[^b]<span style="color: #000000;font-weight: bold">{</span>2<span style="color: #000000;font-weight: bold">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_which_re_language">Which RE Language?</h3>
<div class="paragraph">
<p>Just like there is no one programming language, there is no one language for regular expressions.
So, that leads to an obvious question, which type of RE should we learn?
Because this series is all about the Terminal, the answer is actually very easy, there&#8217;s really only one choice that makes sense, but, it happens to be a choice that conveniently gives us a very solid base to build from for other uses of REs.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start with some context.
Firstly, when it comes to regular expressions you can&#8217;t ignore my favourite scripting language, Perl.
Perl was developed for the purpose of processing text, which means pattern matching is at the very core of its DNA.
The official backronym for Perl is <em>the Practical Extracting and Reporting Language</em>, and the joke backronym is <em>the Pathologically Eclectic Rubbish Lister</em>. Either way, Perl is all about extracting information from textual data, so it&#8217;s all about pattern matching.</p>
</div>
<div class="paragraph">
<p>Because Perl has pattern matching so deeply embedded within its being, it should come as no surprise that the gold standard for regular expressions are so-called <em>Perl-Style Regular Expressions</em>, which you&#8217;ll often find referenced in man pages and other documentation as PCRE, which stands for <em>Perl Compatible Regular Expression</em>.
What we&#8217;re going to learn is not exactly PCRE, but, a sub-set of PCRE called POSIX ERE.
The fact that POSIX ERE is a subset of PCRE means that everything we learn will be useful to us in any application that uses PCRE, which means we can transfer what we learn here to a LOT of other contexts, including the two common web programming languages PHP and JavaScript (which both use PCRE for their regular expression implementations).</p>
</div>
</div>
<div class="sect2">
<h3 id="_posix_ere">POSIX ERE</h3>
<div class="paragraph">
<p>Why POSIX ERE?
In fact, more fundamentally, what is POSIX?</p>
</div>
<div class="paragraph">
<p><!-- vale Vale.Repetition = NO --></p>
</div>
<div class="paragraph">
<p>POSIX stands for <em>Portable Operating System Interface</em>, and it&#8217;s the reason that the things we learn in this series are so surprisingly portable.
POSIX is the standard that unites most of the flavours of Unix and Linux and gives us a common foundation to work off of.
Not all our *nix operating systems are POSIX certified, but they are all, to a very very high degree, POSIX compliant.
OS X is actually POSIX certified, but Linux is not, it just implements pretty much the entire POSIX standard.
POSIX covers many things, from how file systems should be presented, to a core set of terminal commands that are the same across all POSIX OSes, to a large set of programming APIs that can be used to create apps that run on all POSIX systems, to a portable regular expression syntax.</p>
</div>
<div class="paragraph">
<p><!-- vale Vale.Repetition = YES --></p>
</div>
<div class="paragraph">
<p>Actually, POSIX specifies two regular expression languages, POSIX Basic Regular Expressions (BRE), and POSIX Extended Regular Expressions (ERE).
The reason there are two is that POSIX is literally decades old, and regular expressions have come a long way since the BRE syntax was defined.
When it comes to the simple stuff, BRE and ERE are the same, but, when it comes to more complex stuff, specifically cardinalities and grouping, they are not compatible.
For these advanced features, BRE is not PCRE compatible, but ERE is, making it the best kind of RE for those exploring the terminal.</p>
</div>
<div class="paragraph">
<p>For all the examples in this series, we are going to use ERE, and we are only going to use command line tools that understand ERE.
However, it&#8217;s important to know that BRE exists, because you&#8217;ll see both BRE and ERE mentioned in many man pages, and, some terminal commands default to BRE for legacy reasons, but can accept ERE if a certain flag is passed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_getting_practical">Getting Practical</h3>
<div class="paragraph">
<p>The only way to really learn regular expressions is through practical examples, so, for this instalment and the next, we&#8217;ll be using the <code>egrep</code> command to search the standard Unix words file for words that match a given pattern.
We&#8217;ll be looking at the <code>egrep</code> command in more detail later in the series, but for now, all we need to know is that <code>egrep</code> can be used with two arguments, the first, a regular expression in POSIX ERE format, and the second the path to a file to search.
<code>egrep</code> will print each line that contains text that matches the given pattern. It will not print just the text that matches the pattern, it will print the entire line that contains the match.</p>
</div>
<div class="paragraph">
<p>The standard Unix words file is a text file containing a list of valid English words, one word per line.
On OS X and Ubuntu Linux, the file is located at <code>/usr/share/dict/words</code>, though on some Unix/Linux variants you&#8217;ll find it at <code>/usr/dict/words</code> instead.</p>
</div>
</div>
<div class="sect2">
<h3 id="_getting_started_with_posix_ere">Getting Started with POSIX ERE</h3>
<div class="paragraph">
<p><!-- vale Vale.Repetition = NO --></p>
</div>
<div class="paragraph">
<p>In this instalment we&#8217;re going to start with the simpler parts of the ERE language, and, in fact, everything we learn today will be valid ERE, BRE, and PCRE, so it will apply very very widely indeed.</p>
</div>
<div class="paragraph">
<p><!-- vale Vale.Repetition = YES --></p>
</div>
<div class="paragraph">
<p>Ordinary characters represent themselves in a pattern, so the POSIX ERE to represent the letter <code>a</code> is simply:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">a</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, the RE to represent the character <code>t</code> followed by the character <code>h</code> is simply:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">th</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s start with a simple example&#8201;&#8212;&#8201;finding all words that contain a double <code>e</code> in the words file.
Remember, the <code>egrep</code> command prints any line from the input file that matches the specified pattern, so, to find all words with a double <code>e</code> you could use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">egrep <span style="color: #d14">'ee'</span> /usr/share/dict/words</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s take things up a notch, and include line boundaries in our pattern.
The special character <code>^</code> represents <em>start of line</em> when used at the start of a regular expression (it can have other meanings when used elsewhere as we&#8217;ll see later).
Its opposite number is the special character <code>$</code>, which represents <em>end of line</em>.</p>
</div>
<div class="paragraph">
<p>So, the following command will find all words starting with the character <code>b</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">egrep <span style="color: #d14">'^b'</span> /usr/share/dict/words</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, the following command will find all words ending in the three letters <code>ing</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">egrep <span style="color: #d14">'ing$'</span> /usr/share/dict/words</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>*Note:* you may have noticed that I&#8217;ve been single-quoting the pattern in all the examples.
This is often not necessary, because many patterns don&#8217;t contain Bash special characters, but, some do, including the one above, which contains the dollar symbol.
If the string had not been single-quoted, we would have had to escape the dollar symbol which would be very messy.
My advice would be to get into the habit of always single-quoting regular expressions, it&#8217;ll save you a lot of frustration over time!</em></p>
</div>
<div class="paragraph">
<p>Something else that&#8217;s very important is the ability to specify a wild-card character.
We can do that using the period character, which you should read in an RE as <em>any one character</em>.</p>
</div>
<div class="paragraph">
<p><!-- vale Vale.Repetition = NO --></p>
</div>
<div class="paragraph">
<p>As an example, let&#8217;s say you&#8217;re stuck on a thorny crossword puzzle, and you need a word that fits into <code><em>something e something something f something</em></code>.
You could use the following terminal command to find a list of possible answers:</p>
</div>
<div class="paragraph">
<p><!-- vale Vale.Repetition = YES --></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">egrep <span style="color: #d14">'^.e..f.$'</span> /usr/share/dict/words</code></pre>
</div>
</div>
<div class="paragraph">
<p>Something to notice in the above command is that the specific pattern we are looking for is bounded by a
<code>^</code> and a <code>$</code>,
this is to ensure we don&#8217;t get longer words that contain the pattern returned.
If you run the command again but leave those symbols out you&#8217;ll see that you get a lot of unwanted results (over 900 on OS X).</p>
</div>
<div class="paragraph">
<p>The last thing we&#8217;re going to look at in this instalment is character classes, these are used to match a single character against multiple options.
You can think of everything inside a character class as being a big list of "ors".
Character classes are enclosed inside square brackets, so, you should read the character class below as <em>a or b or c or d or e or f</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #000000;font-weight: bold">[</span>abcdef]</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an example, let&#8217;s search for all four-letter words starting with a vowel:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">egrep <span style="color: #d14">'^[aeiou]...$'</span> /usr/share/dict/words</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the minus sign within character classes to specify ranges of characters.
Some commonly used ranges include:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>[0-9]</code>
</td>
<td class="hdlist2">
<p>Any digit</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>[a-z]</code>
</td>
<td class="hdlist2">
<p>Any lowercase letter</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>[A-Z]</code>
</td>
<td class="hdlist2">
<p>Any uppercase letter</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You don&#8217;t have to stick to those common ranges though, you can use subsets of them, and you can use multiple ranges within a single character class.</p>
</div>
<div class="paragraph">
<p>As an example, the regular expression below matches valid MAC addresses in OS X (and Linux) format.
On POSIX OSes like OS X and Linux, MAC addresses are represented as a series of six two-character lower-case hexadecimal numbers separated by colon symbols, so, they could be matched with the following regular expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #000000;font-weight: bold">[</span>0-9a-f][0-9a-f]:[0-9a-f][0-9a-f]:[0-9a-f][0-9a-f]:[0-9a-f][0-9a-f]:[0-9a-f][0-9a-f]:[0-9a-f][0-9a-f]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above RE will work, but it&#8217;s quite unwieldy and full of repetition, you might imagine there&#8217;d be a simpler, more efficient way of representing this pattern, and you&#8217;d be right!
I&#8217;ll stop here and leave the following as a teaser for the next instalment, the above ungainly 102-character RE can be reduced to just 29 characters using two important new concepts, cardinality and grouping.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt18">TTT Part 18 of n &#8212; More REs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In <a href="#ttt17">the previous instalment</a>, we introduced the concept of Regular Expressions and started to learn the POSIX ERE regular expression language, noting that POSIX ERE is a sub-set of the very commonly used Perl Compatible Regular Expression (PCRE) language.</p>
</div>
<div class="paragraph">
<p>In this instalment, we&#8217;ll learn more POSIX ERE syntax, and have a look at some examples of REs in GUI apps.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 18</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episodes 18a &amp; 18b</p>
</div>
<table class="tableblock frame-none grid-none stripes-even stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Episode 18a</th>
<th class="tableblock halign-left valign-top">Episode 18b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT18aMoreREs/TTT_18a_More_REs.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT18bMoreREs/TTT_18b_More_REs.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">Scan the QRcode to listen on a different device</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="assets/qrcodes/TTT_18a.png" alt="QRcode 18a">
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="assets/qrcodes/TTT_18b.png" alt="QRcode 18b">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT18aMoreREs/TTT_18a_More_REs.mp3">play/download the MP3 in your browser (a)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT18bMoreREs/TTT_18b_More_REs.mp3">play/download the MP3 in your browser (b)</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_inverted_character_classes">Inverted Character Classes</h3>
<div class="paragraph">
<p>As we have already seen, character classes can be used to specify a list of allowed characters.
We&#8217;ve seen that you can simply list the characters that are allowed one after the other, and, that you can use the <code>-</code> operator to specify a range of characters.
Something else you can do with a character class is invert it, in other words, have it match every character <strong>except</strong> the ones you list.
To do this, you must start the character class with the <code>^</code> symbol.</p>
</div>
<div class="paragraph">
<p>For example, the following command will find all five-letter words that don&#8217;t start with a vowel:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">egrep <span style="color: #d14">'^[^aeiou]....$'</span> /usr/share/dict/words</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the meaning of the <code>^</code> symbol changes depending on where it is used, outside character classes it means <em>start of line</em>, and inside character classes, it means <em>not any of the following</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_this_or_that">This Or That</h3>
<div class="paragraph">
<p>When we&#8217;re describing patterns in English, we&#8217;ll often find ourselves using the word <em>or</em>, so it&#8217;s not surprising that there is a POSIX ERE operator to allow us to search for one pattern, or another (or another, or another &#8230;&#8203;).
The pipe symbol (<code>|</code>) means <em>or</em> in POSIX ERE.
This symbol has a different meaning in Bash (it&#8217;s one of the stream redirection operators), so it&#8217;s vital you quote any RE containing the <code>|</code> symbol.</p>
</div>
<div class="paragraph">
<p>As an example, the following command will search the standard Unix words file for all five-letter words starting in <code>th</code> or ending in <code>ing</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">egrep <span style="color: #d14">'^th...$|^..ing$'</span> /usr/share/dict/words</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_grouping">Grouping</h3>
<div class="paragraph">
<p>It&#8217;s often very helpful to be able to group together a part of a pattern, effectively defining a sub-pattern.
To do this, surround the sub-pattern in round brackets (aka parentheses).
We can do this to limit the scope of an <em>or</em> operator, or, as we&#8217;ll see shortly, to define which parts of a pattern can and cannot be repeated.</p>
</div>
<div class="paragraph">
<p>As a simple example, the following command will find all seven letter words starting with <code>th</code> or <code>ab</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">egrep <span style="color: #d14">'^(th|ab).....$'</span> /usr/share/dict/words</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cardinalities">Cardinalities</h3>
<div class="paragraph">
<p>Many patterns contain some form of repetition, hence, regular expression languages generally contain a number of operators for expressing different ways in which a pattern, or a part of a pattern, can be repeated.
There are four POSIX ERE operators that allow you to specify different amounts of repetition.</p>
</div>
<div class="paragraph">
<p>The first and most common is the <code>*</code> operator which you should read as <em>zero or more occurrences of</em>.
The operator applies to just the single character or group directly to its left.</p>
</div>
<div class="paragraph">
<p>For example, the command below will find all words of any length starting with <code>th</code> and ending with <code>ing</code>, including the word <code>thing</code> which has no letters between the <code>th</code> and the <code>ing</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">egrep <span style="color: #d14">'^th.*ing$'</span> /usr/share/dict/words</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next operator we&#8217;ll look at is the <code>+</code> operator, which you should read as <em>one or more occurrences of</em>.
Like the <code>*</code>, this operator also only operates on the single character or group directly to its left.
If we repeat the above example but with a <code>+</code> rather than a <code>*</code>, then we are searching for all words starting in <code>th</code> and ending in <code>ing</code> with at least one letter between the <code>th</code> and the <code>ing</code>.
In other words, the same results as before, but without the word <code>thing</code>, which has zero letters between the <code>th</code> and the <code>ing</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">egrep <span style="color: #d14">'^th.+ing$'</span> /usr/share/dict/words</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last of the simple cardinality operators is the <code>?</code> operator which you should read as either <em>zero or one occurrence of</em> or, more succinctly <em>optionally</em>.
Again, like the <code>*</code> and <code>+</code> operators, this operator also only operates on the single character or group directly to its left.</p>
</div>
<div class="paragraph">
<p>As an example, the following command finds all words that end in <code>ing</code> or <code>ings</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">egrep <span style="color: #d14">'ings?$'</span> /usr/share/dict/words</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above returns both <code>winning</code>, and <code>winnings</code>.</p>
</div>
<div class="paragraph">
<p>The first three cardinality operators will usually give you what you need, but, sometimes you need to specify an arbitrary range of times a pattern may be repeated, in which case, you&#8217;ll need the final cardinality operator, <code>{}</code>.
This operator can be used in a number of ways:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even" style="width: 75%;">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{n}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exactly <code>n</code> occurrences of</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{n,m}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">at least <code>n</code> and no more than <code>m</code> occurrences of</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{n,}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">at least <code>n</code> occurrences of</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Like the other three cardinality operators, this operator also only acts on the one character or group directly to its left.</p>
</div>
<div class="paragraph">
<p>As a first example, the following command lists all 10 letter words:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">egrep <span style="color: #d14">'^.{10}$'</span> /usr/share/dict/words</code></pre>
</div>
</div>
<div class="paragraph">
<p>As another example, the following command lists all words between 10 and 12 characters long (inclusive):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">egrep <span style="color: #d14">'^.{10,12}$'</span> /usr/share/dict/words</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, the following command list all words at least 15 letters long:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">egrep <span style="color: #d14">'^.{15,}$'</span> /usr/share/dict/words</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_special_characters">Special Characters</h3>
<div class="paragraph">
<p>We&#8217;ve now seen all the symbols that have a meaning within a POSIX ERE (except for one which we&#8217;ll see in a moment), so, we know that all the following characters have a special meaning:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>^</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Starts with</em> (outside a character class), or <em>not any of</em> (at the start of a character class)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Ends with</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Any one character</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start and end of a character class</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The range operator (only within a character class)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">specify groupings/sub-patterns</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>|</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Or</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Zero or more occurrences of</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>One or more occurrences of</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>?</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Zero or one occurrence of</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The cardinality operator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The escape character (more on this in a moment)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If you want to include any of these characters in your patterns, you have to escape them if they occur somewhere in the pattern where they have a meaning.
The way you do this is by preceding them with the escape character, <code>\</code>.</p>
</div>
<div class="paragraph">
<p>If you wanted to match an actual full-stop (aka period) within your RE, you would need to escape it, so, an RE to match an optionally decimal temperature (in Celsius, Fahrenheit, or Kelvin) could be written like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #000000;font-weight: bold">[</span>0-9]+<span style="color: #000000;font-weight: bold">(</span><span style="color: #d14">\.</span><span style="color: #000000;font-weight: bold">[</span>0-9]+<span style="color: #000000;font-weight: bold">)</span>?[CFK]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, an RE to find all optionally decimal dollar amounts could be written as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #d14">\$</span><span style="color: #000000;font-weight: bold">[</span>0-9]+<span style="color: #000000;font-weight: bold">(</span><span style="color: #d14">\.</span><span style="color: #000000;font-weight: bold">[</span>0-9]+<span style="color: #000000;font-weight: bold">)</span>?</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, we could write this more clearly by using the fact that very few characters have a special meaning within character classes, and hence don&#8217;t need to be escaped if they are used in that context:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #000000;font-weight: bold">[</span>0-9]+<span style="color: #000000;font-weight: bold">([</span>.][0-9]+<span style="color: #000000;font-weight: bold">)</span>?[CFK]
<span style="color: #000000;font-weight: bold">[</span><span style="color: #008080">$]</span><span style="color: #000000;font-weight: bold">[</span>0-9]+<span style="color: #000000;font-weight: bold">([</span>.][0-9]+<span style="color: #000000;font-weight: bold">)</span>?</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a general rule, this kind of notation is easier to read than using the escape character, so, it&#8217;s generally accepted best practice to use character classes where possible to avoid having to escape symbols.
This is of course not always possible, but when it is, it&#8217;s worth doing in my opinion.</p>
</div>
</div>
<div class="sect2">
<h3 id="_escape_sequences">Escape Sequences</h3>
<div class="paragraph">
<p>As well as being used to escape special characters, the <code>\</code> operator can also be used to match some special characters or sets of characters, e.g.:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\\</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">matches a <code>\</code> character</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\n</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">matches a newline character</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">matches a tab character</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">matches any digit, i.e.
is equivalent to <code>[0-9]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\D</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">matches any non-digit, i.e.
is equivalent to <code>[^0-9]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\w</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">matches any word character, i.e.
is equivalent to <code>[0-9a-zA-Z_]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\W</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">matches any non-word character, i.e.
is equivalent to <code>[^0-9a-zA-Z_]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">matches any space character, i.e.
a space or a tab</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\S</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">matches any non-space character, i.e.
not a space or a tab</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">matches a word boundary (start or end of a word)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\&lt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">matches the start of a word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">matches the end of a word</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that the above is not an exhaustive list, these are just the escape sequences you&#8217;re most likely to come across or need.</p>
</div>
<div class="paragraph">
<p>Given the above, we could re-write our regular expressions for temperatures and dollar amounts as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #d14">\b\d</span>+<span style="color: #000000;font-weight: bold">([</span>.]<span style="color: #d14">\d</span>+<span style="color: #000000;font-weight: bold">)</span>?[CFK]<span style="color: #d14">\b</span>
<span style="color: #d14">\b</span><span style="color: #000000;font-weight: bold">[</span><span style="color: #008080">$]</span><span style="color: #d14">\d</span>+<span style="color: #000000;font-weight: bold">([</span>.]<span style="color: #d14">\d</span>+<span style="color: #000000;font-weight: bold">)</span>?<span style="color: #d14">\b</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We have also improved our regular expressions by surrounding them in word boundary markers, this means the RE will only match such amounts if they are not stuck into the middle of another word.</p>
</div>
<div class="paragraph">
<p>For our examples we have been using the standard Unix words file, which has one word per line, so, we have been able to use the start and end of line operators to specify the start and end of words.
However, this would not work if we were searching a file with multiple words on the same line.
To make our examples more generic, replace the <code>^</code> and <code>$</code> dollar operators at the start and end of the patterns with <code>\b</code> (or the start with <code>\&lt;</code> and the end with <code>\&gt;</code>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_putting_it_all_together">Putting it All Together</h3>
<div class="paragraph">
<p>Given everything we now know, let&#8217;s revisit the example we ended with in the previous instalment, our big ungainly RE for matching MAC addresses:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #000000;font-weight: bold">[</span>0-9a-f][0-9a-f]:[0-9a-f][0-9a-f]:[0-9a-f][0-9a-f]:[0-9a-f][0-9a-f]:[0-9a-f][0-9a-f]:[0-9a-f][0-9a-f]:[0-9a-f][0-9a-f]:[0-9a-f][0-9a-f]</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can now re-write it as simply:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #000000;font-weight: bold">[</span>0-9a-f]<span style="color: #000000;font-weight: bold">{</span>2<span style="color: #000000;font-weight: bold">}(</span>:[0-9a-f]<span style="color: #000000;font-weight: bold">{</span>2<span style="color: #000000;font-weight: bold">}){</span>5<span style="color: #000000;font-weight: bold">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above will do everything our original RE did, but, actually, it&#8217;s not as good as it could be, because it really should specify that the entire MAC address should appear as a word, so we should surround it with <code>\b</code> escape sequences:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #d14">\b</span><span style="color: #000000;font-weight: bold">[</span>0-9a-f]<span style="color: #000000;font-weight: bold">{</span>2<span style="color: #000000;font-weight: bold">}(</span>:[0-9a-f]<span style="color: #000000;font-weight: bold">{</span>2<span style="color: #000000;font-weight: bold">}){</span>5<span style="color: #000000;font-weight: bold">}</span><span style="color: #d14">\b</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To really get practical, it&#8217;s time to stop using the standard Unix words file, and start using more complex input.
Specifically, we&#8217;re going to use the <code>ifconfig</code> command which prints the details for all the network devices on a computer.
We&#8217;ll be looking at this command in much more detail later in the series, but for now, we&#8217;ll just be using the command with no arguments.
To see what it is we&#8217;ll be pattern-matching against, run the command on its own first:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ifconfig</code></pre>
</div>
</div>
<div class="paragraph">
<p>So far we have been using the <code>egrep</code> command in its two-argument form, but, it can also be used with only one argument, the pattern to be tested, if the input is passed via <code>STDIN</code>.
We&#8217;ll be using stream redirection to pipe the output of <code>ifconfig</code> to <code>egrep</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s use our new MAC address RE to find all the MAC addresses our computer has:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ifconfig | egrep <span style="color: #d14">'\b[0-9a-f]{2}(:[0-9a-f]{2}){5}\b'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Having created an RE for MAC addresses, we can also create one for IP addresses (IPV4 to be specific):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #d14">\b\d</span><span style="color: #000000;font-weight: bold">{</span>1,3<span style="color: #000000;font-weight: bold">}([</span>.]<span style="color: #d14">\d</span><span style="color: #000000;font-weight: bold">{</span>1,3<span style="color: #000000;font-weight: bold">}){</span>3<span style="color: #000000;font-weight: bold">}</span><span style="color: #d14">\b</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use <code>ifconfig</code> and <code>egrep</code> again to find all the IP addresses our computer has:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ifconfig | egrep <span style="color: #d14">'\b\d{1,3}([.]\d{1,3}){3}\b'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><!-- vale Vale.Repetition = NO --></p>
</div>
<div class="paragraph">
<p>So, let&#8217;s go right back to the examples we used at the very very start of all this.
Firstly, to the RE for domain names:</p>
</div>
<div class="paragraph">
<p><!-- vale Vale.Repetition = YES --></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #000000;font-weight: bold">[</span>a-zA-Z0-9][-a-zA-Z0-9]<span style="color: #000000;font-weight: bold">*</span><span style="color: #000000;font-weight: bold">([</span>.][a-zA-Z0-9][-a-zA-Z0-9]<span style="color: #000000;font-weight: bold">*</span><span style="color: #000000;font-weight: bold">)</span><span style="color: #000000;font-weight: bold">*</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Hopefully, you can now read this RE as follows:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>A letter or digit followed by zero or more letters, digits, or dashes, optionally followed by as many instances of a dot followed by a letter or digits followed by zero or more letters, digits or dashes as desired.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>And finally, to the RE that I promised was a funny joke:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #000000;font-weight: bold">(</span>bb<span style="color: #000000;font-weight: bold">)</span>|[^b]<span style="color: #000000;font-weight: bold">{</span>2<span style="color: #000000;font-weight: bold">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You could read it as:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>two 'b&#8217;s or two characters that are not 'b&#8217;s</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Or, you could read it as:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>To be, or not to be</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Given that Shakespeare&#8217;s 450th birthday was last month, it seemed appropriate to include this bit of nerd humour!</p>
</div>
<div class="paragraph">
<p>We&#8217;ve now covered most of the POSIX ERE spec, and probably more than most people will ever need to know, but if you&#8217;d like to learn more I can recommend <a href="https://www.boost.org/doc/libs/1_44_0/libs/regex/doc/html/boost_regex/syntax/basic_extended.html">this tutorial</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_some_examples_of_res_in_gui_applications">Some Examples of REs in GUI Applications</h3>
<div class="paragraph">
<p>Regular expressions make sense when you want to search for things, so, it&#8217;s not surprising that you mostly find them in apps where searching is important.</p>
</div>
<div class="paragraph">
<p>You&#8217;ll very often find REs in advanced text editors (not in basic editors like TextEdit.app).
Two examples are included below, the <em>Advanced Find and Replace</em> window in <a href="https://www.peterborgapps.com/smultron/">Smultron 6</a>, and the <em>Find</em> dialogue in the <a href="https://www.activestate.com/komodo-edit/downloads">Komodo Edit 8</a> cross-platform IDE (the two editors I do all my programming in):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt18/Screen-Shot-2014-05-10-at-17.49.36.png" alt="Smultron 6 Advanced Find and Replace">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt18/Screen-Shot-2014-05-10-at-17.55.51.png" alt="The Komodo Edit Find Window">
</div>
</div>
<div class="paragraph">
<p>Another place you&#8217;ll often find regular expressions is in apps for renaming files, for example, <a href="https://manytricks.com/namemangler/">Name Mangler 3</a> or the bulk-renaming tool within <a href="https://cocoatech.com/pathfinder/">Path Finder</a>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt18/Screen-Shot-2014-05-10-at-18.14.12.png" alt="Name Mangler">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt18/Screen-Shot-2014-05-10-at-18.17.19.png" alt="Screen Shot 2014-05-10 at 18.17.19">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_update_19_oct_2015_a_nice_web_tool">Update (19 Oct 2015) &#8212; A Nice Web Tool</h3>
<div class="paragraph">
<p>Thanks to NosillaCast listener Caleb Fong for recommending a great online RE testing tool which you can find at <a href="https://regex101.com">regex101.com</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_next_time_2">Next Time &#8230;&#8203;</h3>
<div class="paragraph">
<p>We&#8217;ve now learned enough about REs to move on to looking at command-line tools for searching for text in files, and files in the filesystem.
This is what we&#8217;ll be moving on to next in this series.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt19">TTT Part 19 of n &#8212; Text Searches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the previous two instalments (<a href="#ttt17">17</a> &amp; <a href="#ttt18">18</a>) of this series, we learned how to represent patterns with regular expressions, or, to be more specific, with POSIX Extended Regular Expression (or EREs).
We used the <code>egrep</code> command to test our regular expressions, but we didn&#8217;t discuss the command itself in detail.
Now that we understand regular expressions, it&#8217;s time to take a closer look at both <code>egrep</code>, and its older brother <code>grep</code>, both commands for filtering and searching text.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 19</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 19</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT19TextSearches/TTT_19_Text_Searches.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_19.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT19TextSearches/TTT_19_Text_Searches.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_to_grep_or_to_egrep_that_is_the_question">To <code>grep</code> or to <code>egrep</code> &#8212; that is the question!</h3>
<div class="paragraph">
<p>The <code>grep</code> command goes back a very long way and has been the staple text-searching command on POSIX operating systems like Unix and Linux for decades.
To this day it&#8217;s used millions of times each day for simple text searches.
But, it has a shortcoming&#8201;&#8212;&#8201;it&#8217;s stuck in the past when it comes to regular expressions&#8201;&#8212;&#8201;<code>grep</code> pre-dates the invention of POSIX ERE!
<code>egrep</code> is identical to <code>grep</code> except that it interprets patterns passed to it as POSIX EREs.</p>
</div>
<div class="paragraph">
<p>If you can, it&#8217;s probably best to get into the habit of always using <code>egrep</code>, and never using <code>grep</code>, but for those of us who&#8217;ve been around the block a few times, this could be asking for too much (old habits die hard!).
What I usually do is use <code>grep</code> when I don&#8217;t need regular expressions, and <code>egrep</code> when I do.
However, in this series, I&#8217;m going to follow my own advice and only use <code>egrep</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_egrep_basics"><code>egrep</code> Basics</h3>
<div class="paragraph">
<p>For <code>egrep</code>, lines of text are atomic.
In other words, <code>egrep</code> searches or filters text one line at a time, checking the entire line against the given pattern, and considering the whole line to match the pattern or not.</p>
</div>
<div class="paragraph">
<p>There are two basic ways in which <code>egrep</code> can be used&#8201;&#8212;&#8201;it can filter whatever is sent to via standard in (<code>STDIN</code>&#8201;&#8212;&#8201;see <a href="#ttt15">part 15</a>) against a given pattern, or, it can search for lines matching a given pattern in one or more files.</p>
</div>
</div>
<div class="sect2">
<h3 id="_filtering_stdin">Filtering <code>STDIN</code></h3>
<div class="paragraph">
<p>Let&#8217;s start with the first use-case, using <code>egrep</code> to filter <code>STDIN</code>.
When <code>egrep</code> is used in this mode it passes every line of text sent to <code>STDIN</code> that matches the given pattern to standard out (<code>STDOUT</code>) and ignores all others.
If you send 5,000 lines of text to <code>egrep</code> via <code>STDIN</code>, and only 5 of those lines match the specified pattern, then only 5 lines will be passed to <code>STDOUT</code> (which is the screen unless the output is redirected elsewhere).</p>
</div>
<div class="paragraph">
<p>When content is redirected to <code>egrep's</code> <code>STDIN</code>, <code>egrep</code> only needs one argument&#8201;&#8212;&#8201;the pattern to filter on.</p>
</div>
<div class="paragraph">
<p>On Unix/Linux/OS X computers configured to act as servers, there will be a lot of log files being written to continuously, and sysadmins will very often need to filter those logs while troubleshooting an issue, or tweaking the server&#8217;s configuration.
In my day-job as a Linux sysadmin, I do this all the time.
Regardless of the log file to be filtered, the approach is the same, use <code>tail -f</code> to stream the log file in question to <code>tail's</code> <code>STDOUT</code> in real-time, then redirect that stream to <code>egrep's</code> <code>STDIN</code> with the pipe operator.</p>
</div>
<div class="paragraph">
<p>For example, on a Linux server running a BIND DNS server process, DNS log entries are mixed with other entries in the central system messages log (<code>/var/log/messages</code>).
When debugging a problem with the DNS server, you don&#8217;t want to be distracted by all the other messages flowing into that log file.
The following command will filter that log so that you only see messages from the DNS server process, which all start with the prefix <code>named:</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">tail</span> <span style="color: #000080">-f</span> /var/log/messages | egrep <span style="color: #d14">'^named:'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The log files on our personal computers are much quieter places, so PC users will rarely find themselves needing to filter log files.
However, that doesn&#8217;t mean PC terminal users won&#8217;t find themselves wanting to use <code>egrep</code> to filter <code>STDIN</code>.</p>
</div>
<div class="paragraph">
<p>You can use <code>egrep</code> to filter the output from any command using the pipe operator.
To generate a meaningful example we need a command that will generate a lot of formatted output at will.
We&#8217;re going to use a command we&#8217;ll come back to in much more detail in future instalments, <code>tcpdump</code>.
As its name suggests, <code>tcpdump</code> prints the details of every TCP packet that enters or leaves your computer to <code>STDOUT</code>.
Every time your computer interacts with the network, <code>tcpdump</code> will generate output&#8201;&#8212;&#8201;in our modern connected world, that means <code>tcpdump</code> generates a LOT of output!</p>
</div>
<div class="paragraph">
<p>Firstly, let&#8217;s run <code>tcpdump</code> without filtering its output to see just how much network traffic there is on our computers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">sudo </span>tcpdump <span style="color: #000080">-i</span> any <span style="color: #000080">-nn</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>tcpdump</code> will keep capturing traffic until it is interrupted, so when you&#8217;ve seen enough, you can exit it with <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>c</kbd></span>.</p>
</div>
<div class="paragraph">
<p>It probably won&#8217;t be long until you start seeing packets fly by, but if it&#8217;s a bit sluggish, try checking your email or visiting a web page and the packets will soon start to fly!</p>
</div>
<div class="paragraph">
<p>Now, let&#8217;s say we want to watch what DNS queries our computer is making.
Given that DNS queries are over port 53, and that your router is almost certainly your DNS server, we know that all DNS queries will be sent to your router on port 53.
Before we construct the pattern to pass to <code>egrep</code>, we need to find the IP address of our router.
We can do this by filtering the output from another command that we&#8217;ll be looking at in much more detail later, <code>netstat</code>.
With the appropriate flags, <code>netstat</code> prints out our computer&#8217;s routing table, and the default route in that table is to your router, so filtering the output of <code>netstat</code> for a line starting with the word <code>default</code> will show the IP of your router:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">netstat <span style="color: #000080">-rn</span> | egrep <span style="color: #d14">'^default'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When I run this command I get the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">default            192.168.10.1       UGSc           32        0     en0</code></pre>
</div>
</div>
<div class="paragraph">
<p>This tells me that my router has the IP address <code>192.168.10.1</code> (yours will probably be different, very likely <code>10.0.0.1</code> or <code>192.168.0.1</code>, my network is set up a little unusually).</p>
</div>
<div class="paragraph">
<p>Given this information I can now use <code>egrep</code> to filter the output of tcpdump to show me only my DNS queries with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">sudo </span>tcpdump <span style="color: #000080">-i</span> any <span style="color: #000080">-nn</span> | egrep <span style="color: #d14">'192.168.10.1.53:'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can construct a similar command for your computer by inserting your IP address into the above command.
E.g.
if your router&#8217;s IP address is <code>10.0.0.1</code> the command will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">sudo </span>tcpdump <span style="color: #000080">-i</span> any <span style="color: #000080">-nn</span> | egrep <span style="color: #d14">'10.0.0.1.53:'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that, rather confusingly, <code>tcpdump</code> adds the port number to the end of the IP as a fifth number.</p>
</div>
<div class="paragraph">
<p>Note that if we wanted to be really accurate with our regular expression, we would use something like the example below, which is more explicit, and hence much less prone to picking up the odd false positive:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">sudo </span>tcpdump <span style="color: #000080">-i</span> any <span style="color: #000080">-nn</span> | egrep <span style="color: #d14">'[ ]192[.]168[.]10[.]1[.]53:[ ]'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When you execute your command, visit a few web pages, and watch as DNS queries are sent from your computer to your router.
When I visit <a href="https://www.whitehouse.gov">www.whitehouse.gov</a> I get the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac2013:~ bart$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">sudo </span>tcpdump <span style="color: #000080">-i</span> any <span style="color: #000080">-nn</span> | egrep <span style="color: #d14">'[ ]192[.]168[.]10[.]1[.]53:[ ]'</span>
<span style="color: #888888">tcpdump: data link type PKTAP
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on any, link-type PKTAP (Packet Tap), capture size 65535 bytes
16:07:33.855986 IP 192.168.10.42.62854 &gt; 192.168.10.1.53: 14228+ A? www.whitehouse.gov. (36)
16:07:34.032251 IP 192.168.10.42.63205 &gt; 192.168.10.1.53: 18279+ A? s7.addthis.com. (32)
16:07:34.247111 IP 192.168.10.42.61908 &gt; 192.168.10.1.53: 61513+ A? ct1.addthis.com. (33)
16:07:34.324604 IP 192.168.10.42.49410 &gt; 192.168.10.1.53: 19744+ A? wwws.whitehouse.gov. (37)
16:07:34.374799 IP 192.168.10.42.51554 &gt; 192.168.10.1.53: 27443+ A? www.youtube-nocookie.com. (42)
16:07:34.664967 IP 192.168.10.42.54293 &gt; 192.168.10.1.53: 17308+ A? search.usa.gov. (32)
16:07:35.968991 IP 192.168.10.42.55988 &gt; 192.168.10.1.53: 34309+ A? www.letsmove.gov. (34)
16:07:35.969510 IP 192.168.10.42.63332 &gt; 192.168.10.1.53: 32194+ A? apply.whitehouse.gov. (38)
16:07:35.969644 IP 192.168.10.42.54380 &gt; 192.168.10.1.53: 11407+ A? t.co. (22)
16:07:35.969823 IP 192.168.10.42.54328 &gt; 192.168.10.1.53: 32595+ A? plus.google.com. (33)
16:07:35.970295 IP 192.168.10.42.53706 &gt; 192.168.10.1.53: 58317+ A? usa.gov. (25)
16:07:35.970528 IP 192.168.10.42.61971 &gt; 192.168.10.1.53: 4237+ A? www.twitter.com. (33)
16:07:36.425466 IP 192.168.10.42.49283 &gt; 192.168.10.1.53: 18130+ A? www-google-analytics.l.google.com. (51)
16:07:36.429381 IP 192.168.10.42.56459 &gt; 192.168.10.1.53: 18915+ A? vimeo.com. (27)
16:07:36.429535 IP 192.168.10.42.55061 &gt; 192.168.10.1.53: 4390+ A? petitions.whitehouse.gov. (42)
16:07:36.429677 IP 192.168.10.42.58086 &gt; 192.168.10.1.53: 51451+ A? twitter.com. (29)
16:07:36.441638 IP 192.168.10.42.57427 &gt; 192.168.10.1.53: 7567+ A? searchstats.usa.gov. (37)
16:07:36.442115 IP 192.168.10.42.59259 &gt; 192.168.10.1.53: 62371+ A? s.ytimg.com. (29)
16:07:36.584244 IP 192.168.10.42.65060 &gt; 192.168.10.1.53: 58436+ A? www.facebook.com. (34)
16:07:36.584542 IP 192.168.10.42.65022 &gt; 192.168.10.1.53: 16848+ A? www.linkedin.com. (34)
16:07:36.585051 IP 192.168.10.42.58670 &gt; 192.168.10.1.53: 10667+ A? www.flickr.com. (32)
16:07:36.585184 IP 192.168.10.42.49857 &gt; 192.168.10.1.53: 14702+ A? foursquare.com. (32)
16:07:36.684281 IP 192.168.10.42.61667 &gt; 192.168.10.1.53: 30012+ A? www.google.com. (32)
16:07:36.972650 IP 192.168.10.42.61971 &gt; 192.168.10.1.53: 4237+ A? www.twitter.com. (33)
16:07:37.152113 IP 192.168.10.42.62562 &gt; 192.168.10.1.53: 64882+ A? m.addthis.com. (31)
16:07:38.223524 IP 192.168.10.42.56628 &gt; 192.168.10.1.53: 34626+ A? i1.ytimg.com. (30)
^C3125 packets captured
3125 packets received by filter
0 packets dropped by kernel

</span><span style="color: #555555">bart-imac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This gives you some idea of just how many resources from disparate sources get pulled together to create a modern web page!</p>
</div>
</div>
<div class="sect2">
<h3 id="_searching_files">Searching Files</h3>
<div class="paragraph">
<p>Let&#8217;s move on now to using <code>egrep</code> to search the contents of one or more files for a given pattern.</p>
</div>
<div class="paragraph">
<p>When using <code>egrep</code> to search file(s), it requires a minimum of two arguments, first the pattern to be searched for, and secondly at least one file to search.
If you want to search multiple files, you can keep adding more file paths as arguments.</p>
</div>
<div class="paragraph">
<p>In this mode, <code>egrep</code> will filter the lines in the file in the same way it did when filtering a stream, but if you ask it to filter more than one file it will prepend any output with the name of the file the matching line came from.
This is a very useful feature.</p>
</div>
<div class="paragraph">
<p>The vast majority of the examples we used in the previous two instalments used <code>egrep</code> to search the Unix words file.
As a quick reminder, the following command will find all lines in the words file that start with the letters <code>th</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">egrep <span style="color: #d14">'^th'</span> /usr/share/dict/words</code></pre>
</div>
</div>
<div class="paragraph">
<p>A very common use-case for using <code>egrep</code> on a single file is to quickly check a setting in a configuration file.
For example, on a Linux web server with PHP installed, you could use the command below to check the maximum file upload size the server is configured to accept:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">egrep <span style="color: #d14">'^upload_max_filesize'</span> /etc/php.ini</code></pre>
</div>
</div>
<div class="paragraph">
<p>On a server with a default PHP install that will return the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">upload_max_filesize <span style="color: #000000;font-weight: bold">=</span> 2M</code></pre>
</div>
</div>
<div class="paragraph">
<p>Most of us are probably not running web server processes on our personal computers, so let&#8217;s look at a more practical example.
On any POSIX OS (Linux, Unix or OS X), you can see what DNS server(s) are configured by searching the file <code>/etc/resolv.conf</code> for lines beginning with the word <code>nameserver</code>.
The following command does just that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">egrep <span style="color: #d14">'^nameserver'</span> /etc/resolv.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p>So far we have only searched one file at a time, but you can point <code>egrep</code> at as many files as you like, either explicitly, or by using shell wild card expansion.
For example, the command below looks for lines containing <code>apple.com</code> in all the log files in the folder <code>/var/log</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">egrep <span style="color: #d14">'apple[.]com'</span> /var/log/<span style="color: #000000;font-weight: bold">*</span>.log</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_useful_egrep_flags">Useful <code>egrep</code> Flags</h3>
<div class="paragraph">
<p><code>egrep</code> is a very powerful command that supports a staggering array of flags.
We couldn&#8217;t possibly go through them all here.
Remember, you can use the man pages to see everything <code>egrep</code> can do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">man egrep</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, there are a few flags that are so useful they bear special mention.
Firstly, to make <code>egrep</code> case-insensitive, you can use the <code>-i</code> flag.
If you&#8217;re not sure of the capitalisation of the text you&#8217;re looking for, use <code>egrep -i</code>.</p>
</div>
<div class="paragraph">
<p>If you want to see the line numbers within the files for all the matches found by <code>egrep</code> you can use the <code>-n</code> flag.</p>
</div>
<div class="paragraph">
<p>And finally, the biggie, you can use the <code>-r</code> flag to recursively search every single file in a given directory.
Be careful with this one&#8201;&#8212;&#8201;if you ask <code>egrep</code> to search too much, it will take a very long time indeed to finish!</p>
</div>
</div>
<div class="sect2">
<h3 id="_final_thoughts_4">Final Thoughts</h3>
<div class="paragraph">
<p>In this instalment, we&#8217;ve seen how <code>egrep</code> can be used to filter a stream or to search one or more files for lines of text matching a specified pattern.
This is very useful, and something sysadmins do a lot in the real world.
In the next instalment we&#8217;ll be moving on to a different, but equally important, type of search&#8201;&#8212;&#8201;file searches.
We&#8217;ll use the aptly-named <code>find</code> command to find files that meet one or more criteria.
<code>find</code> supports a huge variety of different search criteria, including simple things like the name of the file, and more advanced things like the amount of time elapsed since the file was last edited.
All these criteria can be combined to create powerful searches that will show all MS Office files in your Documents folder that were edited within the last week and are bigger than 1MB in size.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt20">TTT Part 20 of n &#8212; File Searches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the <a href="#ttt19">previous instalment</a>, we looked at using <code>egrep</code> to search for a particular piece of text in a stream or file.
<code>egrep</code> is often a great tool for finding a file you are looking for, but only if the file is a plain text file, and only if you are searching for that file based on its content.
What if you want to search for files based on other criteria, like the last time the file was edited, or the name of the file, or the size of the file, or the type of the file etc.?
For that, you need a different command, for that you need <code>find</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 20</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 20</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT20FileSearches/TTT_20_File_Searches.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_20.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT20FileSearches/TTT_20_File_Searches.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_basics_of_the_find_command">The Basics of the <code>find</code> Command</h3>
<div class="paragraph">
<p>Regardless of the criteria you wish to use, the basic form of the <code>find</code> command is always the same, you first need to tell it where to look, then you tell it what criteria to use when searching:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find path criteria 1 <span style="color: #000000;font-weight: bold">[</span>criteria 2 ...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The path is searched recursively (by default), so if you give a path of <code>~/Documents</code>, it will search your documents folder and all folders within your documents folder.
To search your entire computer, and all mounted drives, use a path of just <code>/</code>.
To use the current folder as the base of your search use a path of <code>.</code> (which always means &#8216;the current folder&#8217; as we learned in <a href="#ttt04">instalment 4</a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_defining_search_criteria">Defining Search Criteria</h3>
<div class="paragraph">
<p>To see a full list of all possible search criteria, you can, of course, read the manual entry for find with the command <code>man find</code>, but we&#8217;ll look at some of the more common criteria you&#8217;ll be most likely to need here.</p>
</div>
<div class="sect3">
<h4 id="_search_by_file_name">Search by File Name</h4>
<div class="paragraph">
<p>You can do simple file-name searches with the <code>-name</code> flag followed by a simple pattern.
Note that these simple patterns are NOT regular expressions, they use the same syntax as wild card expansion in BASH, i.e.
<code>*</code> means <em>any number of any characters</em>, and <code>?</code> means <em>exactly one of any character</em>.</p>
</div>
<div class="paragraph">
<p>A lot of the time you really don&#8217;t need the added power and complexity of regular expressions, because a lot of the time all you really want is the good old fashioned DOS pattern <code>*.extension</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
remember that <code>*</code> and <code>?</code> have meanings in BASH, so you need to escape them in some way to get reliable results.
It&#8217;s ugly and hard to read <code>*</code> all over the place, so my suggestion is to get into the good habit of ALWAYS quoting your patterns when using <code>-name</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s start with a really simple example, you know the full name of the file you&#8217;re looking for, but, you have no idea where it is.
This is something you often come across when someone asks you to take a look at their server.
You know you need to edit, say, <code>php.ini</code>, but you have no idea where their version of PHP is installed (this is very common when using web server packages for OS X like MAMP or XAMPP). The command below will find all files called <code>php.ini</code> anywhere in your computer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find / <span style="color: #000080">-name</span> <span style="color: #d14">'php.ini'</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
if you&#8217;re going to search your whole computer (like we did above), you&#8217;ll see a lot of &#8216;permission denied&#8217; errors.
To avoid this, run the command with <code>sudo</code>, or, if you want to just ignore the errors, redirect <code>STDERR</code> to <code>/dev/null</code> with <code>2&gt;/dev/null</code> like we learned in <a href="#ttt16">instalment 16</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Something else you very often want to do is find all files of a given extension in a given location.
For example, the command below will list all text files in your home directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find ~ <span style="color: #000080">-name</span> <span style="color: #d14">'*.txt'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can get more creative by looking for all text files with names starting with a <code>b</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find ~ <span style="color: #000080">-name</span> <span style="color: #d14">'b*.txt'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or all text files with a four-letter name with <code>a</code> as the second letter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find ~ <span style="color: #000080">-name</span> <span style="color: #d14">'?a??.txt'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>JPEG files are an interesting case, you&#8217;ll very often see them with two different extensions, <code>.jpg</code> or <code>.jpeg</code>, how can we search for those without using regular expressions?
The key is the <code>-or</code> flag.
So, to look for files ending in either <code>.jpg</code> or <code>.jpeg</code> in our home directory, we could use the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find ~ <span style="color: #000080">-name</span> <span style="color: #d14">'*.jpg'</span> <span style="color: #000080">-or</span> <span style="color: #000080">-name</span> <span style="color: #d14">'*.jpeg'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It looks like we&#8217;ve cracked it, but actually, we haven&#8217;t fully.
Some cameras, for reasons I simply cannot fathom, use the extension <code>.JPG</code> instead of <code>.jpg</code> or <code>.jpeg</code>.
To get around this we could either add two sets of <code>-or -name</code> criteria, or, we could do a case-insensitive name-search by replacing <code>-name</code> with <code>-iname</code>.
This gives us a final JPEG-finding command of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find ~ <span style="color: #000080">-iname</span> <span style="color: #d14">'*.jpg'</span> <span style="color: #000080">-or</span> <span style="color: #000080">-iname</span> <span style="color: #d14">'*.jpeg'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Easily 90% of the time <code>-name</code> and <code>-iname</code> will be all you need to achieve your goals, but, sometimes, you really do need the power of full regular expressions.
When this is the case, you can use the <code>-regex</code> or <code>-iregex</code> flags (<code>-iregex</code> being the case-insensitive version of <code>-regex</code>).
There are two very important caveats when using regular expressions with <code>find</code>.</p>
</div>
<div class="paragraph">
<p>Firstly, unlike with <code>-name</code>, <code>-regex</code> and <code>-iregex</code> do not match against just the file name, they match against the entire file path.
It&#8217;s important that you remember this when constructing your patterns, or you&#8217;ll get unexpected results, either false positives or false negatives.</p>
</div>
<div class="paragraph">
<p>Secondly, by default <code>-regex</code> and <code>-iregex</code> use Basic POSIX Regular Expressions (BREs), rather than the newer Extended POSIX Regular Expressions (EREs) we learned about in instalments <a href="#ttt17">17</a> and <a href="#ttt18">18</a>.
Don&#8217;t worry, you can make <code>find</code> use EREs, you just need to add a <code>-E</code> flag to the start of the command (before the path).</p>
</div>
<div class="paragraph">
<p>Given our knowledge of regular expressions, we could re-write our JPEG search as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find <span style="color: #000080">-E</span> ~ <span style="color: #000080">-iregex</span> <span style="color: #d14">'.*[.]jpe?g'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, like with <code>egrep</code> in the previous instalment, notice that we are quoting the RE to stop Bash wrongly interpreting any of the special characters we may need like <code>*</code> and <code>?</code> in the above example.
Also notice the position of the <code>-E</code> flag, and that we don&#8217;t need to use <code>^</code> or <code>$</code> because the ENTIRE path has to match for the result to validate.
This also means that without the <code>.*</code> at the start of the pattern no files will be returned.</p>
</div>
</div>
<div class="sect3">
<h4 id="_searching_based_on_modified_time">Searching Based on Modified Time</h4>
<div class="paragraph">
<p>Very often, we need to find something we were working on recently, and the key to finding such files is to search based on the time elapsed since a file was last modified.
We can do just that with the <code>-ctime</code> flag (for changed time).</p>
</div>
<div class="paragraph">
<p>By default <code>-ctime</code> works in units of days, however, we can explicitly specify the units of time we&#8217;d like to use by appending one of the following after the number:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even" style="width: 75%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">seconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">minutes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hours</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">days</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>w</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">weeks</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Unless you specify a sign in front of the number, only files modified EXACTLY the specified amount of time in the past will be returned.
That&#8217;s not usually useful.
Instead, what you generally want are all files modified less than a certain amount of time ago, and to do that you add a minus sign before the number.</p>
</div>
<div class="paragraph">
<p>So, to find all files in your Documents folder that have been updated less than an hour ago you could use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find ~/Documents <span style="color: #000080">-ctime</span> <span style="color: #000080">-1h</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_searching_based_on_file_size">Searching Based on File Size</h4>
<div class="paragraph">
<p>Another criteria we may want to search on is file size.
We can do this using the <code>-size</code> flag.
The default units used by <code>-size</code> are utterly unintuitive&#8201;&#8212;&#8201;512k blocks!
Thankfully, like <code>-ctime</code>, <code>-size</code> allows you to specify different units by appending a letter to the number.
The following units are supported:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even" style="width: 75%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Characters (8-bit bytes)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>k</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KiB = 1024 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>M</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MiB = 1024KiB (notice the case&#8201;&#8212;&#8201;must be upper!)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>G</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GiB = 1024MiB (notice the case&#8201;&#8212;&#8201;must be upper!)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>T</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TiB = 1024GiB (notice the case&#8201;&#8212;&#8201;must be upper!)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>P</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PiB = 1024TiB (notice the case&#8201;&#8212;&#8201;must be upper!)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that this command uses the old 1024-based sizes, not the 1,000 based <a href="https://en.wikipedia.org/wiki/International_System_of_Units">SI units</a> used by OS X and hard drive manufacturers (and scientists and engineers and anyone who understands what kilo and mega, etc.
actually mean).</p>
</div>
<div class="paragraph">
<p>Also, like with <code>-ctime</code>, if you don&#8217;t prefix the number with a symbol, only files EXACTLY the size specified will be returned.</p>
</div>
<div class="paragraph">
<p>For example, the following command shows all files in your Downloads folder that are bigger than 200MiB in size:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find ~/Downloads <span style="color: #000080">-size</span> +200M</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, the following command shows all files in your Downloads folder smaller than 1MiB in size:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find ~/Downloads <span style="color: #000080">-size</span> <span style="color: #000080">-1M</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_filtering_on_file_type">Filtering on File &#8216;type&#8217;</h4>
<div class="paragraph">
<p>When I say file type, I mean that in the POSIX sense of the word, not the file extension sense of the word.
In other words, I mean whether something is a regular file, a folder, a link, or some kind of special file.</p>
</div>
<div class="paragraph">
<p>The type of a file can be filtered using the <code>-type</code> flag followed by a valid file type abbreviation.
The list below is not exhaustive, but it covers everything you&#8217;re likely to need:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even" style="width: 75%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a regular file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a directory (AKA folder)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>l</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a symbolic link</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This flag will almost always be used in conjunction with one or more other search flags.
For example, the following command finds all directories in your documents folder that contain the word <code>temp</code> in their name in any case:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find ~/Documents <span style="color: #000080">-type</span> d <span style="color: #000080">-iname</span> <span style="color: #d14">'*temp*'</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_inverting_search_parameters">Inverting Search Parameters</h4>
<div class="paragraph">
<p>In most situations, it&#8217;s easiest to express what it is you want to search for, but sometimes it&#8217;s easier to specify what you don&#8217;t want.
In situations like this, it can be very useful to be able to invert the effect of a single search parameter.
You can do this with the <code>-not</code> flag.</p>
</div>
<div class="paragraph">
<p>For example, you may have a folder where you keep your music, and it should only contain MP3 files and folders.
To be sure that&#8217;s true you could search for all regular files that do not end in <code>.mp3</code> and are not hidden (like those ever-present <code>.DS_Store</code> files) with a command like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find ~/Music/MyMP3s <span style="color: #000080">-type</span> f <span style="color: #000080">-not</span> <span style="color: #000080">-iname</span> <span style="color: #d14">'*.mp3'</span> <span style="color: #000080">-not</span> <span style="color: #000080">-name</span> <span style="color: #d14">'.*'</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_limiting_recursion">Limiting Recursion</h4>
<div class="paragraph">
<p>By default the find command will drill down into every folder contained in the specified path, but, you can limit the depth of the search with the <code>-maxdepth</code> flag.
To search only the specified folder and no deeper use <code>-maxdepth 1</code>.</p>
</div>
<div class="paragraph">
<p>Note that limiting the depth can really speed up searches of large folders if you know what you want is not deep down in the hierarchy.
For example, if you have a lot of documents in your documents folder it can take ages to search it, but, if you are only interested in finding stuff at the top level you can really speed things up.
Let&#8217;s say we are the kind of person who makes lots of temp folders at the top level of their Documents folder (guilty as charged), and you want to find them all so you can do a bit of housekeeping, you could search your entire Documents folder with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find ~/Documents <span style="color: #000080">-type</span> d <span style="color: #000080">-iname</span> <span style="color: #d14">'*temp*'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When I do this it takes literally minutes to return because I have over a TB of files in my Documents folder.
I can get that down to fractions of a second by telling <code>find</code> that I&#8217;m only interested in the top-level stuff with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find ~/Documents <span style="color: #000080">-type</span> d <span style="color: #000080">-iname</span> <span style="color: #d14">'*temp*'</span> <span style="color: #000080">-maxdepth</span> 1</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_combining_search_criteria_boolean_algebra">Combining Search Criteria (Boolean Algebra)</h3>
<div class="paragraph">
<p>We&#8217;ve already seen that we can use the <code>-or</code> and <code>-not</code> flags, but there is also a <code>-and</code> flag.
In fact, if you don&#8217;t separate your criteria with a <code>-or</code> flag, a <code>-and</code> flag is implied.</p>
</div>
<div class="paragraph">
<p>The following example from above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find ~/Music/MyMP3s <span style="color: #000080">-type</span> f <span style="color: #000080">-not</span> <span style="color: #000080">-iname</span> <span style="color: #d14">'*.mp3'</span> <span style="color: #000080">-not</span> <span style="color: #000080">-name</span> <span style="color: #d14">'.*'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Is actually interpreted as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find ~/Music/MyMP3s <span style="color: #000080">-type</span> f <span style="color: #000080">-and</span> <span style="color: #000080">-not</span> <span style="color: #000080">-iname</span> <span style="color: #d14">'*.mp3'</span> <span style="color: #000080">-and</span> <span style="color: #000080">-not</span> <span style="color: #000080">-name</span> <span style="color: #d14">'.*'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can even take things a step further and add subexpressions using <code>(</code> and <code>)</code> to start and end each subexpression (they can even be nested).
Note that <code>(</code> and <code>)</code> have meaning in BASH, so they need to be either escaped or quoted.
Since I find escaping makes everything hard to read and understand, I recommend always quoting these operators.</p>
</div>
<div class="paragraph">
<p>As a final example, the following command will find large PowerPoint presentations in your Documents folder, i.e.
all files bigger than 100MiB in size that end in <code>.ppt</code> or <code>.pptx</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find ~/Documents <span style="color: #000080">-size</span> +100M <span style="color: #d14">'('</span> <span style="color: #000080">-iname</span> <span style="color: #d14">'*.ppt'</span> <span style="color: #000080">-or</span> <span style="color: #000080">-iname</span> <span style="color: #d14">'*.pptx'</span> <span style="color: #d14">')'</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusions_5">Conclusions</h3>
<div class="paragraph">
<p>In this instalment, we&#8217;ve seen that we can use the <code>find</code> command to search for files based on all sorts of criteria and that we can combine those criteria using boolean algebra to generate very powerful search queries.
In the next instalment, we&#8217;ll discover that you can use the <code>find</code> command not only to search for files but to apply an action to every file it finds.</p>
</div>
<div class="paragraph">
<p>The <code>find</code> command is common to all POSIX operating systems, so it works on Linux, Unix, and OS X.
OS X maintains an index of your files allowing quick searching in the Finder and via Spotlight.
Because this index is kept up to date by the OS, it makes searching with Spotlight much quicker than searching with <code>find</code>.
In the next instalment, we&#8217;ll also discover that OS X ships with a terminal command that allows you to use the power of Spotlight from the command line!</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt21">TTT Part 21 of n &#8212; More Searching</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is the third and final instalment on searching.
In the <a href="#ttt19">first instalment</a> on <code>find</code>, we learned how to search for text within files and streams using <code>egrep</code>.
In <a href="#ttt20">the second</a>, we learned to search for files based on all sorts of criteria with the <code>find</code> command.</p>
</div>
<div class="paragraph">
<p>In this final instalment, we&#8217;ll start by looking at one last feature of <code>find</code>, its ability to execute commands on the files it finds.
Then we&#8217;ll end by looking at an OS X-only alternative to <code>find</code> that makes use of the Spotlight search index to really speed up searches.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 21</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 21</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT21MoreSearching/TTT_21_More_Searching.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_21.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT21MoreSearching/TTT_21_More_Searching.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_executing_commands_with_find">Executing Commands with <code>find</code></h3>
<div class="paragraph">
<p>The final trick <code>find</code> has up its sleeves is that it can be used to execute a given command on all the files it finds.
Depending on the command you choose to execute, this could be VERY dangerous indeed, so tread carefully!
Definitely think twice before using the execute feature in `find`å to delete files!</p>
</div>
<div class="paragraph">
<p>To execute commands on the results of <code>find</code> you need to use the <code>-exec</code> flag in conjunction with the <code>{}</code> flag and either the <code>';'</code> or <code>'+'</code> flags.
The reason there are two end flags is that there are two modes in which <code>find</code> can execute commands.
It can either execute the same command once on each file that was found or, it can execute the given command once only with all the found files as arguments.</p>
</div>
<div class="sect3">
<h4 id="_executing_a_command_on_each_filefolder_found">Executing a Command on Each File/Folder Found</h4>
<div class="paragraph">
<p>To execute a command repeatedly, once on each file or folder found, you use the following construct:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find search_path conditions <span style="color: #000080">-exec</span> <span style="color: #0086B3">command </span>args_or_flags <span style="color: #000000;font-weight: bold">{}</span> <span style="color: #d14">';'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>-exec</code> flag means we are about to start specifying a command to execute, and everything up to the <code>';'</code> will be a part of that command.
<code>{}</code> is the point in the command where the found file should be inserted.</p>
</div>
<div class="paragraph">
<p>This sounds quite complicated, but hopefully, a practical example will help.
A real-world problem you may encounter is that you need to make all Perl scripts in a given set of nested folders executable.
As we learned in <a href="#ttt06">instalment 6</a>, we can make a file executable with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">chmod </span>755 path_to_file</code></pre>
</div>
</div>
<div class="paragraph">
<p>Perl scripts have the extension <code>.pl</code>, so using what we learned in the previous instalment we can find all Perl scripts in a given path with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find search_path <span style="color: #000080">-name</span> <span style="color: #d14">'*.pl'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we assume all our Perl files will be in a folder called <code>scripts</code> in our Documents folder, we can put all this together to find and <code>chmod</code> all Perl files in a single command like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find ~/Documents/scripts <span style="color: #000080">-name</span> <span style="color: #d14">'*.pl'</span> <span style="color: #000080">-exec</span> <span style="color: #0086B3">chmod </span>755 <span style="color: #000000;font-weight: bold">{}</span> <span style="color: #d14">';'</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_executing_a_command_once_with_all_filesfolders_found_as_arguments">Executing A Command Once with All Files/Folders Found as Arguments</h4>
<div class="paragraph">
<p>Sometimes we may want to run a command once with all the found files and/or folders as arguments. You can do that with the following construct:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find search_path conditions <span style="color: #000080">-exec</span> <span style="color: #0086B3">command </span>args_or_flags <span style="color: #000000;font-weight: bold">{}</span> <span style="color: #d14">'+'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Like before, <code>{}</code> indicates where the found files and folders should be included in the command, and the <code>'+'</code> on the end indicates the end of the command, and that the command should be run once with all the results as arguments.</p>
</div>
<div class="paragraph">
<p>Again, a practical example might be helpful.
Let&#8217;s say you&#8217;re doing up a report on just how much work went into a coding project.
You want to know how many lines of code you wrote, and you know that all your code is in Perl scripts and Perl modules, i.e.
you know all relevant files have <code>.pl</code> and <code>.pm</code> file extensions.</p>
</div>
<div class="paragraph">
<p>We know from last time that we can find all relevant files with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find search_path <span style="color: #000080">-name</span> <span style="color: #d14">'*.pl'</span> <span style="color: #000080">-or</span> <span style="color: #000080">-name</span> <span style="color: #d14">'*.pm'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We also know from <a href="#ttt15">instalment 15</a> that we can use the <code>wc</code> command with the <code>-l</code> flag to count the number of lines in  one or more files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">wc</span> <span style="color: #000080">-l</span> file 1..n</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming our code is still in a folder called <code>scripts</code> in the Documents folder, the command to find the total number of lines in all the Perl files would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find ~/Documents/scripts <span style="color: #d14">'('</span> <span style="color: #000080">-name</span> <span style="color: #d14">'*.pl'</span> <span style="color: #000080">-or</span> <span style="color: #000080">-name</span> <span style="color: #d14">'*.pm'</span> <span style="color: #d14">')'</span> <span style="color: #000080">-exec</span> <span style="color: #0086B3">wc</span> <span style="color: #000080">-l</span> <span style="color: #000000;font-weight: bold">{}</span> <span style="color: #d14">'+'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that we have to group the two conditions in bracket operators so the scope of the <code>-or</code> is clear.</p>
</div>
<div class="paragraph">
<p>If you installed the XKPasswd 2 Perl module via the quick install instructions at <a href="https://github.com/bbusschots/xkpasswd.pm" class="bare">https://github.com/bbusschots/xkpasswd.pm</a>, you can use the example below to see how many lines of code and documentation went into that project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find /usr/local/xkpasswd.pm <span style="color: #d14">'('</span> <span style="color: #000080">-name</span> <span style="color: #d14">'*.pl'</span> <span style="color: #000080">-or</span> <span style="color: #000080">-name</span> <span style="color: #d14">'*.pm'</span> <span style="color: #d14">')'</span> <span style="color: #000080">-and</span> <span style="color: #000080">-not</span> <span style="color: #000080">-type</span> d <span style="color: #000080">-exec</span> <span style="color: #0086B3">wc</span> <span style="color: #000080">-l</span> <span style="color: #000000;font-weight: bold">{}</span> <span style="color: #d14">'+'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>One final example that might depress you&#8201;&#8212;&#8201;the command below tells you how much disk space you are wasting with large files (&gt;500MiB) in your downloads folder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find ~/Downloads <span style="color: #000080">-size</span> +500M <span style="color: #000080">-exec</span> <span style="color: #0086B3">du</span> <span style="color: #000080">-ch</span> <span style="color: #000000;font-weight: bold">{}</span> <span style="color: #d14">'+'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are VERY careful you can use <code>find -exec</code> to do things like clean up cache folders by deleting anything older than a given amount of time, and other cool and powerful things.
But&#8201;&#8212;&#8201;ALWAYS be careful when using -exec to invoke a command that alters or destroys files or folders.
My approach is to run the command without the <code>-exec</code> first, to be sure ONLY the files and folders you expected to be found are being returned.</p>
</div>
<div class="paragraph">
<p>Finally&#8201;&#8212;&#8201;the nerd joke I think I promised during the last instalment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">find / <span style="color: #000080">-iname</span> <span style="color: #d14">'*base*'</span> <span style="color: #000080">-exec</span> <span style="color: #0086B3">chown</span> <span style="color: #000080">-R</span> us <span style="color: #000000;font-weight: bold">{}</span> <span style="color: #d14">';'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>(If you don&#8217;t get it, <a href="https://en.wikipedia.org/wiki/All_your_base_are_belong_to_us">this might help</a>.)</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_os_x_only_spotlight_from_the_terminal">OS X Only &#8212; Spotlight from the Terminal</h3>
<div class="paragraph">
<p>On OSX the operating system indexes the files on your computer so you can quickly search them with Spotlight.
Rather than having to search through all the files, Spotlight just searches the index, which makes it much faster than <code>find</code> when searching through big chunks of the file system.</p>
</div>
<div class="paragraph">
<p>Apple has very kindly exposed the power of Spotlight to the command line with the very useful <code>mdfind</code> command.</p>
</div>
<div class="paragraph">
<p>If you can type it into the Spotlight text box in the top-left of a Finder window and get back a list of files, you can pass the same query to <code>mdfind</code>, and it will find the same results.
Note that I said Spotlight in the Finder, and not in the menubar&#8201;&#8212;&#8201;that was not by accident.
<code>mdfind</code> is only for finding files, not for all the other fancy stuff you can do with Spotlight in the menu bar like the calculator function or the ability to get dictionary definitions.
Another important caveat is that  <code>mdfind</code> can only find files in folders indexed by Spotlight.
If you add a drive or a folder to Spotlight&#8217;s ignore list, <code>mdfind</code> can never find files on those drives or folders.</p>
</div>
<div class="paragraph">
<p>The <code>mdfind</code> command is very easy to use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">mdfind <span style="color: #d14">'spotlight search string'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, to find all PDFs on your computer you could use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">mdfind <span style="color: #d14">'kind:pdf'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To find all PDFs that contain the word &#8216;internet&#8217; you could use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">mdfind <span style="color: #d14">'kind:pdf internet'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To find every PDF you have edited today you could use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">mdfind <span style="color: #d14">'date:today kind:pdf'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>I haven&#8217;t been able to find a definitive list of all possible Spotlight search commands, but googling for &#8216;spotlight syntax&#8217; will lead to useful articles like <a href="https://osxdaily.com/2010/01/06/improve-your-spotlight-searches-with-search-operators/">this one</a>.</p>
</div>
<div class="paragraph">
<p>mdfind supports a number of arguments, and it can also search based on deep metadata, but I&#8217;m going to leave most of that as an exercise for the user&#8201;&#8212;&#8201;you can get the full documentation through the manual:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">man mdfind</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, there are two flags I do want to draw attention to.</p>
</div>
<div class="paragraph">
<p>By default <code>mdfind</code> will search the entire Spotlight index, but you can ask it to only return results contained within a given folder using the <code>-onlyin</code> flag, for example, to find all PDFs in your Documents folder you could use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">mdfind <span style="color: #000080">-onlyin</span> ~/Documents <span style="color: #d14">'kind:pdf'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the search is always recursive, even when using the <code>-onlyin</code> flag.</p>
</div>
<div class="paragraph">
<p>The other flag I want to mention is <code>-count</code>. If this flag is set the number of matching files will be returned rather than the files themselves.
So, to see how many music files you have in your Music folder you could use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">mdfind <span style="color: #000080">-onlyin</span> ~/Music <span style="color: #000080">-count</span> <span style="color: #d14">'kind:music'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, to answer the eternal question of just how many apps you have installed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">mdfind <span style="color: #000080">-onlyin</span> /Applications <span style="color: #000080">-count</span> <span style="color: #d14">'kind:app'</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_final_thoughts_5">Final Thoughts</h3>
<div class="paragraph">
<p>We have now seen how to filter streams and search files with <code>egrep</code>, and we&#8217;ve learned how to search for files with <code>find</code> and <code>mdfind</code>.
That brings us to the end of the searching topic, at least for now.
The next big topic will be networking, but before we start into such a big topic we&#8217;ll take a break for a fun little tips and tricks instalment.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt22">TTT Part 22 of n &#8212; Tips &amp; Tricks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This instalment is a little breather between the fairly heavy instalments on searching and the upcoming set of instalments on networking.
We&#8217;ll start with a look at some tips and tricks for getting the most out of BASH, and then transition to some tips and tricks for getting the most out of the OS X Terminal app.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 22</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 22</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT22TipsAndTricks/TTT_22_Tips_and_Tricks.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_22.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT22TipsAndTricks/TTT_22_Tips_and_Tricks.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bash_tips_tricks">Bash Tips &amp; Tricks</h3>
<div class="sect3">
<h4 id="_repeating_previous_commands">Repeating Previous Commands</h4>
<div class="paragraph">
<p>Bash provides a number of different ways to repeat commands you&#8217;ve executed in the past.
The simplest command of all of these is <code>!!</code>.
You can use this on its own:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span class="hll"><span style="color: #555555">cc-dsk-2ss:Desktop bart$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">ls</span> <span style="color: #000080">-l</span>
</span><span style="color: #888888">total 96</span>
<span style="color: #888888">-rw-r--r--@ 1 bart  staff  21301  1 Oct 15:15 Screen Shot 2014-10-01 at 15.15.44.png</span>
<span style="color: #888888">-rw-r--r--@ 1 bart  staff  20982  1 Oct 15:15 Screen Shot 2014-10-01 at 15.15.55.png</span>
<span class="hll"><span style="color: #555555">cc-dsk-2ss:Desktop bart$</span><span style="color: #bbbbbb"> </span><span style="color: #000000;font-weight: bold">!!</span>
</span><span style="color: #888888">ls -l</span>
<span style="color: #888888">total 96</span>
<span style="color: #888888">-rw-r--r--@ 1 bart  staff  21301  1 Oct 15:15 Screen Shot 2014-10-01 at 15.15.44.png</span>
<span style="color: #888888">-rw-r--r--@ 1 bart  staff  20982  1 Oct 15:15 Screen Shot 2014-10-01 at 15.15.55.png</span>
<span style="color: #555555">cc-dsk-2ss:Desktop bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll see that when you issue <code>!!</code> as a command, the first thing it does is print out what it is that is being executed, then it does it.</p>
</div>
<div class="paragraph">
<p>You don&#8217;t have to use !!
on its own, you can use it to represent your previous command as part of a new, larger command.
For example, you may want to try a command to be sure it does what you think, and then, when you know it does, pipe the output to a file, or to another command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span class="hll"><span style="color: #555555">cc-dsk-2ss:Desktop bart$</span><span style="color: #bbbbbb"> </span>find ~/Downloads <span style="color: #000080">-iname</span> <span style="color: #d14">'*.iso'</span>
</span><span style="color: #888888">/Users/bart/Downloads/CentOS-6.5-x86_64-bin-DVD1.iso</span>
<span style="color: #888888">/Users/bart/Downloads/CentOS-6.5-x86_64-LiveDVD.iso</span>
<span class="hll"><span style="color: #555555">cc-dsk-2ss:Desktop bart$</span><span style="color: #bbbbbb"> </span><span style="color: #000000;font-weight: bold">!!</span> | <span style="color: #0086B3">wc</span> <span style="color: #000080">-l</span>
</span><span style="color: #888888">find ~/Downloads -iname '*.iso' | wc -l</span>
<span style="color: #888888">       2</span>
<span style="color: #555555">cc-dsk-2ss:Desktop bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>!!</code> command lets you go back just a single command, you can go back further using the up arrow key (and the down arrow key if you go past the command you wanted by mistake).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default Bash on OS X (and RHEL/CentOS Linux) saves every command you execute into its history, so if you run the same command four times in a row, you will have to hit the up arrow four times to get past it in the history.
You can alter this behaviour by setting the environment variable <code>HISTCONTROL</code> to the value <code>ignoredups</code>.
If you want to configure Bash in this way you&#8217;ll want to set that environment variable automatically each time you open a new Terminal, so to do that you need to add the line below into <code>~/.bash_profile</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">export </span><span style="color: #008080">HISTCONTROL</span><span style="color: #000000;font-weight: bold">=</span>ignoredups</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ubuntu does this by default, and I find it a much nicer way of working, so much so that I add the above command to my <code>~/.bash_profile</code> on all my Macs.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Scrolling through the Bash history is very useful, but sometimes you need to do a more powerful search of previously executed commands, this is where the reverse history search comes in.
To enter into this search mode hit <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>r</kbd></span>, your prompt is now replaced with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #000000;font-weight: bold">(</span>reverse-i-search<span style="color: #000000;font-weight: bold">)</span><span style="color: #d14">':</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you type, what you enter will appear before the <code>:</code>, and the most recent matching command will appear after the <code>:</code>.
To accept a match just hit enter and you&#8217;ll return to the regular prompt with that command entered and your cursor positioned at the end of the command.
To search for older matches to the same search string hit <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>r</kbd></span> again, and if you go past the one you wanted, hit <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>r</kbd></span> to go the other way.
This all sounds more complicated than it is, and with a little practice, you&#8217;ll soon get the hang of it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_moving_the_cursor_to_the_start_of_a_command">Moving the Cursor to the Start of a Command</h4>
<div class="paragraph">
<p>You can move the cursor within a command with the left and right arrow keys, but if you use the up and down arrows or <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>r</kbd></span> to search the history your cursor will always be placed at the end of the command, and you will often need to edit the start of the command.
You can just use the left arrow key until you get there, but with long commands this can be a real pain.
<span class="keyseq"><kbd>Ctrl</kbd>+<kbd>a</kbd></span> will jump the cursor to the start of the command.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_os_x_terminal_tips_tricks">OS X Terminal Tips &amp; Tricks</h3>
<div class="sect3">
<h4 id="_dragging_dropping">Dragging &amp; Dropping</h4>
<div class="paragraph">
<p>If you drop a file or folder onto the Terminal its path will be typed into the Terminal.
This includes proxy icons at the top of document windows, the folder proxy icons at the top of Finder windows, and the folder proxy icon at the top of other Terminal windows.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt22/exampletxt.png" alt="Drag and Drop Examples">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_opening_files_folders_from_the_terminal">Opening Files &amp; Folders From the Terminal</h4>
<div class="paragraph">
<p>You can use the <code>open</code> command to open files from the Terminal as if you had double-clicked them in the Finder.
The usage is very simple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">open PATH_TO_FILE <span style="color: #000000;font-weight: bold">[</span>...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this basic usage, OS X will open the file with the default app for the given file type.
If you use <code>open</code> on a folder then that folder will open in the Finder.
For example, you can open the current folder your Terminal is in with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">open .</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>open</code> command is also very useful for accessing hidden folders in the Finder, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">open ~/Library</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to open a file or folder with an app that is not the default app, you can use the <code>-a</code> flag to tell <code>open</code> which app to open the file or folder with.
For example, the following command will open your ~/.bash_profile file in TextEdit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">open ~/.bash_profile <span style="color: #000080">-a</span> /System/Applications/TextEdit.app/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because using a text editor is a common thing to want to do, <code>open</code> supports a shortcut especially for opening files in TextEdit.
Rather than using <code>-a System/Applications/TextEdit.app/</code>, you can just use <code>-e</code> instead, so we could re-write the previous command as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">open ~/.bash_profile <span style="color: #000080">-e</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, you can also use <code>open</code> to reveal a given file in the Finder, you can do that with the <code>-R</code> flag.
E.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">open <span style="color: #000080">-R</span> /etc/hosts</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this will not work for hidden files.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_final_thoughts_6">Final Thoughts</h3>
<div class="paragraph">
<p>Hopefully, you&#8217;ll find at least some of these tips and tricks useful, and find yourself being a little more efficient on the command line.</p>
</div>
<div class="paragraph">
<p>In the next instalment, we&#8217;ll make a start on what will be a quite long series on networking.
We&#8217;ll start by laying a theoretical foundation, and then get stuck in with a selection of network-related terminal commands.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt23">TTT Part 23 of n &#8212; Networking Intro</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This instalment is the first in what will probably be quite a long mini-series on computer networking.
Before we can look at the terminal commands that allow us to interact with the network, we need to gain an understanding of how computer networking works.
This is a complex topic, ad there&#8217;s a lot to take in.
The individual pieces don&#8217;t make sense without keeping the big-picture in mind, and yet the big picture doesn&#8217;t gel together until you start to understand the detail.</p>
</div>
<div class="paragraph">
<p>Bearing that in mind, this instalment starts the series with a big-picture overview.
We&#8217;ll flesh this overview out over the instalments that follow, adding in the detail that will hopefully make the whole thing click for you.
Ultimately, it&#8217;s actually a very elegant design, but that elegance may not be immediately obvious!</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 23</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episodes 23a &amp; 23b</p>
</div>
<table class="tableblock frame-none grid-none stripes-even stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Episode 23a</th>
<th class="tableblock halign-left valign-top">Episode 23b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT23aNetworkingIntro/TTT_23a_Networking_Intro.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT23bNetworkingIntro/TTT_23b_Networking_Intro.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">Scan the QRcode to listen on a different device</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="assets/qrcodes/TTT_23a.png" alt="QRcode 23a">
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="assets/qrcodes/TTT_23b.png" alt="QRcode 23b">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT23aNetworkingIntro/TTT_23a_Networking_Intro.mp3">play/download the MP3 in your browser (a)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT23bNetworkingIntro/TTT_23b_Networking_Intro.mp3">play/download the MP3 in your browser (b)</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="paragraph">
<p>As complicated as computer networks are today, they&#8217;ve actually gotten a lot simpler than they used to be, for the simple reason that everyone has settled on a single protocol stack&#8201;&#8212;&#8201;the so-called TCP/IP stack.
Because TCP/IP is the clear winner, it&#8217;s the only kind of networking we need to look at in this series.
Had we been doing this 20 years ago, things would have been very different, with different companies each using their own suites of networking protocols.
E.g.
Apple used <a href="https://en.wikipedia.org/wiki/AppleTalk">AppleTalk</a>, DEC used <a href="https://en.wikipedia.org/wiki/DECnet">DECnet</a>, and Microsoft used <a href="https://en.wikipedia.org/wiki/NetBIOS">NetBIOS/NetBEUI</a>.</p>
</div>
<div class="sect2">
<h3 id="_the_tcpip_network_model">The TCP/IP Network Model</h3>
<div class="paragraph">
<p>The internet, and our home and work networks, are all TCP/IP networks.
What we now call TCP/IP started life as <a href="https://en.wikipedia.org/wiki/ARPANET">ARPANET</a>, a project run by the US Advanced Research Projects Agency, or ARPA (today this same institution is called <a href="https://en.wikipedia.org/wiki/DARPA">DARPA</a>, the <em>D</em> standing for <em>Defense</em>).
For home users, the internet is a 1990s phenomenon, but DARPANET became operational way back in 1969.</p>
</div>
<div class="paragraph">
<p>The age of TCP/IP is a mixed blessing.
On the one hand, it&#8217;s been around more than long enough to have most of the bugs shaken out of it.
But, on the other hand, it was designed before anyone understood what it would become, so problems like security simply weren&#8217;t considered in the design.
Security has had to be retrofitted afterwards, and that&#8217;s not exactly been a smooth process!</p>
</div>
<div class="sect3">
<h4 id="_key_design_features">Key Design Features</h4>
<div class="ulist">
<ul>
<li>
<p>TCP/IP breaks data into small manageable chunks called packets, and each packet travels across the network independently.
The techno-jargon for this is that TCP/IP networks are <em>packet switched networks</em>.</p>
</li>
<li>
<p>TCP/IP is a <em>best-effort</em> protocol suite&#8201;&#8212;&#8201;routers can drop packets if they need to.</p>
</li>
<li>
<p>TCP/IP is a strictly layered stack of protocols&#8201;&#8212;&#8201;interactions are only possible between adjacent protocols.
Ethernet talks to IP, IP talks to TCP, TCP talks to TLS, TLS talks to HTTP, and vice-versa, but HTTP can never skip over TLS, TCP &amp; IP, and talk directly to Ethernet.</p>
</li>
<li>
<p>There are many more than four protocols in the stack, but they are grouped into four categories called network abstraction layers:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <strong>Link Layer</strong></p>
</li>
<li>
<p>The <strong>Internet Layer</strong></p>
</li>
<li>
<p>The <strong>Transport Layer</strong></p>
</li>
<li>
<p>The <strong>Application Layer</strong></p>
</li>
</ol>
</div>
</li>
<li>
<p>Only protocols adjacent to each other in the stack can communicate with each other, and all communication is through well defined APIs (Application Programming Interfaces).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can think of the protocols in the stack as having agreed contracts with adjacent protocols.
Each protocol advertises the functionality it offers, and it specifies what information it needs to be given in order to deliver that functionality.
Adjacent protocols only need to understand the contracts, not how those contracts are fulfilled.
This is particularly powerful at the link layer, where it allows the practicalities of the physical media the data is travelling over to be abstracted away from the layers above.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_four_network_abstraction_layers">The Four Network Abstraction Layers</h3>
<div class="sect3">
<h4 id="_1_the_link_layer">1 &#8212; The Link Layer</h4>
<div class="paragraph">
<p>The link layer allows a single packet of data to be sent within a network.
Assuming you have only one home network, then the link layer allows packets to get from any one device on your home to any other device on your home.</p>
</div>
<div class="paragraph">
<p>Within our home networks, the Ethernet protocol is used to transmit packets.
Ethernet uses MAC (Media Access Control) addresses to specify the source and destination for each packet.
We actually use two different implementations of Ethernet within our homes&#8201;&#8212;&#8201;we use network cards that send Ethernet packets other over twisted pairs of copper wire, officially called UTP Patch Cables, but almost universally (and technically incorrectly) known as <em>Ethernet cables</em>.
We also use network cards that use radio waves to transmit Ethernet packets, and we call this WiFi.</p>
</div>
<div class="paragraph">
<p>Because of the layering of network protocols, nothing higher up the stack needs to take any account whatsoever of how the data got from one device to another.
All the protocol above has to know is that Ethernet can send a packet from one MAC address to another.
How that&#8217;s achieved is irrelevant to that protocol.</p>
</div>
<div class="paragraph">
<p>Ethernet doesn&#8217;t have the game all to itself within Layer 1.
Sure, it gives us what we call wired and wireless networks, but there are other ways to get data from one end of a physical connection to another.
For example, there is a protocol called FiberChannel that can send data through fiber optic cables, ISDN &amp; ADSL can get data over a phone line, and there are more protocols for getting data through TV cables than you can shake a proverbial stick at!</p>
</div>
<div class="paragraph">
<p>The key point is that no matter what protocols are used in Layer 1, the protocols used in the layers above don&#8217;t care at all about the practicalities, all that matters is the contracts between protocols.</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_the_internet_layer">2 &#8212; The Internet Layer</h4>
<div class="paragraph">
<p>The link layer can move a packet of data between any two devices within a single network. Layer two takes things a step further, allowing for the movement of a single a packet of data between any two devices located anywhere within a set of connected networks.</p>
</div>
<div class="paragraph">
<p>Networks are connected to each other by routers.
A router is a device with at least two network interfaces, one in each connected network.
Our home routers usually connect just two networks together, our home network and our ISP&#8217;s network.
But, the routers within our ISPs and within the internet backbone usually connect many more than two networks to each other.</p>
</div>
<div class="paragraph">
<p>A set of interconnected networks is known as an internetwork or internet, and The Internet is just the biggest internetwork in the world.
The Internet is to internets what the Moon is to moons.
I could create three logical networks in my house, and connect them together with some routers, and I would have created my own internet.
The Internet is only special in that it&#8217;s the internet we as a planet have decided to use for planet-wide computer-to-computer communication.
This is why it&#8217;s grammatically correct to capitalise <em>the Internet</em> when you&#8217;re talking about that world-wide network we all love so much.</p>
</div>
<div class="paragraph">
<p>One of the most amazing things that the internet layer is responsible for is figuring out how packets can get from any one point on an internet to any other arbitrary point anywhere else on that internet, even when the shortest route between those two points often crosses tens of routers.
This really complex task is known simply as &#8216;routing&#8217;, and that it works at all really has to be one of the seven wonders of the digital world!</p>
</div>
<div class="paragraph">
<p>There is only one Layer 2 protocol in use on the Internet and our home networks, and that&#8217;s the Internet Protocol, or simply the IP protocol.
The IP protocol addresses devices with IP addresses.
There are two IP addressing schemes in use today, IPv4, and IPv6.</p>
</div>
<div class="paragraph">
<p>Within our routers is where we first begin to see the power of protocol stacking.
Routers are Layer 2 devices, but they have to use Layer 1 to move packets around.
Our home routers all speak IP, but they also have to speak one or more Layer 1 protocols.
Because all our home networks are Ethernet networks, our routers all speak Ethernet, but it&#8217;s the other protocols the routers speak that divide them into groups.
ADSL modems speak ADSL and Ethernet, ISDN routers speak ISDN and Ethernet, cable modems speak at least one of the zoo of cable modem protocols, and Ethernet.
As a packet moves from router to router, it moves up and down the stack from IP to Ethernet to get from your computer to your router, and then back up to IP so the router can figure out what to do with the packet. If it&#8217;s for the internet, then it goes down to, say, ADSL, then it arrives at your ISP&#8217;s router where it again gets handed up the stack to the IP.
IP then decides which direction to send it in next, then it uses a Layer 1 protocol to send that packet to the next router, perhaps by fiber optic cable, perhaps by satellite link, it doesn&#8217;t matter, it will arrive at the other end, get brought up the stack to IP, and then the next router will send it along the next Layer 1 link.
The key point is that the same IP packet can be sent over lots of different Layer 1 protocols as it moves across an internet from its source IP address to its destination IP address.</p>
</div>
<div class="paragraph">
<p>Finally, it should be noted that the IP protocol is a complex beast, and while it&#8217;s mostly used to send packets of data, known as datagrams, from one IP address to another, it can do more.
The key to this is that the IP protocol contains a bunch of subprotocols.
For example, IGMP allows for so-called multi-cast traffic where a single packet gets delivered to many recipients instead of one.
Another subprotocol we&#8217;ll be seeing again is ICMP, which is used for network troubleshooting.</p>
</div>
</div>
<div class="sect3">
<h4 id="_3_the_transport_layer">3 &#8212; The Transport Layer</h4>
<div class="paragraph">
<p>Layers one and two deal with single packets of data.
We usually want to send or receive a lot more than a single packet, so we need to layer some protocols on top of IP to deal with that reality.</p>
</div>
<div class="paragraph">
<p>Remember, each packet is treated as being entirely independent by layers one and two, and each packet is delivered on a <em>best effort</em> basis. So if we send 100 packets, it&#8217;s likely one or more of them will go missing, and it&#8217;s also very likely that the ones that do arrive will arrive out of order.
Because the Internet is very heavily interconnected, unless your source and destination are directly connected by a single router, there are almost always many different possible paths through the Internet between any two IP addresses.
ISPs will usually have many interconnections with other ISPs, and they will load balance packets across these different interconnections.
The algorithm could be as simple as &#8220;send 10 packets this way, then 5 that way, then 20 that other way, repeat&#8221;.
Even if our 100 packets all get to that router one after the other, they&#8217;ll get separated into little groups spread over those three different routes.
Then they&#8217;ll meet another router which may separate the groups of packets into even smaller groups and so on.
By the time the surviving packets all get to the destination IP address, they really could be in any order, and of course, every router along the way has the choice to drop a packet if it gets overloaded.</p>
</div>
<div class="paragraph">
<p>Layer 3 protocols organise data flows into streams of related packets known as connections.
Layer 3 also introduces the concept of port numbers.
A Layer 3 connection has a source IP address and port, and a destination IP address and port.</p>
</div>
<div class="paragraph">
<p>There are two Layer 3 protocols in common use today, TCP, and UDP.</p>
</div>
<div class="paragraph">
<p>UDP (User Datagram Protocol) is the simplest of the two protocols.
UDP is still a <em>best-effort</em> protocol, and there is still no concept of packets (known as datagrams) being related to one another.
UDP does introduce the concept of source and destination port numbers though, allowing the datagrams to be routed to individual applications or services on the receiving device.
There is no guarantee that a stream of UDP datagrams sent from the same source to the same destination will arrive in the order they were sent.
It&#8217;s up to the receiving application or service to decide what to do about out of order data.
It&#8217;s very common for out of order packets to be ignored by the recipient.</p>
</div>
<div class="paragraph">
<p>You might ask yourself, why would anyone want a protocol that&#8217;s happy to let data go missing?
The answer is that it&#8217;s fast.
By not waiting around for straggler packets you can get close to real-time streams of data, even if it is imperfect data.
So, when speed matters more than perfection, UDP is the right choice.
This is why UDP is often used for streaming media, and for internet voice chat services like Skype.
As well as speed, UDP also has the advantage of being simple, so it&#8217;s CPU and RAM efficient, which is why it&#8217;s also used for very high-volume protocols like DNS and syslog (more on DNS in future instalments).</p>
</div>
<div class="paragraph">
<p>TCP (Transmission Control Protocol) takes things a step further and promises to transmit a stream of data from one IP address to another in such a way that all data that is sent arrives, and all data arrives in the order in which it was sent.
It does this using buffers.
The sender holds a copy of all sent packets in a buffer in case they go missing and have to be resent, and the receiver uses a buffer to reassemble the data back into the right order.
Packets that come in are added to the buffer with gaps being left for their delayed friends.
If a packet takes too long to arrive, it&#8217;s assumed to be missing and the recipient asks the sender to re-send it.
The recipient also sends acknowledgements of what it has received so far back to the sender, so that the sender can remove safely transmitted data from its buffer.
There&#8217;s a lot of complexity here.
Compared to UDP, TCP is much less efficient in every way&#8201;&#8212;&#8201;the buffers take up RAM (though that may be dedicated RAM inside the network card), the more complex algorithm takes up CPU (that might also get off-loaded to the network card), the buffering adds latency, and all that signalling overhead takes up bandwidth.</p>
</div>
<div class="paragraph">
<p>However, all these inefficiencies are a small price to pay for the promise that the data received will be identical to the data sent!</p>
</div>
</div>
<div class="sect3">
<h4 id="_4_the_application_layer">4 &#8212; The Application Layer</h4>
<div class="paragraph">
<p>The bottom three layers are in effect the infrastructure of the internet. The application layer is where the user-facing functionality starts.
The vast majority of the protocols we interact with through the various apps we use are Layer 4 protocols.
E.g.
SMTP, IMAP &amp; POP are the Layer 4 protocols we use to send and receive email.
HTTP, HTTPS, and to a lesser extent FTP are the Layer 4 protocols we use to surf the net.
The domain name system, or DNS, is the Layer 4 protocol we use to abstract away IP addresses.
Online games sit in Layer 4, instant messaging sits in Layer 4, VoIP sits in Layer 4&#8201;&#8212;&#8201;I could go on and on and on!</p>
</div>
<div class="paragraph">
<p>The majority of Layer 4 protocols sit on top of TCP, but a sizeable amount sit on top of UDP instead.
Some applications make use of both&#8201;&#8212;&#8201;for example, when you log on to Skype you&#8217;re using a TCP connection. When you send instant messages via Skype you&#8217;re also almost certainly using TCP, and the under-the-hood signalling back-and-forth needed to initialise a call is also almost certainly done over TCP. All that happens before the app hands over to UDP for transmission of the actual sound and/or video streams.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_putting_it_all_together_2">Putting it All Together</h3>
<div class="paragraph">
<p>From our point of view as a user trying to communicate across our home network or the internet, the process always starts at the application layer.
We are sending an email, or we are viewing a web page, or we are downloading a file, or we are playing a game, or we are chatting with friends, or whatever.</p>
</div>
<div class="paragraph">
<p>As a worked example, let&#8217;s look at what happens when you use your web browser to try to visit <code>http://www.so-4pt.net/~bart/ttt23/</code>.</p>
</div>
<div class="paragraph">
<p>Before you can visit that URL, I have to have put some digital ducks in a row on my end.
Firstly, I have to have arranged for a DNS server to advertise to the world that my webserver has the IP address <code>46.22.130.125</code>, and, I have to have the server with that IP address configured to act as a webserver.</p>
</div>
<div class="paragraph">
<p>On my server, a piece of software has to be running which speaks the HTTP protocol. We&#8217;ll call this piece of software the webserver process.
This process has to have asked the OS to &#8216;listen&#8217; on TCP port 80 (the standard HTTP port).
That means that when any computer initiates a TCP connection to port 80 on my server, my server&#8217;s OS will hand that connection to my webserver process.</p>
</div>
<div class="paragraph">
<p>Assuming I have everything properly configured on my end, you open your favourite browser, and type <code><a href="http://www.so-4pt.net/~bart/ttt23/" class="bare">http://www.so-4pt.net/~bart/ttt23/</a></code> into the address bar, and hit enter.</p>
</div>
<div class="paragraph">
<p>Your browser speaks HTTP, so it starts by formulating an HTTP request which will look something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="html">GET /~bart/ttt23/ HTTP/1.1
Accept:	         text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Encoding: gzip, deflate
Accept-Language: en-gb
Host:            www.so-4pt.net
User-Agent:      Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10) AppleWebKit/600.1.25 (KHTML, like Gecko) Version/8.0 Safari/600.1.25</code></pre>
</div>
</div>
<div class="paragraph">
<p>It then has to figure out, based on the URL you typed, what IP address it should strike up a TCP conversation with!</p>
</div>
<div class="paragraph">
<p>To do that it asks your OS to do a DNS lookup on its behalf.
For simplicity, let&#8217;s assume your OS had the answer in its cache, so it just gives the browser the answer that <code>www.so-4pt.net</code> maps to the IP address to <code>46.22.130.125</code>.
We&#8217;ll be looking at the DNS protocol in much more detail in a future instalment!</p>
</div>
<div class="paragraph">
<p>Your browser then asks your OS to open a TCP connection to port 80 on <code>46.22.130.125</code> on its behalf.
Once your OS has done that, a TCP connection will exist between your browser and the webserver process on my server.
As far as either end of that connection is concerned, any data written into the connection on their end will pop out on the other end exactly as it was written.
This is a two-way connection, so the browser can send data to the webserver process, and the webserver process can send data back to the browser.</p>
</div>
<div class="paragraph">
<p>Your browser then sends the HTTP request it formulated to the webserver process on my server through the TCP connection your OS negotiated with my OS on your browser&#8217;s behalf.
The webserver process receives the request, understands it because it speaks HTTP, and formulates a response in the form of an HTTP response that will look something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="html"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="code"><pre>HTTP/1.1 200 OK
Date: Fri, 24 Oct 2014 22:40:07 GMT
Server: Apache/2.2.15 (CentOS)
Last-Modified: Fri, 24 Oct 2014 22:33:02 GMT
ETag: "1e40df-be-50632c385a380"
Accept-Ranges: bytes
Content-Length: 190
Connection: close
Content-Type: text/html; charset=UTF-8

<span style="color: #000080">&lt;html&gt;</span>
<span style="color: #000080">&lt;head&gt;</span>
 <span style="color: #000080">&lt;title&gt;</span>Hello Termninal Tamer!<span style="color: #000080">&lt;/title&gt;</span>
<span style="color: #000080">&lt;/head&gt;</span>
<span style="color: #000080">&lt;body&gt;</span>
<span style="color: #000080">&lt;h1&gt;</span>Hello Terminal Tamer!<span style="color: #000080">&lt;/h1&gt;</span>
<span style="color: #000080">&lt;p&gt;</span>I hope you<span style="color: #800080">&amp;#39;</span>re enjoying the series thus far!<span style="color: #000080">&lt;/p&gt;</span>
<span style="color: #000080">&lt;p&gt;&lt;em&gt;</span>-- Bart<span style="color: #000080">&lt;/em&gt;&lt;/p&gt;</span>
<span style="color: #000080">&lt;/body&gt;</span>
<span style="color: #000080">&lt;/html&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>You might notice that this response includes the HTML that makes up the content of the page as well as some metadata in the form of an HTTP response code and some HTTP headers.</p>
</div>
<div class="paragraph">
<p>Once my webserver process has formulated this response somehow (in this case by reading a file from the hard disk on my server and copying its contents into the data part of the HTTP response) it sends the response to your browser through the TCP connection.</p>
</div>
<div class="paragraph">
<p>Your browser then interprets the response and acts accordingly.
The <code>200 OK</code> response code tells your browser the request was successful, and that the HTML it got back is not an error message or a redirect or anything like that, and is the HTML for the web page you requested.
It then interprets that HTML and draws the resulting web page on your screen.</p>
</div>
<div class="paragraph">
<p>The key point is that your browser and my webserver app communicated using HTTP, and they were oblivious to how the data got from one to the other.
All either side knew about the network was that TCP was at their service.
How TCP made it possible for the data to go from your browser to my webserver is irrelevant to them both.
Notice how neither the HTTP request nor the HTTP response contained either an IP address or a MAC address. Those things happen below HTTP in the stack, so they are irrelevant to HTTP.</p>
</div>
<div class="paragraph">
<p>The takeaway from this example is that at a logical level, both sides talked HTTP to each other.
Logically, communication is always directly across the stack.</p>
</div>
<div class="paragraph">
<p>Of course, TCP isn&#8217;t magic, and the TCP implementations inside the operating systems on your computer and my server sent a whole load of IP packets over and back between each other to make that TCP connection happen.</p>
</div>
<div class="paragraph">
<p>The two TCP implementations were totally oblivious to how the data got between the two computers though.
All our TCP implementations knew is that they could pass a packet down to the IP implementations within our operating systems and that our IP implementations would send the packet on their behalf.</p>
</div>
<div class="paragraph">
<p>So far, nothing has actually left our computers yet!
All of this chatter between the network layers has been in software. It&#8217;s not until the IP implementations in our OS finally hand those packets down to the Ethernet implementation within our OSes that anything physical actually happens!</p>
</div>
<div class="paragraph">
<p>To understand how the packets actually move from one physical computer to another, let&#8217;s focus on what happens to just one single IP packet and let&#8217;s chose a packet that&#8217;s being sent from your computer to my server.
Let&#8217;s assume your computer is using WiFi to connect to the internet and that you have an ADSL router.</p>
</div>
<div class="paragraph">
<p>We join our packet in the IP implementation of your computer&#8217;s OS.
The first thing your computer&#8217;s IP implementation does is look at the IP address on the packet and compare it to the IP address range of your network.
My server is not in your network, so the IP implementation concludes that the packet is not local and so must be routed.
Because your network is properly configured, your OS knows the IP and MAC addresses of your router&#8217;s internal network interface.
Your IP implementation takes the IP packet and hands it to the Ethernet implementation with your OS along with the MAC address it should be sent to, that of your router.
Your OS&#8217;s Ethernet implementation then wraps some metadata around the IP packet to turn it into an Ethernet packet.
Finally, using the driver software for your WiFi card, your OS&#8217;s Ethernet implementation transmits the Ethernet packet which contains the IP packet we are following as modulated radio waves.</p>
</div>
<div class="paragraph">
<p>Your router&#8217;s wireless card receives the radio waves, interprets them and hands the Ethernet packet up to the Ethernet implementation in your router&#8217;s firmware.
Your router&#8217;s Ethernet firmware unwraps the packet and hands it up to your router&#8217;s IP firmware.
Your router&#8217;s IP firmware looks at the destination address on the IP packet and sees that it&#8217;s destined for the Internet, so it hands the packet down to your router&#8217;s ADSL firmware which wraps the packet again and converts it into electrical impulses which run through the phone network to your ISP&#8217;s router.</p>
</div>
<div class="paragraph">
<p>Your ISP&#8217;s router strips off the ADSL wrapper and passes the packet up to its IP firmware.
The router&#8217;s IP firmware looks at the destination IP and then decides which of your ISP&#8217;s many interconnections to other routers is best suited to this packet.
It then wraps the packet in the appropriate Layer 1 wrapper for the connection it chooses and send it on its way.
The next router along again strips off the Layer 1 wrapper, looks at the IP address, decides which way to route it, wraps it as appropriate and sends it on to the next router.
This continues for as long as it takes for the packet to arrive at the router in the data centre where my webserver lives. I&#8217;m in Ireland and so is my server, and for me, it still takes 8 &#8216;hops&#8217; for the packet to get from my router to the router in the data centre hosting my server. For people farther away it will be even more.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can use the terminal command <code>traceroute</code> (<code>tracert</code> on Windows) to see what routers a packet follows from your computer to my server as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span class="hll"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>traceroute <span style="color: #000080">-n</span> 46.22.130.125
</span><span style="color: #888888">traceroute to 46.22.130.125 (46.22.130.125), 64 hops max, 52 byte packets</span>
<span style="color: #888888"> 1  192.168.10.1  0.500 ms  0.250 ms  0.241 ms</span>
<span style="color: #888888"> 2  192.168.192.1  0.726 ms  0.912 ms  1.027 ms</span>
<span style="color: #888888"> 3  * * *</span>
<span style="color: #888888"> 4  * * *</span>
<span style="color: #888888"> 5  109.255.249.254  16.997 ms  10.094 ms  15.042 ms</span>
<span style="color: #888888"> 6  84.116.238.58  21.565 ms  10.034 ms  13.283 ms</span>
<span style="color: #888888"> 7  213.46.165.2  16.421 ms  13.561 ms  15.019 ms</span>
<span style="color: #888888"> 8  80.91.247.71  15.001 ms  14.692 ms  20.001 ms</span>
<span style="color: #888888"> 9  213.248.83.94  11.905 ms  18.292 ms  9.826 ms</span>
<span style="color: #888888">10  78.153.192.34  15.139 ms  40.017 ms  24.845 ms</span>
<span style="color: #888888">11  78.153.192.65  24.942 ms  17.280 ms  12.718 ms</span>
<span style="color: #888888">12  46.22.130.125  36.758 ms !Z  13.228 ms !Z  15.187 ms !Z</span>
<span style="color: #555555">bart-iMac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Each line of output is a router your packet passed through.
Some routers refuse to return the metadata traceroute requests, so they show up as a row of stars.
The first router you see will be your home router (because I have a complex configuration, the first two routers in my trace are actually within my house), the last line will be my webserver, and the second-to-last line will be the router in the data centre that hosts my webserver.
Subtracting those four IPs out, there are eight routers between my home router and the router in my data centre.</p>
</div>
<div class="paragraph">
<p>Note that we&#8217;ll be looking at <code>traceroute</code> in more detail in a future instalment.</p>
</div>
<div class="paragraph">
<p>(If you&#8217;re not running as an admin you may find that traceroute is not in your path.)</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The router in my data centre will get the packet, unwrap whatever Layer 1 wrapper is around it, pass it up to its IP firmware, and look at the destination IP.
Because my data centre and server are correctly configured, the router&#8217;s IP firmware will recognise that this packet is destined for a device on its local network, and know the MAC address of my server.
It will pass the packet down to its Ethernet firmware one last time, asking it to send the packet to my server&#8217;s MAC address.
The router&#8217;s Ethernet firmware will convert the packet to electrical signals, and send them down the UTP patch cable connected to my server.</p>
</div>
<div class="paragraph">
<p>My server&#8217;s network card will receive the Ethernet packet, unwrap it, and pass it up to my server&#8217;s OS&#8217;s IP implementation, which will remove the IP wrapper and pass the packet to TCP which will finally know what to do with the data inside the last wrapper, and eventually, those 1s and 0s will get to the webserver process as a part of the HTTP request.</p>
</div>
<div class="paragraph">
<p>The key point is how the layers interact.
As we saw initially, logically the browser and the server talked HTTP to each other, but physically, the packet started in the application layer and moved down the layers to the link layer, then up and down between the link and internet layers many times as it moved across before finally being handed all the way up the layers back to the application layer when it arrived at my server.
The diagram below illustrates this idea:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="https://commons.wikimedia.org/wiki/File%3AIP_stack_connections.svg"><img src="assets/ttt23/512px-IP_stack_connections.svg.png" alt="IP stack connections"></a>
</div>
</div>
<div class="paragraph">
<p>So, we followed the path of a single IP packet, how many IP packets were actually needed for this very simple HTTP transaction?
The answer is 12 (see below).
Only a subset of those 12 packets contained the actual data transmitted. The rest were IP packets sent by TCP in order to negotiate and un-negotiate the TCP connection, and to signal back and forth what packets had and had not been received safely.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can see the packets needed to fetch my website by opening two terminal windows and issuing two commands.</p>
</div>
<div class="paragraph">
<p>In the first window, we&#8217;ll use the <code>tcpdump</code> command to print out each packet that is sent from your computer to my server as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">sudo </span>tcpdump <span style="color: #000080">-nn</span> host 46.22.130.125</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will print some metadata and then sit there and do nothing until matching packets are sent or received.</p>
</div>
<div class="paragraph">
<p>In the other terminal window we will use the <code>curl</code> command to fetch the website in question (and print out the HTTP request and response for good measure) using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span class="hll"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>curl <span style="color: #000080">-v</span> http://www.so-4pt.net/~bart/ttt23/
</span><span style="color: #888888">* Hostname was NOT found in DNS cache</span>
<span style="color: #888888">*   Trying 46.22.130.125...</span>
<span style="color: #888888">* Connected to www.so-4pt.net (46.22.130.125) port 80 (#0)</span>
<span style="color: #888888">&gt; GET /~bart/ttt23/ HTTP/1.1</span>
<span style="color: #888888">&gt; User-Agent: curl/7.37.1</span>
<span style="color: #888888">&gt; Host: www.so-4pt.net</span>
<span style="color: #888888">&gt; Accept: */*</span>
<span style="color: #888888">&gt;</span>
<span style="color: #888888">&lt; HTTP/1.1 200 OK</span>
<span style="color: #888888">&lt; Date: Sat, 25 Oct 2014 14:44:30 GMT</span>
<span style="color: #888888">* Server Apache/2.2.15 (CentOS) is not blacklisted</span>
<span style="color: #888888">&lt; Server: Apache/2.2.15 (CentOS)</span>
<span style="color: #888888">&lt; Last-Modified: Fri, 24 Oct 2014 22:33:02 GMT</span>
<span style="color: #888888">&lt; ETag: &amp;quot;1e40df-be-50632c385a380&amp;quot;</span>
<span style="color: #888888">&lt; Accept-Ranges: bytes</span>
<span style="color: #888888">&lt; Content-Length: 190</span>
<span style="color: #888888">&lt; Connection: close</span>
<span style="color: #888888">&lt; Content-Type: text/html; charset=UTF-8</span>
<span style="color: #888888">&lt;</span>
<span style="color: #888888">&lt;html&gt;</span>
<span style="color: #888888">&lt;head&gt;</span>
<span style="color: #888888"> &lt;title&gt;Hello Termninal Tamer!&lt;/title&gt;</span>
<span style="color: #888888">&lt;/head&gt;</span>
<span style="color: #888888">&lt;body&gt;</span>
<span style="color: #888888">&lt;h1&gt;Hello Terminal Tamer!&lt;/h1&gt;</span>
<span style="color: #888888">&lt;p&gt;I hope you&amp;#39;re enjoying the series thus far!&lt;/p&gt;</span>
<span style="color: #888888">&lt;p&gt;&lt;em&gt;-- Bart&lt;/em&gt;&lt;/p&gt;</span>
<span style="color: #888888">&lt;/body&gt;</span>
<span style="color: #888888">&lt;/html&gt;</span>
<span style="color: #888888">* Closing connection 0</span>
<span style="color: #555555">bart-iMac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that every line starting with a <code>*</code> is debug information telling us what <code>curl</code> is doing, the lines starting with a <code>&gt;</code> at the top of the output are the HTTP request, and the lines starting with <code>&lt;</code> in the middle of the output are the HTTP response header.
The remaining lines are the data part of the response, which in this case is the HTML code for the page.</p>
</div>
<div class="paragraph">
<p>Once we enter the above command in our second terminal window we should see some lines whiz by in our first terminal window.
Click on this window and end the capture by hitting <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>c</kbd></span>.
You should now have something that looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">sudo </span>tcpdump <span style="color: #000080">-nn</span> host 46.22.130.125
<span style="color: #888888">Password:
tcpdump: data link type PKTAP
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on pktap, link-type PKTAP (Packet Tap), capture size 65535 bytes
15:56:05.925438 IP 192.168.10.42.64705 &gt; 46.22.130.125.80: Flags [S], seq 724742970, win 65535, options [mss 1460,nop,wscale 5,nop,nop,TS val 535977182 ecr 0,sackOK,eol], length 0
15:56:05.937240 IP 46.22.130.125.80 &gt; 192.168.10.42.64705: Flags [S.], seq 2089856615, ack 724742971, win 14480, options [mss 1460,sackOK,TS val 2641303196 ecr 535977182,nop,wscale 7], length 0
15:56:05.937323 IP 192.168.10.42.64705 &gt; 46.22.130.125.80: Flags [.], ack 1, win 4117, options [nop,nop,TS val 535977193 ecr 2641303196], length 0
15:56:05.937392 IP 192.168.10.42.64705 &gt; 46.22.130.125.80: Flags [P.], seq 1:91, ack 1, win 4117, options [nop,nop,TS val 535977193 ecr 2641303196], length 90
15:56:05.948831 IP 46.22.130.125.80 &gt; 192.168.10.42.64705: Flags [.], ack 91, win 114, options [nop,nop,TS val 2641303207 ecr 535977193], length 0
15:56:05.949785 IP 46.22.130.125.80 &gt; 192.168.10.42.64705: Flags [P.], seq 1:460, ack 91, win 114, options [nop,nop,TS val 2641303208 ecr 535977193], length 459
15:56:05.949806 IP 192.168.10.42.64705 &gt; 46.22.130.125.80: Flags [.], ack 460, win 4103, options [nop,nop,TS val 535977204 ecr 2641303208], length 0
15:56:05.949936 IP 192.168.10.42.64705 &gt; 46.22.130.125.80: Flags [F.], seq 91, ack 460, win 4103, options [nop,nop,TS val 535977204 ecr 2641303208], length 0
15:56:05.950013 IP 46.22.130.125.80 &gt; 192.168.10.42.64705: Flags [F.], seq 460, ack 91, win 114, options [nop,nop,TS val 2641303208 ecr 535977193], length 0
15:56:05.950023 IP 192.168.10.42.64705 &gt; 46.22.130.125.80: Flags [F.], seq 91, ack 461, win 4103, options [nop,nop,TS val 535977204 ecr 2641303208], length 0
15:56:06.023929 IP 46.22.130.125.80 &gt; 192.168.10.42.64705: Flags [.], ack 92, win 114, options [nop,nop,TS val 2641303282 ecr 535977204], length 0
15:56:06.023965 IP 192.168.10.42.64705 &gt; 46.22.130.125.80: Flags [.], ack 461, win 4103, options [nop,nop,TS val 535977278 ecr 2641303282], length 0
^C
12 packets captured
45 packets received by filter
0 packets dropped by kernel
</span><span style="color: #555555">bart-iMac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Above and below the captured packets you&#8217;ll see some header and footer information, but each line starting with a time code in the form of <code>hh:mm:ss.mmmmmm</code> is an IP packet travelling between your computer and my webserver.
You can see that the source is shown as an IP address and port number followed by an arrow pointing to the destination which is also an IP address and port number.
This can look a bit confusing because the port number is added to the IP address as a fifth number.
You&#8217;ll see that my server always uses port 80, but your computer will have chosen a random high port number (64705 in the above capture).
Each time you repeat this process the port on my server will remain 80, but the high port on your computer will be different each time.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll be looking at <code>tcpdump</code> in much more detail later in a future instalment.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_final_thoughts_7">Final Thoughts</h3>
<div class="paragraph">
<p>This is a confusing and dense topic.
I&#8217;d be very surprised if it all sank in on the first reading.
For now, if just the following key points have sunk in, you&#8217;re golden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Networking is complicated!</p>
</li>
<li>
<p>Our computer networks use a stack of protocols known as TCP/IP</p>
</li>
<li>
<p>We think of the stack of protocols as being broken into four layers:</p>
<div class="ulist">
<ul>
<li>
<p>The Link Layer&#8201;&#8212;&#8201;lets computers that are on the same network send single packets of data to each other</p>
</li>
<li>
<p>The Internet Layer&#8201;&#8212;&#8201;lets computers on different networks send single packets of data to each other</p>
</li>
<li>
<p>The Transport Layer&#8201;&#8212;&#8201;lets computers send meaningful streams of data between each other</p>
</li>
<li>
<p>The Application Layer&#8201;&#8212;&#8201;where all the networked apps we use live</p>
</li>
</ul>
</div>
</li>
<li>
<p>Logically, data travels across the layers&#8201;&#8212;&#8201;HTTP to HTTP, TCP to TCP, IP to IP, Ethernet to Ethernet, but physically, data travels up and down the stack, one layer to another, only moving from one device to another when it gets to the Link Layer at the very bottom of the stack.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the following instalments, we&#8217;ll start to make our way up the stack, looking at each layer in more detail, and learning about terminal commands that interact with some of the protocols that make up each layer.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt24">TTT Part 24 of n &#8212; Ethernet &amp; ARP</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In <a href="#ttt23">the previous instalment</a>, we took a big-picture look at how TCP/IP networking works.
As a quick reminder, the most important points were:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Networking is complicated!</p>
</li>
<li>
<p>Our computer networks use a stack of protocols known as TCP/IP</p>
</li>
<li>
<p>We think of the stack of protocols as being broken into four layers:</p>
<div class="ulist">
<ul>
<li>
<p>The Link Layer&#8201;&#8212;&#8201;lets computers that are on the same network send single packets of data to each other</p>
</li>
<li>
<p>The Internet Layer&#8201;&#8212;&#8201;lets computers on different networks send single packets of data to each other</p>
</li>
<li>
<p>The Transport Layer&#8201;&#8212;&#8201;lets computers send meaningful streams of data between each other</p>
</li>
<li>
<p>The Application Layer&#8201;&#8212;&#8201;where all the networked apps we use live</p>
</li>
</ul>
</div>
</li>
<li>
<p>Logically, data travels across the layers&#8201;&#8212;&#8201;HTTP to HTTP, TCP to TCP, IP to IP, Ethernet to Ethernet, but physically, data travels up and down the stack, one layer to another, only moving from one device to another when it gets to the Link Layer at the very bottom of the stack.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this instalment, we&#8217;ll take a quick look at the lowest of these four layers&#8201;&#8212;&#8201;the Link Layer.
Specifically, we&#8217;ll look at MAC addresses, the difference between hubs, switches, and routers, and the ARP protocol.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 24</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 24</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT24EthernetAndARP/TTT_24_Ethernet_and_ARP.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_24.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT24EthernetAndARP/TTT_24_Ethernet_and_ARP.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_before_we_start">Before we Start &#8230;&#8203;</h3>
<div class="paragraph">
<p>Later in the instalment, we&#8217;re going to refer back to results of the following command and explain it, but it takes time for the packets to be collected, so before we start, please open a Terminal window and leave the following command running for at least 5 or 10 minutes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">sudo </span>tcpdump <span style="color: #000080">-nneq</span> arp</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ethernet_a_quick_overview">Ethernet &#8212; A Quick Overview</h3>
<div class="paragraph">
<p>As we discussed in the previous instalment, the bottom of the four layers in the TCP/IP model is the <em>Link Layer</em>.
Its function is to move a single packet of data from one device connected to a network to another device connected to the same network.
Within our homes, we use Ethernet to provide our Layer 1 connectivity.
We use two different implementations of Ethernet&#8201;&#8212;&#8201;we use Ethernet over copper wire (usually called Ethernet cables), and we use Ethernet over radio waves, commonly known as WiFi.</p>
</div>
<div class="paragraph">
<p>The Ethernet protocol addresses hosts on the network by their Media Access Control address, or MAC address.
Every network card on your computer has a MAC address, regardless of whether it&#8217;s a wired or wireless Ethernet card.
An Ethernet packet travelling through your network has a source and a destination MAC address.</p>
</div>
<div class="paragraph">
<p>Ethernet was designed to work on a shared medium&#8201;&#8212;&#8201;i.e., all network cards see all Ethernet packets travelling across the network.
In normal use, a network card ignores all Ethernet packets that are not addressed to it, but a card can be instructed to pass all packets that reach it up to the OS, even those addressed to different MAC addresses. This is known as <em>promiscuous mode</em>.</p>
</div>
<div class="paragraph">
<p>The special MAC address <code>ff:ff:ff:ff:ff:ff</code> is used to <em>broadcast</em> an Ethernet packet to every device on the network.
All network cards consider packets addressed to this special MAC address to be addressed to them, and pass that packet up to the OS, even when not in promiscuous mode.</p>
</div>
<div class="paragraph">
<p>You can see the MAC addresses associated with your Mac/Linux/Unix computer with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ifconfig <span style="color: #000080">-a</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>(the <code>-a</code> stands for &#8216;all&#8217; and is needed in many flavours of Linux to see network devices that are not currently active&#8201;&#8212;&#8201;OS X defaults to showing all devices, so the <code>-a</code> is optional on OS X.)</p>
</div>
<div class="paragraph">
<p>This command will list every network interface defined on your computer, both physical and virtual.
The output is broken into sections with the content of the section tabbed in.
Each section belongs to a different network interface, and the associated MAC address is labelled <code>ether</code>.
The naming conventions for the network interfaces vary massively between different OSes, but one thing is always the same, they are confusing as all heck, and figuring out which name matches which physical network interface is non-trivial.
Things are always confusing, but if you have a VPN installed they get even more confusing because VPNs are implemented using virtual network interfaces.
On the whole, the simplest way to figure out which MAC address matches which device is to use your OS&#8217;s control panel GUI.
On OS X that means the <code>Network</code> System Preference pane.
To see which MAC address matches which interface, select a network interface in the left sidebar, then click <code>Advanced&#8230;&#8203;</code> and navigate to the <code>Hardware</code> tab:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt24/fcedfaa3-f075-4d2a-87fe-48c813c25b9d.png" alt="OS X - Find MAC (1 of 2)">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt24/1a178fa7-0a88-4f67-8273-e2ec2c0900fa.png" alt="OS X Find MAC (2 of 2)">
</div>
</div>
<div class="paragraph">
<p>While the naming of network devices on Linux/Unix/OS X is confusing, there are some general rules that may help you figure out which device is which:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">lo0</dt>
<dd>
<p>This is the so-called <em>loop-back address</em>, it&#8217;s a virtual network interface that can be used to communicate internally within a computer using the TCP/IP stack.
<code>lo0</code> will usually have the IP address <code>127.0.0.1</code> and map to the hostname <code>localhost</code>.
(This is also the genesis of the two popular nerd T-shirts <em>"There&#8217;s no place like 127.0.0.1"</em> and <em>"127.0.0.1 sweet 127.0.0.1"</em>)</p>
</dd>
<dt class="hdlist1">gif0</dt>
<dd>
<p>This is an OS X-specific virtual network interface called the <em>Software Network Interface</em>.
It&#8217;s used by the OS in some way but is of no relevance to users, so it can be ignored.</p>
</dd>
<dt class="hdlist1">stf0</dt>
<dd>
<p>This is another OS X-specific virtual network interface which is used by the OS to bridge IPV4 and IPV6 traffic&#8201;&#8212;&#8201;again, this is not relevant to users, so it can be ignored.</p>
</dd>
<dt class="hdlist1">fw0, fw1 &#8230;&#8203;</dt>
<dd>
<p>OS X addresses firewire interfaces as <code>fw0</code> and up because a FireWire connection between two computers can be used as a network connection between those computers.</p>
</dd>
<dt class="hdlist1">en0, en1 &#8230;&#8203;</dt>
<dd>
<p>OS X addresses Ethernet cards, be they wired or wireless, as <code>en0</code> and up.</p>
</dd>
<dt class="hdlist1">eth0, eth1 &#8230;&#8203;</dt>
<dd>
<p>Most Linux and Unix variants address Ethernet cards, be they wired or wireless, as <code>eth0</code> and up.</p>
</dd>
<dt class="hdlist1">em1, em2 &#8230;&#8203;</dt>
<dd>
<p>These names are used by the <em>Consistent Network Device Naming</em> convention which aims to map the labels on the back of computers to the device names within the OS.
At the moment you&#8217;ll only see these on Dell servers running a RedHat variant (e.g.
RHEL, CentOR and Fedora).
I really hope this idea takes off and more manufacturers start implementing this!</p>
</dd>
<dt class="hdlist1">br0, br1 &#8230;&#8203; or bridge0, bridge1 &#8230;&#8203;</dt>
<dd>
<p>These virtual network devices are known as <em>bridged networks</em> and are often created by virtualisation software to allow VMs to access the network with their own dedicated MAC addresses.</p>
</dd>
<dt class="hdlist1">vmnetX</dt>
<dd>
<p>VMWare uses its own convention for allowing virtual machines to access the network. it created virtual network devices with names consisting of <code>vmnet</code> followed by a number.</p>
</dd>
<dt class="hdlist1">p2p0, p2p1 &#8230;&#8203;</dt>
<dd>
<p>These virtual network devices are known as <em>point to point networks</em> and are used by things like VPNs to send traffic through some kind of tunnel to a server located somewhere else on the internet.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Realistically, if you&#8217;re running Linux or Unix the network interfaces you care about are probably the ones starting with <code>eth</code>, and for Mac users, it&#8217;s probably the ones starting with <code>en</code>.</p>
</div>
<div class="paragraph">
<p>To see all MAC addresses associated with your computer, regardless of which network card they belong to, you can use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ifconfig <span style="color: #000080">-a</span> | egrep <span style="color: #d14">'^\s*ether'</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hubs_switches_routers_whats_the_difference">Hubs, Switches &amp; Routers &#8212; What&#8217;s the Difference?</h3>
<div class="paragraph">
<p>Because Ethernet uses a shared medium, it&#8217;s susceptible to congestion&#8201;&#8212;&#8201;if two network cards try to transmit a packet at the same time, they interfere with each other and both messages become garbled.
This is known as a <em>collision</em>.
When an Ethernet card detects a collision, it stops transmitting and waits a random amount of milliseconds before trying again.
This simple approach has been proven to be very effective, but it&#8217;s Achilles heel is that it&#8217;s very prone to congestion.
When an Ethernet network gets busy the ratio of successful transitions to collisions can collapse to the point where almost no packets actually get through.</p>
</div>
<div class="paragraph">
<p>With WiFi this shortcoming is unavoidable&#8201;&#8212;&#8201;a radio frequency is a broadcast medium, so collisions are always going to be a problem, and this is why it&#8217;s very important to choose a WiFi channel that&#8217;s not also being used by too many of your neighbours!</p>
</div>
<div class="paragraph">
<p>A copper cable is not the same as a radio frequency though!
In order to create a copper-based Ethernet network, we need some kind of box to connect all the cables coming from all our devices together.</p>
</div>
<div class="paragraph">
<p>Originally these boxes had no intelligence at all&#8201;&#8212;&#8201;they simply created an electrical connection between all the cables plugged into them&#8201;&#8212;&#8201;creating a broadcast medium very much like a radio frequency.
This kind of simplistic device is known as an <em>Ethernet hub</em>.
An Ethernet network held together by one or more hubs is prone to congestion.</p>
</div>
<div class="paragraph">
<p>A way to alleviate this problem is to add some intelligence into the box that connects the Ethernet cables together.
Rather than blindly retransmitting every packet, the device can interpret the Ethernet packet, read the destination MAC address, and then only repeat it down the cable connected to the destination MAC address.
Intelligent devices like this are called <em>Ethernet switches</em>.
In order to function, an Ethernet switch maintains a lookup table of all MAC addresses reachable via each cable plugged into it. Connections to hubs/switches are often referred to as <em>legs</em> or <em>ports</em>.
These lookup tables take into account the fact that you can connect switches together, so they allow the mapping of multiple MAC addresses to each leg/port.
If you have an eight-port switch with seven devices connected to it, and you then connect that switch to another switch, that second switch sees seven MAC addresses at the end of one of its legs.</p>
</div>
<div class="paragraph">
<p>Because switches intelligently repeat Ethernet packets, they are much more efficient than hubs, but congestion can still become a problem because broadcast packets have to be repeated out of every port/leg.</p>
</div>
<div class="paragraph">
<p>10 years ago you had to be careful when buying an Ethernet &#8216;switch&#8217; to be sure you weren&#8217;t buying a hub by mistake.
Thankfully, switches are ubiquitous today, and it&#8217;s almost impossible to find a hub.</p>
</div>
<div class="paragraph">
<p>There is a third kind of network device that we should also mention in this conversation&#8201;&#8212;&#8201;the <em>router</em>.
A router is a device that has a Layer 1 connection to two or more different networks.
It uses the Layer 2 IP protocol to intelligently move packets between those networks.</p>
</div>
<div class="paragraph">
<p>Our home routers cause a lot of confusion because they are actually hybrid devices happen to contain a router.
The best way to think of a home router is as a box containing two or three component devices&#8201;&#8212;&#8201;a router to pass packets between your home network and the internet, an Ethernet switch that forms the heart of your home network, and, optionally, a wireless access point, which is the WiFi-equivalent of an Ethernet hub.
Importantly, if it&#8217;s present, the wireless access point is connected to the Ethernet switch, ensuring that a single Ethernet network exists on both the copper and the airwaves.
This means that an Ethernet packet can be sent from a wired network card to a wireless network card in a single Layer 1 hop&#8201;&#8212;&#8201;i.e.
Layer 2 is not needed to get a single packet from a phone on your WiFi to a desktop computer on your wired Ethernet.
Confusingly, while this single packet will pass through a device you <strong>call</strong> a router, it will <strong>not</strong> be routed&#8201;&#8212;&#8201;it will go nowhere near the router inside your home router, it will stay on the switch and the wireless access point inside your home router.
The diagram below illustrates the typical setup:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt24/HomeRouter.png" alt="Home Router">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_address_resolution_protocol_arp">The Address Resolution Protocol (ARP)</h3>
<div class="paragraph">
<p>The protocol that sits on top of Ethernet is the IP Protocol.
The IP protocol moves a packet from one IP address to another, and it does so by repeatedly dropping the packet down to the link layer below to move the packet one <em>hop</em> at a time from a directly-connected device to another directly-connected device until it arrives at its destination.
As a quick reminder, see the diagram below from the previous instalment:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="https://commons.wikimedia.org/wiki/File%3AIP_stack_connections.svg"><img src="assets/ttt24/512px-IP_stack_connections.svg.png" alt="IP stack connections"></a>
</div>
</div>
<div class="paragraph">
<p>Within our LAN, the Layer 1 protocol IP used to move a packet from one device on our LAN to another device on our LAN is Ethernet.
Ethernet can only move a packet from one MAC address to another, and IP moves packets from one IP address to another, so how does the IP protocol figure out what MAC address matches to what IP address so it knows where to ask Ethernet to send the packet?</p>
</div>
<div class="paragraph">
<p>The Address Resolution Protocol, or ARP, is an Ethernet protocol that maps IP addresses to MAC addresses.
It&#8217;s a supremely simplistic protocol.
Whenever a computer needs to figure out what MAC address matches a given IP address, it sends an ARP request to the broadcast MAC address (<code>ff:ff:ff:ff:ff:ff</code>), and whatever computer has the requested IP answers back to the MAC address asking the question with an ARP reply saying that their MAC address matches the requested IP.</p>
</div>
<div class="paragraph">
<p>The command you&#8217;ve had running in the background since the start of this instalment has been listening for ARP packets and printing every one your computer sees.
You should see output something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">sudo </span>tcpdump <span style="color: #000080">-nneq</span> arp
<span style="color: #888888">Password:
tcpdump: data link type PKTAP
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on pktap, link-type PKTAP (Packet Tap), capture size 65535 bytes
15:06:04.868430 40:6c:8f:4d:0b:9b &gt; ff:ff:ff:ff:ff:ff, ARP, length 60: Request who-has 192.168.10.206 tell 192.168.10.100, length 46
15:06:05.706152 40:6c:8f:4d:0b:9b &gt; ff:ff:ff:ff:ff:ff, ARP, length 60: Request who-has 192.168.10.206 tell 192.168.10.100, length 46
15:06:06.868324 40:6c:8f:4d:0b:9b &gt; ff:ff:ff:ff:ff:ff, ARP, length 60: Request who-has 192.168.10.206 tell 192.168.10.100, length 46
15:06:10.623603 40:6c:8f:4d:0b:9b &gt; ff:ff:ff:ff:ff:ff, ARP, length 60: Request who-has 192.168.10.206 tell 192.168.10.100, length 46
15:06:11.705482 40:6c:8f:4d:0b:9b &gt; ff:ff:ff:ff:ff:ff, ARP, length 60: Request who-has 192.168.10.206 tell 192.168.10.100, length 46
15:06:12.868490 40:6c:8f:4d:0b:9b &gt; ff:ff:ff:ff:ff:ff, ARP, length 60: Request who-has 192.168.10.206 tell 192.168.10.100, length 46
15:09:11.698813 40:6c:8f:4d:0b:9b &gt; ff:ff:ff:ff:ff:ff, ARP, length 60: Request who-has 192.168.10.1 tell 192.168.10.100, length 46
15:10:11.696476 40:6c:8f:4d:0b:9b &gt; ff:ff:ff:ff:ff:ff, ARP, length 60: Request who-has 192.168.10.1 tell 192.168.10.100, length 46
15:10:38.977585 dc:86:d8:09:97:09 &gt; ff:ff:ff:ff:ff:ff, ARP, length 60: Request who-has 192.168.10.1 tell 192.168.10.215, length 46
15:10:40.588396 dc:86:d8:09:97:09 &gt; ff:ff:ff:ff:ff:ff, ARP, length 60: Request who-has 192.168.10.1 tell 192.168.10.215, length 46
15:11:07.962791 68:5b:35:97:f1:84 &gt; ff:ff:ff:ff:ff:ff, ARP, length 42: Request who-has 192.168.10.5 tell 192.168.10.42, length 28
15:11:07.963048 50:46:5d:74:ce:66 &gt; 68:5b:35:97:f1:84, ARP, length 60: Reply 192.168.10.5 is-at 50:46:5d:74:ce:66, length 46
15:11:40.716850 40:6c:8f:4d:0b:9b &gt; ff:ff:ff:ff:ff:ff, ARP, length 60: Request who-has 192.168.10.42 tell 192.168.10.100, length 46
15:11:40.716859 68:5b:35:97:f1:84 &gt; 40:6c:8f:4d:0b:9b, ARP, length 42: Reply 192.168.10.42 is-at 68:5b:35:97:f1:84, length 28
15:12:04.557253 68:5b:35:97:f1:84 &gt; 00:13:3b:0e:3f:30, ARP, length 42: Request who-has 192.168.10.1 (00:13:3b:0e:3f:30) tell 192.168.10.42, length 28
15:12:04.557500 00:13:3b:0e:3f:30 &gt; 68:5b:35:97:f1:84, ARP, length 60: Reply 192.168.10.1 is-at 00:13:3b:0e:3f:30, length 46
</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What you can see is a whole bunch of ARP requests asking the network who has various IP addresses, and, a few replies.
If your entire home network uses WiFi you&#8217;ll probably see an approximately even number of requests and responses, but, if your network includes devices connected via wired Ethernet you should notice a distinct asymmetry between requests and responses, especially if your computer is connected to the network via Ethernet.
This is not because requests are going un-answered, but rather because there is a switch in the mix, and that switch is only passing on Ethernet packets that are relevant to you.
Requests are broadcast, so Ethernet switches send those packets to everyone, but responses are directed at a single MAC address, so those are only passed out the relevant port on the switch.
In effect, what you are seeing is the efficiency of an Ethernet switch in action!</p>
</div>
<div class="paragraph">
<p>While we&#8217;re on the subject of efficiency, computers don&#8217;t send an ARP request each and every time they want to transmit an IP packet, ARP responses are cached by the OS, so new ARP requests are only sent when a mapping is not found in the cache.
You can see the MAC to IP mappings currently cached by your OS with the command <code>arp -an</code>.
You&#8217;ll get output something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span class="hll"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>arp <span style="color: #000080">-an</span>
</span><span style="color: #888888">? (192.168.10.1) at 0:13:3b:e:3f:30 on en0 ifscope [Ethernet]</span>
<span style="color: #888888">? (192.168.10.2) at 90:84:d:d1:f0:be on en0 ifscope [Ethernet]</span>
<span style="color: #888888">? (192.168.10.5) at 50:46:5d:74:ce:66 on en0 ifscope [Ethernet]</span>
<span style="color: #888888">? (192.168.10.42) at 68:5b:35:97:f1:84 on en0 ifscope permanent [Ethernet]</span>
<span style="color: #888888">? (192.168.10.100) at 40:6c:8f:4d:b:9b on en0 ifscope [Ethernet]</span>
<span style="color: #888888">? (192.168.10.255) at ff:ff:ff:ff:ff:ff on en0 ifscope [Ethernet]</span>
<span style="color: #555555">bart-iMac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The more devices on your LAN you are interacting with, the more mappings you&#8217;ll see.</p>
</div>
</div>
<div class="sect2">
<h3 id="_arp_security_or_the_utter_lack_thereof">ARP Security (or the Utter Lack Thereof)</h3>
<div class="paragraph">
<p>Something you may have noticed about ARP is that it assumes all computers are truthful, that is to say, that no computer will falsely assert their MAC address maps to any given IP.
This assumption is why <strong>ALL</strong> untrusted Ethernet networks are dangerous&#8201;&#8212;&#8201;be they wired or wireless.
This is why the Ethernet port in a hotel room is just as dangerous as public WiFi.
To intercept other people&#8217;s network traffic, an attacker simply has to send out false ARP replies and erroneously advertise their MAC address as matching their victim&#8217;s IP address.
The attacker can then read the packets before passing them on to the correct MAC address.
Users will not lose connectivity because the packets all get where they are supposed to eventually go, but the attacker can read and alter every packet.
This technique is known as <a href="https://en.wikipedia.org/wiki/ARP_spoofing">ARP Spoofing</a> or ARP Poison Routing (APR) and is staggeringly easy to execute.</p>
</div>
<div class="paragraph">
<p>ARP is just the first example we have met of the Internet&#8217;s total lack of built-in security.
It illustrates the point that the designers of the IP stack simply never imagined there would be malicious actors on their networks.
If it didn&#8217;t have such detrimental effects on all our security, the naive innocence of those early pioneers would be very endearing!</p>
</div>
</div>
<div class="sect2">
<h3 id="_conclusions_6">Conclusions</h3>
<div class="paragraph">
<p>This is the last we&#8217;ll see of Layer 1 in this series.
In the next instalment, we&#8217;ll be moving up the stack to Layer 2 and the IP protocol&#8201;&#8212;&#8201;the real work-horse of the internet.
In particular, we&#8217;ll be tackling one of the single most confusing, and most critical, networking concepts&#8201;&#8212;&#8201;that of the IP subnet.
It&#8217;s impossible to effectively design or troubleshoot home networks without understanding subnets, and yet they are a mystery to so many.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt25">TTT Part 25 of n &#8212; IP Subnets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In <a href="#ttt23">part 23 of n</a>, we took a big-picture look at how TCP/IP networking works.
As a quick reminder, the most important points were:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Our computer networks use a stack of protocols known as TCP/IP</p>
</li>
<li>
<p>We think of the stack of protocols as being broken into four layers:</p>
<div class="ulist">
<ul>
<li>
<p>The Link Layer&#8201;&#8212;&#8201;lets computers that are on the same network send single packets of data to each other</p>
</li>
<li>
<p>The Internet Layer&#8201;&#8212;&#8201;lets computers on different networks send single packets of data to each other</p>
</li>
<li>
<p>The Transport Layer&#8201;&#8212;&#8201;lets computers send meaningful streams of data between each other</p>
</li>
<li>
<p>The Application Layer&#8201;&#8212;&#8201;where all the networked apps we use live</p>
</li>
</ul>
</div>
</li>
<li>
<p>Logically, data travels across the layers&#8201;&#8212;&#8201;HTTP to HTTP, TCP to TCP, IP to IP, Ethernet to Ethernet, but physically, data travels up and down the stack, one layer to another, only moving from one device to another when it gets to the Link Layer at the very bottom of the stack.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In <a href="#ttt24">the previous instalment</a>, we focused on the lowest of the four layers, the link layer, and looked at how Ethernet and ARP work.
In this instalment, we&#8217;ll move one layer up the stack and take a closer look at the IP protocol.
A concept absolutely central to IP&#8217;s operation is that of related groups of IP addresses known as IP Subnetworks or just subnets.
This is the concept we&#8217;ll be focusing on in this instalment.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 25</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episodes 25a &amp; 25b</p>
</div>
<table class="tableblock frame-none grid-none stripes-even stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Episode 25a</th>
<th class="tableblock halign-left valign-top">Episode 25b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT25aIPSubnets/TTT_25a_IP_Subnets.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT25bIPSubnets/TTT_25b_IP_Subnets.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">Scan the QRcode to listen on a different device</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="assets/qrcodes/TTT_25a.png" alt="QRcode 25a">
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="assets/qrcodes/TTT_25b.png" alt="QRcode 25b">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT25aIPSubnets/TTT_25a_IP_Subnets.mp3">play/download the MP3 in your browser (a)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT25bIPSubnets/TTT_25b_IP_Subnets.mp3">play/download the MP3 in your browser (b)</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_ip_addresses">IP Addresses</h3>
<div class="paragraph">
<p>At the IP level, packets are sent from one IP address to another.
Every computer connected to an IP network has one or more IP addresses.
For the purpose of this series we will be ignoring IPv6, so IP addresses are of the form <code>n1.n2.n3.n4</code>, where <code>n1</code> to <code>n4</code> are numbers between 0 and 255, E.g.
<code>192.168.0.1</code>.</p>
</div>
<div class="paragraph">
<p>Unlike MAC addresses, IP addresses are not hard-coded into our network interfaces.
Instead, they have to be configured within the operating system.
Historically this was always a manual process, but today it&#8217;s usually automated using the <em>Dynamic Host Configuration Protocol</em>, or DHCP.
We&#8217;ll be looking at how DHCP works in detail later in the series.
Also, a single network interface can have many IP addresses assigned to it, and a single computer can have many network interfaces, so it&#8217;s not uncommon for a computer to have multiple IP addresses.</p>
</div>
<div class="paragraph">
<p>The vast address-space of possible IP addresses is managed by the <a href="https://www.icann.org"><em>Internet Corporation for Assigned Names and Numbers</em></a> (ICANN).
ICANN assign blocks of IP addresses to organisations.
There are also three special blocks of IP addresses that ICANN have reserved for use on private networks, and it&#8217;s these IPs that we use within our homes.
These private IP addresses can never appear on the public internet, they must always be either completely disconnected from the internet, or isolated from the internet by a NAT router.
We&#8217;ll look at NAT in more detail later, but for now, all we need to know is that just about every home router is a NAT router.</p>
</div>
<div class="paragraph">
<p>The private IP address ranges:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>10.0.0.0</code> to <code>10.255.255.255</code> (in common use)</p>
</li>
<li>
<p><code>172.16.0.0</code> to <code>172.31.255.255</code> (rarely seen)</p>
</li>
<li>
<p><code>192.168.0.0</code> to <code>192.168.255.255</code> (in very common use)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, there are two other special ranges of IPs you may encounter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>127.0.0.0</code> to <code>127.255.255.255</code>&#8201;&#8212;&#8201;the range reserved for so-called <em>loop-back traffic</em> within a computer</p>
</li>
<li>
<p><code>169.254.0.0</code> to <code>169.254.255.255</code>&#8201;&#8212;&#8201;the range reserved for self-assigned IP addresses&#8201;&#8212;&#8201;if you see one of these on your computer, it almost always means something has gone wrong!</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_routing_packets">Routing Packets</h3>
<div class="paragraph">
<p>Unlike Ethernet, the IP protocol can send packets across different networks.
The act of moving a packet through different networks from source to destination is known as <em>routing</em>.
The heavy-lifting in routing, figuring out a route through the maze of interconnected networks that make up the internet, is done by routers, and is beyond the scope of this series.
However, each and every device that speaks IP needs to make some simple routing decisions.
Fundamentally our computers have to answer one simple routing question <em>"is the destination IP address for this packet on my local network, or is it on a different network?"</em>.</p>
</div>
<div class="paragraph">
<p>If your computer determines that the destination IP address is on the local network, then it looks up the MAC address for the destination IP using ARP (as described in <a href="#ttt24">the previous instalment</a>) and sends the packet directly to its destination using Ethernet.</p>
</div>
<div class="paragraph">
<p>On the other hand, if your computer determines that the destination IP is not on your local network, then it must send the packet to your router for processing.
To do this your computer must know the IP address of your router, and, it must find your router&#8217;s MAC address using ARP.
Once your computer has that information it sends the packet to your router using Ethernet.
Your router then sends the packet on to your ISP&#8217;s router which will send it on its way across the internet.</p>
</div>
<div class="paragraph">
<p>At this stage, we know that for your computer to work on an IP network it must have an IP address, and it must know the IP address of the router it should use to send remote packets on their way.
But how does it know whether or not a packet is destined for the local network?
The key to answering that question is IP subnets.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ip_subnets">IP Subnets</h3>
<div class="paragraph">
<p>When we say that a device must figure out whether or not a packet&#8217;s destination IP is local or not, what we really mean is that it must determine whether or not the destination IP is in the same subnet.</p>
</div>
<div class="paragraph">
<p>A subnet is a collection of similar IP addresses that share a single Ethernet network.
In other words, every device on a subnet must be able to send Ethernet packets to every other device on the same subnet.
There is not a one-to-one mapping between Ethernet networks and IP subnets though, so while a subnet can&#8217;t be spread over multiple Ethernet networks, one Ethernet network can host multiple IP subnets.
Having said that, in reality, the mapping usually is one-to-one, especially within our homes.</p>
</div>
<div class="paragraph">
<p>Note that when people talk about a <em>Local Area Network</em> or LAN, they are often referring to an IP subnet.
Do bear in mind though that many people use those terms very loosely, and often inaccurately.</p>
</div>
<div class="paragraph">
<p>In order to understand how a subnet is defined, we need a deeper understanding of IP addresses.
We are accustomed to seeing them as so-called <em>dotted quads</em> (like <code>192.168.0.1</code>), but those dotted quads are just a human-friendly way of representing what an IP address really is&#8201;&#8212;&#8201;a 32-bit binary number.
The IP address <code>192.168.0.3</code> is really <code>11000000101010000000000000000011</code>.</p>
</div>
<div class="paragraph">
<p>We create subnets of different sizes by choosing a dividing line somewhere inside this 32-bit block, and saying that everything before our dividing line will be kept constant for this subnet.
In other words, all IP addresses on a given subnet share the same prefix when expressed in binary form.
This means that to define a subnet we need two pieces of information&#8201;&#8212;&#8201;the first address in the subnet, and the location of the dividing line, or, to use the correct terms, we need a <em>network address</em> (or <em>net address</em>), and a <em>netmask</em>.
The size of the subnet (the number of IP addresses it contains) is determined by where you choose to place the divider.
The closer to the front of the 32 bits, the bigger the subnet, the closer to the back, the smaller.</p>
</div>
<div class="paragraph">
<p>Netmasks are represented using 32-bit binary numbers.
All the bits before the chosen divide are set to <code>1</code>, and all the bits after the divide are set to <code>0</code>.
When written in binary, a netmask MUST be 32 bits long and MUST consist of a series of <code>1</code>s
followed by a series of <code>0</code>s.
The chosen dividing line represented by the netmask is the point where the <code>1</code>s change to <code>0</code>s.</p>
</div>
<div class="paragraph">
<p>Because netmasks are 32-bit numbers, just like IP addresses, we can represent them in the same way, as dotted quads.
(There are other ways to represent them too though&#8201;&#8212;&#8201;as we&#8217;ll see later)</p>
</div>
</div>
<div class="sect2">
<h3 id="_basic_routing_math">Basic Routing Math</h3>
<div class="paragraph">
<p>Remember, the problem to be solved is that our computers need to be able to determine if a given IP address is local or remote.
Local IP packets should be sent directly to the destination, while remote packets should be sent to the router.</p>
</div>
<div class="paragraph">
<p>The key fact here is that you can use a binary <code>AND</code> operator to calculate your net address based on just your IP address and netmask.
In other words, when you take your own IP address and <code>AND</code> it with your netmask you get your net address.
You then take the destination IP address and <code>AND</code> it with your netmask, and compare the result to your net address.
If the result is the same as your net address, the IP is local, if not, it&#8217;s remote and needs to be routed.</p>
</div>
<div class="paragraph">
<p>Firstly, let&#8217;s define what we mean by an <code>AND</code> operation in a binary context:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even" style="width: 75%;">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">A</th>
<th class="tableblock halign-center valign-top">B</th>
<th class="tableblock halign-center valign-top">A <code>AND</code> B</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This probably all sounds very abstract, so let&#8217;s work through an example.
We are computer A, and the two computers we want to communicate with are Computers B and C.
Subnet masks are not published, they are an internal OS setting, so we do not know the recipients&#8217; netmasks, only our own.
So, this is what we know:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Computer A</strong>: IP = <code>192.168.0.3</code>, netmask = <code>255.255.255.248</code></p>
</li>
<li>
<p><strong>Computer B</strong>: IP = <code>192.168.0.5</code></p>
</li>
<li>
<p><strong>Computer C</strong>: IP = <code>192.168.0.9</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>First, let&#8217;s do some conversions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>192.168.0.3</code> = <code>11000000101010000000000000000011</code></p>
</li>
<li>
<p><code>192.168.0.5</code> = <code>11000000101010000000000000000101</code></p>
</li>
<li>
<p><code>192.168.0.9</code> = <code>11000000101010000000000000001001</code></p>
</li>
<li>
<p><code>255.255.255.248</code> = <code>11111111111111111111111111111000</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using the simple <em>truth table</em> for <code>AND</code> shown above, we can <code>AND</code> each IP address with our netmask to get the results below.
Note that you need to apply the <code>AND</code> rule 32 times for each conversation, once for each bit.
This is known in computer science as a <em>bitwise AND</em> operation.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>IP A AND netmask = <code>11000000101010000000000000000000</code> (our net address)</p>
</li>
<li>
<p>IP B AND netmask = <code>11000000101010000000000000000000</code></p>
</li>
<li>
<p>IP C AND netmask = <code>11000000101010000000000000001000</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>What we see here is that A and B are in the same subnet, but C is not.</p>
</div>
<div class="paragraph">
<p>You can play around with this, and see all the binary calculations using my free IP Subnet calculator at <a href="http://subnetcalc.it">www.subnetcalc.it</a>.
You can use <a href="http://subnetcalc.it/?ip=192.168.0.3&amp;mask=255.255.255.248&amp;sc=y">this link</a> to load the IP and Netmask into the interface automatically and save yourself some copying and pasting.
You can then paste IP B and IP C into the IP Test text box near the bottom of the page to see why one is local and the other is not.</p>
</div>
<div class="paragraph">
<p>If we write out all the IP addresses between <code>192.168.0.0</code> and <code>192.168.0.9</code>, as well as our netmask (<code>255.255.255.248</code>) the pattern will hopefully become clear.
For extra clarity, I&#8217;ve also included the imaginary separator represented by the netmask by inserting a <code>|</code> character into the binary strings.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">IP in Binary (With Imaginary Separator)</th>
<th class="tableblock halign-left valign-top">IP quads</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11000000101010000000000000000|000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11000000101010000000000000000|001</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11000000101010000000000000000|010</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11000000101010000000000000000|011</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.3</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11000000101010000000000000000|100</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.4</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11000000101010000000000000000|101</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.5</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11000000101010000000000000000|110</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.6</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11000000101010000000000000000|111</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.7</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11000000101010000000000000001|000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.8</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11000000101010000000000000001|001</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.9</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11111111111111111111111111111|000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>255.255.255.248</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_the_structure_of_a_subnet">The Structure of a Subnet</h3>
<div class="paragraph">
<p>A subnet is, by definition, defined by its netmask and the first IP address within the subnet, known as the network address.
A netmask of <code>255.255.255.248</code> only allows 3 bits of freedom within a subnet, so that means it defines 8 IP addresses (see above), but only SIX can actually be used.
The first and last IP addresses of all subnets are reserved, and cannot be used by devices.</p>
</div>
<div class="paragraph">
<p>The first IP address is the network address, or net address, for the subnet, while the last is the so-called <em>broadcast address</em>.</p>
</div>
<div class="paragraph">
<p>The table below shows the subnet <code>192.168.0.0/255.255.255.248</code>:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">IP in Binary</th>
<th class="tableblock halign-left valign-top">IP quads</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11000000101010000000000000000000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Network Address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11000000101010000000000000000001</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Usable IP Address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11000000101010000000000000000010</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Usable IP Address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11000000101010000000000000000011</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Usable IP Address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11000000101010000000000000000100</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Usable IP Address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11000000101010000000000000000101</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Usable IP Address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11000000101010000000000000000110</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Usable IP Address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11000000101010000000000000000111</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.7</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Broadcast Address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11111111111111111111111111111000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>255.255.255.248</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Netmask</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_broadcast_addresses">Broadcast Addresses</h3>
<div class="paragraph">
<p>Using your subnet&#8217;s broadcast address, you can send a single IP packet to every device on your local subnet.
Like the network address, the broadcast address can be calculated given only a computer&#8217;s IP address and netmask.
In this case, the maths is a little more complicated, but not much.</p>
</div>
<div class="paragraph">
<p>To calculate broadcast addresses we need to learn about two more binary operators&#8201;&#8212;&#8201;binary inversion, and the <code>OR</code> operator.
Inversion is as simple as it sounds, all <code>1</code>s are turned to <code>0</code>s, and all <code>0</code>s to <code>1</code>s.
The <code>OR</code> operator is defined by the truth table below:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even" style="width: 75%;">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">A</th>
<th class="tableblock halign-center valign-top">B</th>
<th class="tableblock halign-center valign-top">A <code>OR</code> B</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To calculate the broadcast address, first, invert the netmask, then <code>OR</code> that inverted netmask with your IP address.</p>
</div>
</div>
<div class="sect2">
<h3 id="_representing_netmasks">Representing Netmasks</h3>
<div class="paragraph">
<p>We&#8217;ve already seen that you can represent a netmask as a dotted quad, just like an IP address, but unfortunately, this is not the only notation in common use.
The list below shows all the commonly used representations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Netmasks are 32-bit binary numbers just like IP addresses, so they can be represented using dotted quads just like IP addresses.
This is the most intuitive representation of a netmask, and for our example network, it would be <code>255.255.255.248</code>.
This is the most commonly used representation and is used in the System Preferences app on OS X and the Windows Control Panel.</p>
</li>
<li>
<p>Netmasks can also be written in hexadecimal. Every group of four bits gets converted to a symbol between <code>0</code> and <code>f</code> in the following way:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre>  0000 <span style="color: #000000;font-weight: bold">=</span> 0
  0001 <span style="color: #000000;font-weight: bold">=</span> 1
  0010 <span style="color: #000000;font-weight: bold">=</span> 2
  0011 <span style="color: #000000;font-weight: bold">=</span> 3
  0100 <span style="color: #000000;font-weight: bold">=</span> 4
  0101 <span style="color: #000000;font-weight: bold">=</span> 5
  0110 <span style="color: #000000;font-weight: bold">=</span> 6
  0111 <span style="color: #000000;font-weight: bold">=</span> 7
  1000 <span style="color: #000000;font-weight: bold">=</span> 8
  1001 <span style="color: #000000;font-weight: bold">=</span> 9
  1010 <span style="color: #000000;font-weight: bold">=</span> a
  1011 <span style="color: #000000;font-weight: bold">=</span> b
  1100 <span style="color: #000000;font-weight: bold">=</span> c
  1101 <span style="color: #000000;font-weight: bold">=</span> d
  1110 <span style="color: #000000;font-weight: bold">=</span> e
  1111 <span style="color: #000000;font-weight: bold">=</span> f
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>In computer science hexadecimal numbers are signified by prefixing them with <code>0x</code>, so our example netmask can be written as <code>0xfffffff8</code>.
This is by far the least human-friendly representation, but it is the one BSD Unix, and OS X, use in the output from the <code>ifconfig</code> command.</p>
</div>
</li>
<li>
<p>A netmask can also be represented in bits. That is to say, the number of the 32 possible bits that are set to 1.
So, for our example network, it has a netmask of 29 bits.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_representing_subnets">Representing Subnets</h3>
<div class="paragraph">
<p>The correct way to write down a subnet definition is as follows: <code>IP_ADDRESS/NETMASK</code>, where any of the above representations for netmasks are permissible</p>
</div>
<div class="paragraph">
<p>This means that our example subnet above can be written in all the following ways:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">192.168.0.0/255.255.255.248
192.168.0.0/29
192.168.0.0/0xfffffff8</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_real_world_simplifications">Real-World Simplifications</h3>
<div class="paragraph">
<p>While it is entirely permissible to have a subnet of any size between 0 and 32 bits, not all sizes are equally common.
There are three very common sizes, and, not coincidentally, they have the advantage that you can visually interpret them when written as dotted quads, so no need to revert to binary!
These three common sizes are:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 22.2222%;">
<col style="width: 22.2223%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Netmask dotted quad</th>
<th class="tableblock halign-left valign-top">bits</th>
<th class="tableblock halign-left valign-top">Hex</th>
<th class="tableblock halign-left valign-top">#IP addresses</th>
<th class="tableblock halign-left valign-top">Common Name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>255.0.0.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xff000000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16,777,214</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class A network</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>255.255.0.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffff0000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">65,534</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class B network</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>255.255.255.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>24</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffff00</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">254</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class C network</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If our computer has a <strong>class C</strong> netmask, then our network address is the first three quads of our IP with the last quad set to 0.
Also, all IPs that start with the same three quads as our IP are local.</p>
</div>
<div class="paragraph">
<p>Similarly, if our computer has a <strong>class B</strong> netmask, then our network address is the first two quads of our IP with the last two quads set to 0.
Also, all IPs that start with the same two quads as our IP are local.</p>
</div>
<div class="paragraph">
<p>Finally, if our computer has a <strong>class A</strong> netmask, then our network address is the first quad of our IP with the last three quads set to 0.
Also, all IPs that start with the same first quad as our IP are local.</p>
</div>
<div class="paragraph">
<p>Most home routers create class C networks by default, so understanding class C networks is enough to allow most home users to get by.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ip_network_configuration">IP Network Configuration</h3>
<div class="paragraph">
<p>In order for a device to properly use an IP network it needs to have three settings correctly configured:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>IP Address</p>
</li>
<li>
<p>Netmask</p>
</li>
<li>
<p>Default gateway AKA default route (the IP address of the router). The router&#8217;s IP MUST fall within the subnet defined by the IP address combined with the netmask</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can see these three settings in the Networks system preference pane in OS X:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt25/3d970446-33cb-4cc8-8358-5040cb13b8d0.png" alt="OS X Network Settings">
</div>
</div>
<div class="paragraph">
<p>Or, you can access them via the command line with the following two commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ifconfig <span style="color: #000080">-a</span>
netstat <span style="color: #000080">-rn</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Both of these commands are VERY talkative, and while all the needed info is in there somewhere, we can use the power of <code>egrep</code> to filter those outputs down to just what we want:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ifconfig <span style="color: #000080">-a</span> | egrep <span style="color: #d14">'\binet\b'</span> | egrep <span style="color: #000080">-v</span> <span style="color: #d14">'127[.]'</span>
netstat <span style="color: #000080">-rn</span> | egrep <span style="color: #d14">'^default'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With these filtered versions of the commands, we can clearly see the three pieces of information we are looking for.
Below is my output, with the desired information highlighted:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>ifconfig <span style="color: #000080">-a</span> | egrep <span style="color: #d14">'\binet\b'</span> | egrep <span style="color: #000080">-v</span> <span style="color: #d14">'127[.]'</span>
<span class="hll"><span style="color: #888888">	inet 192.168.10.42 netmask 0xffffff00 broadcast 192.168.10.255</span>
</span><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>netstat <span style="color: #000080">-rn</span> | egrep <span style="color: #d14">'^default'</span>
<span class="hll"><span style="color: #888888">default            192.168.10.1       UGSc           55        0     en0</span>
</span><span style="color: #555555">bart-iMac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you copy and paste the IP and netmask values from the above commands into the calculator at <a href="http://subnetcalc.it/">www.subnetcalc.it</a> you can see the structure of your subnet.</p>
</div>
</div>
<div class="sect2">
<h3 id="_routable_v_un_routable_protocols_a_home_networking_pitfall">Routable -v- Un-Routable Protocols &#8212; A Home Networking Pitfall</h3>
<div class="paragraph">
<p>The application layer protocols we use to actually do things on our networks or the internet use protocols which sit on top of IP (usually TCP or UDP).
Because IP can send packets between subnets, you might assume that all Application layer protocols that use IP under the hood would also be able to work across different subnets, but you&#8217;d be mistaken.
Many, even most, application layer protocols can indeed cross routers to move between subnets, but a subset of them can&#8217;t.
Protocols that rely on IP broadcast packets are confined to the reach of those packets, i.e., to the local subnet.
Because these protocols can&#8217;t cross routers, they are known as <em>unroutable protocols</em>.</p>
</div>
<div class="paragraph">
<p>The unroutable protocols you are likely to encounter on your home network are mostly designed around zero-config sharing of some sort.
The idea is that computers that share a subnet can easily share data or some other resource without the user needing to do much, if any, configuration.
Probably the most common such protocol is mDNS, better known as Bonjour.
Apple is very fond of unroutable protocols for things like AirVideo, iTunes sharing and printer sharing.
The fact that these protocols are confined within the local subnet is actually a security feature.
Something which can&#8217;t possibly be accessed remotely needs a lot less security than something which could be accessed by anyone on the internet!
If anyone anywhere on the planet could send their screen to your Apple TV you&#8217;d definitely need to set a password on it, and a long one at that, but because AirPlay is unroutable, you don&#8217;t need to bother, making the experience much more pleasant!</p>
</div>
<div class="paragraph">
<p>A very common problem is that people accidentally break their network into multiple subnets, and then find that sharing services have become mysteriously unreliable.</p>
</div>
<div class="paragraph">
<p>Imagine you have half of your devices on one subnet, and half on another&#8201;&#8212;&#8201;those sharing a subnet with an Apple TV can share their screens no problem, but the devices on the other subnet can&#8217;t.
You think they are all on the same network because they are all in your home, and all eventually connect back to your internet router, so you have no idea why something that should just work is just refusing to work!</p>
</div>
<div class="paragraph">
<p>It&#8217;s actually very easy to accidentally break up your network.
Imagine you start with the basic network setup we described last week: you have one home router which connects you to the internet, and provides you with an Ethernet switch and a wireless access point:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt25/HomeRouter.png" alt="Home Router">
</div>
</div>
<div class="paragraph">
<p>This is working quite well, but you have terrible WiFi reception in the back bedroom, so you buy another wireless router, and plug it in.
That device, like your home router, is probably three devices in one, a router, an Ethernet switch, and a wireless access point, that means that depending on your configuration, you can end up with one big IP subnet in the house, or, with two separate IP subnets.
The diagrams below show two possible configurations with two home routers&#8201;&#8212;&#8201;one with a single IP Subnet, the other with two separate subnets.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="sect3">
<h4 id="_good_a_single_subnet">Good &#8212; A Single Subnet</h4>
<div class="imageblock">
<div class="content">
<img src="assets/ttt25/HomeNetwork-WirelessAccessPoint-Good.png" alt="Wireless Access Point - Good">
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_bad_two_subnets">Bad &#8212; Two Subnets</h4>
<div class="imageblock">
<div class="content">
<img src="assets/ttt25/HomeNetwork-WirelessAccessPoint-BAD.png" alt="Wireless Access Point - BAD">
</div>
</div>
<div class="paragraph">
<p>Unless you intentionally want to isolate off some users, you probably want a single subnet, and if you accidentally ended up with more you&#8217;re probably experiencing all sorts of sharing frustrations.
Why can I send my screen to the Apple TV, but my husband can&#8217;t?
Why can my daughter print, but I can&#8217;t?
Why can the Apple TV not see my shared iTunes library while my son&#8217;s computer can?
When you start experiencing strange symptoms like this, the first thing to check is that you haven&#8217;t accidentally divided your network into multiple subnets.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_are_all_the_devices_on_your_home_on_the_same_network">Are All the Devices On Your Home on the Same Network?</h3>
<div class="paragraph">
<p>When the IP stack is trying to decide how to route a packet it only knows its own IP address and netmask, and the destination IP, but when you are trying to figure out if two devices on your home network share a subnet, you have access to more information because you can discover each computer&#8217;s IP <code>AND</code> netmask (by reading them from the UI to terminal).</p>
</div>
<div class="paragraph">
<p>If your intention was to create a single home network, and you want to verify that any two devices really are on the same subnet, you can use the following simple algorithm:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Are the netmasks on the two computers the same?
Yes&#8201;&#8212;&#8201;continue to step 2, NO&#8201;&#8212;&#8201;the two computers are NOT on the same subnet</p>
</li>
<li>
<p>Figure out the network addresses for both IPs. If they are the same, the computers are on the same subnet.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following flow chart will walk you through the process:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt25/SubnetWorkflow.png" alt="Subnet Workflow">
</div>
</div>
<div class="paragraph">
<p><a href="https://www.bartbusschots.ie/s/wp-content/uploads/2014/12/SubnetWorkflow.png">A larger version can be found on the website</a></p>
</div>
<div class="paragraph">
<p>Since most of our home networks use Class C netmasks, you&#8217;ll probably only ever need a small section of the diagram.</p>
</div>
<div class="paragraph">
<p>With a little practice, determining whether or not two devices are on the same subnet will become second nature.
Below is a quick little self-test to get some practice:</p>
</div>
<div class="qlist qanda">
<ol>
<li>
<p><em><code>192.168.0.1/255.255.255.0</code> &amp; <code>192.168.0.1/255.255.0.0</code></em></p>
<p>NOT same subnet&#8201;&#8212;&#8201;this is, in fact, a misconfiguration, one of the two computers needs their netmask changed</p>
</li>
<li>
<p><em><code>192.168.0.23/255.255.255.0</code> &amp; <code>192.168.1.24/255.255.255.0</code></em></p>
<p>NOT same subnet&#8201;&#8212;&#8201;the network addresses are different (<code>192.168.0.0</code> and <code>192.168.1.0</code>)</p>
</li>
<li>
<p><em><code>192.168.5.214/255.255.0.0</code> &amp; <code>196.168.45.169/255.255.0.0</code></em></p>
<p>SAME subnet&#8201;&#8212;&#8201;both are in the class B network with network address <code>192.168.0.0</code></p>
</li>
<li>
<p><em><code>10.0.0.5/24</code> &amp; <code>10.0.0.124/24</code></em></p>
<p>SAME subnet&#8201;&#8212;&#8201;both are in the class C network with network address <code>10.0.0.0</code></p>
</li>
<li>
<p><em><code>10.10.10.54/0xffffff00</code> &amp; <code>10.10.11.54/24</code></em></p>
<p>NOT same subnet&#8201;&#8212;&#8201;both are in class C networks, but one has a network address of <code>10.10.10.0</code> while the other has the network address <code>10.10.11.0</code></p>
</li>
<li>
<p><em><code>10.245.6.11/16</code> &amp; <code>10.245.7.11/0xffff0000</code></em></p>
<p>SAME subnet&#8201;&#8212;&#8201;both are in the class B network with network address <code>10.245.0.0</code></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_conclusions_7">Conclusions</h3>
<div class="paragraph">
<p>For a computer to work correctly on an IP network, it must have the following three things properly configured:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>An IP Address</p>
</li>
<li>
<p>A Netmask</p>
</li>
<li>
<p>A Default Router</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When troubleshooting home network sharing problems, one of the first things to do is verify that all devices are on the same subnet.
Usually, when they&#8217;re not, that was unintentional, and the cause of the problems.
Learning to read and understand IP addresses and netmasks is a vital skill for just about any network troubleshooting.</p>
</div>
<div class="paragraph">
<p>In this instalment, we concentrated on understanding the network settings we see in our computers. In the next instalment we&#8217;ll take a look at the protocol that is almost certainly passing those settings to your computers, DHCP.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt26">TTT Part 26 of n &#8212; DHCP</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In <a href="#ttt23">part 23 of n</a>, we took a big-picture look at how TCP/IP networking works.
As a quick reminder, the most important points were:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Our computer networks use a stack of protocols known as TCP/IP</p>
</li>
<li>
<p>We think of the stack of protocols as being broken into four layers:</p>
<div class="ulist">
<ul>
<li>
<p>The Link Layer&#8201;&#8212;&#8201;lets computers that are on the same network send single packets of data to each other</p>
</li>
<li>
<p>The Internet Layer&#8201;&#8212;&#8201;lets computers on different networks send single packets of data to each other</p>
</li>
<li>
<p>The Transport Layer&#8201;&#8212;&#8201;lets computers send meaningful streams of data between each other</p>
</li>
<li>
<p>The Application Layer&#8201;&#8212;&#8201;where all the networked apps we use live</p>
</li>
</ul>
</div>
</li>
<li>
<p>Logically, data travels across the layers&#8201;&#8212;&#8201;HTTP to HTTP, TCP to TCP, IP to IP, Ethernet to Ethernet, but physically, data travels up and down the stack, one layer to another, only moving from one device to another when it gets to the Link Layer at the very bottom of the stack.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In <a href="#ttt25">the previous instalment</a>, we looked at how IP subnet works.
The key takeaway was that a computer needs a minimum of three settings correctly configured to be able to participate in an IP network: an IP address, a subnet mask, and a default gateway (the IP address of the router providing access outside the subnet).
We also looked at how to read those three settings from your Mac using the GUI (Graphical User Interface) and the Terminal.
Finally, we noted that historically, those settings had to be manually configured, but that today, almost all computers acquire those settings automatically.
In this instalment, we&#8217;ll look at the protocol that makes that possible, the Dynamic Host Configuration Protocol, or DHCP.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 26</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 26</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT26DHCP/TTT_26_DHCP.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_26.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT26DHCP/TTT_26_DHCP.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_problem_to_be_solved">The Problem to be Solved</h3>
<div class="paragraph">
<p>If we rewind the clock to the days before laptops (let alone tablets and smartphones), the only computers connecting to networks were stationary devices.
A network admin would connect the computer to the network, configure the three vital settings, and that would be the computer set up on the network, probably for its entire life.</p>
</div>
<div class="paragraph">
<p>Even at this early stage, there was some friction with this process.
Manually configured network settings make seamless network changes impossible.
Once the network is changed in some way, a network engineer has to revisit each computer one by one to update the settings.</p>
</div>
<div class="paragraph">
<p>However, it was the invention of the portable networked computer that turned this friction into a major problem.
We all expect to be able to get network access where ever we go with our laptops, iPhones, and iPads.
If we were doing things the old way and manually configuring our devices, we would need to know the IP address, netmask, and gateway for every network we used, and we would have to manually change the settings each time we moved from one network to another.
Obviously, manually configured network settings are just not practical in the modern world!</p>
</div>
<div class="paragraph">
<p>The solution was to develop a protocol that would allow computers to automatically discover their own settings.</p>
</div>
<div class="paragraph">
<p>The first attempt at developing such a protocol was <a href="https://en.wikipedia.org/wiki/Reverse_Address_Resolution_Protocol">RARP</a> (the Reverse ARP Protocol), which was published in 1984.
RARP was a link-layer protocol (Layer 1 in the TCP/IP model), which meant that the RARP server had to be on the same Ethernet network as the clients.
This also meant that organisations with multiple subnets needed multiple RARP servers.
RARP was a short-lived experiment, being superseded with the release of <a href="https://en.wikipedia.org/wiki/Bootstrap_Protocol">BOOTP</a> (the Bootstrap Protocol) in 1985.
BOOTP was a significant step forward, introducing the concept of a relay agent that could forward BOOTP requests from multiple subnets to a single centralised BOOTP server.
BOOTP was still very much a product of its time though&#8201;&#8212;&#8201;it was designed around the concept of allocating IPs to computers permanently.
BOOTP has no way to reclaim addresses, so it&#8217;s useless in environments were lots of computers come and go all the time.</p>
</div>
<div class="paragraph">
<p>In 1993 BOOTP was extended to create the protocol we use today, <a href="https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol">DHCP</a> (the Dynamic Host Configuration Protocol).
DHCP is built around the concept of computers temporarily <em>leasing</em> an IP address.
As computers come and go, IP addresses are leased to those computers for a set amount of time, and then reclaimed for later reuse.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_chicken_the_egg">The Chicken &amp; the Egg</h3>
<div class="paragraph">
<p>As perverse as it sounds, DHCP is an Application Layer protocol (Layer 4 in the TCP/IP model) that&#8217;s used to configure a computer&#8217;s IP settings (Layer 2 in the TCP/IP model).
DHCP uses UDP, which in turn uses IP.
How can a protocol that relies on the IP protocol be used to configure the computer&#8217;s IP settings?</p>
</div>
<div class="paragraph">
<p>The reason DHCP can work is that even an un-configured IP stack can send and receive so-called <em>broadcast packets</em>.
ARP maps the IP address <code>255.255.255.255</code> to the MAC address <code>FF:FF:FF:FF:FF:FF</code>.
As we learned in <a href="#ttt24">Instalment 24</a>, <code>FF:FF:FF:FF:FF:FF</code> is a special MAC address that&#8217;s used to send a packet to every device on an Ethernet network.
Devices with an un-configured IP stack can send and receive IP (and hence UDP) packets with a source address of <code>0.0.0.0</code> and a destination address of <code>255.255.255.255</code>.
The DHCP protocol makes liberal use of these broadcast packets.</p>
</div>
</div>
<div class="sect2">
<h3 id="_prerequisites">Prerequisites</h3>
<div class="paragraph">
<p>For DHCP to work on a given Ethernet network, that network must contain one of two things&#8201;&#8212;&#8201;a DHCP server, or a DHCP relay agent.
We&#8217;ve already mentioned that so-called home routers are not actually routers, but boxes containing many components.
We already know that these devices contain a router component, an Ethernet switch component, and a wireless access point component but they actually contain more components than that.
Another one of the components contained within the little boxes we refer to as home routers is a DHCP server.
This means that on our home networks we have a DHCP server directly connected to our Ethernet network.</p>
</div>
<div class="paragraph">
<p>On larger networks, like those you&#8217;d find in corporations or educational institutions, you won&#8217;t find home routers powering the network.
Instead, what you&#8217;ll find is that the managed switches and routers used by these organisations contain DHCP relay agents, which relay DHCP requests from all the different subnets on the network to a single central cluster of DHCP servers (usually with redundancy built-in in case a server crashes).
This more complex environment is outside of the scope of this series.
We&#8217;ll be ignoring DHCP relay agents for the remainder of this discussion.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_dhcp_works">How DHCP Works</h3>
<div class="paragraph">
<p>DHCP is a simple request-response protocol.
DHCP relies heavily on UDP broadcast packets, but whenever possible it uses regular UDP packets because they cause less congestion on a network.</p>
</div>
<div class="paragraph">
<p>When a computer configured to use DHCP is first connected to a network, a four-part conversation should follow, at the end of which the computer should have a fully configured TCP/IP stack.
Assuming everything goes to plan, the following should be the sequence of events:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The client broadcasts a DHCP DISCOVER packet to <code>255.255.255.255</code>.</p>
</li>
<li>
<p>A DHCP server receives that packet and responds with A DHCP OFFER packet also broadcast to <code>255.255.255.255</code>.</p>
</li>
<li>
<p>The client receives the OFFER and broadcasts a DHCP REQUEST packet.</p>
</li>
<li>
<p>The server receives the REQUEST and broadcasts back a DHCP ACK packet.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>What does that sequence of four packets really mean?</p>
</div>
<div class="paragraph">
<p>The initial DHCP DISCOVER is the client broadcasting its request for configuration settings to the entire network in the hope that a DHCP server will respond to it.
That request contains a minimum of the MAC address of the requesting computer, a list of configuration settings it would like a value for, and a so-called <em>magic cookie</em>.
The DISCOVER packet can also contain extra information like the client&#8217;s hostname, and the length of the lease the client would like.</p>
</div>
<div class="paragraph">
<p>The DHCP server will hear the broadcast and, assuming it&#8217;s configured to do so, respond by broadcasting a DHCP OFFER.
The DHCP OFFER will contain the magic cookie, an IP, subnet, and gateway for the client&#8217;s use, a lease time, and values for as many of the requested settings as possible.</p>
</div>
<div class="paragraph">
<p>If the client is happy with the settings it was offered it will broadcast a DHCP REQUEST, formally asking that it be assigned the offered IP.
The REQUEST contains the IP being requested, the client&#8217;s MAC address, the magic cookie again, and another copy of the list of desired settings.</p>
</div>
<div class="paragraph">
<p>Assuming the requested IP is still free, the server will broadcast back a DHCP ACK (acknowledgement) packet confirming to the client that it can use those details.
The ACK contains the same information as the original OFFER.</p>
</div>
<div class="paragraph">
<p>Once that four-way transaction is complete, the DHCP server marks the IP as being in use for the duration of the lease, and the client uses the supplied details to configure its IP stack.</p>
</div>
<div class="paragraph">
<p>The magic cookie is just a random value generated by the client that is used to tie the different DHCP packets together.
On a busy network, there could be many DISCOVERs, OFFERs, REQUESTs, and ACKs broadcast every second, so without the magic cookie, it would be impossible to tell which response is meant for which client.</p>
</div>
<div class="paragraph">
<p>When the lease comes to an end, the whole process does not have to be repeated.
The client can simply send a new DHCP REQUEST, asking for the lease on its current IP to be extended.
If the server is happy to extend the lease it will respond with a DHCP ACK.
Because the client machine has an IP at this point, there is no need to use inefficient broadcast packets, so these REQUEST and ACK packets are sent directly using regular UDP packets.</p>
</div>
</div>
<div class="sect2">
<h3 id="_seeing_dhcp_packets">Seeing DHCP Packets</h3>
<div class="paragraph">
<p>We can use the tcpdump command to display all the DHCP packets reaching our computer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">sudo </span>tcpdump <span style="color: #000080">-ennv</span> port 67 or port 68</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will create quite verbose output, showing the full content of every DHCP packet.
The content of a packet is tabbed in, so each line starting at the left edge is the start of a new packet.</p>
</div>
<div class="paragraph">
<p>Below is a capture if the DHCP conversation between my laptop and my router, with the critical information highlighted, and a blank line inserted between each packet for extra clarity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">20:00:18.229408 60:c5:47:9b:e7:88 <span style="color: #000000;font-weight: bold">&gt;</span> ff:ff:ff:ff:ff:ff, ethertype IPv4 <span style="color: #000000;font-weight: bold">(</span>0x0800<span style="color: #000000;font-weight: bold">)</span>, length 342: <span style="color: #000000;font-weight: bold">(</span>tos 0x0, ttl 255, <span style="color: #0086B3">id </span>45669, offset 0, flags <span style="color: #000000;font-weight: bold">[</span>none], proto UDP <span style="color: #000000;font-weight: bold">(</span>17<span style="color: #000000;font-weight: bold">)</span>, length 328<span style="color: #000000;font-weight: bold">)</span>
    0.0.0.0.68 <span style="color: #000000;font-weight: bold">&gt;</span> 255.255.255.255.67: BOOTP/DHCP, Request from 60:c5:47:9b:e7:88, length 300, xid 0x6e151923, secs 2, Flags <span style="color: #000000;font-weight: bold">[</span>none]
  Client-Ethernet-Address 60:c5:47:9b:e7:88
  Vendor-rfc1048 Extensions
<span class="hll">    Magic Cookie 0x63825363
</span><span class="hll">    DHCP-Message Option 53, length 1: Discover
</span>    Parameter-Request Option 55, length 9:
      Subnet-Mask, Default-Gateway, Domain-Name-Server, Domain-Name
      Option 119, LDAP, Option 252, Netbios-Name-Server
      Netbios-Node
    MSZ Option 57, length 2: 1500
<span class="hll">    Client-ID Option 61, length 7: ether 60:c5:47:9b:e7:88
</span>    Lease-Time Option 51, length 4: 7776000
    Hostname Option 12, length 8: <span style="color: #d14">"BW-MBP-2"</span>

20:00:18.234197 00:13:3b:0e:3f:30 <span style="color: #000000;font-weight: bold">&gt;</span> 60:c5:47:9b:e7:88, ethertype IPv4 <span style="color: #000000;font-weight: bold">(</span>0x0800<span style="color: #000000;font-weight: bold">)</span>, length 342: <span style="color: #000000;font-weight: bold">(</span>tos 0x10, ttl 128, <span style="color: #0086B3">id </span>0, offset 0, flags <span style="color: #000000;font-weight: bold">[</span>none], proto UDP <span style="color: #000000;font-weight: bold">(</span>17<span style="color: #000000;font-weight: bold">)</span>, length 328<span style="color: #000000;font-weight: bold">)</span>
    192.168.10.1.67 <span style="color: #000000;font-weight: bold">&gt;</span> 192.168.10.206.68: BOOTP/DHCP, Reply, length 300, xid 0x6e151923, Flags <span style="color: #000000;font-weight: bold">[</span>none]
<span class="hll">  Your-IP 192.168.10.206
</span>  Client-Ethernet-Address 60:c5:47:9b:e7:88
  Vendor-rfc1048 Extensions
<span class="hll">    Magic Cookie 0x63825363
</span><span class="hll">    DHCP-Message Option 53, length 1: Offer
</span>    Server-ID Option 54, length 4: 192.168.10.1
    Lease-Time Option 51, length 4: 86400
    Subnet-Mask Option 1, length 4: 255.255.255.0
    Default-Gateway Option 3, length 4: 192.168.10.1
    Domain-Name-Server Option 6, length 4: 192.168.10.1
    Domain-Name Option 15, length 11: <span style="color: #d14">"local domain"</span>

20:00:19.235167 60:c5:47:9b:e7:88 <span style="color: #000000;font-weight: bold">&gt;</span> ff:ff:ff:ff:ff:ff, ethertype IPv4 <span style="color: #000000;font-weight: bold">(</span>0x0800<span style="color: #000000;font-weight: bold">)</span>, length 342: <span style="color: #000000;font-weight: bold">(</span>tos 0x0, ttl 255, <span style="color: #0086B3">id </span>45670, offset 0, flags <span style="color: #000000;font-weight: bold">[</span>none], proto UDP <span style="color: #000000;font-weight: bold">(</span>17<span style="color: #000000;font-weight: bold">)</span>, length 328<span style="color: #000000;font-weight: bold">)</span>
    0.0.0.0.68 <span style="color: #000000;font-weight: bold">&gt;</span> 255.255.255.255.67: BOOTP/DHCP, Request from 60:c5:47:9b:e7:88, length 300, xid 0x6e151923, secs 3, Flags <span style="color: #000000;font-weight: bold">[</span>none]
  Client-Ethernet-Address 60:c5:47:9b:e7:88
  Vendor-rfc1048 Extensions
<span class="hll">    Magic Cookie 0x63825363
</span><span class="hll">    DHCP-Message Option 53, length 1: Request
</span><span class="hll">    Parameter-Request Option 55, length 9:
</span><span class="hll">      Subnet-Mask, Default-Gateway, Domain-Name-Server, Domain-Name
</span><span class="hll">      Option 119, LDAP, Option 252, Netbios-Name-Server
</span><span class="hll">      Netbios-Node
</span>    MSZ Option 57, length 2: 1500
    Client-ID Option 61, length 7: ether 60:c5:47:9b:e7:88
<span class="hll">    Requested-IP Option 50, length 4: 192.168.10.206
</span>    Server-ID Option 54, length 4: 192.168.10.1
    Hostname Option 12, length 8: <span style="color: #d14">"BW-MBP-2"</span>

20:00:19.239426 00:13:3b:0e:3f:30 <span style="color: #000000;font-weight: bold">&gt;</span> 60:c5:47:9b:e7:88, ethertype IPv4 <span style="color: #000000;font-weight: bold">(</span>0x0800<span style="color: #000000;font-weight: bold">)</span>, length 342: <span style="color: #000000;font-weight: bold">(</span>tos 0x10, ttl 128, <span style="color: #0086B3">id </span>0, offset 0, flags <span style="color: #000000;font-weight: bold">[</span>none], proto UDP <span style="color: #000000;font-weight: bold">(</span>17<span style="color: #000000;font-weight: bold">)</span>, length 328<span style="color: #000000;font-weight: bold">)</span>
    192.168.10.1.67 <span style="color: #000000;font-weight: bold">&gt;</span> 192.168.10.206.68: BOOTP/DHCP, Reply, length 300, xid 0x6e151923, secs 3, Flags <span style="color: #000000;font-weight: bold">[</span>none]
<span class="hll">  Your-IP 192.168.10.206
</span>  Client-Ethernet-Address 60:c5:47:9b:e7:88
  Vendor-rfc1048 Extensions
<span class="hll">    Magic Cookie 0x63825363
</span><span class="hll">    DHCP-Message Option 53, length 1: ACK
</span>    Server-ID Option 54, length 4: 192.168.10.1
<span class="hll">    Lease-Time Option 51, length 4: 7200
</span><span class="hll">    Subnet-Mask Option 1, length 4: 255.255.255.0
</span><span class="hll">    Default-Gateway Option 3, length 4: 192.168.10.1
</span><span class="hll">    Domain-Name-Server Option 6, length 4: 192.168.10.1
</span><span class="hll">    Domain-Name Option 15, length 11: <span style="color: #d14">"localdomain"</span>
</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_beware_of_nacks">Beware of NACKs</h3>
<div class="paragraph">
<p>We&#8217;ve already seen the four most common types of DHCP packet, DISCOVER, OFFER, REQUEST, and ACK.
There are three more types you may see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DHCP INFORM packets are used by clients to request more information from the server.
If you configure your browser to use automatic proxy configuration, your computer can send a DHCP INFORM packet to ask the DHCP server if it knows what proxy settings should be used.</p>
</li>
<li>
<p>Polite DHCP clients can also use DHCP RELEASE packets to tell a DHCP server they are finished with an IP address.
This allows the IP to be marked as free before the lease expires.</p>
</li>
<li>
<p>The final type of DHCP packet is the one you need to be wary of&#8201;&#8212;&#8201;the DHCP NACK.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As the name may suggest to you, NACK stands for NOT ACK, in other words, it&#8217;s a negative response to a DHCP REQUEST.
It&#8217;s perfectly normal for a small percentage of the DHCP packets on a network to be NACKs as they can be produced in innocent ways.
However, on a healthy network, you should see far fewer NACKs than ACKS.</p>
</div>
<div class="paragraph">
<p>When a client&#8217;s lease is coming to an end, it sends a DHCP REQUEST to ask that its lease be extended.
If for any reason the server does not want to extend the lease, it will respond with a DHCP NACK.
On receiving this NACK the client simply starts from zero again and sends a DHCP DISCOVER, at which point it will receive an OFFER of a different IP, which it can then REQUEST, and which the server should then ACK.
This means that the pattern REQUEST, NACK, DISCOVER, OFFER, REQUEST, ACK is entirely innocent, and nothing to worry about.</p>
</div>
<div class="paragraph">
<p>DHCP NACKs can also be generated when an address that&#8217;s supposed to be managed by DHCP is hard-coded onto a device somewhere on the network.
Before sending out an ACK for an IP that&#8217;s not supposed to be leased to anyone yet, the DHCP server will try ping the IP to make sure it really is free. If it gets a reply, it will respond to the REQUEST with a NACK.</p>
</div>
<div class="paragraph">
<p>Finally, some computers, when waking up from sleep or booting, like to request their old IP again, even if the lease time has expired.
When this happens, it&#8217;s quite possible that the server has reused the IP, and hence it has to NACK that request.
This will result in the innocent pattern REQUEST, NACK, DISCOVER, OFFER, REQUEST, ACK.</p>
</div>
<div class="paragraph">
<p>When you need to start worrying is when you see the same client get NACKed over and over again, and never get to an ACK, or, when you start to see as many or more NACKs as ACKs.</p>
</div>
<div class="paragraph">
<p>There are two common problems that can lead to excessive NACKs.</p>
</div>
<div class="paragraph">
<p>Firstly, if a network contains two DHCP servers (or more), they can end up fighting with each other.
One can NACK every offer made by the other, and vice-versa.
It&#8217;s possible for two dueling DHCP servers to make it impossible for anyone on the network to get an IP via DHCP.
This is something I&#8217;ve witnessed a few times during my day job.
This can be done accidentally, or maliciously.</p>
</div>
<div class="paragraph">
<p>Secondly, it is possible to configure your DHCP server to always assign the same IP address to a given MAC address.
These so-called <em>static leases</em> allow you to have all the advantages of manually configured IP addresses without the disadvantages.
Many home routers allow you to configure these kinds of static leases.
Where things can go wrong is when there is a static lease defined for a given MAC address, and some other device on the network has been manually configured to use that IP address.
The DHCP server will offer the same IP over and over again, and each time the client responds with a DHCP REQUEST it will receive a NACK because the IP is responding to PINGs.
In this situation, the DHCP client will fail to connect to the network until the usurper is removed from the network.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_ipconfig_command_os_x_only">The <code>ipconfig</code> Command (OS X Only)</h3>
<div class="paragraph">
<p>We&#8217;ve already encountered the <code>ifconfig</code> command which is common to all POSIX OSes, but OS X also contains a separate command which provides command-line access to many of the functions exposed in the Network System Preference Pane.
I&#8217;m referring to the confusingly named <code>ipconfig</code>.
The reason I say this is a confusing name is that it&#8217;s very similar to <code>ifconfig</code> and identical to a completely different Windows command.</p>
</div>
<div class="paragraph">
<p><code>ipconfig</code> can be used to turn a network interface off as follows (replacing <code>enX</code> with the actual interface you want to disable):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">sudo </span>ipconfig <span style="color: #0086B3">set </span>enX NONE</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ipconfig</code> can be used to enable a network interface in DHCP mode as follows (again replacing <code>enX</code> with the actual interface you want to disable):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">sudo </span>ipconfig <span style="color: #0086B3">set </span>enX DHCP</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, <code>ipconfig</code> can be used to show the DHCP ACK packet that was used to configure a network interface (again replacing <code>enX</code> with the actual interface you want to get the packet for):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">sudo </span>ipconfig getpacket enX</code></pre>
</div>
</div>
<div class="paragraph">
<p>The relevant information is in the options section near the bottom of the output, highlighted below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="code"><pre><span style="color: #555555">BW-MBP-2:~ bart$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">sudo </span>ipconfig getpacket en1
<span style="color: #888888">Password:</span>
<span style="color: #888888">op = BOOTREPLY</span>
<span style="color: #888888">htype = 1</span>
<span style="color: #888888">flags = 0</span>
<span style="color: #888888">hlen = 6</span>
<span style="color: #888888">hops = 0</span>
<span style="color: #888888">xid = 1846876452</span>
<span style="color: #888888">secs = 0</span>
<span style="color: #888888">ciaddr = 192.168.10.206</span>
<span style="color: #888888">yiaddr = 192.168.10.206</span>
<span style="color: #888888">siaddr = 0.0.0.0</span>
<span style="color: #888888">giaddr = 0.0.0.0</span>
<span style="color: #888888">chaddr = 60:c5:47:9b:e7:88</span>
<span style="color: #888888">sname =</span>
<span style="color: #888888">file =</span>
<span style="color: #888888">options:</span>
<span style="color: #888888">Options count is 8</span>
<span style="color: #888888">dhcp_message_type (uint8): ACK 0x5</span>
<span class="hll"><span style="color: #888888">server_identifier (ip): 192.168.10.1</span>
</span><span style="color: #888888">lease_time (uint32): 0x15180</span>
<span class="hll"><span style="color: #888888">subnet_mask (ip): 255.255.255.0</span>
</span><span class="hll"><span style="color: #888888">router (ip_mult): {192.168.10.1}</span>
</span><span class="hll"><span style="color: #888888">domain_name_server (ip_mult): {192.168.10.1}</span>
</span><span class="hll"><span style="color: #888888">domain_name (string): localdomain</span>
</span><span style="color: #888888">end (none):</span>
<span style="color: #555555">BW-MBP-2:~ bart$</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>For a full description of everything <code>ipconfig</code> can do, see its man page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">man ipconfig</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_security_elephant_in_the_room_again">The Security Elephant in the Room (Again)</h3>
<div class="paragraph">
<p>As we saw with ARP previously, there is no security built into the DHCP protocol.
DHCP clients will blindly implement whatever settings a DHCP server hands them.
This is usually fine, because most of the time, the only DHCP server on your network is one that is there to help, but not always.
A DHCP server process is small and simple.
Any computer can act as a DHCP server.
An attacker could connect to an open wireless network and run their own DHCP server, advertising their IP as the gateway, and hence become a Man In The Middle.
Similarly, a malicious DHCP server could advertise a malicious DNS server, also allowing them to redirect all internet traffic to malicious servers.</p>
</div>
<div class="paragraph">
<p>As a user, your only defence is to assume the worst on all networks you don&#8217;t control, and use technologies like VPNs and TLS/SSL to protect your data.</p>
</div>
<div class="paragraph">
<p>Network administrators can also protect their users by monitoring the source addresses of all DHCP OFFER, DHCP ACK, DHCP NACK, and DHCP INFORM packets and triggering an alarm if any unauthorised DHCP servers become active on the network.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conclusions_8">Conclusions</h3>
<div class="paragraph">
<p>The two critical pieces of information to take away from this instalment are that DHCP is used to automatically configure the IP stack on our computers and that a healthy DHCP transaction takes the following form: DISCOVER, OFFER, REQUEST, ACK.</p>
</div>
<div class="paragraph">
<p>In the previous two instalments, we learned how Ethernet and IP provide the basic networking functionality our computers need to communicate.
In this instalment, we&#8217;ve seen how our home routers use the DHCP protocol to automatically configure the IP settings on our devices.
In the next instalment, we&#8217;ll learn how DNS allows us as humans to ignore IP addresses while surfing the web, sending emails, playing games, and so much more.</p>
</div>
<div class="paragraph">
<p>Once we&#8217;ve added an understanding of DNS to our mental toolkit, we&#8217;ll be ready to apply everything we have learned in instalments 23 through 27 together in a single instalment dedicated to terminal commands for network troubleshooting.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt27">TTT Part 27 of n &#8212; DNS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In <a href="#ttt23">part 23 of n</a>, we took a big-picture look at how TCP/IP networking works.
As a quick reminder, the most important points were:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Our computer networks use a stack of protocols known as TCP/IP</p>
</li>
<li>
<p>We think of the stack of protocols as being broken into four layers:</p>
<div class="ulist">
<ul>
<li>
<p>The Link Layer&#8201;&#8212;&#8201;lets computers that are on the same network send single packets of data to each other</p>
</li>
<li>
<p>The Internet Layer&#8201;&#8212;&#8201;lets computers on different networks send single packets of data to each other</p>
</li>
<li>
<p>The Transport Layer&#8201;&#8212;&#8201;lets computers send meaningful streams of data between each other</p>
</li>
<li>
<p>The Application Layer&#8201;&#8212;&#8201;where all the networked apps we use live</p>
</li>
</ul>
</div>
</li>
<li>
<p>Logically, data travels across the layers&#8201;&#8212;&#8201;HTTP to HTTP, TCP to TCP, IP to IP, Ethernet to Ethernet, but physically, data travels up and down the stack, one layer to another, only moving from one device to another when it gets to the Link Layer at the very bottom of the stack.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We have now looked in detail at <a href="#ttt24">Layer 1</a> and <a href="#ttt25">Layer 2</a>, and have looked at how <a href="#ttt26">DHCP</a> allows our computers to automatically configure their TCP/IP network stack.
In this instalment, we&#8217;re going to look at a Layer 4 protocol that is essential to our use of the internet&#8201;&#8212;&#8201;DNS.</p>
</div>
<div class="paragraph">
<p>At layers 2 and 3, all addressing is by IP address, yet just about every networked app we use totally insulates us from that fact.
Our computers think in terms of IP addresses, but we think in terms of domain names.
The Domain Name System (DNS) exists to bridge this gap, allowing domain names to be converted to IP addresses, and IP addresses to domain names.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 27</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episodes 27a &amp; 27b</p>
</div>
<table class="tableblock frame-none grid-none stripes-even stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Episode 27a</th>
<th class="tableblock halign-left valign-top">Episode 27b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT27aDNS/TTT_27a_DNS.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT27bDNS/TTT_27b_DNS.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">Scan the QRcode to listen on a different device</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="assets/qrcodes/TTT_27a.png" alt="QRcode 27a">
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="assets/qrcodes/TTT_27b.png" alt="QRcode 27b">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT27aDNS/TTT_27a_DNS.mp3">play/download the MP3 in your browser (a)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT27bDNS/TTT_27b_DNS.mp3">play/download the MP3 in your browser (b)</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_the_hosts_file">The Hosts File</h3>
<div class="paragraph">
<p>In the early days of the internet the conversion between human-readable hostnames for computers and IP addresses was stored within each computer in a single file&#8201;&#8212;&#8201;<code>/etc/hosts</code>.
This meant that names were not in any way authoritative.
I could give whatever name I wanted to an IP address and save that mapping into my <code>/etc/hosts</code> file, and you could give the same IP address a completely different name and save that mapping in your <code>/etc/hosts</code> file.</p>
</div>
<div class="paragraph">
<p>Organisations could choose to centrally manage <code>/etc/hosts</code> file by keeping an authoritative copy on a file server and having a script copy that file to every computer within the organisation overnight, but it really was up to each organisation to decide how they would manage hostname to IP address mappings.</p>
</div>
<div class="paragraph">
<p>While DNS superseded the hosts file, it did not replace it.
The hosts file still exists in Linux, Unix, OS X, and even Windows!
On a POSIX OS like OS X you can view the content of the file with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">cat</span> /etc/hosts</code></pre>
</div>
</div>
<div class="paragraph">
<p>This file is given a higher priority than DNS by your operating system, so any name to IP mappings you add to this file will override the official mappings from DNS.
This can be very useful.
It can be used as a crude form of website blocking. If you map a website you don&#8217;t want your kids to use to a non-existent IP address, or to the loopback address (<code>127.0.0.1</code>), then that site will be inaccessible.
Another great use for the hosts file is to test a new website before you make it live.
Finally, you can also use the hosts file to add memorable names to computers on your own home network.
It&#8217;s a much simpler approach than running your own private DNS infrastructure.</p>
</div>
<div class="paragraph">
<p>The hosts file is a plain text file with a very simplistic format.
Each line must start with an IP address followed by one or more names separated by blank space.
If I wanted to add two aliases to my home router, I could add a line like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">192.168.10.1 myrouter myrouter.localdomain</code></pre>
</div>
</div>
<div class="paragraph">
<p>I would now be able to access the web interface for my router at <code><a href="https://myrouter" class="bare">https://myrouter</a></code> and <code><a href="https://myrouter.localdomain" class="bare">https://myrouter.localdomain</a></code>.</p>
</div>
<div class="paragraph">
<p>It&#8217;s also helpful to note that lines starting with a <code>#</code> are interpreted as comment lines, and ignored by the OS.
If you&#8217;re going to use the hosts file extensively, it&#8217;s a good idea to comment your changes so you know why you did what you did when you look back at the file a few months or years hence!</p>
</div>
<div class="paragraph">
<p>Finally, be aware that the file is owned by root, so you need to use <code>sudo</code> to gain root privileges to edit the file, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">sudo </span>vi /etc/hosts
<span style="color: #0086B3">sudo </span>pico /etc/hosts</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_domain_name_system">The Domain Name System</h3>
<div class="paragraph">
<p>The DNS spec was released in 1983, and the first Unix DNS server was written in 1984.
Although the spec has been added to in the intervening years, the fundamental design remains unchanged.</p>
</div>
<div class="sect3">
<h4 id="_the_dns_philosophy">The DNS Philosophy</h4>
<div class="paragraph">
<p>Before DNS, computers had simple hostnames but DNS took things to the next level by introducing the concept of a hierarchy of names.
In DNS speak, a group of related names are known as a zone but most people refer to them as domains.</p>
</div>
<div class="paragraph">
<p>The hierarchy of domain names is anchored at the top by the so-called root zone, which has the one-letter name <code>.</code> (almost universally omitted when domain names are written).
Below the root, you will find the so-called TLDs or <em>Top Level Domains</em> like <code>.com</code>, <code>.net</code>, <code>.org</code>, and so on.
As well as generic TLDs like those examples, there are also country-specific TLDs, like <code>.ie</code> for Ireland, <code>.be</code> for Belgium, <code>.fr</code> for France, and so forth.
Some countries have also chosen to break their TLDs up into multiple sub-TLDs, a practice that seems particularly common among former British colonies!
E.g.
in Australia commercial sites are <code>.com.au</code> while educational sites are <code>.edu.au</code>.
A particularly cryptic one is <code>.ac.uk</code>, which is the TLD for UK educational institutions (the <code>ac</code> stands for <em>Academic Community</em>).</p>
</div>
<div class="paragraph">
<p>Institutions and the general public can buy the rights to use domain names one level down from TLDs.
Allison Sheridan, for example, has the rights to <code>podfeet.com</code>, and I have the rights to <code>bartb.ie</code>.
Once you own a domain you can then break it down any way you like, adding as many or as few subdomains as desired.
<code>www.podfeet.com</code> is a subdomain of <code>podfeet.com</code> which is a subdomain of the generic TLD <code>.com</code> which is a subdomain of the root (<code>.</code>).
Technically, <code>www.podfeet.com</code> should be written as <code>www.podfeet.com.</code>, but as a species, we&#8217;ve decided that the DNS root zone should be implied rather than explicitly added to domain names, and we&#8217;ve written our software with that implicit assumption.
You are entirely free to add the final dot back in though, it is part of the spec after all!</p>
</div>
<div class="paragraph">
<p>The best way to think of DNS names is as a tree, as illustrated in the diagram below.
But, rather than reading the tree from root to leaf, we always read it backwards, from leaf to root.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt27/DNSHierarchy.png" alt="DNS Hierarchy">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dns_records">DNS Records</h4>
<div class="paragraph">
<p>Many people describe DNS as being like the internet&#8217;s phone book, because like a phone book, it turns names into numbers.
That&#8217;s not a bad analogy, but it&#8217;s overly simplistic.
A phone book contains only one type of record, phone numbers, but the DNS system contains records of many different types.
The list below is not exhaustive, but covers the records you&#8217;re most likely to encounter:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>A</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A DNS A record maps a domain name to an IPv4 IP address&#8201;&#8212;&#8201;the most common kind of DNS record</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AAAA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Someday DNS AAAA records may replace A records as the most common&#8201;&#8212;&#8201;they map domain names to IPv6 addresses.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CNAME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A DNS CNAME (Canonical Name) record maps a domain name to another domain name.
Think of CNAME records as DNS aliases.
E.g.
If you outsource your email service to a third party but don&#8217;t want to give people a URL with another company&#8217;s domain name in it, you could set up a CNAME record to alias <code>webmail.yourdomain.com</code> to <code>webmail.serviceprovider.com</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MX</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS MX records, or Mail eXchanger records specify the domain name of the mail server that accepts email for a given domain.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PTR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS PTR records are used by the reverse-DNS system to map a domain name to an IP address (think of them as the inverse of A records).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS NS records map a domain name to the domain name of the server that is authoritative for that domain (domains usually have 2 or 3 NS records)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TXT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS TXT records, or text records, are used to map a domain name to an arbitrary piece of text.
A common usage for TXT records is to prove domain ownership.
Certificate authorities and cloud service providers often force people applying for a certificate or a service to prove they own a domain name by asking that they set a given TXT record on the domain.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SRV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS SRV records, or service records, are used to map service to a given domain name, port number, and protocol.
Microsoft Windows licensing and Microsoft Active Directory make extensive use of SRV records for service auto-discovery.
E.g., a DNS SRV record is used by Windows desktop computers in large organisations with centrally managed multi-user licenses to figure out what server they should contact to license themselves.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If this series was targeted at corporate sysadmins we&#8217;d focus heavily on A, AAAA, PRT &amp; SRV records.
If it was targeted at webmasters we&#8217;d focus on A, CNAME, NS and TXT records.
But, as this series is targeted at home users, we&#8217;re only really interested in A, CNAME &amp; MX records.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dns_servers">DNS Servers</h3>
<div class="paragraph">
<p>An important subtlety in the operation of DNS is that there are two very distinct types of DNS servers that fulfil two entirely different roles.
Hence, talking about a <em>DNS Server</em> without any more specificity is meaningless, and only likely to lead to confusion.
To save everyone&#8217;s sanity you should never use the term <em>DNS Server</em>. Instead, always refer to either <em>Authoritative DNS Servers</em> or <em>DNS Resolvers</em>.</p>
</div>
<div class="sect3">
<h4 id="_authoritative_dns_servers">Authoritative DNS Servers</h4>
<div class="paragraph">
<p>Authoritative DNS servers are responsible for hosting the DNS records for a domain.
Each domain has to be served by at least one authoritative server, and almost all domains have two or more authoritative servers.
Large organisations like corporations and universities often run their own authoritative servers, but the general public generally pays a domain registrar to provide authoritative DNS servers for their domains.
E.g.
I pay Register365 to host the DNS zone for <code>bartb.ie</code> on their cluster of authoritative DNS servers, and Allison pays GoDaddy to host the DNS zone for <code>podfeet.com</code> on their cluster of authoritative DNS servers.</p>
</div>
<div class="paragraph">
<p>Most of us rely on our domain registrars to perform two functions for us&#8201;&#8212;&#8201;register the domain, and host the DNS zone on their authoritative servers.
It is entirely possible to separate those two functions.
Sometimes it makes more sense to have the company that hosts your website also host your DNS zone on their authoritative DNS servers.
The fact that these two roles are separable causes a lot of confusion.</p>
</div>
<div class="paragraph">
<p>What really happens is that your registrar manages the NS records for your domain, and you can then point those NS records at their authoritative DNS servers, or any other authoritative DNS servers of your choice, perhaps those belonging to your hosting company.</p>
</div>
<div class="paragraph">
<p>Unless you own your own domain, you probably don&#8217;t need to know about authoritative DNS servers.</p>
</div>
<div class="paragraph">
<p>If you do own your own domain, you are probably administering it through an online control panel with your domain registrar or hosting provider.
You should be able to access an interface that looks something like the one in the screenshot below (from Hover.com) where you can see all the DNS records set on your domain, edit them, and add new ones.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt27/Screen-Shot-2015-01-16-at-15.00.22.png" alt="DNS Control Panel on Hover.com">
</div>
</div>
<div class="paragraph">
<p><!-- vale Vale.Repetition = NO --></p>
</div>
<div class="paragraph">
<p>What you can see in the screenshot above is that there are just three DNS records in the <code>xkpasswd.net</code> zone: two A records (one for <code>xkpasswd.net</code>, and one for <code>www.xkpasswd.net</code>), and an MX record.
You&#8217;ll notice that one of the A records and the MX record use the shortcut symbol <code>@</code> to represent &#8216;this domain&#8217;.
In other words, in this example, where ever you see <code>@</code>, replace it with <code>xkpasswd.net</code>.
The <code>@</code> symbol is used in this way in many DNS control panels, and indeed many many DNS configuration files.</p>
</div>
<div class="paragraph">
<p><!-- vale Vale.Repetition = YES --></p>
</div>
</div>
<div class="sect3">
<h4 id="_dns_resolvers">DNS Resolvers</h4>
<div class="paragraph">
<p>DNS Resolvers do the actual work of looking up the DNS records for a given domain name, whether it&#8217;s A records and CNAME records for turning domain names into IP addresses, or MX records for figuring out what mail server an email for a given domain should be sent to.
DNS resolvers query the authoritative DNS servers to perform these lookups.</p>
</div>
<div class="paragraph">
<p>When DHCP pushes a <em>name server</em> setting to your computer, it is specifying which DNS Resolver your computer should use.
When you look at the Name Server setting in the Network System Preference Pane, you will see what DNS Resolver your computer is configured to use.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt27/f106e4d1-f8fe-4f75-9a19-67f355fa73fa.png" alt="Name Server Setting">
</div>
</div>
<div class="paragraph">
<p>On most Linux and Unix OSes, DNS resolution is controlled using the configuration file <code>/etc/resolv.conf</code>.
This file is present in OS X but is used as a way for the OS to expose the settings to scripts and command-line utilities rather than as a way of controlling DNS configuration.
The file on OS X is in the identical format to the ones on Linux and Unix.
You can have a look at this file with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">cat</span> /etc/resolv.conf</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_types_of_dns_resolver">Types of DNS Resolver</h4>
<div class="paragraph">
<p>A true DNS resolver works its way from the DNS root servers out to the requested domain name one step at a time.
For example, for a DNS resolver to convert <code>www.bartb.ie</code> to an IP address it must follow the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Query one of the root DNS servers for the A record for <code>www.bartb.ie.</code> (the list of DNS root servers is hardcoded into the resolver&#8217;s configuration)</p>
</li>
<li>
<p>The root DNS server will respond that it doesn&#8217;t know the answer to that query, but that it does know the authoritative name servers responsible for the <code>.ie.</code> zone.
In other words, the first query returns a list of NS records for the <code>.ie</code> domain.</p>
</li>
<li>
<p>The resolver then asks one of the authoritative DNS servers for <code>.ie</code> if it has an A record for <code>www.bartb.ie.</code></p>
</li>
<li>
<p>The <code>.ie</code> authoritative server responds that it doesn&#8217;t, but that it does know the authoritative servers for the <code>bartb.ie.</code> zone.
The server returns the list of NS records for <code>bartb.ie</code> to the resolver.</p>
</li>
<li>
<p>The resolver then asks one of the authoritative servers for the <code>bartb.ie.</code> zone if it has an A record for <code>www.bartb.ie.</code></p>
</li>
<li>
<p>This is my authoritative DNS server, and I have properly configured it, so it does indeed know the answer, and returns the IP address for <code>www.bartb.ie</code> to the resolver.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The second type of DNS resolver is called the stub resolver.
Stub resolvers don&#8217;t do the hard work of resolution themselves, instead, they forward the request to another resolver and wait to be told the answer.</p>
</div>
<div class="paragraph">
<p>Our operating systems contain stub resolvers and our home routers contain stub resolvers.
Our ISPs provide true resolvers, as do some third-party organisations like Google and OpenDNS.</p>
</div>
<div class="paragraph">
<p>If we imagine the typical home network, what happens when you type an address into the URL bar of your browser is that your browser asks your OS for the IP address that matches the URL you just entered.
Your OS passes that request on to its internal stub resolver.
The stub resolver in your OS passes the query on to the name server DHCP told it to use (almost certainly your home router).
Your home router also contains a stub resolver, so it, in turn, passes the request on to the name server it was configured to use by the DHCP packet it received from your ISP.
Finally, your ISP&#8217;s resolver does the actual resolving and replies to your router with the answer which replies to the stub resolver in your OS which replies to your browser.</p>
</div>
<div class="paragraph">
<p>When you take into account the redirections by the stub resolvers as well as the actual resolution, you find that six separate DNS requests were needed to convert <code>www.bartb.ie</code> to <code>46.22.130.125</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Browser to stub resolver in OS</p>
</li>
<li>
<p>Stub resolver in OS to stub resolver in router</p>
</li>
<li>
<p>Stub resolver in router to true resolver in ISP</p>
</li>
<li>
<p>True resolver in ISP to root DNS server</p>
</li>
<li>
<p>True resolver in ISP to <code>.ie</code> Authoritative DNS server</p>
</li>
<li>
<p>True resolver in ISP to <code>bartb.ie</code> Authoritative DNS server in Register365</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_dns_caching">DNS Caching</h4>
<div class="paragraph">
<p>If every DNS query generated this much activity the load on the root DNS servers would be astronomical, the load on the authoritative servers for the TLDs would be massive too, and even the load on authoritative servers for regular domains like <code>bartb.ie</code> would be large.</p>
</div>
<div class="paragraph">
<p>To make DNS practical, caching is built into the protocol&#8217;s design.
DNS caching is not an afterthought, it was designed in from the start.</p>
</div>
<div class="paragraph">
<p>Every response to a DNS query by an authoritative server contains a piece of metadata called a TTL.
This stands for <em>Time to Live</em> and is expressed as a number of seconds.
The TTL tells resolvers how long the result may be cached for.</p>
</div>
<div class="paragraph">
<p>All DNS resolvers, including stub resolvers, can cache results.
This means that in reality, only a small percentage of the queries your ISP&#8217;s true resolver receives need to be resolved from first principles.
All the common sites like <code>www.google.com</code> will be in the cache, so the resolver can reply without doing any work.
Similarly, the stub resolver in your home router can also cache results, so if anyone in your house has been to <code>podfeet.com</code> recently, the stub resolver can answer directly from the cache without ever contacting your ISP&#8217;s resolver.
The stub resolvers within our OSes can also cache results, so if you visit the same domain in two different browsers, you only need to contact your home router once.
Finally, browsers can also cache responses, so as you browse from page to page within a given site, your browser doesn&#8217;t keep asking the stub resolver built into your OS the same question over and over again.</p>
</div>
<div class="paragraph">
<p>Between your browser&#8217;s cache, your OS&#8217;s cache, your router&#8217;s cache and your ISP&#8217;s cache, only a tiny percentage of queries result in work for the root DNS servers or the authoritative DNS servers.</p>
</div>
<div class="paragraph">
<p>Also&#8201;&#8212;&#8201;it&#8217;s not just positive results that get cached&#8201;&#8212;&#8201;if a domain name is found not to exist, that non-existence is also cached.</p>
</div>
<div class="paragraph">
<p>This multi-layered caching makes DNS very efficient, but it comes at a price, changes made on the authoritative servers do not propagate instantaneously.
They only become visible when all the caches between the user and the authoritative server have expired and the data is refreshed.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_dns_protocol">The DNS Protocol</h3>
<div class="paragraph">
<p>DNS is a Layer 4 protocol that sits on top of UDP.
Each query consists of a single packet, as does each reply.
This use of single packets makes DNS very efficient, but it limits the amount of data that can be contained in a reply, and, it means that requests and replies can get silently dropped because UDP does not guarantee delivery of every packet.
Because of this, DNS resolvers sometimes have to retry their requests after a certain timeout value.</p>
</div>
<div class="paragraph">
<p>Authoritative servers and DNS resolvers listen on UDP port 53.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dns_commands">DNS Commands</h3>
<div class="paragraph">
<p>Windows users must use the old <code>nslookup</code> command to resolve domain names:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">nslookup domain.name</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command is still present in most Unix and Linux variants, including OS X, but is marked as deprecated on some modern distributions.</p>
</div>
<div class="paragraph">
<p>POSIX users, including Mac users, should probably get out of the habit of using <code>nslookup</code> and start relying on the <code>host</code> command for simple queries, and the <code>dig</code> command for complex queries instead.</p>
</div>
<div class="paragraph">
<p>The <code>host</code> command is superbly simple, it accepts one argument, the domain name to resolve, and prints out the corresponding IP address.
If the domain has an MX record that value is printed out too, and if the answer had to be arrived at by following one or more CNAME aliases those intermediate steps are printed out as well.
E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
</pre></td><td class="code"><pre><span class="hll"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>host www.bartb.ie
</span><span style="color: #888888">www.bartb.ie has address 46.22.130.125</span>
<span class="hll"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>host www.podfeet.com
</span><span style="color: #888888">www.podfeet.com is an alias for podfeet.com.</span>
<span style="color: #888888">podfeet.com has address 173.254.94.93</span>
<span style="color: #888888">podfeet.com mail is handled by 10 aspmx.l.google.com.</span>
<span style="color: #888888">podfeet.com mail is handled by 20 alt1.aspmx.l.google.com.</span>
<span style="color: #888888">podfeet.com mail is handled by 30 alt2.aspmx.l.google.com.</span>
<span style="color: #888888">podfeet.com mail is handled by 40 aspmx2.googlemail.com.</span>
<span style="color: #888888">podfeet.com mail is handled by 50 aspmx3.googlemail.com.</span>
<span style="color: #555555">bart-iMac2013:~ bart$</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>dig</code> command is the swiss-army knife of DNS.
For a full list of its many features see:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">man dig</code></pre>
</div>
</div>
<div class="paragraph">
<p>The basic structure of the command is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">dig <span style="color: #000000;font-weight: bold">[</span>options] domain.name <span style="color: #000000;font-weight: bold">[</span>record_type] <span style="color: #000000;font-weight: bold">[</span>@server]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t specify a record type, an A record is assumed, and if you don&#8217;t specify a server, the OS&#8217;s specified resolver is used.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t specify any options you will see quite verbose output, showing both the DNS query sent and the reply, if any.
This can be quite confusing, which is why I suggest using the simpler <code>host</code> command for basic queries.
E.g.
the following shows the output when trying to resolve <code>www.bartb.ie</code> which exists, and <code>wwww.bartb.ie</code> which does not.
There is so much output that at first glance you might think both queries had succeeded.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span class="hll"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>dig www.bartb.ie
</span>
<span style="color: #888888">; &lt;&lt;&gt;&gt; DiG 9.8.3-P1 &lt;&lt;&gt;&gt; www.bartb.ie</span>
<span style="color: #888888">;; global options: +cmd</span>
<span style="color: #888888">;; Got answer:</span>
<span style="color: #888888">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 32641</span>
<span style="color: #888888">;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</span>

<span style="color: #888888">;; QUESTION SECTION:</span>
<span style="color: #888888">;www.bartb.ie.			IN	A</span>

<span style="color: #888888">;; ANSWER SECTION:</span>
<span style="color: #888888">www.bartb.ie.		18643	IN	A	46.22.130.125</span>

<span style="color: #888888">;; Query time: 0 msec</span>
<span style="color: #888888">;; SERVER: 192.168.10.1#53(192.168.10.1)</span>
<span style="color: #888888">;; WHEN: Tue Dec 30 19:08:41 2014</span>
<span style="color: #888888">;; MSG SIZE  rcvd: 46</span>

<span class="hll"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>dig wwww.bartb.ie
</span>
<span style="color: #888888">; &lt;&lt;&gt;&gt; DiG 9.8.3-P1 &lt;&lt;&gt;&gt; wwww.bartb.ie</span>
<span style="color: #888888">;; global options: +cmd</span>
<span style="color: #888888">;; Got answer:</span>
<span style="color: #888888">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NXDOMAIN, id: 4581</span>
<span style="color: #888888">;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 0</span>

<span style="color: #888888">;; QUESTION SECTION:</span>
<span style="color: #888888">;wwww.bartb.ie.			IN	A</span>

<span style="color: #888888">;; AUTHORITY SECTION:</span>
<span style="color: #888888">bartb.ie.		1799	IN	SOA	ns0.reg365.net. support.reg365.net. 2013011301 28800 3600 604800 86400</span>

<span style="color: #888888">;; Query time: 32 msec</span>
<span style="color: #888888">;; SERVER: 192.168.10.1#53(192.168.10.1)</span>
<span style="color: #888888">;; WHEN: Tue Dec 30 19:08:47 2014</span>
<span style="color: #888888">;; MSG SIZE  rcvd: 89</span>

<span style="color: #555555">bart-iMac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What you will notice is that in the first output there is some metadata followed by a number of distinct sections, and finally some more metadata.</p>
</div>
<div class="paragraph">
<p>You can tell the second query failed for two reasons.
Firstly, in the metadata at the top of the output, the status of the query is shown as <code>NXDOMAIN</code> (non-existent domain) rather than <code>NOERROR</code>.
Secondly, there is no <code>ANSWER</code> section in the output.</p>
</div>
<div class="paragraph">
<p>Sometimes this detailed output is very useful, but oftentimes it just gets in the way.
You can suppress the extra information by using the <code>+short</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span class="hll"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>dig +short www.bartb.ie
</span><span style="color: #888888">46.22.130.125</span>
<span class="hll"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>dig +short wwww.bartb.ie
</span><span style="color: #555555">bart-iMac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can request records other than A records by specifying the type of record you want after the domain name, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span class="hll"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>dig +short podfeet.com NS
</span><span style="color: #888888">ns02.domaincontrol.com.</span>
<span style="color: #888888">ns01.domaincontrol.com.</span>
<span class="hll"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>dig +short podfeet.com MX
</span><span style="color: #888888">10 aspmx.l.google.com.</span>
<span style="color: #888888">20 alt1.aspmx.l.google.com.</span>
<span style="color: #888888">30 alt2.aspmx.l.google.com.</span>
<span style="color: #888888">40 aspmx2.googlemail.com.</span>
<span style="color: #888888">50 aspmx3.googlemail.com.</span>
<span class="hll"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>dig +short podfeet.com TXT
</span><span style="color: #888888">"google-site-verification=T6-e-TwfJb8L7TAR8TpR_qQlyzfIafm_a7Lm9cN97kI"</span>
<span style="color: #555555">bart-iMac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use dig to interrogate an authoritative server directly or to use a resolver other than the one configured in the OS by adding a final argument starting with an <code>@</code> symbol.
The argument can be either the domain name for the server your want to query or the IP address of the server.
This can useful when trying to figure out whether or not a given DNS resolver is functioning, or, when testing changes made to authoritative servers without having to wait for all the caches to expire.</p>
</div>
<div class="paragraph">
<p>Below is an example of each use, first querying Google&#8217;s free public resolver for the name server for <code>bartb.ie</code>, and then querying the authoritative server for <code>bartb.ie</code> for the A record for <code>www.bartb.ie</code> (I&#8217;ve left off the <code>+short</code> so you can see which servers were queried in the metadata at the bottom of the output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span class="hll"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>dig bartb.ie NS @8.8.8.8
</span>
<span style="color: #888888">; &lt;&lt;&gt;&gt; DiG 9.8.3-P1 &lt;&lt;&gt;&gt; bartb.ie NS @8.8.8.8</span>
<span style="color: #888888">;; global options: +cmd</span>
<span style="color: #888888">;; Got answer:</span>
<span style="color: #888888">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 55395</span>
<span style="color: #888888">;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 0</span>

<span style="color: #888888">;; QUESTION SECTION:</span>
<span style="color: #888888">;bartb.ie.			IN	NS</span>

<span style="color: #888888">;; ANSWER SECTION:</span>
<span style="color: #888888">bartb.ie.		21185	IN	NS	ns1.reg365.net.</span>
<span style="color: #888888">bartb.ie.		21185	IN	NS	ns0.reg365.net.</span>
<span style="color: #888888">bartb.ie.		21185	IN	NS	ns2.reg365.net.</span>

<span style="color: #888888">;; Query time: 12 msec</span>
<span class="hll"><span style="color: #888888">;; SERVER: 8.8.8.8#53(8.8.8.8)</span>
</span><span style="color: #888888">;; WHEN: Tue Dec 30 19:23:38 2014</span>
<span style="color: #888888">;; MSG SIZE  rcvd: 90</span>

<span class="hll"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>dig www.bartb.ie @ns1.reg365.net
</span>
<span style="color: #888888">; &lt;&lt;&gt;&gt; DiG 9.8.3-P1 &lt;&lt;&gt;&gt; www.bartb.ie @ns1.reg365.net</span>
<span style="color: #888888">;; global options: +cmd</span>
<span style="color: #888888">;; Got answer:</span>
<span style="color: #888888">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 36163</span>
<span style="color: #888888">;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</span>
<span style="color: #888888">;; WARNING: recursion requested but not available</span>

<span style="color: #888888">;; QUESTION SECTION:</span>
<span style="color: #888888">;www.bartb.ie.			IN	A</span>

<span style="color: #888888">;; ANSWER SECTION:</span>
<span style="color: #888888">www.bartb.ie.		86400	IN	A	46.22.130.125</span>

<span style="color: #888888">;; Query time: 24 msec</span>
<span class="hll"><span style="color: #888888">;; SERVER: 85.233.160.78#53(85.233.160.78)</span>
</span><span style="color: #888888">;; WHEN: Tue Dec 30 19:24:03 2014</span>
<span style="color: #888888">;; MSG SIZE  rcvd: 46</span>

<span style="color: #555555">bart-iMac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, the <code>+trace</code> command can be used to do a full top-down resolution of a given domain name in the same way that a resolver would if the result was not cached.
To see what question is being asked at each stage of the trace, I like to add the <code>+question</code> option as well.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span class="hll"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>dig +trace +question www.bartb.ie
</span>
<span style="color: #888888">; &lt;&lt;&gt;&gt; DiG 9.8.3-P1 &lt;&lt;&gt;&gt; +trace +question www.bartb.ie</span>
<span style="color: #888888">;; global options: +cmd</span>
<span style="color: #888888">;.				IN	NS</span>
<span style="color: #888888">.			18794	IN	NS	m.root-servers.net.</span>
<span style="color: #888888">.			18794	IN	NS	a.root-servers.net.</span>
<span style="color: #888888">.			18794	IN	NS	c.root-servers.net.</span>
<span style="color: #888888">.			18794	IN	NS	h.root-servers.net.</span>
<span style="color: #888888">.			18794	IN	NS	i.root-servers.net.</span>
<span style="color: #888888">.			18794	IN	NS	d.root-servers.net.</span>
<span style="color: #888888">.			18794	IN	NS	g.root-servers.net.</span>
<span style="color: #888888">.			18794	IN	NS	k.root-servers.net.</span>
<span style="color: #888888">.			18794	IN	NS	e.root-servers.net.</span>
<span style="color: #888888">.			18794	IN	NS	l.root-servers.net.</span>
<span style="color: #888888">.			18794	IN	NS	f.root-servers.net.</span>
<span style="color: #888888">.			18794	IN	NS	j.root-servers.net.</span>
<span style="color: #888888">.			18794	IN	NS	b.root-servers.net.</span>
<span style="color: #888888">;; Received 228 bytes from 192.168.10.1#53(192.168.10.1) in 16 ms</span>

<span style="color: #888888">;www.bartb.ie.			IN	A</span>
<span style="color: #888888">ie.			172800	IN	NS	a.ns.ie.</span>
<span style="color: #888888">ie.			172800	IN	NS	b.ns.ie.</span>
<span style="color: #888888">ie.			172800	IN	NS	c.ns.ie.</span>
<span style="color: #888888">ie.			172800	IN	NS	d.ns.ie.</span>
<span style="color: #888888">ie.			172800	IN	NS	e.ns.ie.</span>
<span style="color: #888888">ie.			172800	IN	NS	f.ns.ie.</span>
<span style="color: #888888">ie.			172800	IN	NS	g.ns.ie.</span>
<span style="color: #888888">ie.			172800	IN	NS	h.ns.ie.</span>
<span style="color: #888888">;; Received 485 bytes from 192.203.230.10#53(192.203.230.10) in 36 ms</span>

<span style="color: #888888">;www.bartb.ie.			IN	A</span>
<span style="color: #888888">bartb.ie.		172800	IN	NS	ns0.reg365.net.</span>
<span style="color: #888888">bartb.ie.		172800	IN	NS	ns1.reg365.net.</span>
<span style="color: #888888">bartb.ie.		172800	IN	NS	ns2.reg365.net.</span>
<span style="color: #888888">;; Received 94 bytes from 77.72.72.44#53(77.72.72.44) in 14 ms</span>

<span style="color: #888888">;www.bartb.ie.			IN	A</span>
<span style="color: #888888">www.bartb.ie.		86400	IN	A	46.22.130.125</span>
<span style="color: #888888">;; Received 46 bytes from 85.233.160.79#53(85.233.160.79) in 23 ms</span>

<span style="color: #555555">bart-iMac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first thing <code>dig</code> does is ask my stub resolver for a list of the root name servers.
You see the output as a list of 13 NS records for the domain <code>.</code>.</p>
</div>
<div class="paragraph">
<p>Once <code>dig</code> knows the root name servers, it starts the actual resolution of <code>www.bartb.ie</code>, asking one of those 13 servers (<code>192.203.230.10</code>) if it has an A record for <code>www.bartb.ie</code>.</p>
</div>
<div class="paragraph">
<p>The root server doesn&#8217;t respond with a direct answer to the question, but with a list of eight authoritative name servers for the <code>.ie</code> zone.</p>
</div>
<div class="paragraph">
<p><code>dig</code> then asks one of the <code>.ie</code> name servers (<code>77.72.72.44</code>) if it has an A record for <code>www.bartb.ie</code>.
It also doesn&#8217;t answer the question but responds with a list of three authoritative name servers for the <code>bartb.ie</code> zone.</p>
</div>
<div class="paragraph">
<p>Finally, <code>dig</code> asks one of the authoritative servers for <code>bartb.ie</code> (<code>85.233.160.79</code>) if it has an A record for <code>www.bartb.ie</code>.
This server does know the answer, so it replies with that A record, specifying that <code>www.bartb.ie</code> is at <code>46.22.130.125</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_security_elephant_in_the_room">The Security Elephant in the Room</h3>
<div class="paragraph">
<p>As with so many of the older protocols we&#8217;ve discussed in this series, DNS was created at a time when security simply wasn&#8217;t a consideration.</p>
</div>
<div class="paragraph">
<p>The source of the weakness is two-fold, firstly, DNS packets are not encrypted, and there is no tamper detection included in the protocol, so it&#8217;s trivially easy for any attackers who get themselves into a man-in-the-middle position to rewrite DNS responses to silently redirect people to malicious servers.
If you were in a coffee shop and one of your fellow caffeine aficionados had used the lack of security in the ARP protocol to become a man-in-the-middle, they could alter the IP address your computer thinks any site, say paypal.com as an example, maps to.
If they then set up their own server at the incorrect IP and make it look like PayPal&#8217;s site, they could easily trick people into revealing their usernames and passwords.</p>
</div>
<div class="paragraph">
<p>Because of how UDP works, it is possible to send a UDP packet with a forged source address.
Attackers can use this fact to bombard victims with fake DNS responses in the hope that the fake response is received before the real one.
This fake response can contain any length of TTL, so attackers can have their malicious response cached for a very long time.
This is known as DNS Cache Poisoning.</p>
</div>
<div class="paragraph">
<p>Cache poisoning is not as easy as it used to be because the source ports for DNS queries are now randomised.
This means that a remote attacker needs to correctly guess the random port number for their fake packet to have any chance of being accepted.
Attackers can get around this by sending LOTS of false responses with different random port numbers but the protection is not perfect.
An attacker with enough determination and bandwidth can still poison a DNS cache.
Also, note that Man-in-the-middle (MITM) attackers see both the request and response packets, so they don&#8217;t need to guess the port number, they can simply alter the valid response packet to say what they want it to say, so port randomisation provides no protection from MITM attacks.</p>
</div>
<div class="paragraph">
<p>The good news though is that there is a solution in the making.
An extension to DNS called <a href="https://en.wikipedia.org/wiki/Domain_Name_System_Security_Extensions">DNSSEC</a> provides a solution by cryptographically signing DNS responses.
This does not prevent an attacker from altering the response or sending fake responses, but it does make it possible for the recipient to know the response is fake, and ignore it.</p>
</div>
<div class="paragraph">
<p>DNSSEC is quite slow to be rolled out, but it is starting to happen now.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conclusions_9">Conclusions</h3>
<div class="paragraph">
<p>We&#8217;ve seen how DNS converts human-readable domain names into computer-readable IP addresses.
It is vital that our computers have access to a working DNS Resolver because if they don&#8217;t, the internet will be unusable.</p>
</div>
<div class="paragraph">
<p>From previous instalments, we already know that for a computer to function properly on a TCP/IP network it must have three settings properly configured, an IP address, a netmask, and a default gateway.
We can now add a fourth required setting, a DNS resolver, or name server.</p>
</div>
<div class="paragraph">
<p>In the next instalment, we&#8217;ll focus on tools for troubleshooting network problems.
We&#8217;ll have seen many of the commands before, but we&#8217;re looking at them in more detail and in context.
The aim of the next instalment will be to build up a troubleshooting strategy that starts at the bottom of the network stack and works up through it methodically to locate the problem, allowing you to focus your efforts in the right place, and avoid wasting your time debugging things that are actually working just fine.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt28">TTT Part 28 of n &#8212; Network Troubleshooting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In <a href="#ttt23">part 23 of n</a>, we took a big-picture look at how TCP/IP networking works.
As a quick reminder, the most important points were:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Our computer networks use a stack of protocols known as TCP/IP</p>
</li>
<li>
<p>We think of the stack of protocols as being broken into four layers:</p>
<div class="ulist">
<ul>
<li>
<p>The Link Layer&#8201;&#8212;&#8201;lets computers that are on the same network send single packets of data to each other</p>
</li>
<li>
<p>The Internet Layer&#8201;&#8212;&#8201;lets computers on different networks send single packets of data to each other</p>
</li>
<li>
<p>The Transport Layer&#8201;&#8212;&#8201;lets computers send meaningful streams of data between each other</p>
</li>
<li>
<p>The Application Layer&#8201;&#8212;&#8201;where all the networked apps we use live</p>
</li>
</ul>
</div>
</li>
<li>
<p>Logically, data travels across the layers&#8201;&#8212;&#8201;HTTP to HTTP, TCP to TCP, IP to IP, Ethernet to Ethernet, but physically, data travels up and down the stack, one layer to another, only moving from one device to another when it gets to the Link Layer at the very bottom of the stack.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Since that big-picture introduction we&#8217;ve looked at the first three layers in detail, and we&#8217;ve also looked at two layer-4 protocols that function as part of the network infrastructure&#8201;&#8212;&#8201;DHCP for the automatic discovery of network settings, and DNS for mapping domain names to IP addresses.
Later in the series, we will move on to look at some more Layer 4 protocols, but before we do I want to consolidate what we&#8217;ve learned so far into a strategy for debugging network problems.
In short&#8201;&#8212;&#8201;how to get from a vague complaint like &#8220;the internet is broken&#8221; to a specific problem that can be addressed.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 28</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 28</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT28NetworkTroubleshooting/TTT_28_Network_Troubleshooting.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_28.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT28NetworkTroubleshooting/TTT_28_Network_Troubleshooting.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>When troubleshooting network problems, the basic advice is to start at the bottom of the stack and work your way up until you find the problem.
You can break the process down into four loose steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Basic Network Connectivity:</strong> make sure the computer has at least one active network connection.</p>
</li>
<li>
<p><strong>IP Configuration:</strong> make sure the computer has the three required IP settings configured:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>An IP address</p>
</li>
<li>
<p>A Netmask</p>
</li>
<li>
<p>A default gateway</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>IP Connectivity:</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Test whether the computer can communicate with the default gateway (probably your home router)</p>
</li>
<li>
<p>Test whether the computer can communicate with a server on the internet</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Domain Name Resolution:</strong> make sure the computer can use DNS to resolve domain names to IP addresses.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Let&#8217;s now look at these steps in more detail, and at the terminal commands we&#8217;ll need for each.
At the end of each section, we&#8217;ll also describe what we should see if everything is working correctly at that level of the stack, and some things to consider if you find results that are not as expected.</p>
</div>
<div class="sect2">
<h3 id="_step_1_check_basic_network_connectivity">Step 1 &#8212; Check Basic Network Connectivity</h3>
<div class="paragraph">
<p>Starting at the very bottom of the network stack we need to make sure there is at least one network interface up and connected before we continue.</p>
</div>
<div class="paragraph">
<p>The terminal command for listing network interfaces is <code>ifconfig</code>.
We&#8217;ve seen this command in previous instalments but never looked at it in detail.
Note that there are some subtle differences between the versions of this command available on OS X and on Linux.
In our examples, we will be using the OS X version of the command.</p>
</div>
<div class="paragraph">
<p><code>ifconfig</code> can be used to both show and alter the configuration of network interfaces.
Note that we will only be using the command to display the current settings, not to alter them.
On OS X you should use the Networks system preference pane to change network settings.</p>
</div>
<div class="paragraph">
<p>To get a list of the names of all network interfaces defined on a Mac run the following command (does not work in Linux):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ifconfig <span style="color: #000080">-l</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The command will return the names on a single line separated by spaces.</p>
</div>
<div class="paragraph">
<p>Remember that <code>lo0</code> is the so-called loop-back address used for purely internal network communication and that on Macs, &#8216;real&#8217; network interfaces will be named <code>en</code> followed by a number, e.g.
<code>en0</code> and <code>en1</code>.
Any other network interfaces you see are either non-traditional interfaces like firewire or virtual interfaces created by software like VPN clients.
When it comes to basic network troubleshooting it&#8217;s the <code>en</code> devices that we are interested in.</p>
</div>
<div class="paragraph">
<p>Once you know the names of your network devices you can see more information for any given device bypassing the device name as an argument.
E.g. the following is the description of my <code>en0</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span class="hll"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>ifconfig en0
</span><span style="color: #888888">en0: flags=8863&lt;UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500</span>
<span style="color: #888888">	options=10b&lt;RXCSUM,TXCSUM,VLAN_HWTAGGING,AV&gt;</span>
<span style="color: #888888">	ether 68:5b:35:97:f1:84</span>
<span style="color: #888888">	inet6 fe80::6a5b:35ff:fe97:f184%en0 prefixlen 64 scopeid 0x4</span>
<span style="color: #888888">	inet 192.168.10.42 netmask 0xffffff00 broadcast 192.168.10.255</span>
<span style="color: #888888">	nd6 options=1&lt;PERFORMNUD&gt;</span>
<span style="color: #888888">	media: autoselect (1000baseT &lt;full-duplex,flow-control,energy-efficient-Ethernet&gt;)</span>
<span style="color: #888888">	status: active</span>
<span style="color: #555555">bart-iMac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also see the details for all network interfaces by replacing the interface name with the <code>-a</code> flag (this is what the OS X version of <code>ifconfig</code> does implicitly if called with no arguments):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ifconfig <span style="color: #000080">-a</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A more useful option is <code>-u</code>, which lists all interface marked by the OS as being in an <em>up</em> state.
Note that an interface can be up, but inactive.</p>
</div>
<div class="paragraph">
<p>By default, <code>ifconfig</code> returns quite a bit of information for each interface, but not enough to make it obvious which interface matches which physical network connection.
You can get more information by adding the <code>-v</code> flag (for verbose).</p>
</div>
<div class="paragraph">
<p>Putting it all together, the command to run when verifying that there is basic network connectivity is <code>ifconfig -uv</code>.</p>
</div>
<div class="paragraph">
<p>The following sample output shows one active Ethernet network connection, <code><strong>en0</strong></code>, and one inactive WiFi connection <code><strong>en1</strong></code>.
The important parts of the output have been highlighted for clarity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span class="hll"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>ifconfig <span style="color: #000080">-uv</span>
</span><span style="color: #888888">lo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu 16384 index 1</span>
<span style="color: #888888">	eflags=10000000&lt;SENDLIST&gt;</span>
<span style="color: #888888">	options=3&lt;RXCSUM,TXCSUM&gt;</span>
<span style="color: #888888">	inet6 ::1 prefixlen 128</span>
<span style="color: #888888">	inet 127.0.0.1 netmask 0xff000000</span>
<span style="color: #888888">	inet6 fe80::1%lo0 prefixlen 64 scopeid 0x1</span>
<span style="color: #888888">	inet 127.94.0.1 netmask 0xff000000</span>
<span style="color: #888888">	inet 127.94.0.2 netmask 0xff000000</span>
<span style="color: #888888">	nd6 options=1&lt;PERFORMNUD&gt;</span>
<span style="color: #888888">	link quality: 100 (good)</span>
<span style="color: #888888">en0: flags=8863&lt;UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500 index 4</span>
<span style="color: #888888">	eflags=980&lt;TXSTART,RXPOLL,ARPLL&gt;</span>
<span style="color: #888888">	options=10b&lt;RXCSUM,TXCSUM,VLAN_HWTAGGING,AV&gt;</span>
<span style="color: #888888">	ether 68:5b:35:97:f1:84</span>
<span style="color: #888888">	inet6 fe80::6a5b:35ff:fe97:f184%en0 prefixlen 64 scopeid 0x4</span>
<span style="color: #888888">	inet 192.168.10.42 netmask 0xffffff00 broadcast 192.168.10.255</span>
<span style="color: #888888">	nd6 options=1&lt;PERFORMNUD&gt;</span>
<span style="color: #888888">	media: autoselect (1000baseT &lt;full-duplex,flow-control,energy-efficient-Ethernet&gt;)</span>
<span class="hll"><span style="color: #888888">	status: active</span>
</span><span class="hll"><span style="color: #888888">	type: Ethernet</span>
</span><span style="color: #888888">	link quality: 100 (good)</span>
<span style="color: #888888">	scheduler: QFQ</span>
<span style="color: #888888">	link rate: 1.00 Gbps</span>
<span style="color: #888888">en1: flags=8823&lt;UP,BROADCAST,SMART,SIMPLEX,MULTICAST&gt; mtu 1500 index 5</span>
<span style="color: #888888">	eflags=200080&lt;TXSTART,NOACKPRI&gt;</span>
<span style="color: #888888">	ether c8:e0:eb:48:02:7b</span>
<span style="color: #888888">	nd6 options=1&lt;PERFORMNUD&gt;</span>
<span style="color: #888888">	media: autoselect (&lt;unknown type&gt;)</span>
<span class="hll"><span style="color: #888888">	status: inactive</span>
</span><span class="hll"><span style="color: #888888">	type: Wi-Fi</span>
</span><span style="color: #888888">	scheduler: TCQ (driver managed)</span>
<span style="color: #555555">bart-iMac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_expected_results">Expected Results</h4>
<div class="paragraph">
<p>If all is well, there should be two network interfaces active, the loopback interface (<code>lo0</code>), and an interface of either type <code>Ethernet</code> or <code>WiFi</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_possible_problemssolutions">Possible Problems/Solutions</h4>
<div class="ulist">
<ul>
<li>
<p>No interface is active&#8201;&#8212;&#8201;turn one on in the Network System Preference Pane</p>
</li>
<li>
<p>If using Ethernet, the cable could be bad, or the router/switch it is plugged into could be bad&#8201;&#8212;&#8201;check for a link light on the router/switch</p>
</li>
<li>
<p>The network card could be broken (unlikely)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_check_basic_ip_configuration">Step 2 &#8212; Check Basic IP Configuration</h3>
<div class="paragraph">
<p>For a computer to have IP connectivity it needs three settings.
It needs to know its IP address, it needs to know its Netmask, and it needs to know the IP address of the router it should use to communicate beyond the local network.
This last setting is referred to by a number of different names, including <em>default gateway</em>, <em>default route</em>, and just <em>router</em>.
A network is incorrectly configured if the IP address for the default gateway is outside the subnet defined by the combination of the IP address and netmask.
If you&#8217;re not sure if the gateway address is contained within the defined subnet, you may find an online IP subnet calculator like <a href="http://subnetcalc.it">subnetcalc.it</a> helpful.</p>
</div>
<div class="paragraph">
<p>If an IP address has been configured for an interface there will be a line starting with <code>inet</code> in that interface&#8217;s description in the output from <code>ifconfig</code>.
This line will give you the IP address and netmask.</p>
</div>
<div class="paragraph">
<p>Below is an example of the output for my one active network interface, <code>en0</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span class="hll"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>ifconfig <span style="color: #000080">-v</span> en0
</span><span style="color: #888888">en0: flags=8863&lt;UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500 index 4</span>
<span style="color: #888888">	eflags=980&lt;TXSTART,RXPOLL,ARPLL&gt;</span>
<span style="color: #888888">	options=10b&lt;RXCSUM,TXCSUM,VLAN_HWTAGGING,AV&gt;</span>
<span style="color: #888888">	ether 68:5b:35:97:f1:84</span>
<span style="color: #888888">	inet6 fe80::6a5b:35ff:fe97:f184%en0 prefixlen 64 scopeid 0x4</span>
<span class="hll"><span style="color: #888888">	inet 192.168.10.42 netmask 0xffffff00 broadcast 192.168.10.255</span>
</span><span style="color: #888888">	nd6 options=1&lt;PERFORMNUD&gt;</span>
<span style="color: #888888">	media: autoselect (1000baseT &lt;full-duplex,flow-control,energy-efficient-Ethernet&gt;)</span>
<span style="color: #888888">	status: active</span>
<span style="color: #888888">	type: Ethernet</span>
<span class="hll"><span style="color: #888888">	link quality: 100 (good)</span>
</span><span style="color: #888888">	scheduler: QFQ</span>
<span style="color: #888888">	link rate: 1.00 Gbps</span>
<span style="color: #555555">bart-iMac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>While looking at this output it&#8217;s also worth checking that the link quality is being shown as good.</p>
</div>
<div class="paragraph">
<p>To read the default route you&#8217;ll need to use the <code>netstat</code> command.
We haven&#8217;t looked at this command in detail yet, and we won&#8217;t be until a future instalment.
For now, we just need to know that the following command will show us the IP address of the default router:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">netstat <span style="color: #000080">-rn</span> | egrep <span style="color: #d14">'^default'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following sample output shows that my default gateway is set to <code>192.168.10.1</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>netstat <span style="color: #000080">-rn</span> | egrep <span style="color: #d14">'^default'</span>
<span style="color: #888888">default            192.168.10.1       UGSc           28        0     en0
</span><span style="color: #555555">bart-iMac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_expected_result">Expected Result</h4>
<div class="paragraph">
<p>There will be an IP address, netmask, and default gateway configured, and the default gateway will be within the subnet defined by the IP address and netmask.
Make a note of these three settings for future reference.</p>
</div>
</div>
<div class="sect3">
<h4 id="_possible_problemssolutions_2">Possible Problems/Solutions</h4>
<div class="ulist">
<ul>
<li>
<p>DHCP has been disabled on the interface&#8201;&#8212;&#8201;enable it using the Network System Preference Pane</p>
</li>
<li>
<p>DHCP is not working on the network&#8201;&#8212;&#8201;this will need to be addressed on the router</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_test_ip_connectivity">Step 3 &#8212; Test IP Connectivity</h3>
<div class="paragraph">
<p>At this point, we can have some confidence that the settings on the computer itself are at least sane.
It&#8217;s now time to start probing the network the computer is connected to.</p>
</div>
<div class="paragraph">
<p>The <code>ping</code> command allows us to test connectivity to a specified IP address.
This command is ubiquitous across OSes and even exists on Windows, though there are some subtle differences in the commands' behaviour across the different OSes.</p>
</div>
<div class="paragraph">
<p><code>ping</code> uses the Internet Control Message Protocol (ICMP).
This is a protocol that sits in Layer 2 next to IP and is used for network diagnostics rather than information transport.
<code>ping</code> works by sending an ICMP echo request packet to the target IP and waiting for an ICMP echo response packet back.
According to the RFCs (Requests for Comment), all TCP/IP stacks should respond to ICMP echo requests, but many do not.
Services like Steve Gibson&#8217;s Shields Up even go so far as to actively discourage obeying the RFCs.
Personally, I think it&#8217;s reasonable for home routers not to reply to pings, but world-facing servers should be good netizens and obey the RFCs.
(Windows Server also blocks ICMP requests by default, which is very annoying when trying to monitor your own network&#8217;s health!)</p>
</div>
<div class="paragraph">
<p>To use the <code>ping</code> command simply pass it the IP address to be pinged as an argument.</p>
</div>
<div class="paragraph">
<p>On OS X, Unix and Linux, <code>ping</code> will default to continuously sending pings until the user interrupts the process, while on Windows <code>ping</code> defaults to sending exactly 4 pings and then stops.
To get the Windows version of <code>ping</code> to ping continuously use the <code>-t</code> flag.
If <code>ping</code> is running continuously, you stop it by pressing <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>c</kbd></span>.
That will stop new pings being sent, and <code>ping</code> will then print some summary information before exiting.</p>
</div>
<div class="paragraph">
<p>To avoid having to hit <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>c</kbd></span>, while still getting a good sample size, the <code>-c</code> flag can be used to specify the desired number of pings to send.
10 is a sensible value to choose.</p>
</div>
<div class="paragraph">
<p>To start to probe our connectivity we should first try ping the default gateway we discovered in the previous step.
The example below shows my output, pinging my default gateway <code>192.168.10.1</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span class="hll"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>ping <span style="color: #000080">-c</span> 10 192.168.10.1
</span><span style="color: #888888">PING 192.168.10.1 (192.168.10.1): 56 data bytes</span>
<span style="color: #888888">64 bytes from 192.168.10.1: icmp_seq=0 ttl=64 time=0.378 ms</span>
<span style="color: #888888">64 bytes from 192.168.10.1: icmp_seq=1 ttl=64 time=0.365 ms</span>
<span style="color: #888888">64 bytes from 192.168.10.1: icmp_seq=2 ttl=64 time=0.398 ms</span>
<span style="color: #888888">64 bytes from 192.168.10.1: icmp_seq=3 ttl=64 time=0.383 ms</span>
<span style="color: #888888">64 bytes from 192.168.10.1: icmp_seq=4 ttl=64 time=0.409 ms</span>
<span style="color: #888888">64 bytes from 192.168.10.1: icmp_seq=5 ttl=64 time=0.363 ms</span>
<span style="color: #888888">64 bytes from 192.168.10.1: icmp_seq=6 ttl=64 time=0.273 ms</span>
<span style="color: #888888">64 bytes from 192.168.10.1: icmp_seq=7 ttl=64 time=0.396 ms</span>
<span style="color: #888888">64 bytes from 192.168.10.1: icmp_seq=8 ttl=64 time=0.265 ms</span>
<span style="color: #888888">64 bytes from 192.168.10.1: icmp_seq=9 ttl=64 time=0.385 ms</span>

<span style="color: #888888">--- 192.168.10.1 ping statistics ---</span>
<span class="hll"><span style="color: #888888">10 packets transmitted, 10 packets received, 0.0% packet loss</span>
</span><span style="color: #888888">round-trip min/avg/max/stddev = 0.265/0.362/0.409/0.048 ms</span>
<span style="color: #555555">bart-iMac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If all is well on the local network (LAN), then there should be 0% packet loss reported by <code>ping</code>.
You would also expect the round trip times to be very small.
The round trip times should also be reasonably similar to each other&#8201;&#8212;&#8201;at the very least of the same order of magnitude.</p>
</div>
<div class="paragraph">
<p>If there is little or no packet loss, we need to probe further for the source of the problems.
To do this we need to ping an IP address that is outside of the LAN.
If you happen to know your ISP&#8217;s router&#8217;s address you could try ping that, but realistically people won&#8217;t know that kind of thing, and many ISPs configure their routers not to respond to pings.
What you can do instead is ping any IP out on the internet that you know exists, and that you know answers pings.
I tend to use Google&#8217;s public DNS resolver for the simple reason that I know it&#8217;s very likely to be up, that it answers pings, and that it has a very memorable IP address&#8201;&#8212;&#8201;<code>8.8.8.8</code>.</p>
</div>
<div class="paragraph">
<p>Below is a sample of the output I get when I ping Google&#8217;s public DNS resolver:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>ping <span style="color: #000080">-c</span> 10 8.8.8.8
<span style="color: #888888">PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: icmp_seq=0 ttl=56 time=30.380 ms
64 bytes from 8.8.8.8: icmp_seq=1 ttl=56 time=18.387 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=56 time=18.423 ms
64 bytes from 8.8.8.8: icmp_seq=3 ttl=56 time=13.232 ms
64 bytes from 8.8.8.8: icmp_seq=4 ttl=56 time=11.189 ms
64 bytes from 8.8.8.8: icmp_seq=5 ttl=56 time=13.054 ms
64 bytes from 8.8.8.8: icmp_seq=6 ttl=56 time=17.855 ms
64 bytes from 8.8.8.8: icmp_seq=7 ttl=56 time=12.875 ms
64 bytes from 8.8.8.8: icmp_seq=8 ttl=56 time=22.634 ms
64 bytes from 8.8.8.8: icmp_seq=9 ttl=56 time=34.798 ms

--- 8.8.8.8 ping statistics ---
10 packets transmitted, 10 packets received, 0.0% packet loss
round-trip min/avg/max/stddev = 11.189/19.283/34.798/7.488 ms
</span><span style="color: #555555">bart-iMac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the round trip times are much longer now&#8201;&#8212;&#8201;tens of milliseconds.
If you have a slower internet connection the times could even rise to hundreds of milliseconds.
What is important though is that they are all similar.
If there are massive fluctuations in response times that suggests that your ISP is having capacity issues and that your internet connection is unstable.</p>
</div>
<div class="paragraph">
<p>If there is ping connectivity all the way out to Google, then you know you have a working internet connection.</p>
</div>
<div class="sect3">
<h4 id="_expected_result_2">Expected Result</h4>
<div class="paragraph">
<p>Both the default gateway and the IP address on the internet reply to the pings, and have 0% packet loss.</p>
</div>
<div class="paragraph">
<p>Any packet loss at all when pinging your default gateway is a bad sign.
It is indicative of an unhealthy LAN or at the very least an unhealthy connection between the computer being tested and the core of the LAN.</p>
</div>
<div class="paragraph">
<p>If your ISP&#8217;s network is healthy, packet loss out to Google should be zero too, but if your ISP&#8217;s network is a little congested, you might see the odd dropped packet creep in.
Losing the occasional packet is tolerable, especially at peak times, but it does suggest that your ISP&#8217;s network is under stress, or that your connection to your ISP is perhaps a little lossy.</p>
</div>
<div class="paragraph">
<p>If your default gateway reports expected results, but the public IP address doesn&#8217;t, that implies there is a problem somewhere between your default gateway and the public IP address you were pinging.
It could be that the server hosting the public IP is down, and everything else is OK, but if you use a big server like Google&#8217;s DNS resolver for your test, that would be extremely unlikely.
The most likely scenario would be that your ISP is having a problem.</p>
</div>
<div class="paragraph">
<p>If you have a simple setup with just one home router, it&#8217;s probably safe to call your ISP as soon as a ping to an outside IP fails, but if you have a more complex setup, you might want to do a little more investigation before making that call.
After all, it would be embarrassing to phone your ISP only to find that the problem is actually somewhere within your own setup!</p>
</div>
<div class="paragraph">
<p>You can use the <code>traceroute</code> command to attempt to clarify the location of the problem.
The <code>traceroute</code> command streams out a series of packets with different TTLs (Time To Live specified not in time but in hops between IP routers).
Every TCP/IP stack that interacts with a <code>traceroute</code> packet at an IP level should decrement the TTL by one before passing the packet on to the next router along the packet&#8217;s route to the destination being tested.
If a TCP/IP stack gets a <code>traceroute</code> packet and there is no TTL left, it should reply to the originator informing it of where the packet got to within its TTL.
By piecing together the information contained in all the returned packets for each TTL it&#8217;s possible to see how packets between the source and destination IPs traverse the internet.
Because this protocol uses many packets, you are not seeing the journey any one packet took, but the average journey of all the packets.</p>
</div>
<div class="paragraph">
<p>Note that not all routers respond to traceroute packets, so there may be no information for some TTLs, in which case that network hop is shown with just stars in `traceroute&#8217;`s output.</p>
</div>
<div class="paragraph">
<p>The <code>traceroute</code> command is available in Windows, Linux, Unix and OS X, but there is one caveat, it&#8217;s spelt differently on Windows!
To trace your route to Google&#8217;s public DNS resolver you would issue the following command on OS X, Linux or Unix:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">traceroute 8.8.8.8</code></pre>
</div>
</div>
<div class="paragraph">
<p>On Windows the command would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">tracert 8.8.8.8</code></pre>
</div>
</div>
<div class="paragraph">
<p>On my home network, I have two routers&#8201;&#8212;&#8201;one provided by my ISP which doesn&#8217;t give me the level of control or security I want, and my own router which does.
I can see both of these internal hops when I <code>traceroute</code> to Googles DNS resolver.
The command issued and the two internal hops are highlighted in the sample output below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span class="hll"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>traceroute 8.8.8.8
</span><span style="color: #888888">traceroute to 8.8.8.8 (8.8.8.8), 64 hops max, 52 byte packets</span>
<span class="hll"><span style="color: #888888"> 1  bw-pfsense (192.168.10.1)  0.482 ms  0.339 ms  0.251 ms</span>
</span><span class="hll"><span style="color: #888888"> 2  192.168.192.1 (192.168.192.1)  0.822 ms  0.927 ms  0.911 ms</span>
</span><span style="color: #888888"> 3  * * *</span>
<span style="color: #888888"> 4  * * *</span>
<span style="color: #888888"> 5  109.255.250.254 (109.255.250.254)  15.475 ms  12.704 ms  10.010 ms</span>
<span style="color: #888888"> 6  84.116.238.62 (84.116.238.62)  15.239 ms  12.699 ms  11.892 ms</span>
<span style="color: #888888"> 7  213.46.165.54 (213.46.165.54)  20.095 ms  14.596 ms  14.963 ms</span>
<span style="color: #888888"> 8  66.249.95.135 (66.249.95.135)  13.044 ms  17.823 ms  16.784 ms</span>
<span style="color: #888888"> 9  google-public-dns-a.google.com (8.8.8.8)  13.102 ms  27.005 ms  14.958 ms</span>
<span style="color: #555555">bart-iMac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the home router provided by my ISP were to be down I would expect the trace to get stuck after it hits my main router (<code>bw-pfsense</code>). If that hop showed up, but then the trace went dark, then I would know that all equipment within my house is working fine, but that nothing is getting out onto the internet from my house, implicating my ISP.</p>
</div>
</div>
<div class="sect3">
<h4 id="_possible_problemssolutions_3">Possible Problems/Solutions</h4>
<div class="ulist">
<ul>
<li>
<p>If there is not even connectivity as far as the default gateway then either the network settings are wrong, or there is a hardware problem with the LAN</p>
</li>
<li>
<p>If there is packet loss when pinging the default gateway, then either there is congestion on the LAN, or there is a hardware problem&#8201;&#8212;&#8201;perhaps a faulty switch/router or perhaps a faulty network card.
If using Ethernet it could also be a damaged Ethernet cable, and if using WiFi it could be low signal strength, congestion of the channel because too many of your neighbours are using the same channel, or RF interference of some kind.</p>
</li>
<li>
<p>If the ping to the public IP does not respond at all then either the server you are pinging is down, or, more likely, your connection to the internet is down.
<code>traceroute</code> may help you prove it really is your ISP that is the problem before you spend an eternity on hold with them!</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_4_check_name_resolution">Step 4 &#8212; Check Name Resolution</h3>
<div class="paragraph">
<p>Almost everything we do online involves domain names rather than IP addresses, so if a computer has lost the ability to convert domain names to IP addresses it will appear to have lost its internet connection even if it has full IP-level connectivity.</p>
</div>
<div class="paragraph">
<p>To test name resolution simply try to resolve a known-good domain name like <code>google.com</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">host google.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>If name resolution is working you should see output something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>host google.com
<span style="color: #888888">google.com has address 74.125.24.113
google.com has address 74.125.24.100
google.com has address 74.125.24.101
google.com has address 74.125.24.139
google.com has address 74.125.24.138
google.com has address 74.125.24.102
google.com has IPv6 address 2a00:1450:400b:c02::71
google.com mail is handled by 10 aspmx.l.google.com.
google.com mail is handled by 40 alt3.aspmx.l.google.com.
google.com mail is handled by 20 alt1.aspmx.l.google.com.
google.com mail is handled by 50 alt4.aspmx.l.google.com.
google.com mail is handled by 30 alt2.aspmx.l.google.com.
</span><span style="color: #555555">bart-iMac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The actual details returned could vary depending on where and when you run the command; what matters is that you get back a list of IPs.</p>
</div>
<div class="paragraph">
<p>If that fails, check that DNS resolvers have been configured on the computer by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">cat</span> /etc/resolv.conf | egrep <span style="color: #d14">'^nameserver'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If all is well there should be at least one line returned.
The example below shows that my Mac is configured to use one DNS resolver, <code>192.168.10.1</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span class="hll"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">cat</span> /etc/resolv.conf | egrep <span style="color: #d14">'^nameserver'</span>
</span><span class="hll"><span style="color: #888888">nameserver 192.168.10.1</span>
</span><span style="color: #555555">bart-iMac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also worth testing whether or not Google&#8217;s public DNS resolver will work from the given computer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">dig +short google.com @8.8.8.8</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you can resolve names using Google&#8217;s public resolver you should see output something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span class="hll"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>dig +short google.com @8.8.8.8
</span><span style="color: #888888">74.125.138.100</span>
<span style="color: #888888">74.125.138.113</span>
<span style="color: #888888">74.125.138.138</span>
<span style="color: #888888">74.125.138.102</span>
<span style="color: #888888">74.125.138.139</span>
<span style="color: #888888">74.125.138.101</span>
<span style="color: #555555">bart-iMac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The actual IPs returned could well be different depending on where and when you run the command; the important thing is that a list of IPs is returned.</p>
</div>
<div class="sect3">
<h4 id="_expected_result_3">Expected Result</h4>
<div class="paragraph">
<p>The test name resolves to one or more IP addresses without error.</p>
</div>
</div>
<div class="sect3">
<h4 id="_possible_problemssolutions_4">Possible Problems/Solutions</h4>
<div class="ulist">
<ul>
<li>
<p>If there are no resolvers listed in <code>/etc/resolve.conf</code>, then ideally the user&#8217;s home router should be checked to make sure DNS is properly configured there because DNS settings should be passed down to the computer via DHCP.</p>
</li>
<li>
<p>Only if the problem can&#8217;t be addressed on the router does it make sense to try to fix it on the computer itself by hard-coding it to use a particular resolver in the Network System Preference Pane.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusions_10">Conclusions</h3>
<div class="paragraph">
<p>When a family member, colleague, or friend comes to you with a vague problem statement like &#8220;the internet is down&#8221;, it&#8217;s very hard to know where to begin.
By starting at the bottom of the stack and working your way up methodically you should be able to discover the point at which things break down, and hence know where to focus your efforts at fixing the problem.
The methodology described here does not tell you exactly what to do in any given situation because the variability is infinite, but it should help you focus your efforts where they are needed.</p>
</div>
<div class="paragraph">
<p>Up until now, the networking segment of this series has focused on how the internet works.
We&#8217;ve looked in detail at the protocols that could best be described as the infrastructure of the internet.
The series is now going to shift focus away from the infrastructure itself, and onto some uses of that infrastructure.</p>
</div>
<div class="paragraph">
<p>The next few instalments are going to focus on a very powerful Layer 4 protocol that allows for secure communication between two computers&#8201;&#8212;&#8201;the Secure Shell Protocol, better known as SSH.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt29">TTT Part 29 of n &#8212; Intro to SSH</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the previous six instalments, we looked in detail at how TCP/IP networks tick.
In these instalments we worked our way up from the bottom of the four-layer TCP/IP network model to the top, finishing off with a look at two protocols in the Application Layer at the top of the stack.
Those two protocols, DHCP &amp; DNS exist in the top layer but are different to most other top-layer protocols in that they can reasonably be described as forming part of the infrastructure of the internet.
The email and web protocols may sit within the same network layer, but they still rely on DNS to function.</p>
</div>
<div class="paragraph">
<p>For the remainder of the networking section in this series we&#8217;re moving away from infrastructure-like protocols, and focusing on the user-facing Application Layer protocols.
The first of these we&#8217;ll be looking at is the <a href="https://en.wikipedia.org/wiki/Secure_Shell">Secure Shell</a> or SSH.
This protocol is one of the absolute workhorses of the internet, and a vital tool for all Linux, Unix, and OS X sysadmins.</p>
</div>
<div class="paragraph">
<p>At it&#8217;s simplest level SSH allows you to execute commands on a remote computer, but because it was designed around the concept of a secure tunnel between two systems, SSH has expanded to allow all kinds of advanced features.
The least-generous description of this could be that SSH has become a kind of sysadmin&#8217;s <a href="https://www.urbandictionary.com/define.php?term=fridgeoven">fridgeoven</a>.
But I don&#8217;t buy that, I prefer the alternative interpretation&#8201;&#8212;&#8201;it simply makes sense not to reinvent the wheel, and to allow as much information as possible to flow throw the secure connection SSH provides between the two endpoints.</p>
</div>
<div class="paragraph">
<p>Today we&#8217;re just going to start with the basics, but in future instalments, we&#8217;ll move on to the more advanced features.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 29</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 29</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT29IntroToSSH/TTT_29_Intro_to_SSH.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_29.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT29IntroToSSH/TTT_29_Intro_to_SSH.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_introducing_ssh">Introducing SSH</h3>
<div class="paragraph">
<p>The SSH protocol allows one computer running an SSH client to securely connect to another running an SSH server.
In other words, SSH is a client-server protocol.
The computer initiating the connection is referred to as the client, and the computer being connected to as the server.</p>
</div>
<div class="paragraph">
<p>SSH operates over TCP, and while SSH servers can listen on any TCP port, by default SSH servers listen on port 22.
As its name suggests, security is integral to the Secure Shell, and all SSH traffic is encrypted by default.</p>
</div>
<div class="paragraph">
<p>SSH is often described as the secure replacement for the older insecure <a href="https://en.wikipedia.org/wiki/Telnet">Telnet</a> protocol.
It&#8217;s certainly true that SSH provides a secure replacement for Telnet, but it&#8217;s much more than that, providing additional features Telnet never did.</p>
</div>
<div class="paragraph">
<p>The first version of SSH dates back to 1995, which sounds old in IT terms, but bear in mind that Telnet dates back to 1968!
The first version of the SSH protocol had some security shortcomings, so a new version of the protocol, SSH 2, was released in 2006, and this is what we use today.</p>
</div>
</div>
<div class="sect2">
<h3 id="_some_preliminaries">Some Preliminaries</h3>
<div class="paragraph">
<p>To play along with this segment you&#8217;ll need two computers with SSH installed the SSH service enabled on at least one of those computers, and TCP/IP network connectivity between them.
The two computers can be a mix of OS X, Linux, and Unix.</p>
</div>
<div class="paragraph">
<p>OS X comes with SSH installed by default, but remote logins over SSH are disabled by default, i.e.
the SSH service is not running by default.
This means that a Mac can always act as an SSH client, but can only act as an SSH server when it has been configured to do so.</p>
</div>
<div class="paragraph">
<p>To enable the SSH service on a Mac, open the Sharing preference pane and enable the &#8216;Remote Login&#8217; option.
This interface will allow you to limit SSH access to just some of the user accounts on your Mac, or to allow all users to connect to your Mac over SSH.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt29/d411bff4-5d3d-452f-932b-d1176196f32e.png" alt="OS X Enable SSH Service">
</div>
</div>
<div class="paragraph">
<p>Linux machines usually have SSH installed and enabled by default.
Instructions for installation and activation vary from one Linux distribution to the next, so I&#8217;ll have to leave it as an exercise for the reader to find instructions for specific Linux distros as needed.</p>
</div>
<div class="paragraph">
<p>With SSH installed and enabled on two computers, pick one to be the client, and one the server, i.e.
one to connect from, and one to connect to.
You&#8217;ll need to know the IP address (or DNS name) of the one you choose to act as the server.
In the examples below I&#8217;ll be connecting to my file server, a Linux server on my LAN with the private IP address <code>192.168.10.20</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_ssh_to_run_a_command_on_another_computer">Using SSH to Run a Command on Another Computer</h3>
<div class="paragraph">
<p>The simplest thing you can do with SSH is use to it to execute a single command on a remote computer.
This can be done using the SSH command in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ssh username@remote_computer <span style="color: #d14">'command'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, the following command returns a list of all running processes on my file server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ssh bart@192.168.10.20 <span style="color: #d14">'ps -ef'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that when you are asked for a password, you should enter the password for the remote user, not your password on the local computer.</p>
</div>
<div class="paragraph">
<p>Note that if your username is the same on the machine you are SSHing from and the one your are SSHing to, you can leave out the username, so since I log in to both computers as the user <code>bart</code>, I could simplify the above command to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ssh 192.168.10.20 <span style="color: #d14">'ps -ef'</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ssh_security">SSH Security</h3>
<div class="paragraph">
<p>If you&#8217;ve never used SSH before on a computer, the chances are very high that when you tried to play along with the previous section you encountered a strange notification that may have looked like an error, asking you to enter <code>yes</code> or <code>no</code>.
It probably looked something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">The authenticity of host <span style="color: #d14">'192.168.10.20 (192.168.10.20)'</span> can<span style="color: #d14">'t be established.
RSA key fingerprint is 29:b0:59:4f:ef:2e:6d:ee:81:97:40:04:aa:03:f7:66.
Are you sure you want to continue connecting (yes/no)?</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Firstly, it&#8217;s safe to hit <code>yes</code> if you are connecting to a server for the first time.</p>
</div>
<div class="paragraph">
<p>It&#8217;s still important that we understand what the message meant, and why it&#8217;s OK to say yes on your first connection to a server.</p>
</div>
<div class="paragraph">
<p>When SSHing to a remote computer, your computer tries its best to authenticate the remote computer in order to protect you from man-in-the-middle attacks.</p>
</div>
<div class="paragraph">
<p>Web servers solve this problem using Certificates signed by Certificate Authorities and validated by trust anchors installed in our computers.
If SSH had been designed the same way, we would need to apply for a certificate for each computer we wanted to SSH to.
This would create a major barrier to the adoption of SSH, so thankfully the SSH protocol solves the man-in-the-middle problem in a very different way.
The solution SSH has chosen works without the need for any central authorities like the Certificate Authorities that underpin security on the web, but the price we pay for that convenience is that we have to deal with prompts like the one above.
Because there are no central authorities to rely on, the end-user has to take responsibility for their own security.</p>
</div>
<div class="paragraph">
<p>When the SSH service is installed on a computer, a random asymmetric key-pair is generated.
One half of that pair is designated the server&#8217;s private key, and the other the server&#8217;s public key.</p>
</div>
<div class="paragraph">
<p>The first time a client connects to a server via SSH, the client saves the server&#8217;s public key in a special file, along with the server&#8217;s IP address and DNS name (if the client connected by DNS name rather than IP).</p>
</div>
<div class="paragraph">
<p>When the client re-connects with a server on an IP address or at a DNS name it has saved details for, it uses the saved public key to validate the server.
A man-in-the-middle will not have the server&#8217;s private key, and so will not be able to pass the client&#8217;s security check.</p>
</div>
<div class="paragraph">
<p>Once you understand this process, the message you get when you first connect to a server makes more sense.
You are being asked if you want to trust a server for which there is no saved public key, and hence whose identity cannot be confirmed.
When you say yes a second message will pop up, telling you the key has been saved, it will look something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">Warning: Permanently added <span style="color: #d14">'192.168.10.20'</span> <span style="color: #000000;font-weight: bold">(</span>RSA<span style="color: #000000;font-weight: bold">)</span> to the list of known hosts.</code></pre>
</div>
</div>
<div class="paragraph">
<p>On future connections to the server, you should not see any more messages, because the key will be saved, and the server should pass validation by the client.</p>
</div>
<div class="paragraph">
<p>The database of public keys is stored in a plain text file, <code>~/.ssh/known_hosts</code>, one entry per line.
You can view the content of this file with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">cat</span> ~/.ssh/known_hosts</code></pre>
</div>
</div>
<div class="paragraph">
<p>If for some reason the server validation fails, you&#8217;ll see an error message something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
Someone could be eavesdropping on you right now <span style="color: #000000;font-weight: bold">(</span>man-in-the-middle attack<span style="color: #000000;font-weight: bold">)!</span>
It is also possible that a host key has just been changed.
The fingerprint <span style="color: #000000;font-weight: bold">for </span>the RSA key sent by the remote host is
29:b0:59:4f:ef:2e:6d:ee:81:97:40:04:aa:03:f7:66.
Please contact your system administrator.
Add correct host key <span style="color: #000000;font-weight: bold">in</span> /Users/bart/.ssh/known_hosts to get rid of this message.
Offending RSA key <span style="color: #000000;font-weight: bold">in</span> /Users/bart/.ssh/known_hosts:14
RSA host key <span style="color: #000000;font-weight: bold">for </span>192.168.10.20 has changed and you have requested strict checking.
Host key verification failed.</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <strong>could</strong> mean there is a man-in-the-middle attack in progress.
But before you assume the worst, remember that there are legitimate reasons a server&#8217;s public and private keys could change.</p>
</div>
<div class="paragraph">
<p>Firstly, if you reinstall the OS on a computer, a new set of SSH keys will be generated, so the server will legitimately change identity.</p>
</div>
<div class="paragraph">
<p>Secondly, if you regularly connect to multiple servers on a network that has dynamically assigned IPs, then sooner or later you&#8217;ll get this error because you once saw one computer at this IP, and now a different one has randomly been assigned it.
It&#8217;s largely to avoid problems like this that I like to set static DHCP leases for all my computers on my home network.</p>
</div>
<div class="paragraph">
<p>Once you have satisfied yourself that the warning message is innocent, the solution is to edit <code>~/.ssh/known_hosts</code> with your favourite text editor and remove the line containing the old key.
Conveniently, the line number is given in the error message. It&#8217;s the number after the <code>:</code>, so in the example above, the offending key is on line 14, so that&#8217;s the line I need to delete.</p>
</div>
<div class="paragraph">
<p><strong>Update:</strong> An alternative to manually editing the file is to use the <code>ssh-keygen</code> command to delete the offending key for you.
You do this using the <code>-R</code> flag (R for remove) to pass the IP or hostname who&#8217;s key you need to remove:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ssh-keygen <span style="color: #000080">-R</span> computer_name_or_ip</code></pre>
</div>
</div>
<div class="paragraph">
<p>Thanks to Twitter user <a href="https://twitter.com/adrianluff">@adrianluff</a> for the tip!</p>
</div>
</div>
<div class="sect2">
<h3 id="_remote_command_shells">Remote Command Shells</h3>
<div class="paragraph">
<p>If you need to run more than one command on a remote computer, it&#8217;s more convenient to get a full remote command shell, which you can easily do by leaving off the final argument (the command to execute remotely).
So, the general form would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ssh username@remote_computer</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, the username can be omitted if it&#8217;s the same on both computers, so for, me I can get a remote shell on my file server with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ssh 192.168.10.20</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you ssh to a remote computer in this way you get a full remote shell, so it really is as if you were typing in a terminal window on that computer.</p>
</div>
<div class="paragraph">
<p>As mentioned previously, SSH defaults to using TCP port 22, but, an SSH service can, in theory, be run on any port number.
Some hosting providers add a little extra security by running SSH on a non-standard port.
This will not protect from targeted attacks, but it will stop automated scans of the internet from finding your SSH server.
If the SSH server you are connecting to is not running on port 22, you need to use the <code>-p</code> flag to specify the port number, e.g.
if I were to move the SSH service on my file store to port 2222 the two example commands above would become:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ssh <span style="color: #000080">-p</span> 2222 192.168.10.20 <span style="color: #d14">'ps -ef'</span>
ssh <span style="color: #000080">-p</span> 2222 192.168.10.20</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusions_11">Conclusions</h3>
<div class="paragraph">
<p>In this instalment, we&#8217;ve covered the basics of SSH.
We can now use it to execute single commands on a remote computer and to get an interactive command shell on a remote computer.
This is enough to replace the old insecure Telnet protocol with a secure alternative, and, enough to get by in most scenarios.</p>
</div>
<div class="paragraph">
<p>While what we&#8217;ve learned in this instalment is usually sufficient, there are advantages to learning about some of SSH&#8217;s more advanced features, which is what we&#8217;ll be doing in the next instalment.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt30">TTT Part 30 of n &#8212; SSHing More Securely</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In <a href="#ttt29">the previous instalment</a>, we saw how we can use SSH to execute a single command on a remote computer, or, to get a command shell on a remote computer.
We also saw how SSH uses host keys to protect us from man-in-the-middle (MITM) attacks.</p>
</div>
<div class="paragraph">
<p>In this instalment, we&#8217;re going to look at how we can improve both SSH security and convenience with SSH keys.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 30</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 30</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT30SSHingMoreSecurely/TTT_30_SSHing_More_Securely.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_30.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT30SSHingMoreSecurely/TTT_30_SSHing_More_Securely.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>SSH keys utilise asymmetric encryption, specifically public/private key cryptography.
It&#8217;s important to have a clear understanding of how this works before proceeding.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Asymmetric Encryption and Public &amp; Private Keys&#8201;&#8212;&#8201;A Quick Summary</div>
<div class="paragraph">
<p>An Encryption algorithm turns unencrypted plain text into encrypted cypher text using some kind of key.
The simplest type of encryption uses the same key to encrypt and decrypt and is known as symmetric encryption.</p>
</div>
<div class="paragraph">
<p>With asymmetric encryption, there is not one key, but two, a so-called key-pair.
Whatever is encrypted with one key can only be decrypted with the other.
Either key can encrypt, but you can only decrypt with the one you didn&#8217;t use to encrypt.</p>
</div>
<div class="paragraph">
<p>For public/private key cryptography we arbitrarily designate one of the keys in the key pair as the private key, and the other as the public key.
We then make sure the private key is NEVER shared.
The public key can be safely published anywhere without impacting security.</p>
</div>
<div class="paragraph">
<p>If we give someone our public key, and they encrypt something with it, only we can decrypt it, because only we have our private key.
This fact can be used as the basis for an authentication system because only the holder of the private key that matches a public key can decrypt a test message sent by someone with that public key.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_ssh_key_authentication">SSH Key Authentication</h3>
<div class="paragraph">
<p>The SSH protocol has support for multiple different types of authentication.
By default, one of the authentication mechanisms used by SSH is password authentication.
SSH will allow you to connect to a given account on a computer if you know the password for that user on that computer.
By default, SSH will also try to use an SSH key-pair for authentication instead of a password, and in fact, it will try to use a key-pair before it tries to use a password.</p>
</div>
<div class="paragraph">
<p>To use SSH key authentication you need to do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Generate an SSH key-pair on the computer you will be SSHing from (you only have to do this once, you can use the same key-pair to authenticate to multiple computers safely).</p>
</li>
<li>
<p>Give the <strong>public</strong> key from that key-pair to the person managing the computer you want to SSH to (never share your private key with anyone!).</p>
</li>
<li>
<p>Wait for the administrator of the remote computer to add your public key to the list of allowed keys within the account you will be SSHing to.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Once those steps have been completed you will be able to log in to the remote computer without having to know the password of the user you will be connecting as.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at these steps in detail now.
To play along you&#8217;ll need two computers, one to SSH from, and one to SSH to.</p>
</div>
<div class="sect3">
<h4 id="_generating_an_ssh_key_pair">Generating an SSH Key-Pair</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This section assumes you are using a Linux-like operating system (Linux, Unix, Mac, or the Windows Subsystem for Linux on Windows 10) and have not yet generated an SSH key-pair for the account you will be SSHing from, if you have, please skip on to the next section.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em><strong>Update&#8201;&#8212;&#8201;February 2020:</strong> I blogged <a href="https://www.bartbusschots.ie/s/2020/02/26/generating-ssh-keys-on-windows-with-puttygen/">Instructions for generating an SSH key-pair on Windows using PuTTYgen</a>.</em></p>
</div>
<div class="paragraph">
<p>The process starts on the computer you will be SSHing from.
You need to open a terminal as the user who will be SSHing to the remote computer, and in that terminal type the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ssh-keygen <span style="color: #000080">-t</span> rsa</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will create an SSH key-pair and offer to store the two halves in the default locations (press enter to accept the defaults for the location):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The private key: <code>~/.ssh/id_rsa</code></p>
</li>
<li>
<p>The public key: <code>~/.ssh/id_rsa.pub</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you already have a set of keys and don&#8217;t want to replace them, you can use the <code>-f</code> flag and specify a different location to save the private key (the public key will get stored in the same folder and with the same name, but with <code>.pub</code> appended to it).</p>
</div>
<div class="paragraph">
<p>When you run the <code>ssh-keygen</code> command you will be asked to enter a password.
This is the password that will secure the private key.
This is a very important safety measure because it means that if your private key is lost or stolen, it cannot be used unless the attacker also knows the matching password.
The <code>ssh-keygen</code> command will accept a blank password, but this is to be strongly discouraged because it leaves your private key unprotected.</p>
</div>
<div class="paragraph">
<p>It should also be noted that if you forget the password protecting your private key, you won&#8217;t be able to use that key-pair any more, and you&#8217;ll need to generate a fresh key-pair!</p>
</div>
<div class="paragraph">
<p>Once you enter a password <code>ssh-keygen</code> will generate a public and private key, tell you where it has saved them, tell you the key&#8217;s fingerprint (a big long hexadecimal string separated with <code>:</code>s), and it will show you the key&#8217;s random art image.
This is a representation of the key as a little ASCII art graphic.
This is much more memorable to humans than the fingerprint. Show us two different pictures and we&#8217;ll spot the difference in seconds, show us two different strings of hex and we&#8217;ll find it very hard to spot subtle differences!</p>
</div>
<div class="paragraph">
<p>To get a sense of how difficult an SSH key is to brute force attack, you can have a look at the private key you just generated with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">cat</span> ~/.ssh/id_rsa</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the public key with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">cat</span> ~/.ssh/id_rsa.pub</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Base64 Encoding</div>
<div class="paragraph">
<p>If you are wondering what format the keys are stored in, it&#8217;s the very commonly used <a href="https://en.wikipedia.org/wiki/Base64">base64 encoding</a>.
This is a very robust format that ignores characters like line breaks and spaces which could get introduced if a key were to be copied and pasted into an email or something like that.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_granting_access_with_an_ssh_public_key">Granting Access With an SSH Public Key</h4>
<div class="paragraph">
<p>The next step in the process is to share your public key with the person administering the computer you will be SSHing to.
You can do this by attaching the public key to an email, or simply copying and pasting its content into an email.
If we know the password of the remote account we will be connecting to, we can also copy the key over ourselves, but more on that later.</p>
</div>
<div class="paragraph">
<p>To grant a remote user access to a given account, a computer administrator needs to add the remote user&#8217;s public key to a special file in the home directory of the local user the remote user will be connecting as.
That special file is <code>~/.ssh/authorized_keys</code> (or if the key is only to be used over the SSH2 protocol, <code>~/.ssh/authorized_keys2</code>).</p>
</div>
<div class="paragraph">
<p>The <code>~/.ssh/authorized_keys</code> file should contain one public key per line.
You can grant access to as many users as you like by adding as many public keys are you like.</p>
</div>
<div class="paragraph">
<p>SSH is an absolute stickler about the permissions on the <code>authorized_keys</code> file, including the permissions on the folder that contains it, i.e.
<code>~/.ssh/</code>.
No one other than the owner of the account (and root) should have write permissions to either the containing folder or the file itself.
Because public keys are not sensitive information, SSH does not care if other users can read what is effectively public information, but the ability to write to that file would allow any other user on the system to grant themselves access to that account by adding their own public key to the list.
To prevent this from happening, SSH will not accept a key if it&#8217;s contained in a file that is writeable by anyone but the owner of the account.
An example of working permissions on an account with the username <code>bart</code> is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="hll"><span style="color: #555555">[bart@www ~]$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">ls</span> <span style="color: #000080">-al</span> ~/.ssh
</span><span style="color: #888888">total 20</span>
<span class="hll"><span style="color: #888888">drwx------  2 bart bart 4096 May  5  2014 .</span>
</span><span style="color: #888888">drwxr-xr-x 16 bart bart 4096 Mar 15 14:32 ..</span>
<span class="hll"><span style="color: #888888">-rw-r--r--  1 bart bart  670 Feb 14  2013 authorized_keys</span>
</span><span style="color: #888888">-rw-r--r--  1 bart bart  660 May  5  2014 known_hosts</span>
<span style="color: #555555">[bart@www ~]$</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember that in a list of the contents of the folder <code>~/.ssh</code>, the permissions on that folder itself are the permissions on the special file <code>.</code>.
I have highlighted the command, and the two important sets of permissions highlighted.</p>
</div>
</div>
<div class="sect3">
<h4 id="_simplifying_the_process_with_ssh_copy_id">Simplifying the Process with <code>ssh-copy-id</code></h4>
<div class="paragraph">
<p>It takes time and effort to manually copy across your public key and to make sure all the file permissions are correct.
Assuming you know the password to log in to the remote computer, you can automate the process with the <code>ssh-copy-id</code> utility.</p>
</div>
<div class="paragraph">
<p>This utility comes as standard on all the Linux distributions I have used, but annoyingly, OS X&#8217;s version of SSH does not come with <code>ssh-copy-id</code>.
All is not lost though, because the open source community are here to help!</p>
</div>
<div class="paragraph">
<p>OS X users can install <code>ssh-copy-id</code> onto their Mac using the free and open source project <a href="https://github.com/beautifulcode/ssh-copy-id-for-OSX">ssh-copy-id-for-OSX</a>.</p>
</div>
<div class="paragraph">
<p>If you follow the link above you&#8217;ll see that installing <code>ssh-copy-id</code> onto your mac is as simple as running the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">curl <span style="color: #000080">-L</span> https://raw.githubusercontent.com/beautifulcode/ssh-copy-id-for-OSX/master/install.sh | sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above command has to be run from an admin account, and it uses <code>sudo</code> for the install, so you will be prompted for your password.</p>
</div>
<div class="paragraph">
<p>Whatever OS you are on, once you have <code>ssh-copy-id</code> installed, copying over your public key becomes as easy as running the command below (replacing <code>user</code> and <code>computer</code> as appropriate):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ssh-copy-id user@computer</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sshing_to_a_computer_using_key_authentication">SSHing to a Computer Using Key Authentication</h4>
<div class="paragraph">
<p>Once you have generated your key-pair, and the remote admin has correctly added your public key to the <code>authorized_keys</code> file, you are ready to start using your private key as your authentication when SSHing to that remote computer.</p>
</div>
<div class="paragraph">
<p>If you saved your key to the default location (<code>~/.ssh/id_rsa</code>), then you don&#8217;t have to do anything special to start using your key, just issue your SSH command as normal.
Remember, by default, SSH tries key-based authentication before password-based authentication.
If your private key is not in the default location you need to tell SSH what key to use with the <code>-i</code> flag (i for identity).</p>
</div>
<div class="paragraph">
<p>Assuming you followed best-practice advice and protected your private key with a password, you will be asked for a password when you try to SSH, but you are not being asked for the password of the remote account you are connecting to, instead, you are being asked for the key to unlock your private key.</p>
</div>
</div>
<div class="sect3">
<h4 id="_securely_saving_your_private_keys_password">Securely Saving Your Private Key&#8217;s Password</h4>
<div class="paragraph">
<p>I promised convenience AND security, but surely swapping one password for another is no more convenient?</p>
</div>
<div class="paragraph">
<p>The good news is that there are mechanisms for safely caching that password so you don&#8217;t have to keep entering it each time you SSH.
The exact details of the mechanism vary from OS to OS.
The good news is that Mac users have it best in this regard.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Commands to Save RSA Key Passphrase to Apple Keychain</div>
<div class="paragraph">
<p>In later versions of OSX (macOS Sierra and higher), you will not get the popup offering to save your passphrase to Apple Keychain. See <a href="#ttt37">TTT37</a> under "SSH Agent on OS X &amp; macOS" for the new method to store your passphrase in Keychain.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The version of SSH that ships with OS X has support for OS X&#8217;s secure keychain.
This is a secure vault OS X uses to store the passwords you save in all sorts of apps, including Mail.app and Safari.
This means that on OS X, when you use SSH key authentication, a popup window will appear asking for the password for your private key, and that pop window has a checkbox to allow the password to be saved in your keychain.
Once you do this you will never have to enter that password again, you will now be able to SSH without entering a password in a secure manner.</p>
</div>
<div class="paragraph">
<p>Users of other OSes are not completely out of luck, but the solutions available are less convenient.
On Linux and other versions of Unix, a service called <code>ssh-agent</code> can be used to cache the passwords for SSH keys.
Since this series is targeted primarily at Mac users, I won&#8217;t go into the details here, but there are plenty of guides available online if you search for <em>`ssh-agent tutorial`</em>.</p>
</div>
<div class="paragraph">
<p>So, whether you are using OS X&#8217;s key chain, or <code>ssh-agent</code>, you can now securely log in to remote computers over SSH with the minimum of effort.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_advantages_to_key_based_authentication">Advantages to Key-based Authentication</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Convenience</strong>&#8201;&#8212;&#8201;with OS X&#8217;s keychain or <code>ssh-agent</code> securely storing the password for your private key, you can safely use SSH without having to enter a password.</p>
</li>
<li>
<p><strong>Security</strong>&#8201;&#8212;&#8201;once you have key-based authentication in place, you can either set a really long and secure password on the remote account or even disable password-based logins completely (we don&#8217;t cover how to do that in this series).
SSH keys are much more difficult to brute force than even the most complex of passwords.</p>
</li>
<li>
<p><strong>A Form of 2-Factor Auth</strong>&#8201;&#8212;&#8201;in order to log in as you, an attacker needs to have your private key and needs to know the password for your private key.
<em>Some argue that this is only 1.5-factor auth because unlike a physical dongle, you have no real way of knowing if someone has stolen a copy of your private key. Since it is digital, a copy can be taken without depriving you of your copy, and hence alerting you to its loss.</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>One place where key-based auth really comes into its own is with shared accounts.</p>
</div>
<div class="paragraph">
<p>Imagine you are working on a website together with some volunteers from a club you are a member of.
The server hosting your site allows logins over SSH.
All those working on the project need to be able to log into the webserver to edit the site.
Being a club, there is going to be a natural churn of members, so people will continually join and leave the project, and it&#8217;s possible that some of the leavers will not be leaving on good terms.
How do you handle this situation?</p>
</div>
<div class="paragraph">
<p>First, let&#8217;s look at the simplest and perhaps most obvious solution&#8201;&#8212;&#8201;a shared password.
You set a password on the account, and share that password with the group.
Then, each time a new member starts, you let them in on the secret.
So far so good.
Then, someone leaves the project.
You now have to either accept the fact that someone no longer working on the project still knows the shared secret, and hence can still log in and perhaps sabotage the site, or, you need to change the password and tell only the remaining people the new password.
That scheme is workable but cumbersome.</p>
</div>
<div class="paragraph">
<p>A better solution would be to give no one the password to the account at all and use SSH keys instead.
On joining the project, each participant provides their SSH public key, and those keys are added to the <code>~/.ssh/authorized_keys</code> file.
As people come and go, simply add and remove their public keys.
When someone leaves, no one else has to change anything, and there is no shared secret.</p>
</div>
<div class="paragraph">
<p>Managing a long <code>authorized_keys</code> file does not have to be difficult for two reasons.
Firstly, <code>ssh-keygen</code> adds the username and hostname of the person whose key it is to the end of all public keys, so just reading the key could well tell you all you need to know to identify which key belongs to whom.
If that information is not sufficient, you can add comment lines to the file by staring those lines with the <code>#</code> symbol.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conclusions_12">Conclusions</h3>
<div class="paragraph">
<p>Usually, we have to choose between convenience and security, but with SSH keys we get to have our proverbial cake and eat it too.
By putting in a little work up front, we get a more convenient and more secure SSH experience.</p>
</div>
<div class="paragraph">
<p>So far we have only looked at using SSH to execute terminal commands remotely, either one command at a time, or through an interactive command shell running on the remote computer.
But, SSH&#8217;s encrypted connection can be used to secure much more than just a command shell.
In fact, it can be used to secure just about any kind of network communication through a number of different mechanisms.
In the next two instalments we&#8217;ll see how to securely transmit files over SSH, and, how to securely tunnel any network connection through an SSH connection.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt31">TTT Part 31 of n &#8212; SSH File Transfers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In <a href="#ttt29">Part 29 of n</a>, we learned how to use SSH to execute commands on a remote computer.
In <a href="#ttt30">the previous instalment</a>, we learned how to add security and convenience to SSH connections using SSH key-pairs.</p>
</div>
<div class="paragraph">
<p>The most important thing SSH provides is an encrypted connection between two computers.
As we&#8217;ve seen, that encrypted connection can be used to securely issue terminal commands to a remote computer, but that same secured channel can also be used to secure other network connections between computers.
In this instalment, we&#8217;ll look at three different ways of securely copying files between computers through an SSH connection, and in the next instalment, we&#8217;ll look at tunnelling just about any network connection through an SSH connection.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 31</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 31</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT31SSHFileTransfers/TTT_31_SSH_File_Transfers.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_31.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT31SSHFileTransfers/TTT_31_SSH_File_Transfers.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_examples_prep">Examples Prep.</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Commands to Save RSA Key Passphrase to Apple Keychain</div>
<div class="paragraph">
<p>In later versions of OSX (macOS Sierra and higher), you will not get the popup offering to save your passphrase to Apple Keychain. See <a href="#ttt37">TTT37</a> under "SSH Agent on OS X &amp; macOS" for the new method to store your passphrase in Keychain.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Before we get tucked in, just a reminder that in order to play along with the examples, you&#8217;ll need two computers with SSH installed, one you can SSH from, and one you can SSH to.
Throughout the examples, I&#8217;ll refer to the computer you are SSHing from as the local computer and the one you are SSHing to as the remote computer.</p>
</div>
<div class="paragraph">
<p>It should also be noted that if you have not set up SSH keys as described in the previous instalment, you&#8217;ll be entering your password a lot as you work through these examples!</p>
</div>
<div class="paragraph">
<p>Before getting started we need to create some dummy files to copy between the two computers.
To make things as simple as possible, we&#8217;re going to place our temporary files in a location that exists on all POSIX OSes where all users have read and write access&#8201;&#8212;&#8201;the temporary folder, <code>/tmp</code>.
We&#8217;ll use SSH to create the remote files.</p>
</div>
<div class="paragraph">
<p>In order to make the commands easier to copy and paste, we&#8217;re going to use shell variables to store the username to SSH as, and the computer to SSH to.
You&#8217;ll need to replace <code>my_remote_username</code> with your username on the remote computer, and <code>my_remote_computer</code> with the IP address or DNS name of the remote computer in the variable definitions below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #008080">SSH_USER</span><span style="color: #000000;font-weight: bold">=</span>my_remote_username
<span style="color: #008080">SSH_COMP</span><span style="color: #000000;font-weight: bold">=</span>my_remote_computer</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_create_the_local_dummy_files">Create the Local Dummy Files</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">mkdir</span> <span style="color: #000080">-p</span> /tmp/ttt31/fromRemote
<span style="color: #0086B3">echo</span> <span style="color: #d14">"Hello World! (Local Text File 1)"</span> <span style="color: #000000;font-weight: bold">&gt;</span> /tmp/ttt31/scp_local1.txt
<span style="color: #0086B3">echo</span> <span style="color: #d14">"#Hello World! (Local Markdown File 1)"</span> <span style="color: #000000;font-weight: bold">&gt;</span> /tmp/ttt31/scp_local1.md
<span style="color: #0086B3">echo</span> <span style="color: #d14">"#Hello World! (Local Markdown File 2)"</span> <span style="color: #000000;font-weight: bold">&gt;</span> /tmp/ttt31/scp_local2.md</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we move files around, you can monitor the content of the local folder, and its sub-folders, with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">ls</span> <span style="color: #000080">-R</span> /tmp/ttt31/</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_the_remote_dummy_files">Create the Remote Dummy Files</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre>ssh <span style="color: #008080">$SSH_USER</span>@<span style="color: #008080">$SSH_COMP</span> <span style="color: #d14">'mkdir -p /tmp/ttt31/fromLocal'</span>
ssh <span style="color: #008080">$SSH_USER</span>@<span style="color: #008080">$SSH_COMP</span> <span style="color: #d14">'echo "Hello World! (Remote Text File)" &gt; /tmp/ttt31/scp_remote.txt'</span>
ssh <span style="color: #008080">$SSH_USER</span>@<span style="color: #008080">$SSH_COMP</span> <span style="color: #d14">'mkdir /tmp/ttt31/scp_folder'</span>
ssh <span style="color: #008080">$SSH_USER</span>@<span style="color: #008080">$SSH_COMP</span> <span style="color: #d14">'echo "Hello World! (Remote Text File 1)" &gt; /tmp/ttt31/scp_folder/file1.txt'</span>
ssh <span style="color: #008080">$SSH_USER</span>@<span style="color: #008080">$SSH_COMP</span> <span style="color: #d14">'echo "Hello World! (Remote Text File 2)" &gt; /tmp/ttt31/scp_folder/file2.txt'</span>
ssh <span style="color: #008080">$SSH_USER</span>@<span style="color: #008080">$SSH_COMP</span> <span style="color: #d14">'mkdir /tmp/ttt31/rsync_folder'</span>
ssh <span style="color: #008080">$SSH_USER</span>@<span style="color: #008080">$SSH_COMP</span> <span style="color: #d14">'echo "Hello World! (Remote Text File 1)" &gt; /tmp/ttt31/rsync_folder/file1.txt'</span>
ssh <span style="color: #008080">$SSH_USER</span>@<span style="color: #008080">$SSH_COMP</span> <span style="color: #d14">'echo "Hello World! (Remote Text File 2)" &gt; /tmp/ttt31/rsync_folder/file2.txt'</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>As we move files around, you can monitor the content of the remote folder, and its sub-folders, with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ssh <span style="color: #008080">$SSH_USER</span>@<span style="color: #008080">$SSH_COMP</span> <span style="color: #d14">'ls -R /tmp/ttt31/'</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tidying_up">Tidying Up</h4>
<div class="paragraph">
<p>If you want to start over at any stage or to clean up after yourself when finished, the following commands will remove the local and remote dummy files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">rm</span> <span style="color: #000080">-rf</span> /tmp/ttt31
ssh <span style="color: #008080">$SSH_USER</span>@<span style="color: #008080">$SSH_COMP</span> <span style="color: #d14">'rm -rf /tmp/ttt31'</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scp_the_secure_copy_command"><code>scp</code> &#8212; The Secure Copy Command</h3>
<div class="paragraph">
<p>The simplest way to securely copy files between computers is with the secure copy command, <code>scp</code>.
As its name would suggest, it is very like the regular POSIX copy command, <code>cp</code>, but with the added ability to copy files between computers.</p>
</div>
<div class="paragraph">
<p>The basic syntax is the same as that for the copy command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">scp source_file_1 <span style="color: #000000;font-weight: bold">[</span>source_file_2 ...] destination</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can specify one or more source files, and a destination to copy them to.
The big difference is that with scp, both the source and destination can be on another computer.
If you want to specify a remote file path as source or destination, simply prefix the path with <code>user@computer:</code>.</p>
</div>
<div class="paragraph">
<p>Because the scp command uses SSH to connect to remote computers, it can use SSH key-pairs, so if you have them configured as described in the previous instalment, you can copy files between computers without needing to enter a password.</p>
</div>
<div class="paragraph">
<p>As a first example, let&#8217;s copy the remote file <code>/tmp/ttt31/scp_remote.txt</code> to the local folder <code>/tmp/ttt31/fromRemote</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">scp <span style="color: #008080">$SSH_USER</span>@<span style="color: #008080">$SSH_COMP</span>:/tmp/ttt31/scp_remote.txt /tmp/ttt31/fromRemote/</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can verify that the remote file was downloaded with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">ls</span> /tmp/ttt31/fromRemote</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, let&#8217;s copy the local file <code>/tmp/ttt31/scp_local1.txt</code> to the remote folder <code>/tmp/ttt31/fromLocal</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">scp /tmp/ttt31/scp_local1.txt <span style="color: #008080">$SSH_USER</span>@<span style="color: #008080">$SSH_COMP</span>:/tmp/ttt31/fromLocal/</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can verify that the file transferred over with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ssh <span style="color: #008080">$SSH_USER</span>@<span style="color: #008080">$SSH_COMP</span> <span style="color: #d14">'ls /tmp/ttt31/fromLocal'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can specify as many source files as we like, and we can use wild card characters to specify multiple files at once.
As an example, let&#8217;s copy all MarkDown files in the local folder <code>/tmp/ttt31/</code> to the remote folder <code>/tmp/ttt31/fromLocal</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">scp /tmp/ttt31/<span style="color: #000000;font-weight: bold">*</span>.md <span style="color: #008080">$SSH_USER</span>@<span style="color: #008080">$SSH_COMP</span>:/tmp/ttt31/fromLocal/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, you can verify that the files transferred over with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ssh <span style="color: #008080">$SSH_USER</span>@<span style="color: #008080">$SSH_COMP</span> <span style="color: #d14">'ls /tmp/ttt31/fromLocal'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;re not going to describe all the optional flags <code>scp</code> supports. You can read about those in the man page for <code>scp</code>.
However, I do want to mention that like <code>cp</code>, <code>scp</code> allows entire folders to be transferred using the <code>-r</code> flag (for recursive).</p>
</div>
<div class="paragraph">
<p>As an example, let&#8217;s copy the entire remote folder <code>/tmp/ttt31/scp_folder</code> to the local folder <code>/tmp/ttt31/fromRemote/</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">scp <span style="color: #000080">-r</span> <span style="color: #008080">$SSH_USER</span>@<span style="color: #008080">$SSH_COMP</span>:/tmp/ttt31/scp_folder /tmp/ttt31/fromRemote/</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can verify that the folder, and its contents, were downloaded with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">ls</span> <span style="color: #000080">-R</span> /tmp/ttt31/fromRemote</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rsync_over_ssh"><code>rsync</code> over SSH</h3>
<div class="paragraph">
<p>The <code>rsync</code> command allows one folder, and all its nested content, to be intelligently synchronised with another.
<code>rsync</code> will only copy files that are different between the source and the destination, so it&#8217;s a very powerful and efficient backup tool.
So powerful in fact, that many GUI backup tools are little more than GUIs for the <code>rsync</code> command.</p>
</div>
<div class="paragraph">
<p>The basic structure of the <code>rsync</code> command is shown below, but in practice, a number of flags are needed in order to use <code>rsync</code> as an effective backup tool.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">rsync source_folder destination_folder</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to create a good backup, I would advise always using a number of flags, so the command I suggest remembering is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">rsync <span style="color: #000080">-av</span> <span style="color: #000080">--delete</span> source_folder destination_folder</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>-a</code> flag puts <code>rsync</code> into <em>archive mode</em>, which is a synonym for <em>backup mode</em>.
In this mode, file permissions are preserved, and symlinks are copied as links, not replaced with the files they point to.</p>
</div>
<div class="paragraph">
<p>The <code>-v</code> flag puts <code>rsync</code> into <em>verbose mode</em>, which means it will print out each file it copies or deletes.</p>
</div>
<div class="paragraph">
<p>The scary looking <code>--delete</code> option tells <code>rsync</code> that it should remove any files at the destination that are not present at the source.
If this flag is not used, the destination will get ever bigger over time as files deleted at the source are left in place at the destination.</p>
</div>
<div class="paragraph">
<p>When specifying the source folder, whether or not you add a trailing <code>/</code> makes a really big difference to the behaviour of <code>rsync</code>.
If you leave off the trailing <code>/</code>, then a new folder with the same name as the source folder will be created in the destination folder.
If you add the trailing <code>/</code>, then the contents of the source folder will be copied to the destination folder.
I always use the trailing <code>/</code>, because I find that behaviour the most intuitive.
If you add the trailing <code>/</code> to the source, then <code>rsync</code> will make both the source and destination be the same.</p>
</div>
<div class="paragraph">
<p>So far, we have seen how <code>rsync</code> can synchronise two folders on the same computer, now let&#8217;s add SSH into the mix.
Historically, <code>rsync</code> used its own custom networking protocol, but that protocol is not secure.
Modern versions of <code>rsync</code> can use an external program to create the network connection across which it will transfer files.
This is done with the <code>-e</code> flag (for external program).
To transfer files over SSH, we need to use <code>-e ssh</code>.</p>
</div>
<div class="paragraph">
<p>Like <code>scp</code>, <code>rsync</code> allows either the source or destination (or both) to be specified as being remote by prefixing the path with <code>user@computer:</code>.</p>
</div>
<div class="paragraph">
<p>Like with <code>scp</code>, <code>rsync</code> over SSH can use SSH key-pairs to allow password-less synchronisation of folders across the network.</p>
</div>
<div class="paragraph">
<p>One caveat is that <code>rsync</code> has to be installed on <code>both</code> the local and remote computers for a synchronisation operation to succeed.
OS X comes with <code>rsync</code> installed by default, as do many Linux distros.
However, on some Linux distros, particularly the more minimalist ones, you may need to install <code>rsync</code> using the distro&#8217;s package manager.
This is true if you do a minimal install of CentOS for example.</p>
</div>
<div class="paragraph">
<p>As an example, let&#8217;s use <code>rsync</code> to back up the contents of the remote folder <code>/tmp/ttt31/rsync_folder</code> to the local folder <code>/tmp/ttt31/fromRemote/rsync_backup</code>.
Using <code>rsync</code> to pull a backup from a remote computer is a very common use-case.
For example, every night at 4 am my Linux file server at home reaches out to the web server that hosts all my websites to do a full backup of my sites using <code>rsync</code> over SSH.</p>
</div>
<div class="paragraph">
<p>Running an <code>rsync</code> backup for the first time can be nerve-wracking, are you sure the right files will be copied/deleted etc.?
The <code>-n</code> flag is here to save your nerves!
When you issue an <code>rsync</code> command with the <code>-n</code> flag (I remember it as <code>n</code> for <em>not really</em>), <code>rsync</code> will print the changes it would make, but not actually do anything&#8201;&#8212;&#8201;think of it as a dry run.
Let&#8217;s start by running our example backup as a dry run, just to be sure we have everything correct.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">rsync <span style="color: #000080">-avn</span> <span style="color: #000080">--delete</span> <span style="color: #000080">-e</span> ssh <span style="color: #008080">$SSH_USER</span>@<span style="color: #008080">$SSH_COMP</span>:/tmp/ttt31/rsync_folder/ /tmp/ttt31/fromRemote/rsync_backup</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that because we want to backup the content of the folder <code>rsync_folder</code>, rather than the folder itself, a trailing <code>/</code> has been included in the source specification.</p>
</div>
<div class="paragraph">
<p>You&#8217;ll see from the output that a folder to hold the backup named <code>rsync_backup</code> would be created and that two files would be downloaded to that folder.
This is as expected, so we can now run the command for real by removing the <code>-n</code> flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">rsync <span style="color: #000080">-av</span> <span style="color: #000080">--delete</span> <span style="color: #000080">-e</span> ssh <span style="color: #008080">$SSH_USER</span>@<span style="color: #008080">$SSH_COMP</span>:/tmp/ttt31/rsync_folder/ /tmp/ttt31/fromRemote/rsync_backup</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can verify that the files have been downloaded with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">ls</span> /tmp/ttt31/fromRemote/rsync_backup</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because we have not changed the remote files, if you re-run the command, nothing will be transferred.
Try it!</p>
</div>
<div class="paragraph">
<p>Let&#8217;s give <code>rsync</code> some work to do by creating a third remote file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ssh <span style="color: #008080">$SSH_USER</span>@<span style="color: #008080">$SSH_COMP</span> <span style="color: #d14">'echo "Hello World! (Remote Text File 3)" &gt; /tmp/ttt31/rsync_folder/file3.txt'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, run the <code>rsync</code> command again, and you should see just this new file get downloaded.
You can verify that the file was downloaded by running the <code>ls</code> command again.</p>
</div>
<div class="paragraph">
<p>Finally, let&#8217;s edit one of the remote files, and delete another.
We&#8217;ll add some text to <code>file1.txt</code>, and delete <code>file2.txt</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ssh <span style="color: #008080">$SSH_USER</span>@<span style="color: #008080">$SSH_COMP</span> <span style="color: #d14">'echo "EDITED" &gt;&gt; /tmp/ttt31/rsync_folder/file1.txt'</span>
ssh <span style="color: #008080">$SSH_USER</span>@<span style="color: #008080">$SSH_COMP</span> <span style="color: #d14">'rm /tmp/ttt31/rsync_folder/file2.txt'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With those changes made, run the <code>rsync</code> command again.
You should see <code>file1.txt</code> get downloaded again, and <code>file2.txt</code> get deleted.
You can verify that <code>file1.txt</code> was updated with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">cat</span> /tmp/ttt31/fromRemote/rsync_backup/file1.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>And you can verify that <code>file2.txt</code> has been deleted from the local backup with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">ls</span> /tmp/ttt31/fromRemote/rsync_backup</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_secure_ftp">Secure FTP</h3>
<div class="paragraph">
<p>The final secure file transfer protocol we&#8217;ll be looking at is SFTP, which is basically the old insecure FTP protocol reimplemented to use SSH as the communication channel.
This protocol is mostly used by GUI apps like <a href="https://panic.com/transmit/">Panic&#8217;s Transmit</a> rather than from the terminal.
This is because, unlike <code>rsync</code> and <code>scp</code>, this command does not immediately do anything, it simply gives you a new command shell in which to enter FTP commands.</p>
</div>
<div class="paragraph">
<p>If you know the source and destination paths, I would recommend using <code>scp</code> or <code>rsync</code> over SFTP when working in the terminal.
However, it can be useful if you need to explore the remote file system to find the file you want to transfer, or if you are already familiar with the FTP shell.</p>
</div>
<div class="paragraph">
<p>Like <code>scp</code> and <code>rsync</code>, SFTP can make use of SSH key-pairs to connect without the need to enter a password.
This is also true when using SFTP through most SFTP GUI apps.
Good GUI SFTP apps like Transmit will use SSH keys automatically, but some SFTP GUI apps make you manually specify that you wish to use a key, and/or specify the key to be used.</p>
</div>
<div class="paragraph">
<p>Transmit is the SFTP client I use each and every day, and I love it, but, they didn&#8217;t make it at all obvious that they have SSH key support.
Users could be forgiven for not connecting the small key icon next to the password field with SSH key-pairs.
If you hover over that icon you&#8217;ll see that Transmit uses keys in the default location automatically and that if you want to use a key in a different location, you need to click on the key icon to specify the path to the key file you&#8217;d like to use.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt31/Screen-Shot-2015-04-04-at-14.53.39.png" alt="Transmit SSH Key Support">
</div>
</div>
<div class="paragraph">
<p>While the FTP shell is not difficult to use, I don&#8217;t think it is worth spending too much time on it in this series.
Personally, I never use it because I find that <code>scp</code> and <code>rsync</code> allow me to achieve my goals more easily.
But, I would like to give you a flavour of it, and you can then decide whether or not you&#8217;d like to learn more.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at how to initiate an SFTP session, and some of the most important FTP commands.</p>
</div>
<div class="paragraph">
<p>You can connect to the remote computer with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">sftp user@computer</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you know the remote folder you want to copy files from, you can also specify that while connecting as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">sftp user@computer:remote_path</code></pre>
</div>
</div>
<div class="paragraph">
<p>Whenever any command puts me into another shell, the first thing I want to know is how to get out!
With SFTP you have two choices, the traditional FTP command <code>bye</code>, or the more memorable command <code>exit</code>.</p>
</div>
<div class="paragraph">
<p>Within a Bash shell you are used to the concept of a present working directory, but in an (S)FTP shell that concept is extended to two present working directories, a present local working directory, and a present remote working directory.
The default local present working directory is the folder from which you issued the (S)FTP command, and the default remote present wording directory is the home directory of the user you connected as.
You can see each of these two current paths with the commands <code>lpwd</code> (local present working directory) and <code>pwd</code> (remote present working directory).</p>
</div>
<div class="paragraph">
<p>You can change both of these paths at any time using the <code>lcd</code> (local change directory), and <code>cd</code> (remote change directory) commands.</p>
</div>
<div class="paragraph">
<p>You can also list the contents of both present working directories with the commands <code>lls</code> (local file listing), and <code>ls</code> (remote file listing).</p>
</div>
<div class="paragraph">
<p>Finally, there are the all-important commands for uploading and downloading files.
To download a file from the remote present working directory to the local present working directory, you use the <code>get</code> command, which takes one or more arguments, the names of the files to download.
Similarly, to upload a file from the local present working directory to the remote present working directory, you use the <code>put</code> command, which also takes file names as arguments.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conclusions_13">Conclusions</h3>
<div class="paragraph">
<p>We have now seen three different commands for securely copying files between computers via an SSH connection.
All three of these commands have different strengths and weaknesses and are the best-fit solution for different scenarios.
For example, backing up files that don&#8217;t change very often with <code>scp</code> would be very wasteful on bandwidth, and using an SFTP shell is a total waste of time if you know both source and destination paths, but, if you need to explore a remote filesystem to find a file to download, SFTP is the best fit.</p>
</div>
<div class="paragraph">
<p>There are a lot of similarities between the three commands.
All three of them can make use of SSH key-pairs, and all three of them use the same syntax for specifying a remote path, i.e.
<code>user@computer:path</code>.</p>
</div>
<div class="paragraph">
<p>So far we have learned to use SSH to execute terminal commands on remote computers and to securely transfer files between computers.
In the next instalment, we&#8217;ll learn about three more SSH features, one that allows us to use SSH teleport GUIs between computers, and two to use SSH&#8217;s secure connection to protect any arbitrary insecure network connection.</p>
</div>
</div>
<div class="sect2">
<h3 id="_p_s">P.S.</h3>
<div class="paragraph">
<p>I backup up my own web server, a Linux server, over SSH each night.
I use SSH to reach in and back up my MySQL Databases and Subversion source code repositories, then I use SCP to download those backups, and I use rsync over SSH to back up all the regular files that power all my websites.</p>
</div>
<div class="paragraph">
<p>Because this is a very generic thing to want to do, I have released the script I use as open source over on GitHub as <code>backup.pl</code>&#8201;&#8212;&#8201;you can read the documentation and download the script on <a href="https://github.com/bbusschots/backup.pl">the project&#8217;s GitHub page</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt32">TTT Part 32 of n &#8212; SSH Tunnelling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is the fourth SSH instalment.
So far we&#8217;ve learned how to <a href="#ttt29">securely execute terminal commands on remote computers</a>, how to <a href="#ttt31">securely copy files across the network using SSH</a>, and how to <a href="#ttt30">add both security and convenience</a> to both those operations with SSH key pairs.</p>
</div>
<div class="paragraph">
<p>As we saw in <a href="#ttt31">the previous instalment</a>, SSH&#8217;s ability to provide a secure connection between two computers can be used in many different ways.
In this instalment we&#8217;ll learn about three more ways to encapsulate other network traffic within an SSH connection, adding encryption to that traffic.</p>
</div>
<div class="paragraph">
<p>Running commands and copying files are the kinds of things most people do, so the three SSH instalments to date have been quite generally applicable.
That is not the case for this instalment.
The three SSH features we&#8217;ll be discussing are all very useful to those who need them, but only a minority will have a use for any one of these features.
However, even if you don&#8217;t need these features today, I would argue that it&#8217;s good to know these features exist because they could well solve a problem you&#8217;ll have in the future.</p>
</div>
<div class="paragraph">
<p>There will be illustrations of the uses for these technologies, but not commands you type into your terminal to play along at home.
That makes this an unusual instalment, but I hope you will still find it worthwhile.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 32</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 32</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT32SSHTunneling/TTT_32_SSH_Tunneling.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_32.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT32SSHTunneling/TTT_32_SSH_Tunneling.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_x11_forwarding">X11 Forwarding</h3>
<div class="sect3">
<h4 id="_the_problem_to_be_solved_2">The Problem To Be Solved</h4>
<div class="paragraph">
<p>SSH makes it easy to execute terminal commands on remote computers, but what about running GUI apps on remote computers?
That&#8217;s the problem X11 forwarding solves.</p>
</div>
</div>
<div class="sect3">
<h4 id="_description">Description</h4>
<div class="paragraph">
<p>Linux and Unix OSes use a technology called <a href="https://en.wikipedia.org/wiki/X_Window_System">The X Window System</a> (more commonly known as X11) to render the GUI.
OS X is different, Apple chose to use their own Quartz technology rather than X11.
But, there is an officially sanctioned version of X11 for OS X called <a href="https://xquartz.macosforge.org/landing/">XQuartz</a>, which allows X11 GUIs to be displayed on OS X.
With XQuartz installed, X11 apps can run in a regular OS X window.</p>
</div>
<div class="paragraph">
<p>What X11 Forwarding allows you to do is have an app running on the remote computer but with the GUI rendered on your local computer.
SSH effectively teleports the GUI across the network!</p>
</div>
<div class="paragraph">
<p>For this to work the remote computer must have X11 installed, the remotely running app must use X11 to render its GUI, and the local computer must have X11 installed.</p>
</div>
<div class="paragraph">
<p>This means that Macs with XQuartz installed can receive remote GUIs, but cannot be the source or remote GUIs unless there are X11 apps installed on the Mac (possible, but uncommon).</p>
</div>
</div>
<div class="sect3">
<h4 id="_instructions">Instructions</h4>
<div class="paragraph">
<p>To enable X11 forwarding on an SSH connection, use the <code>-X</code> flag.
This might result in an error that looks something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">Warning: untrusted X11 forwarding setup failed: xauth key data not generated</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you see the above error, also add the <code>-Y</code> flag (the two flags can be cuddled as <code>-XY</code>).</p>
</div>
<div class="paragraph">
<p>You don&#8217;t need an interactive shell to use X11 forwarding, for example, to run FireFox on a remote Linux computer but have the GUI show up on your local computer you would use a command of the form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ssh <span style="color: #000080">-XY</span> my_user@my_server <span style="color: #d14">'firefox'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An important caveat is that X11 forwarding is very bandwidth inefficient.
It works very well over a local network but can be painfully slow across the internet.</p>
</div>
</div>
<div class="sect3">
<h4 id="_example_use_cases">Example Use Cases</h4>
<div class="ulist">
<ul>
<li>
<p><strong>Running GUI Control Panels</strong>&#8201;&#8212;&#8201;just about anything on Linux can be configured using a text file (probably in <code>/etc/</code> somewhere), but sometimes it&#8217;s much easier to just run a little GUI tool to configure the setting you need.
X11 forwarding makes it possible to do this on remote Linux servers.</p>
</li>
<li>
<p><strong>Accessing web interfaces that are restricted to local access Only</strong>&#8201;&#8212;&#8201;if you have a web interface that allows something sensitive to be configured, it&#8217;s good security practice to limit access to it to <code>localhost</code> only.
This means it can only be accessed by a browser running on the computer itself.
If you don&#8217;t have physical access that gets awkward unless you have X11 forwarding which will allow you to run a browser on the remote computer, but with the GUI forwarded to your local computer.
Two common examples of this are the CUPS (Common Unix Printing System) printer sharing configuration interface (you&#8217;ll find it at <code>https://localhost:631</code> if it&#8217;s configured), and the <a href="http://www.webmin.com">webmin</a> server management interface.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ssh_port_forwarding">SSH Port Forwarding</h3>
<div class="sect3">
<h4 id="_the_problem_to_be_solved_3">The Problem To Be Solved</h4>
<div class="paragraph">
<p>Wrap encryption around an otherwise unencrypted network connection.</p>
</div>
</div>
<div class="sect3">
<h4 id="_description_2">Description</h4>
<div class="paragraph">
<p>SSH port forwarding allows you to map a local TCP port to a TCP port on a remote computer.
Any traffic you send to the local port is sent through the SSH connection and then routed to its final destination after it comes out of the other end of the SSH connection.</p>
</div>
<div class="paragraph">
<p>While it is inside the SSH connection it is encrypted.
Once it leaves the SSH connection on the other side it continues the rest of its journey unprotected.</p>
</div>
<div class="paragraph">
<p>This can be used in two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To map a port on the computer you are SSHing to, to a port in your local computer.
When used in this way the traffic is encrypted for its entire journey.
This is the most secure way to use port forwarding.</p>
</li>
<li>
<p>To map a port on a third computer to a port on your local computer, with all traffic flowing through the computer you are SSHing to.
In this scenario the traffic is encrypted between your computer and the computer you are SSHing to, but not for the remainder of the journey from the computer you are SSHing to onto the third computer.
I would recommend against using port forwarding in this way if possible.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A crude analogy would be to think of SSH port forwarding as a single-port VPN.</p>
</div>
</div>
<div class="sect3">
<h4 id="_instructions_2">Instructions</h4>
<div class="paragraph">
<p>A single SSH connection can forward many ports.
For each port to be forwarded, an instance of the <code>-L</code> flag should be used in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #000080">-L</span><span style="color: #000000;font-weight: bold">[</span>LOCAL_PORT]:[DESTINATION_HOST]:[DESTINATION_PORT]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example_use_case_mysql">Example Use Case &#8212; MySQL</h4>
<div class="paragraph">
<p>Many websites are powered by <a href="https://www.mysql.com">MySQL</a> databases.
It&#8217;s common when working on a website to need access to the MySQL server powering your site from your local computer.
You can do this using the MySQL command-line tools, or, using a MySQL GUI.
The problem is that the MySQL protocol is insecure (at least by default, it is possible to configure it to use SSL, but that&#8217;s not straight forward).
Your username, password, and all the queries you issue and the server&#8217;s responses are all sent across the network unencrypted.
Because this is so dangerous, it&#8217;s common to limit MySQL to using the <code>localhost</code> IP address (<code>127.0.0.1</code>) or to firewall off access so that only computers within a secured network segment can access the server.</p>
</div>
<div class="paragraph">
<p>This is no good if you are working from home!
SSH port forwarding can save the day, assuming you have SSH access to either the server running MySQL (or another server in the same network as the MySQL server that has been granted access to it.)</p>
</div>
<div class="paragraph">
<p>Assuming the most secure scenario, MySQL limited to <code>127.0.0.1</code> only, and SSH access to the server running MySQL, you would map the port with a command of the form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ssh user@computer <span style="color: #000080">-L</span> 3306:127.0.0.1:3306</code></pre>
</div>
</div>
<div class="paragraph">
<p>As long as that SSH connection is left open, port 3306 on your computer (the standard MySQL port) is mapped to port 3306 on the remote computer&#8217;s localhost IP.
You now instruct your favourite MySQL client to connect to port 3306 on your local computer, and SSH then securely forwards that connection to the remote server for you, allowing you safe and secure access to MySQL.</p>
</div>
<div class="paragraph">
<p>This is such a common use case that many modern MySQL GUI clients allow you to configure this kind of port forwarding from within the GUI, removing the need to remember the terminal command.
An example of a beautiful free MySQL GUI with SSH port forwarding support is <a href="https://www.sequelpro.com">Sequel Pro</a> (OS X Only).
I use SSH port forwarding with Sequel Pro each and every day!</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dynamic_ssh_port_forwarding_sshsocks">Dynamic SSH Port Forwarding (SSH+SOCKS)</h3>
<div class="sect3">
<h4 id="_the_problem_to_be_solved_4">The Problem to be Solved</h4>
<div class="paragraph">
<p>Regular SSH port forwarding requires that the local port, the destination IP and the destination port all be specified at the moment the SSH connection is created.
This means it can only be used when all that information is known in advance and does not need to be changed while the connection is open.</p>
</div>
<div class="paragraph">
<p>This limitation makes it effectively impossible to route applications that make many network connections to many destinations, like a web browser, through regular SSH port forwarding.</p>
</div>
<div class="paragraph">
<p>Dynamic Port Forwarding makes it possible for any app that can use the standard <a href="https://en.wikipedia.org/wiki/SOCKS">SOCKS protocol</a> to route traffic through an SSH connection. That includes apps like web browsers, chat clients, and email clients.</p>
</div>
</div>
<div class="sect3">
<h4 id="_description_3">Description</h4>
<div class="paragraph">
<p>Dynamic port forwarding is a relatively recent addition to SSH, and one of SSH&#8217;s little-known gems.</p>
</div>
<div class="paragraph">
<p>The SOCKS protocol can be used to proxy a TCP connection from any port to any port on behalf of any client that supports the protocol.
It is normally used at the perimeter of corporate networks to regulate external internet access.
All computers inside the corporation that need to make out-going network connections use the SOCKS proxy, which can then apply any rules to those connection requests the corporation desires.
All network connections effectively get broken in two.
The clients talk to the SOCKS proxy and the SOCKS proxy talks to the destination server.</p>
</div>
<div class="paragraph">
<p>When using SSH dynamic port forwarding, what happens is that a SOCKS server is started on your local computer, running on a port you specify, and it sends all the traffic it proxies through the SSH connection, and out onto the internet from the remote end of the SSH connection.
While the traffic is encapsulated within the SSH connection it&#8217;s encrypted.
Once it leaves the SSH connection it is unencrypted for the remainder of its journey.</p>
</div>
<div class="paragraph">
<p>This really is analogous to a VPN, with the caveat that only traffic sent to the locally running SOCKS proxy is secured.</p>
</div>
<div class="paragraph">
<p>The good news is that the SOCKS standard is very widely implemented.
All the major browser can use SOCKS, and there is OS-level support for SOCKS in Windows and OS X.</p>
</div>
<div class="paragraph">
<p>The down-side over a real VPN is that you MUST be sure all apps are configured to use the SOCKS proxy before you start to use them, and you must remove the SOCKS configuration once the SSH connection is closed or all your apps will lose internet access.</p>
</div>
</div>
<div class="sect3">
<h4 id="_instructions_3">Instructions</h4>
<div class="paragraph">
<p>To instruct SSH to behave as a SOCKS proxy, use the <code>-D</code> flag.
The <code>-D</code> flag requires that the local port the SOCKS server should listen on be specified.
The default SOCKS port is 1080, so that&#8217;s a good choice.
To set up a SOCKS proxy on the default port use a command of the following form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ssh <span style="color: #000080">-D</span> 1080 user@computer</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example_use_cases_2">Example Use Cases</h4>
<div class="ulist">
<ul>
<li>
<p><strong>Access local-only web servers on remote servers</strong>&#8201;&#8212;&#8201;if X11 forwarding is not a viable option for whatever reason, dynamic port forwarding can be used as an alternative to access local-only web interfaces like those for CUPS or webmin.
Simply configure your locally running browser to use the SOCKS server provided by SSH, and then browse to the local URL (be sure the browser is not configured to bypass the proxy for local addresses).</p>
</li>
<li>
<p><strong>Securely browse the web in coffee shops/hotels</strong>&#8201;&#8212;&#8201;if you set up an SSH server in your home, you can use SSH dynamic port forwarding to route all your browser traffic through an SSH connection to your home, safely getting you through the hostile coffee shop or hotel network.</p>
</li>
<li>
<p><strong>Bypass geographic restrictions</strong>&#8201;&#8212;&#8201;some websites are only available from some countries.
If you set up an SSH server in your home, you can use dynamic port forwarding to browse the web from anywhere and make it appear you are at home.
This is a great way to keep up with your favourite sports ball matches while travelling.
Assuming you have no moral objections to doing so, you could also rent a cheap virtual server in a country whose TV you like better than the TV in your own country, and use dynamic SSH port forwarding to watch streaming TV from that country from anywhere in the world.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusions_14">Conclusions</h3>
<div class="paragraph">
<p>We&#8217;ve almost covered everything about SSH that we will be covering in this series.
We can now issue remote terminal commands, run remote GUI apps, transfer files, and tunnel TCP connections through SSH.
All that remains now is for a few little tips to make your SSHing easier, which is what we&#8217;ll cover in the next, and final, SSH instalment.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt33">TTT Part 33 of n &#8212; SSH 'Bookmarks'</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is the final SSH instalment.
So far we&#8217;ve learned how to <a href="#ttt29">securely execute terminal commands on remote computers</a>, how to <a href="#ttt31">securely copy files across the network using SSH</a>, how to <a href="#ttt30">add both security and convenience</a> to both those operations with SSH key pairs, and how to <a href="#ttt32">tunnel just about anything through SSH</a>.</p>
</div>
<div class="paragraph">
<p>In this final instalment, we&#8217;ll look at two approaches for creating SSH bookmarks, SSH config files, and SSH GUIs.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 33</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 33</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT33SSHBookmarks/TTT_33_SSH_Bookmarks.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_33.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT33SSHBookmarks/TTT_33_SSH_Bookmarks.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ssh_config_files">SSH Config Files</h3>
<div class="paragraph">
<p>Each time you issue an SSH command, SSH checks for the presence of a system-wide config file at <code>/etc/ssh/ssh_config</code>, and a user-specific config file at <code>~/.ssh/config</code>.
If either or both of these files exist, they&#8217;ll be checked for a host definition matching the computer name specified in the command.
If both files exist and contain conflicting information, the user-level file takes precedence.
If the contents of either file conflicts with flags passed to the SSH command, the flags passed to the command will take precedence.</p>
</div>
<div class="paragraph">
<p>Config files can be used to set things like the port number, username, and even the hostname/IP address for a given computer name.</p>
</div>
<div class="paragraph">
<p>The syntax for SSH config files is very simple.
A file contains one or more host sections, and host sections contain one or more options.
You start a new host section by starting a line with the word <code>Host</code> followed by a space and the computer name you want the section to apply to.
You add the options for that host on the lines below, one option per line.
For readability, the options for each host are usually indented with 2 or 4 spaces or a tab.
You can add comment lines by starting them with the <code>#</code> symbol.
Option lines can be added in three forms:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">Option_name Option_value</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">Option_name <span style="color: #d14">"Option value"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #008080">Option_name</span><span style="color: #000000;font-weight: bold">=</span>Option Value</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first form can only be used if there are no spaces in the value for the options.</p>
</div>
<div class="paragraph">
<p>You can get a full list of all the supported options and values with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">man ssh_config</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is a short-list of some of the more commonly used options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>User</code></dt>
<dd>
<p>Specify the username to use when connecting to the host.</p>
</dd>
<dt class="hdlist1"><code>Port</code></dt>
<dd>
<p>Specify the port to use when connecting to the host.
This option is equivalent to the <code>-p</code> command-line option.</p>
</dd>
<dt class="hdlist1"><code>HostName</code></dt>
<dd>
<p>Specify the real hostname or IP to use when connecting to the computer name.</p>
</dd>
<dt class="hdlist1"><code>ForwardX11</code></dt>
<dd>
<p>Specify whether or not X11 forwarding should be enabled.
This option can only accept the values <code>yes</code>, and <code>no</code>.
Setting the value of this option to <code>yes</code> is equivalent to including the <code>-X</code> command-line flag.</p>
</dd>
<dt class="hdlist1"><code>ForwardX11Trusted</code></dt>
<dd>
<p>This option can only accept the values <code>yes</code>, and <code>no</code>.
Setting the value of this option to <code>yes</code> is equivalent to including the <code>-Y</code> command-line flag.</p>
</dd>
<dt class="hdlist1"><code>LocalForward</code></dt>
<dd>
<p>Specify a local port to forward to a remote port when connecting to the host.
This option takes two arguments (separated by a space), the local port number to forward, and the destination host and port number in the form <code>host:port</code>.
This option is equivalent to the <code>-L</code> command-line option.</p>
</dd>
<dt class="hdlist1"><code>DynamicForward</code></dt>
<dd>
<p>Set up dynamic port forwarding (a SOCKS Proxy).
The value must be a port number, and this option is equivalent to <code>-D</code> command-line option.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>SSH config files are very often used to specify that all SSH-based connections to a given computer should go to a given non-standard port.
When using the SSH command itself you can specify the port number with the <code>-p</code> option, but you can&#8217;t always do that when using SSH via another command.
For example, <code>rsync</code> does not allow you to specify an SSH port number, so if you need to use <code>rsync</code> to connect to a computer with SSH running on a non-standard port, you must use an SSH config file.
E.g.
if the computer <code>my-rsync-server.com</code> has SSH listening on port 2222, you would use the following host declaration in an SSH config file to enable <code>rsync</code> connections over SSH:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">Host my-rsync-server.com
  Port 2222</code></pre>
</div>
</div>
<div class="paragraph">
<p>Even if you never find yourself in a situation where you must use an SSH config file, you might still find it worth the effort to set one up.
You can use them to create what are effectively SSH bookmarks.</p>
</div>
<div class="paragraph">
<p>As an example, let&#8217;s say we regularly have to connect to the server <code>this-is-a-really-long-name.com</code> on port 2222 with the username <code>rhododendron</code>.
You could type the following each time you wanted to connect:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ssh rhododendron@this-is-a-really-long-name.com <span style="color: #000080">-p</span> 2222</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, you could shorten that command to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ssh myserver</code></pre>
</div>
</div>
<div class="paragraph">
<p>All you would have to do to make your life that much easier would be to create the following host definition in your SSH config file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">Host myserver
  HostName this-is-a-really-long-name.com
  User rhododendron
  Port 2222</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how the <code>HostName</code> option allows us to give short nicknames to servers.</p>
</div>
<div class="paragraph">
<p>Finally, you can use wild cards when specifying a <code>Host</code> declaration.
<code>*</code> is interpreted at as &#8216;zero or more of any character&#8217;, and <code>?</code> is interpreted as &#8216;exactly 1 character&#8217;.</p>
</div>
<div class="paragraph">
<p>This can be very useful if, for example, you have the same username on all servers for a given company (perhaps the one you work for).
You could set SSH to use that username on all servers in the organisation&#8217;s domain with an entry like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">Host <span style="color: #000000;font-weight: bold">*</span>.my-company.com
  User my_username</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ssh_guis">SSH GUIs</h3>
<div class="paragraph">
<p>Whatever OS you happen to be using, you&#8217;ll have many SSH GUI clients to choose from.
In general, they all provide the same basic functionality&#8201;&#8212;&#8201;they allow you to save SSH connection details so you can quickly and easily connect to the computers you regularly connect to.
In effect, most of the GUIs are just graphical alternatives to SSH config files.</p>
</div>
<div class="paragraph">
<p>Rather than spend an eternity making an exhaustive list of all the SSH GUIs out there, I thought I&#8217;d simply recommend the ones I have found the most useful.
Below are the three SSH GUIs I use regularly.</p>
</div>
<div class="sect3">
<h4 id="_jellyfissh_os_x_only">JellyfiSSH (OS X Only)</h4>
<div class="paragraph">
<p>This little OS X app is <a href="https://itunes.apple.com/ie/app/jellyfissh/id416399476?mt=12">available in the OS X App Store</a> for just €3.49.
It provides a small window containing your SSH bookmarks, and optionally a menubar dropdown with all your bookmarks.
You use the app to open your saved SSH connections in new Terminal windows.</p>
</div>
<div class="paragraph">
<p>You can organise your bookmarks into categories, and you can set all sorts of settings for each bookmark.
The app supports all the obvious stuff like hostname, username, and port number, but you can also set up the more advanced stuff like X11 forwarding and port forwarding, and you can customise the Terminal settings for each bookmark.
This means that you can do clever things like creating a custom background image for each bookmark, or, set the background colour depending on the server&#8217;s role.
I like to use red backgrounds for live servers for example, and green backgrounds for test servers.</p>
</div>
<div class="paragraph">
<p>The more energy you put into creating your bookmarks, the more use you&#8217;ll get out of the app.
I find it well worth taking the time to create custom background images for each server so I can see at a glance what terminal window is connected to what server.
My background images have the name of the server in big writing in the centre of the background image at 25% opacity and an icon for the OS the server is running in the top right corner.</p>
</div>
</div>
<div class="sect3">
<h4 id="_prompt_2_ios_only">Prompt 2 (iOS Only)</h4>
<div class="paragraph">
<p>In my opinion the best SSH client for iOS is without doubt Prompt 2 from Panic.
It&#8217;s a universal app, and costs just €4.99 <a href="https://itunes.apple.com/ie/app/prompt-2/id917437289?mt=8">in the iOS App Store</a>.</p>
</div>
<div class="paragraph">
<p>The standard iOS keyboard is not very SSH-friendly, but with Prompt 2 that&#8217;s not a problem&#8201;&#8212;&#8201;the app&#8217;s UI provides quick and easy access to things like the control and tab keys, as well as special characters you&#8217;ll need often like <code>|</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_putty_windows">PuTTY (Windows)</h4>
<div class="paragraph">
<p>I prefer to avoid using Windows desktops when possible, but when I have no choice but to use them, I use PuTTY for all my SSH needs.
The app is as old as the hills and has a website straight from the 1980s, but it works like a charm and is very popular.
The app is small, efficient, and easy to use, and it&#8217;s also free and open source.
PuTTY is a single stand-alone <code>.exe</code> file, so you don&#8217;t even have to install it, and you can run it straight from a thumb drive.</p>
</div>
<div class="paragraph">
<p>As well as just <code>putty.exe</code>, the SSH GUI, the same project also provides SCP (<code>pscp.exe</code>), SFTP (<code>psftp.exe</code>), and SSH Agent (<code>pagent.exe</code>) commands for Windows.</p>
</div>
<div class="paragraph">
<p>You can get all these Windows utilities from the <a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/download.html">PuTTY download page</a>.</p>
</div>
<div class="paragraph">
<p>There are also versions of PuTTY for Unix and Linux.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusions_15">Conclusions</h3>
<div class="paragraph">
<p>With SSH keys for secure password-less authentication and either SSH config files or an SSH GUI app to bookmark the computers you connect to regularly, you should be able to have a nice easy SSH experience.
You can now easily execute remote commands, and transfer files across the network securely.</p>
</div>
<div class="paragraph">
<p>Within the context of the larger networking section within this series, SSH is just one of the Application Layer protocols we&#8217;ll be looking at.
In the next instalment, we&#8217;ll move on to look at terminal commands for interacting with HTTP(S), the protocol that powers the world wide web.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt34">TTT Part 34 of n &#8212; Introducing HTTP</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In <a href="#ttt33">the previous instalment</a>, we finished a five-part series on SSH.
Before moving on, let&#8217;s take a moment to step back and look at the big picture.
The five SSH instalments are all part of the now long-running series on networking.
We have been working our way through the networking stack since <a href="#ttt23">instalment 23</a>.
We started at the bottom of the stack, and have worked our way up.
We are not exploring protocols in the Application Layer.</p>
</div>
<div class="paragraph">
<p>In this instalment, we&#8217;re moving on from SSH to HTTP, the protocol that powers the world wide web.</p>
</div>
<div class="paragraph">
<p>Before we look at some HTTP-related terminal commands, we need a basic understanding of how HTTP works, so that&#8217;s what this instalment is all about.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 34</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 34</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT34IntroducingHTTP/TTT_34_Introducing_HTTP.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_34.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT34IntroducingHTTP/TTT_34_Introducing_HTTP.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_introducing_http">Introducing HTTP</h3>
<div class="paragraph">
<p>HTTP, the Hyper Text Transfer Protocol, is an application layer protocol that sits on top of TCP.
By default, HTTP servers listen on TCP port 80.
HTTP is a request-response protocol, where the clients (usually web browsers) formulate an HTTP request and send it to an HTTP server, which then interprets it and formulates an HTTP response which the client then processes.
The HTTP protocol is plain-text and human-readable.</p>
</div>
<div class="paragraph">
<p>The HTTP protocol is most closely associated with web browsers, which use it to fetch web pages, but it&#8217;s used by other apps too.
Another common example is podcatchers, which use HTTP to fetch the RSS feeds that define podcasts, as well as the media files those feeds link to.
Many modern phone &amp; tablet apps also use HTTP to communicate with the so-called cloud that powers them.
HTTP is one of the real workhorses of the modern internet.</p>
</div>
</div>
<div class="sect2">
<h3 id="_http_requests">HTTP Requests</h3>
<div class="paragraph">
<p>An HTTP request consists of between one and three sections.
It always starts with a request line.
This request line can be followed by zero or more request header lines, and finally, a data section may follow, separated from the headers by an empty line.
The data section, should it be present, contains data entered into web forms, including file uploads.</p>
</div>
<div class="paragraph">
<p>The HTTP request line specifies the HTTP method to use, the path to request from the server, and the version of the HTTP protocol the remainder of the request will use.</p>
</div>
<div class="paragraph">
<p>The HTTP request headers are specified one per line, as name-value pairs, with the name separated from the value by a <code>:</code> character.
The headers are used by the client to pass information to the server which it can use in generating its response.</p>
</div>
<div class="paragraph">
<p>The following is an actual HTTP request for <a href="https://www.podfeet.com/blog/">www.podfeet.com/blog/</a> as emitted by FireFox:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">GET /blog/ HTTP/1.1
Host: www.podfeet.com
User-Agent: Mozilla/5.0 <span style="color: #000000;font-weight: bold">(</span>Macintosh<span style="background-color: #f8f8f8">;</span> Intel Mac OS X 10.10<span style="background-color: #f8f8f8">;</span> rv:37.0<span style="color: #000000;font-weight: bold">)</span> Gecko/20100101 Firefox/37.0
Accept: text/html,application/xhtml+xml,application/xml<span style="background-color: #f8f8f8">;</span><span style="color: #008080">q</span><span style="color: #000000;font-weight: bold">=</span>0.9,<span style="color: #000000;font-weight: bold">*</span>/<span style="color: #000000;font-weight: bold">*</span><span style="background-color: #f8f8f8">;</span><span style="color: #008080">q</span><span style="color: #000000;font-weight: bold">=</span>0.8
Accept-Language: en,en-US<span style="background-color: #f8f8f8">;</span><span style="color: #008080">q</span><span style="color: #000000;font-weight: bold">=</span>0.7,ga<span style="background-color: #f8f8f8">;</span><span style="color: #008080">q</span><span style="color: #000000;font-weight: bold">=</span>0.3
Accept-Encoding: <span style="color: #0086B3">gzip</span>, deflate
Cookie: <span style="color: #008080">__utma</span><span style="color: #000000;font-weight: bold">=</span>188241321.1236907656.1162169166.1408563404.1431184789.53<span style="background-color: #f8f8f8">;</span> <span style="color: #008080">__qca</span><span style="color: #000000;font-weight: bold">=</span>P0-1257128144-1331857305112<span style="background-color: #f8f8f8">;</span> <span style="color: #008080">PHPSESSID</span><span style="color: #000000;font-weight: bold">=</span>n7uq31arql1uao8g3rahchu743<span style="background-color: #f8f8f8">;</span> <span style="color: #008080">__utmb</span><span style="color: #000000;font-weight: bold">=</span>188241321.2.10.1431184789<span style="background-color: #f8f8f8">;</span> <span style="color: #008080">__utmc</span><span style="color: #000000;font-weight: bold">=</span>188241321<span style="background-color: #f8f8f8">;</span> <span style="color: #008080">__utmz</span><span style="color: #000000;font-weight: bold">=</span>188241321.1431184789.53.1.utmcsr<span style="color: #000000;font-weight: bold">=(</span>direct<span style="color: #000000;font-weight: bold">)</span>|utmccn<span style="color: #000000;font-weight: bold">=(</span>direct<span style="color: #000000;font-weight: bold">)</span>|utmcmd<span style="color: #000000;font-weight: bold">=(</span>none<span style="color: #000000;font-weight: bold">)</span><span style="background-color: #f8f8f8">;</span> <span style="color: #008080">__utmt</span><span style="color: #000000;font-weight: bold">=</span>1
DNT: 1
Connection: keep-alive
Cache-Control: max-age<span style="color: #000000;font-weight: bold">=</span>0</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first line is the request line, which states that the HTTP <code>GET</code> method should be used, that the path <code>/blog/</code> is being requested, and that the request is being made using version 1.1 of the HTTP protocol.</p>
</div>
<div class="paragraph">
<p>The remainder of the lines are request headers, there is no data included in this request.
We won&#8217;t look at all the headers, but I do want to draw attention to a few notable ones.</p>
</div>
<div class="paragraph">
<p>The <code>Host</code> header is what makes it possible for multiple websites to be served from a single IP address.
The receiving web server will have many different domains configured, and this header will tell it which content is being requested.
The <code>User-Agent</code> header identifies the browser to the server and makes it possible to gather browser and OS usage stats.
Notice how you can tell from the above header that I was using FireFox 37 on OS X 10.10.</p>
</div>
<div class="paragraph">
<p>Notice that any cookies my browser has stored for the domain <code>podfeet.com</code> have been added to the request via the <code>Cookie</code> header.
Each HTTP request to a server is completely independent of all other requests.
There is no relationship between them, no concept of an extended connection or session.
This was a major shortcoming of HTTP, and cookies were added later to make it possible for multiple requests to be tied together.
When sending a reply to the client, the server can include a <code>Set-Cookie</code> header containing a string of text.
It is expected that the client will include this cookie in the request headers of all future requests to that same domain until the cookie expires.
The server can then tie together all the separate requests into a persistent state, making it possible to log in to websites.
Without cookies, there would have been no so-called <em>web 2.0</em>!</p>
</div>
<div class="paragraph">
<p>The <code>Accept-Language</code> header enables internationalisation of websites.
Servers can store multiple versions of the same site in different languages, and use this header to return the correct version to the user.</p>
</div>
<div class="paragraph">
<p>You might also notice that I have the Do Not Track (<code>DNT</code>) header set to 1, which means I am asking not to be tracked.</p>
</div>
<div class="sect3">
<h4 id="_http_methods">HTTP Methods</h4>
<div class="paragraph">
<p>There are quite a few different HTTP methods, but there are only two in common use, <code>GET</code> and <code>POST</code>.</p>
</div>
<div class="paragraph">
<p><code>GET</code> requests should be used when there is little or no form data to send to the server.
What little data there may be gets added to the end of the URL after a <code>?</code> symbol.
<code>GET</code> requests should never be used to send sensitive data, as the data is included in the URL, and hence recorded in logs.
<code>GET</code> requests should be used to retrieve data, and should not be used to alter the internal state of a web app.
Because <code>GET</code> requests append their data to the end of the URL, and because there is a maximum allowed length for URLs, there is a limit to how much data can be sent using a <code>GET</code> request.
A big advantage to <code>GET</code> requests is that their URLs can be bookmarked and shared with others.
E.g., when I use Google to search for something, the text I type into the text box is sent to Google&#8217;s servers using a <code>GET</code> request.
I can see it in the URL of the search results.
I can then copy and paste that URL into an email to share that search with someone else.</p>
</div>
<div class="paragraph">
<p><code>POST</code> requests should be used when there is a lot of data to send, or when the data is sensitive.
<code>POST</code> requests should be used for all request that changes the internal state of a web app, e.g.
to send an email in a webmail interface, add a post on a social media site, or change a password.
<code>POST</code> requests add the form data after the headers, so it is not logged and has no restrictions on the length of the data.
<code>POST</code> requests cannot be bookmarked or shared.</p>
</div>
</div>
<div class="sect3">
<h4 id="_encoding_form_data">Encoding Form Data</h4>
<div class="paragraph">
<p>Whenever we submit a web form, the data we have entered is submitted to the server as part of an HTTP request.
If the submit button is configured to use <code>GET</code>, then the data is appended to the URL, like a Google search, and if the submit button is configured to use <code>POST</code>, the data is added to the end of the HTTP request, after the request headers, separated from them by a blank line.
However, regardless of how the data is sent, it is always encoded in the same way.</p>
</div>
<div class="paragraph">
<p>Each form element on a page has a name and a value.
The data is encoded as a sequence of <code>name=value</code> pairs, separated with <code>&amp;</code> symbols.
Neither names nor values can contain special characters, so any such characters in the data must be encoded using URL escape sequences.
These are two-digit hexadecimal codes prefixed with the <code>%</code> symbol.
You&#8217;ll find a <a href="https://www.w3schools.com/tags/ref_urlencode.asp">full list of URL escape codes here</a>, but as an example, a space character is encoded as <code>%20</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_http_responses">HTTP Responses</h3>
<div class="paragraph">
<p>When a web server receives an HTTP request, it interprets it, tries to fetch the data requested and return it.
It may well fail, but whatever the result of attempting to fulfil the request, the server will formulate an HTTP response to communicate the outcome of the request to the client.</p>
</div>
<div class="paragraph">
<p>Similar to the request, an HTTP response has three parts, a status line, zero or more response header lines, and a final optional data segment, separated from the headers by a blank line.</p>
</div>
<div class="paragraph">
<p>Below is a truncated version of the HTTP response from Allison&#8217;s web server to a request for <a href="https://www.podfeet.com/blog/" class="bare">https://www.podfeet.com/blog/</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">HTTP/1.1 200 OK
Date: Sat, 09 May 2015 15:52:42 GMT
Server: Apache
X-Pingback: https://www.podfeet.com/blog/xmlrpc.php
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate, post-check<span style="color: #000000;font-weight: bold">=</span>0, pre-check<span style="color: #000000;font-weight: bold">=</span>0
Pragma: no-cache
Set-Cookie: <span style="color: #008080">PHPSESSID</span><span style="color: #000000;font-weight: bold">=</span>eand2g7q77privgcpvi6m7i7g2<span style="background-color: #f8f8f8">;</span> <span style="color: #008080">path</span><span style="color: #000000;font-weight: bold">=</span>/
Vary: Accept-Encoding
Transfer-Encoding: chunked
Content-Type: text/html<span style="background-color: #f8f8f8">;</span> <span style="color: #008080">charset</span><span style="color: #000000;font-weight: bold">=</span>UTF-8

&lt;<span style="color: #000000;font-weight: bold">!</span>DOCTYPE html PUBLIC <span style="color: #d14">'-//W3C//DTD XHTML 1.0 Transitional//EN'</span> <span style="color: #d14">'https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'</span><span style="color: #000000;font-weight: bold">&gt;</span>
&lt;html <span style="color: #008080">xmlns</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'http//www.w3.org/1999/xhtml'</span> <span style="color: #008080">lang</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'en-US'</span><span style="color: #000000;font-weight: bold">&gt;</span>
&lt;<span style="color: #0086B3">head</span><span style="color: #000000;font-weight: bold">&gt;</span>
&lt;meta http-equiv<span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'Content-Type'</span> <span style="color: #008080">content</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">'text/html; charset=UTF-8'</span> /&gt;
	&lt;title&gt;NosillaCast&lt;/title&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first line of the response gives the HTTP version, and most importantly, the HTTP response code.
This tells the client what kind of response it is receiving.
You could receive a successful response, a response instructing the client to re-issue its request to a different URL (i.e.
a redirect), a request for authentication (a username and password popup), or an error message.</p>
</div>
<div class="paragraph">
<p>After the HTTP response line comes a list of HTTP header lines, again, we won&#8217;t go into them all, but I do want to draw your attention to a few important ones.
Firstly, the <code>Server</code> header makes it possible to gather statistics on the web servers in use on the internet&#8201;&#8212;&#8201;notice that Allison&#8217;s site is powered by an Apache webserver.
The single most important response header is <code>Content-Type</code>, which tells the client what type of data it will receive after the blank line, and optionally, how it&#8217;s encoded.
In this case, the data section contains HTML markup encoded using UTF-8.
Also notice that the server is requesting the client set a new cookie using the <code>Set-Cookie</code> header and that the <code>Cache-Control</code> header is telling the client, in many different ways, that it absolutely positively should not cache a copy of this page.
The actual HTML markup for Allison&#8217;s home page is hundreds of lines long, I have only shown the first six lines.</p>
</div>
<div class="paragraph">
<p>It&#8217;s important to note that rendering a single web page generally involves many HTTP requests, often to multiple servers.
The first response will usually be the HTML markup for the web page in question, but that HTML will almost certainly contain links to other resources need to render the page, like style sheets, images, JavaScript files, etc.
As an example, rendering Allison&#8217;s home page requires 107 HTTP requests!
That&#8217;s on the high side because Allison has a lot of videos embedded in her home page, and quite a few widgets embedded in her sidebars.
However, on the modern web, it&#8217;s not unusual to need this many requests to render a single page.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note - a later redesign of Allison&#8217;s site reduced the number of http requests to 68.</div>

</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_http_response_codes">HTTP Response Codes</h4>
<div class="paragraph">
<p>There are many supported HTTP response codes (<a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html">click here for a full list</a>), and we&#8217;re not going to go into them all, but I do want to explain the way they are grouped and highlight some common ones you&#8217;re likely to come across.</p>
</div>
<div class="paragraph">
<p>HTTP response codes are three-digit numbers starting with 1, 2, 3, 4, or 5.
They are grouped into related groups by their first digit.
All response codes starting with a 1 are so-called informational responses.
These are rarely used.
All response codes starting with a 2 are successful responses to requests.
All response codes starting with a 3 are redirection responses.
All responses starting with a 4 are client errors (in a very loose sense), and finally, all responses starting with a 5 are server errors.</p>
</div>
<div class="paragraph">
<p>Some common HTTP response codes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>200 - OK</code></dt>
<dd>
<p>This is the response code you always hope to get, it means your request was successful</p>
</dd>
<dt class="hdlist1"><code>301 - Moved Permanently</code></dt>
<dd>
<p>A permanent redirect, this redirect may be cached by clients</p>
</dd>
<dt class="hdlist1"><code>302 - Found</code></dt>
<dd>
<p>A temporary redirect, this redirect should not be cached by clients as it could change at any time</p>
</dd>
<dt class="hdlist1"><code>400 - Bad Request</code></dt>
<dd>
<p>The HTTP request sent to the server was not valid.
You&#8217;re unlikely to ever see this in a browser, but if you muck around constructing your own requests on the terminal you might well see it when you get something wrong!</p>
</dd>
<dt class="hdlist1"><code>401 - Not Authorised</code></dt>
<dd>
<p>Tells the client to request a username and password from the user</p>
</dd>
<dt class="hdlist1"><code>403 - Forbidden</code></dt>
<dd>
<p>The requested URL exists, but the client has been denied access, perhaps based on the user they have logged in as the IP address they are accessing the site from, or the file-type of the URL they are attempting to access.</p>
</dd>
<dt class="hdlist1"><code>404 - Not Found</code></dt>
<dd>
<p>One of the most common errors you&#8217;ll see&#8201;&#8212;&#8201;your request was valid, the server understood it, but it has no content to return to you at that URL.</p>
</dd>
<dt class="hdlist1"><code>500 - Internal Server Error</code></dt>
<dd>
<p>The web programmers' most hated error&#8201;&#8212;&#8201;it just means the server encountered an error while trying to fulfil your request.</p>
</dd>
<dt class="hdlist1"><code>502 - Bad Gateway</code></dt>
<dd>
<p>In the days of CDNs (Content Delivery Networks), these errors are becoming ever more common.
It means that your browser has successfully contacted a front-end web server, probably at the CDN, but that the back-end server that actually contains the information you need is not responding to the front-end server.
The front-end server is considered a gateway to the back-end server, hence the name of the error.</p>
</dd>
<dt class="hdlist1"><code>503 - Service Unavailable</code></dt>
<dd>
<p>The server is temporarily too busy to deal with you&#8201;&#8212;&#8201;effectively a request to try again later.</p>
</dd>
<dt class="hdlist1"><code>504 - Gateway Timeout</code></dt>
<dd>
<p>This error is similar to a 502 and is also becoming ever more common with the rise of CDNs, it means the back-end server is up but is responding too slowly to the front-end server, and the front-end server is giving up.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_mime_types">MIME Types</h4>
<div class="paragraph">
<p>HTTP uses the <code>Content-Type</code> header to specify the type of data being returned.
The value of that header must be a so-called MIME Type or <em>internet media type</em>.
MIME Types have their origins in the common suite of email protocols, and were later adopted for use on the world wide web&#8201;&#8212;&#8201;after all, why reinvent the wheel!?</p>
</div>
<div class="paragraph">
<p>There are MIME types for just about everything, and they consist of two parts, a general type, and then a more specific identifier.
E.g.
all the text-based code files used on the web have MIME types starting with <code>text</code>, e.g.:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>text/html</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTML markup</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>text/javascript</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JavaScript code</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>text/css</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CSS Style Sheet definitions</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Some other common web MIME Types include:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>image/jpeg</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JPEG Photos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>image/png</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PNG graphics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>audio/mpeg</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MP3 audio</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>video/mp4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MPEG 4 video</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_exploring_http_with_your_browser">Exploring HTTP With Your Browser</h3>
<div class="paragraph">
<p>Before moving on to the HTTP-related terminal commands, let&#8217;s look at some of the debugging tools contained within our browsers.
All modern browsers have developer tools, and they all do similar things, but the UI is different in each.
My personal preference is to use Safari&#8217;s developer tools, but so as to make this section accessible to as many people as possible, we&#8217;ll use the cross-platform FireFox browser.</p>
</div>
<div class="paragraph">
<p>To enable the developer tools we are interested in today, browse to the site you want to explore, e.g.
<a href="https://www.bartb.ie/">www.bartb.ie</a>, and click on <span class="menuseq"><b class="menu">Tools</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Web Developer</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Network</b></span>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt34/Screen-Shot-2015-05-09-at-17.33.50.png" alt="Enable FireFox Dev Tools">
</div>
</div>
<div class="paragraph">
<p>This will open a new subwindow at the bottom of your FireFox window with a message telling you to reload the page.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt34/Screen-Shot-2015-05-09-at-17.33.58.png" alt="FireFox Dev Tools - Reload Page">
</div>
</div>
<div class="paragraph">
<p>When you do, you&#8217;ll see all the HTTP requests needed to load my home page scroll by, with a timeline next to the list.
If you scroll up to the very top of the list you&#8217;ll see the initial request, which received HTML markup in response from my server.
All the other requests are follow-up requests for resources needed to render my home page, like JavaScript code files, CSS style sheets, and images.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt34/Screen-Shot-2015-05-09-at-17.34.54.png" alt="FireFox Dev Tools - Timeline">
</div>
</div>
<div class="paragraph">
<p>You can click on any request to see more details.
This will add a tab to the right with lots of tabs to explore, though the Headers tab is the one we are interested in.
There is a button to show the raw headers.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt34/Screen-Shot-2015-05-09-at-17.51.48.png" alt="FireFox De Tools - Request Details">
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll notice a lot of <code>304</code> response codes.
This is a sign of efficient use of caching.
If you click on one of these requests and look at the raw headers, you&#8217;ll see that the request headers included a header called <code>If-Modified-Since</code>, which specifies a date.
That tells the server that the browser has a cached copy of this URL that was retrieved at the specified date.
The server can use this date to check if the content of the URL has changed since then.
If the data is unchanged, the server can respond with a <code>304</code> status code rather than a fresh copy of the data, this tells the client that the data has not changed, so it&#8217;s OK to use the cached version.
This kind of caching of static content like images saves a lot of bandwidth.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conclusions_16">Conclusions</h3>
<div class="paragraph">
<p>Hopefully, you now have a basic understanding of what your browser is doing when you visit a webpage.
Do bear in mind though that we have ignored some of the subtle detail of the process so as not to add unnecessary confusion.
While this description will be sufficient to understand the terminal commands that interact with web servers, it would not be sufficient to pass an exam on the subject!</p>
</div>
<div class="paragraph">
<p>Now that we understand the fundamentals of how HTTP works, we are ready to look at some related terminal commands.
In the next instalment, we&#8217;ll learn about three such terminal commands, <code>lynx</code>, <code>wget</code> and <code>curl</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt35">TTT Part 35 of n &#8212; HTTP Commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In <a href="#ttt34">the previous instalment</a> we introduced the HTTP protocol.
In this instalment, we&#8217;ll look at three terminal commands which make use of the HTTP protocol.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll start by browsing from the terminal, and then move on to a pair of very similar commands for making HTTP requests from the terminal.
These two commands can do many things, but we&#8217;ll focus on two specific use cases: downloading files, and viewing HTTP headers.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 35</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 35</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT35HTTPCommands/TTT_35_HTTP_Commands.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_35.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also <a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/TTT35HTTPCommands/TTT_35_HTTP_Commands.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_browsing_the_web_from_the_terminal">Browsing the Web from the Terminal</h3>
<div class="paragraph">
<p>The modern internet tends to be a flashy place full of pictures and videos, but, much of its value still comes from the text it contains.
Sometimes it&#8217;s actually an advantage to see the web free from everything but the text.
For example, text is very efficient when it comes to bandwidth, so if you have a particularly poor internet connection, cutting out the images and videos can really speed things up.
The visually impaired may also find it helpful to distil the internet down to just the text.</p>
</div>
<div class="paragraph">
<p>In both of these situations, the <code>lynx</code> text-based web browser can be very useful.
It allows you to browse the web from the terminal.
While many versions of Linux come with lynx installed by default, OS X doesn&#8217;t.
The easiest way to install it is using <a href="https://www.macports.org/install.php">MacPorts</a>.
Once you have MacPorts installed, you can install <code>lynx</code> on your Mac with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">sudo </span>port <span style="color: #0086B3">install </span>lynx</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have <code>lynx</code> installed, you can open any web page in your browser by passing the URL as an argument to the command <code>lynx</code>, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">lynx https://www.podfeet.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>As <code>lynx</code> loads the page, you&#8217;ll see it tell you what it&#8217;s doing, and it may ask your permission to accept some cookies.
Once the page is loaded, you can move down a whole screen of text at a time with the space bar, up a whole screen with the <kbd>b</kbd> key, and hop from link to link within the page with the up
and down
arrow keys.
To follow a link, hit the right
arrow key, to go back to the previous page, hit the left
arrow key.
You can go to a different URL by pressing the <kbd>g</kbd> key, and you can quit the app with the <kbd>q</kbd> key.</p>
</div>
<div class="paragraph">
<p>You can also search within a page with the <kbd>/</kbd> key.
Hitting <code>/</code> will allow you to enter a search string.
When you want to submit the search, hit <kbd>Enter</kbd>.
If a match is found, you will be taken to it.
You can move to the next match with the <kbd>n</kbd> key, and back to the previous match with <span class="keyseq"><kbd>Shift</kbd>+<kbd>n</kbd></span>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_viewing_http_headers_downloading_files">Viewing HTTP Headers &amp; Downloading Files</h3>
<div class="paragraph">
<p><code>wget</code> and <code>curl</code> are a pair of terminal commands that can be used to make HTTP connections, and view the results.
Both commands can do almost all the same things, but they each do them in a slightly different way.
Just about every version of Linux and Unix will come with one or both of these commands installed.
OS X comes with <code>curl</code>, while <code>wget</code> seems to be more common on Linux.
Most Linux distributions will allow you to install both of these commands, and you can install <code>wget</code> on OS X using MacPorts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">sudo </span>port <span style="color: #0086B3">install </span>wget</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_downloading_files">Downloading Files</h4>
<div class="paragraph">
<p>Both <code>curl</code> and <code>wget</code> can be used to download a file from the internet, but <code>wget</code> makes it a little easier.</p>
</div>
<div class="paragraph">
<p>The URL to download a zip file containing the latest version of <code>Crypt::HSXKPasswd</code> from GitHub is <code><a href="https://github.com/bbusschots/xkpasswd.pm/archive/master.zip" class="bare">https://github.com/bbusschots/xkpasswd.pm/archive/master.zip</a></code>.
The two commands below can be used to download that file to the present working directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">wget https://github.com/bbusschots/xkpasswd.pm/archive/master.zip

curl <span style="color: #000080">-O</span> https://github.com/bbusschots/xkpasswd.pm/archive/master.zip</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, <code>wget</code> downloads URLs, while <code>curl&#8217;s default is to print their contents to `STDOUT</code>.
The <code>-O</code> option tells <code>curl</code> to output to a file rather than <code>STDOUT</code>.
Both of the commands above will save the file locally with the name at the end of the URL.
While that is a sensible default, it&#8217;s not always what you want.
In fact, in this case, the default file name is probably not what you want, since <code>master.zip</code> is very nondescript.
Both commands allow an alternative output file to be specified:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">wget <span style="color: #000080">-O</span> HSXKPasswd.zip https://github.com/bbusschots/xkpasswd.pm/archive/master.zip

curl <span style="color: #000080">-o</span> HSXKPasswd.zip https://github.com/bbusschots/xkpasswd.pm/archive/master.zip

curl https://github.com/bbusschots/xkpasswd.pm/archive/master.zip <span style="color: #000000;font-weight: bold">&gt;</span> HSXKPasswd.zip</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_viewing_http_headers">Viewing HTTP Headers</h4>
<div class="paragraph">
<p>When developing websites, or when configuring redirects, it can be very helpful to see exactly what is being returned by the webserver.
Web browsers have a tendency to cache things, which can make broken sites appear functional, and functional sites appear broken.
When using <code>curl</code> or <code>wget</code>, you can see exactly what is happening at the HTTP level.</p>
</div>
<div class="paragraph">
<p>As an example, let&#8217;s look at the redirect Allison has on her site to redirect people to her Twitter account: <code><a href="https://www.podfeet.com/twitter" class="bare">https://www.podfeet.com/twitter</a></code>.
To see exactly what Allison&#8217;s server is returning, we can use <code>wget</code> with the <code>--spider</code> and <code>-S</code> options:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>wget <span style="color: #000080">--spider</span> <span style="color: #000080">-S</span> https://www.podfeet.com/twitter
<span style="color: #888888">Spider mode enabled. Check if remote file exists.</span>
<span style="color: #888888">--2015-07-04 17:36:12--  https://www.podfeet.com/twitter</span>
<span style="color: #888888">Resolving www.podfeet.com (www.podfeet.com)... 173.254.94.93</span>
<span style="color: #888888">Connecting to www.podfeet.com (www.podfeet.com)|173.254.94.93|:80... connected.</span>
<span style="color: #888888">HTTP request sent, awaiting response...</span>
<span class="hll"><span style="color: #888888">  HTTP/1.1 301 Moved Permanently</span>
</span><span style="color: #888888">  Date: Sat, 04 Jul 2015 16:36:12 GMT</span>
<span style="color: #888888">  Server: Apache</span>
<span class="hll"><span style="color: #888888">  Location: https://twitter.com/podfeet</span>
</span><span style="color: #888888">  Keep-Alive: timeout=10, max=500</span>
<span style="color: #888888">  Connection: Keep-Alive</span>
<span style="color: #888888">  Content-Type: text/html; charset=iso-8859-1</span>
<span style="color: #888888">Location: https://twitter.com/podfeet [following]</span>
<span style="color: #888888">Spider mode enabled. Check if remote file exists.</span>
<span style="color: #888888">--2015-07-04 17:36:12--  https://twitter.com/podfeet</span>
<span style="color: #888888">Resolving twitter.com (twitter.com)... 199.16.156.198, 199.16.156.70, 199.16.156.102, ...</span>
<span style="color: #888888">Connecting to twitter.com (twitter.com)|199.16.156.198|:443... connected.</span>
<span style="color: #888888">HTTP request sent, awaiting response...</span>
<span style="color: #888888">  HTTP/1.1 200 OK</span>
<span style="color: #888888">  cache-control: no-cache, no-store, must-revalidate, pre-check=0, post-check=0</span>
<span style="color: #888888">  content-length: 262768</span>
<span style="color: #888888">  content-security-policy: default-src https:; connect-src https:; font-src https: data:; frame-src https: twitter:; img-src https: blob: data:; media-src https: blob:; object-src https:; script-src 'unsafe-inline' 'unsafe-eval' https:; style-src 'unsafe-inline' https:; report-uri https://twitter.com/i/csp_report?a=NVQWGYLXFVZXO2LGOQ%3D%3D%3D%3D%3D%3D&amp;ro=false;</span>
<span style="color: #888888">  content-type: text/html;charset=utf-8</span>
<span style="color: #888888">  date: Sat, 04 Jul 2015 16:36:13 GMT</span>
<span style="color: #888888">  expires: Tue, 31 Mar 1981 05:00:00 GMT</span>
<span style="color: #888888">  last-modified: Sat, 04 Jul 2015 16:36:13 GMT</span>
<span style="color: #888888">  ms: A</span>
<span style="color: #888888">  pragma: no-cache</span>
<span style="color: #888888">  server: tsa_b</span>
<span style="color: #888888">  set-cookie: _twitter_sess=BAh7CSIKZmxhc2hJQzonQWN0aW9uQ29udHJvbGxlcjo6Rmxhc2g6OkZsYXNo%250ASGFzaHsABjoKQHVzZWR7ADoPY3JlYXRlZF9hdGwrCD%252Fg7FlOAToMY3NyZl9p%250AZCIlMDc5ODNiZjRjY2VmYTZmMzkyMjViNzUzMzBjMTlmN2M6B2lkIiVlMGRl%250AMGUxNThhOGFlYjQ2MDk5MzhlYTg5MDVhZjkwYg%253D%253D--eb013985df212afa338abf74675b639d75a96486; Path=/; Domain=.twitter.com; Secure; HTTPOnly</span>
<span style="color: #888888">  set-cookie: guest_id=v1%3A143602777299066731; Domain=.twitter.com; Path=/; Expires=Mon, 03-Jul-2017 16:36:13 UTC</span>
<span style="color: #888888">  status: 200 OK</span>
<span style="color: #888888">  strict-transport-security: max-age=631138519</span>
<span style="color: #888888">  x-connection-hash: 781f41ed342615977688eb6f432f7fc4</span>
<span style="color: #888888">  x-content-type-options: nosniff</span>
<span style="color: #888888">  x-frame-options: SAMEORIGIN</span>
<span style="color: #888888">  x-response-time: 127</span>
<span style="color: #888888">  x-transaction: b3fb3de740391d24</span>
<span style="color: #888888">  x-twitter-response-tags: BouncerCompliant</span>
<span style="color: #888888">  x-ua-compatible: IE=edge,chrome=1</span>
<span style="color: #888888">  x-xss-protection: 1; mode=block</span>
<span style="color: #888888">Length: 262768 (257K) [text/html]</span>
<span style="color: #888888">Remote file exists and could contain further links,</span>
<span style="color: #888888">but recursion is disabled -- not retrieving.</span>

<span style="color: #555555">bart-iMac2013:~ bart$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>--spider</code> option tells <code>wget</code> not to download the actual contents of the URL, and the <code>-S</code> flag tells <code>wget</code> to show the server headers.
By default, <code>wget</code> will follow up to 20 redirects, so there is much more output here than we really need.
The information we need is there, and I have highlighted it, but it would be easier to get to if <code>wget</code> didn&#8217;t follow the redirect and then ask Twitter&#8217;s server for its headers too.
Since we only need the first set of headers, we need to tell <code>wget</code> not to follow any redirects at all, and we can do that with the <code>--max-redirect</code> flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>wget <span style="color: #000080">--spider</span> <span style="color: #000080">-S</span> <span style="color: #000080">--max-redirect</span> 0 https://www.podfeet.com/twitter
<span style="color: #888888">Spider mode enabled. Check if remote file exists.</span>
<span style="color: #888888">--2015-07-04 17:38:45--  https://www.podfeet.com/twitter</span>
<span style="color: #888888">Resolving www.podfeet.com (www.podfeet.com)... 173.254.94.93</span>
<span style="color: #888888">Connecting to www.podfeet.com (www.podfeet.com)|173.254.94.93|:80... connected.</span>
<span style="color: #888888">HTTP request sent, awaiting response...</span>
<span class="hll"><span style="color: #888888">  HTTP/1.1 301 Moved Permanently</span>
</span><span style="color: #888888">  Date: Sat, 04 Jul 2015 16:38:45 GMT</span>
<span style="color: #888888">  Server: Apache</span>
<span class="hll"><span style="color: #888888">  Location: https://twitter.com/podfeet</span>
</span><span style="color: #888888">  Keep-Alive: timeout=10, max=500</span>
<span style="color: #888888">  Connection: Keep-Alive</span>
<span style="color: #888888">  Content-Type: text/html; charset=iso-8859-1</span>
<span style="color: #888888">Location: https://twitter.com/podfeet [following]</span>
<span style="color: #888888">0 redirections exceeded.</span>
<span style="color: #555555">bart-iMac2013:~ bart$</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The information we need is now much easier to find.
We can see that Allison&#8217;s server is returning a permanent redirect (HTTP response code 301) which is redirecting browsers to <a href="https://twitter.com/podfeet" class="bare">https://twitter.com/podfeet</a>.</p>
</div>
<div class="paragraph">
<p>We can, of course, do the same with <code>curl</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>curl <span style="color: #000080">-I</span> https://www.podfeet.com/twitter
<span class="hll"><span style="color: #888888">HTTP/1.1 301 Moved Permanently</span>
</span><span style="color: #888888">Date: Sat, 04 Jul 2015 16:43:49 GMT</span>
<span style="color: #888888">Server: Apache</span>
<span class="hll"><span style="color: #888888">Location: https://twitter.com/podfeet</span>
</span><span style="color: #888888">Content-Type: text/html; charset=iso-8859-1</span>

<span style="color: #555555">bart-iMac2013:~ bart$</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>-I</code> flag tells <code>curl</code> to only fetch the headers and not the contents of the URL.
When fetching headers, <code>curl</code> does not follow redirects by default, so there is no need to suppress that behaviour.</p>
</div>
<div class="paragraph">
<p>Often, you only care about the response headers, so the output of <code>curl -I</code> is perfect, but, when you do want to see the request headers too, you can add the <code>-v</code> flag to put <code>curl</code> into verbose mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="code"><pre><span style="color: #555555">bart-iMac2013:~ bart$</span><span style="color: #bbbbbb"> </span>curl <span style="color: #000080">-vI</span> https://www.podfeet.com/twitter
<span style="color: #888888">* Hostname was NOT found in DNS cache
*   Trying 173.254.94.93...
* Connected to www.podfeet.com (173.254.94.93) port 80 (#0)
&gt; HEAD /twitter HTTP/1.1
&gt; User-Agent: curl/7.37.1
&gt; Host: www.podfeet.com
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 301 Moved Permanently
HTTP/1.1 301 Moved Permanently
&lt; Date: Sat, 04 Jul 2015 16:46:29 GMT
Date: Sat, 04 Jul 2015 16:46:29 GMT
* Server Apache is not blacklisted
&lt; Server: Apache
Server: Apache
&lt; Location: https://twitter.com/podfeet
Location: https://twitter.com/podfeet
&lt; Content-Type: text/html; charset=iso-8859-1
Content-Type: text/html; charset=iso-8859-1

&lt;
* Connection #0 to host www.podfeet.com left intact
</span><span style="color: #555555">bart-iMac2013:~ bart$</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_and_more">And More &#8230;&#8203;</h4>
<div class="paragraph">
<p>This is just a taster of what <code>curl</code> and <code>wget</code> can do.
For more details, see their relevant <code>man</code> pages.</p>
</div>
<div class="paragraph">
<p>I like to have both <code>curl</code> and <code>wget</code> installed on all my computers because I find <code>wget</code> easier to use for downloading files and <code>curl</code> easier to use for viewing HTTP headers.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusions_17">Conclusions</h3>
<div class="paragraph">
<p>Armed with <code>lynx</code>, <code>curl</code>, and <code>wget</code>, you can use the terminal to browse the web, download files, and peep under the hood of HTTP connections.
When working on websites, you may find you can save a lot of time and energy by using these terminal commands to see exactly what your web server is returning.</p>
</div>
<div class="paragraph">
<p>This instalment concludes our look at the HTTP protocol.
In the next instalment, we&#8217;ll move on to look at two commands that allow you to see what your computer is doing on the network in great detail.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt36">TTT Part 36 of n &#8212; screen &amp; cron</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The previous 13 instalments in this series related to networking, but we&#8217;re going
to change tack completely for this instalment, and look at two unrelated, but
very useful terminal commands&#8201;&#8212;&#8201;<code>screen</code>, and <code>cron</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title"><code>screen</code> has been replaced with <code>tmux</code></div>
<div class="paragraph">
<p>Please refer to <a href="#ttt38">ttt38</a> in which it is explained that <code>screen</code> was deprecated in all Red Hat variants of Linux in 2019, and replaced with the much more powerful <code>tmux</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>screen</code> is a utility that allows for the creation of persistent virtual terminal sessions that you can disconnect from without terminating, and reconnect and pick up where you left off at a later time.
<code>screen</code> is particularly useful when used in conjunction with SSH.</p>
</div>
<div class="paragraph">
<p><code>cron</code>, on the other hand, is a system for automatically executing recurring tasks.
It&#8217;s extremely flexible and very useful for things like scheduling backups to run in the middle of the night.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 36</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 36</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/ttt-36-screen-and-cron_202004/TTT_36_screen_and_cron.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_36.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also
<a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/ttt-36-screen-and-cron_202004/TTT_36_screen_and_cron.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_screen_utility">The <code>screen</code> Utility</h3>
<div class="paragraph">
<p>The <code>screen</code> command is included with OS X by default, but it is not included by default on all Linux distros.
It is however usually available through the distro&#8217;s standard package manager.</p>
</div>
<div class="paragraph">
<p><code>screen</code> creates a virtual terminal that detaches itself from the shell that starts
it. It will continue to run even when that shell ends, because you closed the
terminal window or logged out of the computer.
This means that screen sessions keep running until they are explicitly ended, or the computer is rebooted.
The idea is that you can connect and disconnect as often as you like, allowing you to pick up right where you left off.</p>
</div>
<div class="paragraph">
<p>There are many situations in which this is very useful.
Below are just a few examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When connecting to a server over SSH from a laptop that is regularly put to
sleep&#8201;&#8212;&#8201;if you do all your work on the remote server in a screen session, you
can disconnect and reconnect without interrupting your workflow.</p>
</li>
<li>
<p>When connecting to a server over SSH from a location with poor internet connectivity&#8201;&#8212;&#8201;if you use screen, a network interruption will not terminate a running command.</p>
</li>
<li>
<p>When running commands that will take a long time to execute&#8201;&#8212;&#8201;you can start the command in a screen session, disconnect, and check back on it a few hours, or even days, later.</p>
</li>
<li>
<p>When multiple real humans have to share a single login account on a computer — each can do their work in their own named screen session.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Remember that <code>screen</code> must be installed on the computer where the session will run, so if you want to run a session on a remote machine you are SSHing to, <code>screen</code> needs to be installed on the remote machine.</p>
</div>
<div class="paragraph">
<p>Screen sessions run as, and belong to, the user that creates them.
You can run arbitrarily many screen sessions at any one time.
To see all your currently running sessions, use the command:</p>
</div>
<div class="paragraph">
<p><code>screen -ls</code></p>
</div>
<div class="paragraph">
<p>If you have no running screen sessions, it will give you output something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">$</span><span style="color: #bbbbbb"> </span>screen <span style="color: #000080">-ls</span>
<span style="color: #888888">No Sockets found in /var/folders/0f/8m9p9bj556394xd50jl4g_340000gn/T/.screen.

</span><span style="color: #555555">$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can start a new screen session with the command:</p>
</div>
<div class="paragraph">
<p><code>screen</code></p>
</div>
<div class="paragraph">
<p>You may get a welcome message asking you to hit space to continue, if you do, hit space.
You&#8217;ll then get a new command prompt.
This is your screen session, not your original shell.
You can run commands in here as normal.
As an example, let&#8217;s run a command that never ends, <code>top</code>.</p>
</div>
<div class="paragraph">
<p>We can now disconnect from this screen session and return to our regular command prompt with the key combination <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>a</kbd>+<kbd>d</kbd></span>.</p>
</div>
<div class="paragraph">
<p>If we now list our current sessions, we should see one listed:</p>
</div>
<div class="paragraph">
<p><code>screen -ls</code></p>
</div>
<div class="paragraph">
<p>We can reconnect to our most recent screen session with the command:</p>
</div>
<div class="paragraph">
<p><code>screen -r</code></p>
</div>
<div class="paragraph">
<p>This will get us back into our session, where <code>top</code> is still running, just like we left it.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s end this session by typing <code>q</code> to quit out of <code>top</code>, and get our shell back within our screen session, and then <code>exit</code> to end the screen session.</p>
</div>
<div class="paragraph">
<p>You may want to use different screen sessions for different tasks, in which case it makes sense to give them human-friendly names.
You can create a named session with the following command (replacing <code>SESSION_NAME</code> with the name you would like to give the session):</p>
</div>
<div class="paragraph">
<p><code>screen -S SESSION_NAME</code></p>
</div>
<div class="paragraph">
<p>At a later time, you can then reconnect to that session with:</p>
</div>
<div class="paragraph">
<p><code>screen -r SESSION_NAME</code></p>
</div>
<div class="paragraph">
<p>Let&#8217;s create a named session for top:</p>
</div>
<div class="paragraph">
<p><code>screen -S top</code></p>
</div>
<div class="paragraph">
<p>In this session, start top:</p>
</div>
<div class="paragraph">
<p><code>top</code></p>
</div>
<div class="paragraph">
<p>Now, disconnect from the session (<span class="keyseq"><kbd>Ctrl</kbd>+<kbd>a</kbd>+<kbd>d</kbd></span>).</p>
</div>
<div class="paragraph">
<p>You can see that the session has been named:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">$</span><span style="color: #bbbbbb"> </span>screen <span style="color: #000080">-ls</span>
<span style="color: #888888">There is a screen on:
6125.top (Detached)
1 Socket in /var/folders/0f/8m9p9bj556394xd50jl4g_340000gn/T/.screen.

</span><span style="color: #555555">$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>(The number before the name is the process ID for the session.)</p>
</div>
<div class="paragraph">
<p>We can now re-connect to our named session with:</p>
</div>
<div class="paragraph">
<p><code>screen -r top</code></p>
</div>
<div class="paragraph">
<p>By default, each screen can only be attached to by one client at a time.
If you try to attach to a screen session that already has a client attached, you will not succeed.</p>
</div>
<div class="paragraph">
<p>When you use screen over SSH, you can easily end up in a situation where you have accidentally left yourself attached to a session on a computer at home or in the office, and you now need to attach to that same session from your laptop while out and about.</p>
</div>
<div class="paragraph">
<p>When you find yourself in this situation, you have two choices&#8201;&#8212;&#8201;you can use the <code>-d</code> flag to remotely detach the other client, e.g.
<code>screen -rd SCREEN_NAME</code>, or, you can choose to share the session in real-time using the <code>-x</code> flag, e.g.
<code>screen -rx SCREEN_NAME</code>.
You can test both of these behaviours on a single machine by opening two terminal windows.
In the first window, start a named session with: <code>screen -S test</code>.
In the second terminal window, try to attach to this session with just the <code>-r</code> flag: <code>screen -r test</code>.
You will get an error something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">$</span><span style="color: #bbbbbb"> </span>screen <span style="color: #000080">-r</span> <span style="color: #0086B3">test</span>
<span style="color: #888888">There is a screen on:
	31366.test	(Attached)
There is no screen to be resumed matching test.
</span><span style="color: #555555">$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s now try the first of our options by entering the following in the second terminal window:</p>
</div>
<div class="paragraph">
<p><code>screen -rd test</code></p>
</div>
<div class="paragraph">
<p>Notice that the screen session in the first window was detached.</p>
</div>
<div class="paragraph">
<p>Finally, let&#8217;s use the first window to try our second option, sharing the session.
In the first, now detached terminal window, enter:</p>
</div>
<div class="paragraph">
<p><code>screen -rx test</code></p>
</div>
<div class="paragraph">
<p>Notice that now, both terminal windows are seeing the same session, and they are sharing it in real time. If you type in one, you&#8217;ll see yourself in the other!</p>
</div>
<div class="paragraph">
<p>As well as allowing you to have multiple sessions, <code>screen</code> also allows you to have multiple virtual windows within each session.
When in a screen session, you can create a new window with the key combination <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>a</kbd>+<kbd>c</kbd></span> (for create).
You&#8217;ll see that gives us a new window.
You can toggle between the two most recent windows within a session with <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>a</kbd></span> twice in a row.
If you have more than two windows you&#8217;ll need to use either <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>a</kbd>+<kbd>n</kbd></span> (for next) to move forward through the windows, or <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>a</kbd>+<kbd>p</kbd></span> (for previous) to move backwards through the windows.
To see a list of your windows in the bottom left of the terminal, press <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>a</kbd>+<kbd>w</kbd></span> (this will not work if you are in an app that is constantly rewriting the screen like <code>top</code>).
Windows are numbered from zero, and your current window is indicated with a <code>*</code> after the number.</p>
</div>
<div class="paragraph">
<p>Personally, I find virtual windows within virtual screens much too confusing, so I never use this feature.
Some people do find it very useful though, so I thought it was worth mentioning in case it is of use to some.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_cron_utility">The <code>cron</code> Utility</h3>
<div class="paragraph">
<p>Unix/Linux systems, including OS X, use a system known as <code>cron</code> for automating the repeated execution of tasks.
The rules of the repetition are extremely flexible, and as a result, the syntax can be a little daunting at first.</p>
</div>
<div class="paragraph">
<p>The way the cron system works is that each user may define a so-called <em>crontab</em>, which is a table listing tasks to be run, and defining when they should be run.
Tasks, or jobs, in a user&#8217;s crontab, will run as that user, but with a very minimal environment.
Any output sent to <code>STDOUT</code> or <code>STDERR</code> by a cron job will be emailed to the user using the local mail exchanger.
On modern OS X desktops, that means it goes into your user&#8217;s Unix mailbox, which you do not see in Mail.app, and probably have no idea exists.
We&#8217;ll look in more detail at what to do with the output from cron jobs later.</p>
</div>
<div class="paragraph">
<p>To see your crontab, simply run the command <code>crontab -l</code> (for list).
Unless you have added something to your cron previously, this command probably returns nothing.</p>
</div>
<div class="paragraph">
<p>You can edit your crontab with the command <code>crontab -e</code> (for edit).
This will open your crontab with your system&#8217;s default text editor (probably <code>vi</code>, which we learned about in <a href="#ttt11">instalment 11</a>).
Your cron jobs need to be specified one per line in a special format.</p>
</div>
<div class="paragraph">
<p>First, you specify when the command should be run as five space-delimited time specifiers, then you add another space, and then you add the command to be run, along with all its arguments.
The five time-specifiers tend to be the cause of people&#8217;s confusion when it comes to the crontab.</p>
</div>
<div class="paragraph">
<p>The way it works is that every minute, every cron job who&#8217;s five-part time specifier matches the current time gets executed.</p>
</div>
<div class="paragraph">
<p>Lines in the crontab starting with <code>#</code> are comment lines, that is to say, <code>cron</code> ignores them.
Blank lines are also ignored.</p>
</div>
<div class="paragraph">
<p>As well as lines starting with time specifiers and comment lines, a crontab can also contain a number of special command lines.
We&#8217;ll see some of these later in this instalment.</p>
</div>
<div class="sect3">
<h4 id="_specifying_when">Specifying When</h4>
<div class="paragraph">
<p>The five parts to the time specifier are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Minute (0-59)</p>
</li>
<li>
<p>Hour (0-23)</p>
</li>
<li>
<p>Day of Month (1-31)</p>
</li>
<li>
<p>Month (1-12)</p>
</li>
<li>
<p>Day of Week (0-6, with Sunday as zero)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For each of these five specifiers, you can enter a number, or, the character <code>*</code>, which is interpreted to mean <em>any</em>.</p>
</div>
<div class="paragraph">
<p>So, to run a command on-the-hour-every-hour, you would use the specifier:</p>
</div>
<div class="paragraph">
<p><code>0 * * * *</code></p>
</div>
<div class="paragraph">
<p>This will match when the minutes are exactly zero, the hour is anything, the day of the month is anything, the month is anything, and the day of the week is anything.</p>
</div>
<div class="paragraph">
<p>To run a command at 4:30 am on the first of every month you would use the specifier:</p>
</div>
<div class="paragraph">
<p><code>30 4 1 * *</code></p>
</div>
<div class="paragraph">
<p>In other words, the specifier will match when the minute is 30, the hour is 4, the day of the month is 1, the month is anything, and the day of the week is anything.</p>
</div>
<div class="paragraph">
<p>As well as taking single numbers, each of the five parts of the specifier can take multiple comma-separated values and ranges (don&#8217;t add spaces after the commas).
So, to run a task at 8 am and 8 pm every weekday you would use the specifier:</p>
</div>
<div class="paragraph">
<p><code>0 8,20 * * 1-5</code></p>
</div>
<div class="paragraph">
<p>That is, when the minute is zero, the hour is 8 or 20, any day of the month, any month, and the day of the week is between 1 and 5 inclusive, i.e.
Monday to Friday.</p>
</div>
<div class="paragraph">
<p>Finally, you can use the <code>*/n</code> syntax to specify that something should happen every <code>n</code> minutes (or hours etc.)
To run a command every two minutes you would use the specifier:</p>
</div>
<div class="paragraph">
<p><code>*/2 * * * *</code></p>
</div>
<div class="paragraph">
<p>As a final example, to run a command every two minutes during business hours on weekdays you would use the following specifier:</p>
</div>
<div class="paragraph">
<p><code>*/2 9-18 * * 1-5</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_dealing_with_output">Dealing with Output</h4>
<div class="paragraph">
<p>By default, all output to either <code>STDOUT</code> or <code>STDERR</code> will get emailed to the local Unix mailbox for the user that owns the crontab.
You can specify a different email address to send the output to with the special <code>MAILTO</code> command.
The format is very simple (replacing <code>an.email@addre.ss</code> with the actual email address output should be emailed to):</p>
</div>
<div class="paragraph">
<p><code>MAILTO <a href="mailto:an.email@addre.ss">an.email@addre.ss</a></code></p>
</div>
<div class="paragraph">
<p>A single crontab can specify multiple different <code>MAILTO</code> commands.
The way it works is that all defined cron jobs use the <code>MAILTO</code> definition that precedes them most closely.
You should consider the top of the file to have an implicit <code>MAILTO</code> command of the form:</p>
</div>
<div class="paragraph">
<p><code>MAILTO username@localhost</code></p>
</div>
<div class="paragraph">
<p>If both your ISP and the email provider hosting the target email address are accommodating, this will work from your desktop or laptop.
It does for me.
However, many ISPs and many mail servers will reject email coming from home IP addresses rather than trusted mail servers.</p>
</div>
<div class="paragraph">
<p>If you definitely want to use email, you have two options.
Firstly, OS X uses the open source MTA (Mail Transfer Agent) <a href="http://www.postfix.org">Postfix</a>, so you could re-configure postfix to use a mail relay to send the emails on your behalf.
In the past, many ISPs provided an SMTP server for their customers to use, so if your ISP does, this is at least a plausible option.
This is not for the faint-hearted though&#8201;&#8212;&#8201;you&#8217;ll need to take the time to familiarise yourself with Postfix and to learn what the different settings in the config file do.</p>
</div>
<div class="paragraph">
<p>Your second option is to use the built-in command-line mail client in OS X to read your Unix inbox directly.
The command is <code>mail</code>, and there is a man page explaining how it works.
This works, but it&#8217;s quite clunky.</p>
</div>
<div class="paragraph">
<p>If email doesn&#8217;t "just work" for you, my advice would be to change tack and use stream redirection (as described in instalments <a href="#ttt15">15</a> and <a href="#ttt16">16</a>) instead.
This is the approach we will use in our examples in this instalment.</p>
</div>
</div>
<div class="sect3">
<h4 id="_a_simple_cron_example">A simple cron Example</h4>
<div class="paragraph">
<p>To see cron in action, let&#8217;s create a simple crontab that will write the current time to a text file every 2 minutes.
The terminal command to see the current date and time is <code>date</code>.
We&#8217;ll write our file to a location that is universally writeable on all Macs&#8201;&#8212;&#8201;the temporary folder, <code>/tmp</code>.</p>
</div>
<div class="paragraph">
<p>To edit your crontab, run the command <code>crontab -e</code>.
You are now in <code>vi</code>.
Enter insert mode by pressing the <code>i</code> key.</p>
</div>
<div class="paragraph">
<p>Enter the following:</p>
</div>
<div class="paragraph">
<p><code>*/2 * * * * /bin/date &gt;&gt; /tmp/crontest.log</code></p>
</div>
<div class="paragraph">
<p>Exit insert mode by hitting the escape key.
Save the crontab by typing <code>:wq</code> and then enter/return.</p>
</div>
<div class="paragraph">
<p>Verify that your crontab has been saved with <code>crontab -l</code>.</p>
</div>
<div class="paragraph">
<p>Now watch for the output to the file with:</p>
</div>
<div class="paragraph">
<p><code>tail -f /tmp/crontest.log</code></p>
</div>
<div class="paragraph">
<p>Every two minutes you should see the current date and time be appended to the file.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cron_the_environment">Cron &amp; the Environment</h4>
<div class="paragraph">
<p>You may notice that I used the full path to the <code>date</code> command in the above example.
The reason for this is that cron executes your cron jobs with a very minimal environment.
As we learned in <a href="#ttt12">instalment 12</a>, you can see the content of your environment in a regular shell with the command <code>env</code>.
To see what the environment looks like from cron&#8217;s point of view, add the following to your crontab, then wait for at least two minutes:</p>
</div>
<div class="paragraph">
<p><code>*/2 * * * * /usr/bin/env &gt; /tmp/cronenv.txt</code></p>
</div>
<div class="paragraph">
<p>When more than two minutes have passed, you should see a copy of the environment from the point of view of a cron job with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
</pre></td><td class="code"><pre><span style="color: #555555">$</span><span style="color: #bbbbbb"> </span><span style="color: #0086B3">cat</span> /tmp/cronenv.txt
<span style="color: #888888">SHELL=/bin/sh
USER=bart
PATH=/usr/bin:/bin
PWD=/Users/bart
SHLVL=1
HOME=/Users/bart
LOGNAME=bart
_=/usr/bin/env
</span><span style="color: #555555">$</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that while there is a <code>PATH</code> environment variable, it has very little in it.
This is why you are best off always using full paths when executing commands via cron.</p>
</div>
<div class="paragraph">
<p>You can set environment variables in the crontab.
You simply assign them on a line by themselves.
We can add a new variable by adding a line like:</p>
</div>
<div class="paragraph">
<p><code>DUMMY_ENVIRONMENT_VARIABLE=boogers</code></p>
</div>
<div class="paragraph">
<p>The definition needs to be earlier in the crontab than the cron jobs that will use the variable.
If you edit your crontab so it contains the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #008080">DUMMY_ENVIRONMENT_VARIABLE</span><span style="color: #000000;font-weight: bold">=</span>boogers
<span style="color: #000000;font-weight: bold">*</span>/2 <span style="color: #000000;font-weight: bold">*</span> <span style="color: #000000;font-weight: bold">*</span> <span style="color: #000000;font-weight: bold">*</span> <span style="color: #000000;font-weight: bold">*</span> /usr/bin/env <span style="color: #000000;font-weight: bold">&gt;</span> /tmp/cronenv.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then wait at least two minutes, and then run the command:</p>
</div>
<div class="paragraph">
<p><code>cat /tmp/cronenv.txt</code></p>
</div>
<div class="paragraph">
<p>You should now see your new variable has indeed been added to your cron job&#8217;s environment.</p>
</div>
<div class="paragraph">
<p>You could use this technique to set your own value for the <code>PATH</code> environment variable.
My preference is not to alter the <code>PATH</code> within the crontab, but to always use full paths in my cron jobs.
That seems a more robust and explicit approach to me.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_final_thoughts_8">Final Thoughts</h3>
<div class="paragraph">
<p>In this instalment, we&#8217;ve seen how to use <code>screen</code> to create persistent virtual terminals that can be disconnected from and reconnected to later, and how to use <code>cron</code> to schedule periodic tasks.
This is the first taming the terminal in some time, and will probably be the last one for a while too.
There will be more instalments, but not at regular intervals.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt37">TTT Part 37 of n &#8212; SSH Agents</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since we covered SSH in parts <a href="#ttt29">29</a> &amp; <a href="#ttt30">30</a>, Apple has changed how their desktop OS deals with the passphrases protecting SSH identities (key pairs).
This provides us with a good opportunity to have a look at the SSH Agent in general, and, how things have changed on the Mac in particular.</p>
</div>
<div class="paragraph">
<p>The good news is that while things have changed on the Mac, with a small amount of effort, you can get back all the convenience and security you had before.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Quick Links</div>
<div class="ulist none">
<ul class="none">
<li>
<p><a href="#Revision_SSH_Identities">1 Revision&#8201;&#8212;&#8201;SSH Identities</a></p>
</li>
<li>
<p><a href="#SSH_Agents">2 SSH Agents</a></p>
<div class="ulist none">
<ul class="none">
<li>
<p><a href="#It8217s_All_About_the_ssh-add_Command">2.1 It&#8217;s All About the ssh-add Command</a></p>
</li>
<li>
<p><a href="#Loading_Identities_into_an_SSH_Agent">2.2 Loading Identities into an SSH Agent</a></p>
</li>
<li>
<p><a href="#Removing_Identities_from_an_SSH_Agent">2.3 Removing Identities from an SSH Agent</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#SSH_Agent_on_OS_X_038_macOS">3 SSH Agent on OS X &amp; macOS</a></p>
<div class="ulist none">
<ul class="none">
<li>
<p><a href="#Changes_in_macOS_Sierra">3.1 Changes in macOS Sierra</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#Final_Thoughts">4 Final Thoughts</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 37</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 37</p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/ttt-37-ssh-agents_202004/TTT_37_SSH_Agents.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_37.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also
<a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/ttt-37-ssh-agents_202004/TTT_37_SSH_Agents.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Revision_SSH_Identities">Revision &#8212; SSH Identities</h3>
<div class="paragraph">
<p>As a quick reminder&#8201;&#8212;&#8201;SSH can authenticate users in many ways.
The two most common are passwords, and so-called <em>SSH identities</em> (sometimes referred to as <em>SSH keys</em>).
An SSH identity consists of a private key, a matching public key, and some metadata.
The two keys are stored in separate files, and the name of the file containing the public key must be identical to the one for the private key, but with <code>.pub</code> appended to it.
When SSH config files or commands require the path to an identity, what they&#8217;re looking for is the path to the private key&#8217;s file.
SSH identities are created using the <code>ssh-keygen</code> command.</p>
</div>
<div class="paragraph">
<p>SSH has the concept of a default identity.
Wherever an identity can be used, SSH will check a number of pre-defined file paths (in a pre-defined order) for a valid identity file, and use the first one it finds.
Today, using the most modern versions of SSH and the default key algorithms, that effectively means that your default identity is <code>~/.ssh/id_rsa</code> (and <code>~/.ssh/id_rsa.pub</code>).</p>
</div>
<div class="paragraph">
<p>As with any cryptographic system based on public &amp; private keys, your security completely depends on keeping the private key secret, and the publication of your public key has no impact on your security at all.
That means that the half of the identity that doesn&#8217;t end in <code>.pub</code> is the crown jewels, and you are free to share the half that does end in <code>.pub</code> freely.</p>
</div>
<div class="paragraph">
<p>No sysadmin should ever ask you for your private key; they should only ever need your public key.
If you want to be granted access to a computer, you give the person who manages that computer your public key, they grant access to that key, and you can then log on from the computer that had the matching private key.</p>
</div>
<div class="paragraph">
<p>To protect your private key, SSH identity files support passphrase-based encryption.
The actual values stored in the files can be the result of encrypting the private key with a passphrase.
The ssh-keygen command will allow you to set a blank password on an identity, but it very much encourages you not to do that, and to set a good, secure passphrase.</p>
</div>
<div class="paragraph">
<p>If you follow best practice and do indeed set a passphrase on your identity, SSH will prompt you for that passphrase whenever it needs the private key part of that identity.
This gets very tedious very quickly, and that&#8217;s where the SSH Agent comes in.</p>
</div>
</div>
<div class="sect2">
<h3 id="SSH_Agents">SSH Agents</h3>
<div class="paragraph">
<p>The SSH Agent&#8217;s <em>raison d&#8217;être</em> is to take the pain out of using passphrase-protected SSH identities.
SSH Agents securely cache the decrypted private keys belonging to SSH identities.
SSH Agent processes are generally not shared between users. In fact, they&#8217;re generally not even shared between login sessions.
When I log into my Mac, a new SSH Agent is automatically started, and that specific SSH Agent is only accessible by apps or commands that I start within that login session.
SSH Agents don&#8217;t store anything permanently&#8201;&#8212;&#8201;they forget everything as soon as they stop running, and logging out will kill the SSH Agent associated with a specific login session.</p>
</div>
<div class="paragraph">
<p>The core SSH libraries are aware of SSH Agents and can communicate with them, so the caching they provide is available to all the SSH-related terminal commands like <code>ssh</code>, <code>scp</code>, <code>sftp</code>, as well as to any GUI apps <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> that make use of the appropriate SSH APIs, for example, both Transmit and SequelPro have SSH Agent support.</p>
</div>
<div class="paragraph">
<p>The exact mechanisms for configuring an SSH Agent to automatically start and stop on login and logout varies from OS to OS, but many desktop Unix/Linux flavours start SSH Agents by default.
Apple has done so on the Mac since Mac OS X 10.5 Leopard.
If you&#8217;re not a Mac user you&#8217;ll need to do a little Googling to figure out what the state of play is on your particular OS.
Note that there are even SSH Agent implementations for Windows.
You can use <a href="https://cygwin.com/">Cygwin</a> to run OpenSSH&#8217;s SSH Agent, or, you can use <code>pageant.exe</code>, an SSH Agent from the people behind the venerable <a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html">PuTTY SSH client</a>.</p>
</div>
<div class="sect3">
<h4 id="It8217s_All_About_the_ssh-add_Command">It&#8217;s All About the <code>ssh-add</code> Command</h4>
<div class="paragraph">
<p>On Linux/Unix systems (including Apple&#8217;s OSes), the SSH Agent is provided by the command <code>ssh-agent</code>, but that&#8217;s not the command you use to interact with your particular SSH Agent.
Instead, all your interaction with your SSH Agent will be via the command <code>ssh-add</code>.</p>
</div>
<div class="paragraph">
<p>Firstly, you can check that you actually have a running SSH Agent associated with your login using the <code>-l</code> flag (for list).
If you do have a running SSH Agent you&#8217;ll either see a list of loaded identities or, a message like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">$</span><span style="color: #bbbbbb"> </span>ssh-add <span style="color: #000080">-l</span>
<span style="color: #888888">The agent has no identities.
</span><span style="color: #555555">$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If no SSH Agent is running you&#8217;ll get an error message something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">$</span><span style="color: #bbbbbb"> </span>ssh-add <span style="color: #000080">-l</span>
<span style="color: #888888">Could not open a connection to your authentication agent.
</span><span style="color: #555555">$</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Loading_Identities_into_an_SSH_Agent">Loading Identities into an SSH Agent</h4>
<div class="paragraph">
<p>You can load your default identity (generally <code>~/.ssh/id_rsa</code>) into your SSH agent with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ssh-add</code></pre>
</div>
</div>
<div class="paragraph">
<p>And, you can add a specific identity with the <code>-a</code> flag, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ssh-add <span style="color: #000080">-a</span> ~/some_ssh_identity_file</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you will be asked to enter the passphrase for each identity as you load it.</p>
</div>
<div class="paragraph">
<p>Once you have one or more identities loaded into your SSH Agent you should see them when you run <code>ssh-add</code> with the <code>-l</code> flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">$</span><span style="color: #bbbbbb"> </span>ssh-add <span style="color: #000080">-l</span>
<span style="color: #888888">2048 SHA256:UNP5g9KBBOfqi2RYrtY2aGILNbcvp2pe23+38Ignvsc /Users/bart/.ssh/id_rsa (RSA)
</span><span style="color: #555555">$</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Removing_Identities_from_an_SSH_Agent">Removing Identities from an SSH Agent</h4>
<div class="paragraph">
<p>Counter-intuitively, you also use the <code>ssh-add</code> command to remove identities from your SSH Agent.
You can remove just your default identity by passing only the <code>-d</code> flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">$</span><span style="color: #bbbbbb"> </span>ssh-add <span style="color: #000080">-d</span>
<span style="color: #888888">Identity removed: /Users/bart/.ssh/id_rsa (bart@localhost)
</span><span style="color: #555555">$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can remove other identities by passing the path to the file representing the identity in question as an argument after the <code>-d</code> flag, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">ssh-add <span style="color: #000080">-d</span> ~/some_ssh_identity_file</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also remove all identities at once with the <code>-D</code> flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">$</span><span style="color: #bbbbbb"> </span>ssh-add <span style="color: #000080">-D</span>
<span style="color: #888888">All identities removed.
</span><span style="color: #555555">$</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="SSH_Agent_on_OS_X_038_macOS">SSH Agent on OS X &amp; macOS</h3>
<div class="paragraph">
<p>Since Mac OS X 10.5 Leopard, Apple has integrated SSH Agents into their OS.
When you log in to a Mac, you&#8217;ll find an SSH Agent running and ready to accept identities.
As well as taking care of starting and stopping an agent for each user on login and logout, Apple also added their own additional features to the standard SSH Agent from OpenSSH to allow it to integrate with the OS&#8217;s Keychain feature.
This allows the passphrase for SSH identities to be safely stored in the Keychain, and easily flowed from there to your SSH Agent as needed.</p>
</div>
<div class="paragraph">
<p>In versions of Apple&#8217;s OS from Mac OS X 10.5 Leopard up to and including OS X 10.11 El Capitan, Apple completely automated the integration between the Keychain and the SSH Agent&#8201;&#8212;&#8201;it just worked.
No setup, no configuration, no user action at all, it just made users&#8217; lives easier!</p>
</div>
<div class="paragraph">
<p>Each time SSH on a Mac tried to load an encrypted SSH identity it would try to find the matching passphrase in the user&#8217;s Login keychain, if found, the passphrase would be used to decrypt the private key, which SSH would then cache in the user&#8217;s SSH Agent.
From the user&#8217;s point of view, this meant that if the passphrase for an SSH identity was in their keychain, they could use that identity without ever being asked to enter their passphrase.
If the needed passphrase was not found in the Keychain, the OS would pop up a GUI dialogue box requesting the passphrase, and, providing a tick box to save the passphrase into the Keychain if desired.</p>
</div>
<div class="paragraph">
<p>From a user&#8217;s point of view this meant that if you ticked the box to save the passphrase once, you&#8217;d never need to enter it ever again.</p>
</div>
<div class="sect3">
<h4 id="Changes_in_macOS_Sierra">Changes in macOS Sierra</h4>
<div class="paragraph">
<p>This behaviour was very convenient, but also completely non-standard.
Other Unix/Linux OSes don&#8217;t behave like this.
And, as of macOS 10.12 Sierra, neither does Apple&#8217;s OS!
The core abilities haven&#8217;t changed, but the integration with the Keychain is no longer enabled by default.</p>
</div>
<div class="paragraph">
<p>MacOS Sierra still automatically starts an SSH Agent when you log in and shuts it down when you log out, so there&#8217;s still an SSH Agent waiting for you by default.
However, by default, that SSH Agent won&#8217;t go looking for passphrase in your keychain, nor will it save any passphrase you do enter into your Keychain.</p>
</div>
<div class="paragraph">
<p>The integration isn&#8217;t gone though, it&#8217;s just dormant by default.</p>
</div>
<div class="paragraph">
<p>If you only want the integration between your Keychain and your SSH Agent every now and then, Apple provides a quick and easy way to load all SSH identities for which there are passphrases in your keychain into your SSH Agent&#8201;&#8212;&#8201;simply call <code>ssh-add</code> with the <code>-A</code> flag.
I keep the passphrase for just one SSH key in my keychain (the one for my default key), so when I load all identities from my keychain, this is what I see:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">$</span><span style="color: #bbbbbb"> </span>ssh-add <span style="color: #000080">-A</span>
<span style="color: #888888">Identity added: /Users/bart/.ssh/id_rsa (/Users/bart/.ssh/id_rsa)
</span><span style="color: #555555">$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>How is this different to <code>ssh-add</code> with no arguments?
Let&#8217;s see&#8201;&#8212;&#8201;I&#8217;ll empty the SSH Agent, and re-add the same identity without using the Keychain integration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">$</span><span style="color: #bbbbbb"> </span>ssh-add <span style="color: #000080">-D</span>
<span style="color: #888888">All identities removed.
</span><span style="color: #555555">$</span><span style="color: #bbbbbb"> </span>ssh-add
<span style="color: #888888">Enter passphrase for /Users/bart/.ssh/id_rsa:
Identity added: /Users/bart/.ssh/id_rsa (/Users/bart/.ssh/id_rsa)
</span><span style="color: #555555">$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that without the Keychain integration, I have to enter my passphrase.</p>
</div>
<div class="paragraph">
<p>Initially, when macOS Sierra first shipped and people started to notice that their SSH identities were no longer automatically loading into their SSH Agents using the passphrases in their keychains, the internet was full of people insisting that the <code>ssh-add -A</code> command was the only solution.
Many people also suggested that the only way to automate the integration between your keychain and your SSH Agent was to add this command into one of your shell&#8217;s startup files, e.g.
<code>~/.bash_profile</code>.
I&#8217;m happy to tell you that these people were mistaken and that you shouldn&#8217;t follow their advice.</p>
</div>
<div class="paragraph">
<p>You&#8217;ll be happy to learn that Apple has provided an official, documented, mechanism for enabling the integration between your keychain and your SSH Agent.
What the internet mavens offering their poor advice had failed to do was RTFM (Read The <em>Fine</em> Manual):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">man ssh_config</code></pre>
</div>
</div>
<div class="paragraph">
<p>Don&#8217;t worry, I&#8217;ll summaries the relevant bits for you&#8201;&#8212;&#8201;with macOS Sierra, Apple introduced two new SSH configuration options for controlling the integration between the SSH Agent and the Keychain.
Both of these options can be specified in your <code>~/.ssh/config</code> file.</p>
</div>
<div class="paragraph">
<p>The first option, <code>UseKeychain</code>, controls the flow of passphrases from the SSH Agent to your Keychain&#8201;&#8212;&#8201;setting this option to <code>yes</code> will cause all passphrases entered into your SSH Agent to be stored in your Login keychain.</p>
</div>
<div class="paragraph">
<p>The second option, <code>AddKeysToAgent</code>, controls the auto-fetching of passphrases from the Keychain by the SSH Agent as required.
The two valid values for this option are <code>yes</code> and <code>no</code>.</p>
</div>
<div class="paragraph">
<p>So, to restore the old pre-macOS behaviour, edit your <code>~/.ssh/config</code> file so it contains the following (the first line is just a comment and has no effect on the OS&#8217;s actual behaviour):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #999988;font-style: italic"># enable integration between Keychain and SSH Agent</span>
UseKeychain <span style="color: #0086B3">yes
</span>AddKeysToAgent <span style="color: #0086B3">yes</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once that&#8217;s done, log out and log back in, and all should be as it was under El Capitan.</p>
</div>
<div class="paragraph">
<p>We can verify that everything is working as it should, and, that the loading of keys happens on-demand, not on login, with a little experiment.</p>
</div>
<div class="paragraph">
<p>Start by logging out and then back in.
At this point, you should have a running SSH Agent, but it should contain no identities.
You can verify this with the <code>ssh-add -l</code> command.</p>
</div>
<div class="paragraph">
<p>Next, SSH to a server which you have configured to use an encrypted SSH identity.
The first thing you should notice is that you get logged in to the server without needing to enter your passphrase&#8201;&#8212;&#8201;the <code>ssh</code> command tried to load your identity from disk, but found the private key to be encrypted, so it asked your SSH Agent if it had a cached copy of the private key, which it didn&#8217;t, so it asked your keychain if it had the passphrase for the relevant identity, which it did, so it decrypted and cached the private key, and then passed it back to the <code>ssh</code> command, which logged you into the server.
You can verify that the identity has been cached in your SSH Agent with the <code>ssh-add -l</code> command.</p>
</div>
<div class="paragraph">
<p>One final thing to note is that the GUI for entering SSH identity passphrases has been removed from macOS Sierra.
This means that you may have to explicitly add your identity to your SSH Agent once using the <code>ssh-add</code> command, even if you enable keychain integration.</p>
</div>
<div class="paragraph">
<p>You&#8217;ll find more detailed information about the SSH Agent-related changes Apple made in macOS Sierra in <a href="https://developer.apple.com/library/content/technotes/tn2449/_index.html">Apple Technical Note TN2449</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Final_Thoughts">Final Thoughts</h3>
<div class="paragraph">
<p>Regardless of your OS, you can make use of an SSH Agent to avoid having to re-enter passwords for SSH identities over and over again.
This is true on all OSes, even Windows.
This is yet another reason to stop using password-less SSH identities&#8201;&#8212;&#8201;with an SSH Agent, you can have both security and convenience!</p>
</div>
<div class="paragraph">
<p>And, for all you Mac users like me who were cranky at the loss of the automated integration between the Keychain and the SSH Agent in macOS Sierra, you&#8217;ve now got a robust and supported fix.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt38">TTT Part 38 of n &#8212; TMUX (A Screen Alternative)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since we covered the <code>screen</code> command in <a href="#ttt36">instalment 36</a>, it has been deprecated in Red Enterprise Linux 8, and <a href="https://access.redhat.com/solutions/4136481">the official advice from Red Hat</a> is to transition to the <code>tmux</code> command. Having been a fan of <code>screen</code> for years, I was skeptical, but I shouldn&#8217;t have been. <code>tmux</code> can do everything <code>screen</code> can, it can arguably do it better, and, it can do much more than <code>screen</code> ever could!</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 38</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 38<br>
part of  <a href="https://www.podfeet.com/blog/2020/07/ccatp-645/">episode 645 of the Chit Chat Across the Pond Podcast</a></p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/ttt-38-tmux/TTT_38_TMUX.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_38.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also
<a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/ttt-38-tmux/TTT_38_TMUX.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>As you may remember, the <code>screen</code> command allows you to create a command line session that continues to run after you close your terminal window or disconnect from your SSH session. At a later time you can then reconnect to the still-running screen session and pick up where you left off. This is very useful for executing long-running commands, and for working on a remote server over a spotty internet connection.</p>
</div>
<div class="paragraph">
<p>It&#8217;s very easy to use <code>tmux</code> to achieve exactly the same result, and the commands are arguably simpler&#8201;&#8212;&#8201;the arguments are certainly a lot more sensible and obvious anyway. 🙂</p>
</div>
<div class="sect2">
<h3 id="_sessions_windows_and_panes">Sessions, Windows, and Panes</h3>
<div class="paragraph">
<p>The <code>screen</code> command works on a very simplistic model&#8201;&#8212;&#8201;each virtual terminal is a session, and you can have as many sessions as you like. By default <code>screen</code> sessions are numbered, but you can name them for your convenience.</p>
</div>
<div class="paragraph">
<p>The <code>tmux</code> command expands this model by introducing the concepts of <em>windows</em> and <em>panes</em> within numbered or optionally named <em>sessions</em>. The name <code>tmux</code> is a portmanteau of <em>terminal multiplexer</em>, so it&#8217;s built around the idea of running multiple terminals within a single visible window.</p>
</div>
<div class="paragraph">
<p><em>tmux sessions</em> contain one or more <em>tmux windows</em> each of which contain one or more <em>tmux panes</em>. A <em>tmux pane</em> is a command shell. You can tile these panes into <em>tmux windows</em>, and you can stack these <em>tmux windows</em> one on top of the other within <em>tmux sessions</em>.</p>
</div>
<div class="paragraph">
<p>It&#8217;s unfortunate that <code>tmux</code> chose to re-use the word <em>window</em>, because it already has a meaning within GUI operating systems, so it often leads to confusion. I find it helpful to think of <em>tmux windows</em> as being like browser tabs&#8201;&#8212;&#8201;multiple full-page vertically stacked windows-within-a-window. Like a single browser window stacks multiple tabs on top of each other, a single <em>tmux session</em> stacks multiple <em>tmux windows</em> on top of each other.</p>
</div>
<div class="paragraph">
<p>If this all sounds too complicated, don&#8217;t worry, a default <code>tmux</code> session contains a single window which contains a single pane. In other words, <strong>by default</strong> <code>tmux</code> <strong>behaves like</strong> <code>screen</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installing_tmux">Installing <code>tmux</code></h3>
<div class="paragraph">
<p>On Linux <code>tmux</code> will almost certainly be available from your distribution&#8217;s standard package manager, so for people on RHEL-flavoured distros it will probably be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">sudo </span>yum <span style="color: #0086B3">install </span>tmux</code></pre>
</div>
</div>
<div class="paragraph">
<p>And for Debian-flavoured distros probably:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">sudo </span>apt-get <span style="color: #0086B3">install </span>tmux</code></pre>
</div>
</div>
<div class="paragraph">
<p>On macOS we&#8217;ll need to use a third-party package manager like <a href="https://brew.sh">Homebrew</a> to easily install <code>tmux</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">brew <span style="color: #0086B3">install </span>tmux</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_tmux_command">The <code>tmux</code> Command</h3>
<div class="paragraph">
<p>Regardless of what you&#8217;re trying to do with <code>tmux</code>, the command will generally be of the form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">tmux COMMAND <span style="color: #000000;font-weight: bold">[</span>OPTIONS]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>COMMAND</code> is one of the many <code>tmux</code> commands listed in the extensive manual page (<code>man tmux</code>), and <code>OPTIONS</code> are optional extra flags to pass information to the specified command.</p>
</div>
<div class="paragraph">
<p>The <code>tmux</code> commands are very descriptively named, which  makes them easy to read but hard to type, so <code>tmux</code> provides short aliases for the most commonly used commands, e.g. <code>lscm</code> is an alias for the extremely convenient <code>list-commands</code> which lists all the commands <code>tmux</code> supports, or, gives details on a specific command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac2018:~ bart%</span><span style="color: #bbbbbb"> </span>tmux lscm
<span style="color: #888888">attach-session (attach) [-dErx] [-c working-directory] [-t target-session]
bind-key (bind) [-nr] [-T key-table] [-N note] key command [arguments]
break-pane (breakp) [-dP] [-F format] [-n window-name] [-s src-pane] [-t dst-window]
capture-pane (capturep) [-aCeJNpPq] [-b buffer-name] [-E end-line] [-S start-line] [-t target-pane]
</span><span style="color: #999988;font-style: italic">...
</span><span style="color: #888888">unbind-key (unbind) [-an] [-T key-table] key
unlink-window (unlinkw) [-k] [-t target-window]
wait-for (wait) [-L|-S|-U] channel

</span><span style="color: #555555">bart-imac2018:~ bart%</span><span style="color: #bbbbbb"> </span>tmux lscm rename-session
<span style="color: #888888">rename-session (rename) [-t target-session] new-name
</span><span style="color: #555555">bart-imac2018:~ bart%</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_managing_sessions">Managing Sessions</h3>
<div class="paragraph">
<p>Let&#8217;s start our exploration of <code>tmux</code> at the highest level&#8201;&#8212;&#8201;the session.</p>
</div>
<div class="sect3">
<h4 id="_listing_sessions_creating_joining_sessions">Listing Sessions Creating &amp; Joining Sessions</h4>
<div class="paragraph">
<p>Before we create our first session, let&#8217;s learn how to list the currently running sessions. The command is <code>list-sessions</code>, but it has the convenient alias <code>ls</code>.</p>
</div>
<div class="paragraph">
<p>When you have no sessions running you should expect to see something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac2018:~ bart%</span><span style="color: #bbbbbb"> </span>tmux <span style="color: #0086B3">ls</span>
<span style="color: #888888">no server running on /private/tmp/tmux-501/default
</span><span style="color: #555555">bart-imac2018:~ bart%</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The default command is <code>new-session</code>, or <code>new</code>, so to create an un-named new session and attach to it (<code>tmux</code> jargon for connect), simply run <code>tmux</code> with no arguments.</p>
</div>
<div class="paragraph">
<p>You&#8217;ll now find yourself inside a <code>tmux</code> session. Leave this session alone for now, and open another terminal window.</p>
</div>
<div class="paragraph">
<p>From this new terminal we can see that we now have a single running <code>tmux</code> session numbered <code>0</code> with no name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac2018:~ bart%</span><span style="color: #bbbbbb"> </span>tmux <span style="color: #0086B3">ls</span>
<span style="color: #888888">0: 1 windows (created Sat Jul 11 12:39:56 2020) (attached)
</span><span style="color: #555555">bart-imac2018:~ bart%</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When reading this output, note that the session&#8217;s name is the very first line in the output. Since we didn&#8217;t give our session a human-friendly name, it defaulted to the very computery <code>0</code>! We can also see that the session contains one window, the date it was created. The <code>(attached)</code> suffix tells us there is currently a client connected to the session, i.e. our first terminal window.</p>
</div>
<div class="paragraph">
<p><strong>In tmux-jargon connecting to a session is <em>attaching</em>, and disconnecting is <em>detaching</em>.</strong></p>
</div>
<div class="paragraph">
<p>If we run the <code>tmux</code> command again in our second terminal window we will create a new session&#8201;&#8212;&#8201;let&#8217;s go ahead and do that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">tmux</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, go ahead and open a third terminal window and list the sessions again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac2018:~ bart%</span><span style="color: #bbbbbb"> </span>tmux <span style="color: #0086B3">ls</span>
<span style="color: #888888">0: 1 windows (created Sat Jul 11 12:39:56 2020) (attached)
1: 1 windows (created Sat Jul 11 12:47:35 2020) (attached)
</span><span style="color: #555555">bart-imac2018:~ bart%</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can now see that we have two sessions, again, rather un-imaginatively named <code>0</code> and <code>1</code>. 🙂</p>
</div>
<div class="paragraph">
<p>Let&#8217;s now use our third terminal window to join our first session using the <code>attach-session</code> command via its alias <code>attach</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">tmux attach <span style="color: #000080">-t</span> 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you <strong>use the</strong> <code>-t</code> <strong>flag to target a specific session with any session-specific tmux commands</strong>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s do something inside this session, say run the <code>top</code> command with no arguments. Have a look at your first terminal window&#8201;&#8212;&#8201;both windows are now seeing the same session in real time! Switch to the first window and end the top command by pressing <code>q</code>. Not only can both windows see the same session, both are controlling it!</p>
</div>
<div class="paragraph">
<p>Before we move on, notice that while you&#8217;re in a <code>tmux</code> session there is a green status bar at the bottom of your terminal window. This tells you important information about your current session. Here&#8217;s my third terminal window:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt38/Screenshot-2020-07-11-at-12.59.30.png" alt="tmux window">
</div>
</div>
<div class="paragraph">
<p>On the right of the status bar you&#8217;ll see the text <code>"bart-imac2018.localdo" 12:59 11-Jul-20</code>. The part in quotation marks is my Mac&#8217;s hostname (not very imaginative). That&#8217;s not that useful when you&#8217;re running <code>tmux</code> on your local computer, but can it can be very convenient when SSHed into a remote server. You&#8217;ll also see the current date and time, not all that useful, but it can be convenient.</p>
</div>
<div class="paragraph">
<p>On the left of the status bar you&#8217;ll see information about your current session, in this case <code>[0] 0:zsh*</code>. The first part is the name of the session, simply <code>0</code> in this case, and the part after that is the name of the window, and the command executing in that window. Since we only have one window by default, and since we didn&#8217;t name it, it also has the default name <code>0</code>.</p>
</div>
<div class="paragraph">
<p>You&#8217;ll notice that I&#8217;m using zsh as my shell these days rather than bash (more on this in future instalments). If you run the <code>top</code> command again you&#8217;ll see the current command change appropriately.</p>
</div>
</div>
<div class="sect3">
<h4 id="_controlling_the_session_from_the_inside">Controlling The Session From the Inside</h4>
<div class="paragraph">
<p>You&#8217;ll notice that we now have three terminal windows open&#8201;&#8212;&#8201;that&#8217;s literally what a terminal multiplexer is supposed to avoid, so clearly, we&#8217;re missing something!</p>
</div>
<div class="paragraph">
<p>You can issue commands for controlling your <code>tmux</code> session from within your <code>tmux</code> session by first pressing <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> to enter <em>command mode</em>, and then entering your desired command.</p>
</div>
<div class="paragraph">
<p>Notice it&#8217;s <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> <strong>followed by another key</strong>, not <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd>+<kbd>OTHER_KEY</kbd></span>.</p>
</div>
<div class="paragraph">
<p>Once you can enter command mode there are lots of things you can do, but thankfully, most of the really important stuff is mapped to single-key shortcuts. There is even a single-key shortcut to see all the available commands: the question mark. Try pressing <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> then <kbd>?</kbd>. You can now scroll up and down through a list of all the supported commands. When you&#8217;re done being overwhelmed by how much <code>tmux</code> can do, hit the escape key to return to your session. 🙂</p>
</div>
<div class="paragraph">
<p>The single most important shortcut is the one to detach from a session, i.e. to exit out of <code>tmux</code> but leave your session running. To detach from <code>tmux</code> press <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> followed by <kbd>d</kbd>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_naming_sessions">Naming Sessions</h3>
<div class="paragraph">
<p>If you&#8217;re only going to use <code>tmux</code> as a work-around for a spotty internet connection to a server then you&#8217;ll only want one session, so having it named 0 is not a problem. It&#8217;s short and logical, so you&#8217;re not likely to forget it. You would simply connect each time using <code>tmux attach -t 0</code> in fact, when there is only one session you don&#8217;t even have to specify its name, you can simply connect with <code>tmux attach</code>!</p>
</div>
<div class="paragraph">
<p>However, if you&#8217;re going to have multiple sessions, numbers become a real pain to manage. In that situation you really want descriptive names on your sessions to help you remember which is which.</p>
</div>
<div class="sect3">
<h4 id="_naming_a_session_from_within">Naming a Session from Within</h4>
<div class="paragraph">
<p><strong>You can (re)name a session any time from within the session by pressing</strong> <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> <strong>followed by</strong> <kbd>$</kbd><strong>.</strong></p>
</div>
<div class="paragraph">
<p>Practice by re-naming the first session to <code>ttt</code> by pressing <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span>, then <kbd>$</kbd>, then back-space to delete the existing name (<code>0</code>), and finally typing <code>ttt</code> and pressing enter.</p>
</div>
<div class="paragraph">
<p>Notice that the name immediately changes in the status bar. If you now detach from this session with <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> followed by <kbd>d</kbd> you can see the name is also visible in the session listing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">bart-imac2018:~ bart%</span><span style="color: #bbbbbb"> </span>tmux <span style="color: #0086B3">ls</span>
<span style="color: #888888">1: 1 windows (created Sat Jul 11 13:33:05 2020) (attached)
ttt: 1 windows (created Sat Jul 11 13:33:00 2020) (attached)
</span><span style="color: #555555">bart-imac2018:~ bart%</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_naming_sessions_at_creation">Naming Sessions at Creation</h4>
<div class="paragraph">
<p>We can name a new session as we create it with the <code>-s</code> flag. Using the terminal window we just used for the session listing, let&#8217;s make a new named session:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">tmux new <span style="color: #000080">-s</span> ttt2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the name is reflected in the status bar.</p>
</div>
<div class="paragraph">
<p>We could detach and run the listing again to see our third session, but let&#8217;s use this as an excuse to learn how to list sessions from within a session. Press <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> to enter command mode, and then <kbd>s</kbd> to enter session selection mode. We continue to see our session in the lower half of the window, but the top of the window now contains a list of running sessions. We can select one by using the up and down arrow keys and then pressing enter, or by typing the number next to each session on the list.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt38/Screenshot-2020-07-11-at-13.43.52.png" alt="tmux session selector">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ending_sessions">Ending Sessions</h3>
<div class="paragraph">
<p>Creating sessions is great, but you do also need to be able to clean up after yourself, so let&#8217;s look at some choices for ending sessions.</p>
</div>
<div class="sect3">
<h4 id="_ending_the_current_session">Ending the Current Session</h4>
<div class="paragraph">
<p>If you&#8217;re in a single-window-single-pane <code>tmux</code> session (like all the sessions we&#8217;ve been using in this instalment), you can end it by simply exiting from the shell running within that session, i.e., simply enter the bash/zsh command <code>exit</code>.</p>
</div>
<div class="paragraph">
<p>Try it by using one of your three terminal windows, connecting to the ttt2 <code>tmux</code> session, then, from within that session simply typing <code>exit</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ending_a_session_with_the_tmux_command">Ending a Session with the <code>tmux</code> Command</h4>
<div class="paragraph">
<p>You can also end a session from the outside using the <code>tmux</code> command kill-session. As an example, let&#8217;s kill the session we re-named to <code>ttt</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">tmux kill-session <span style="color: #000080">-t</span> ttt</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you still had a terminal window connected to that session you&#8217;ll notice you got exited from <code>tmux</code> and are back in your regular shell.</p>
</div>
</div>
<div class="sect3">
<h4 id="_killing_all_sessions">Killing all Sessions</h4>
<div class="paragraph">
<p>We have one final proverbial sledge-hammer at our disposal to end all our sessions in one fell swoop&#8201;&#8212;&#8201;we can kill the <code>tmux</code> server process that&#8217;s hosting all our sessions with the <code>kill-server</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">tmux kill-server</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_revisiting_the_attach_session_command">Revisiting the <code>attach-session</code> Command</h3>
<div class="paragraph">
<p>Since attaching to a running session is one of the most important things to be able to do, let&#8217;s take a moment to circle back to this critical command in a little more detail.</p>
</div>
<div class="paragraph">
<p>Firstly, this command is so important that it doesn&#8217;t just have a regular alias (<code>attach</code>), it also has the single-letter alias <code>a</code>.</p>
</div>
<div class="paragraph">
<p>Secondly, you don&#8217;t have to specify the session you wish to attach to. If you omit the <code>-t</code> flag <code>tmux</code> will connect to the most recently detached session.</p>
</div>
<div class="paragraph">
<p>Putting those two things together in a situation where you only use one session, you can always reattach to it with the simple command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">tmux a</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_recipe_using_tmux_for_a_resilient_ssh_connection">Recipe &#8212; Using <code>tmux</code> for a Resilient SSH Connection</h3>
<div class="paragraph">
<p>Before finishing this instalment, let&#8217;s circle back to the problem we first used the <code>screen</code> command to solve&#8201;&#8212;&#8201;executing long-running commands on a remote server over SSH from over a patchy internet connection.</p>
</div>
<div class="paragraph">
<p>What we want is a single quick and easy command to <em>connect to session 0 if it exists, or create a new session 0 if it doesn&#8217;t.</em></p>
</div>
<div class="paragraph">
<p>We know that the command <code>tmux a</code> will try to attach to the mostly recently used session, so if there will only ever be a session 0, then that command will work most of the time. It will fail the first time you try to connect after session 0 or the entire <code>tmux</code> server were killed. How could that happen? Leaving aside the obvious answer that you killed them intentionally, the most likely reason is that the Linux/Mac server you are SSHing to was rebooted.</p>
</div>
<div class="paragraph">
<p>To take our simple <code>tmux a</code> command to the next level, and have it intelligently create a session if none exists, we can leverage three additional things:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The fact that the <code>tmux</code> command emits standards-compliant exit codes depending on whether it succeeds or fails.</p>
</li>
<li>
<p>The fact that sh-derived shells like bash and zsh interpret error exit codes as <code>false</code>.</p>
</li>
<li>
<p>The fact that sh-derived shells implement so-called <em>lazy evaluation</em> of boolean operators.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In shells derived from sh, like bash and zsh, a double-pipe indicates a boolean <em>or</em> operation. When or-ing two values, if the first is <code>true</code>, the final result will always be <code>true</code> because <code>true || true</code> is <code>true</code>, and <code>true || false</code> is also <code>true</code>. That means that when the shell executes the command to the left of the <code>||</code> and it evaluates to <code>true</code> (emits a success exit code), there is no need to execute the command to the right to determine the result of the <code>||</code> operation. For this reason, sh, bash, and zsh all skip the command to the right of an
<code>||</code> operator when the command to the left succeeds. This approach is known as <em>lazy evaluation</em>, and used by many programming languages too.</p>
</div>
<div class="paragraph">
<p>Note that sh-derived shells take the same approach when evaluating boolean <em>and</em> operations, the operator for which is <code>&amp;&amp;</code>. In this case, when the command to the left of the <code>&amp;&amp;</code> evaluates to <code>false</code>, the result will always be <code>false</code>, regardless of the outcome of the second command, because <code>false &amp;&amp; true</code> is <code>false</code>, and so is <code>false &amp;&amp; false</code>.</p>
</div>
<div class="paragraph">
<p>This second approach is probably more commonly used than the first, because it allows you do execute a second command if, and only if, the first succeeds. I often use this to conditionally reboot a server after a successful software update:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">yum update <span style="color: #000080">-y</span> <span style="color: #000000;font-weight: bold">&amp;&amp;</span> shutdown <span style="color: #000080">-r</span> now</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, in this case we want to execute a second command only if the first fails, so we&#8217;ll make use of lazy execution of <code>||</code> rather than <code>&amp;&amp;</code>.</p>
</div>
<div class="paragraph">
<p>What we want to do is attach to an existing session if possible, and, only if that fails, make a new session. We know that <code>tmux a</code> will attach to the most recent existing session if there is one, or fail with an error, and we know that <code>tmux</code> will create a new session and attach to it.</p>
</div>
<div class="paragraph">
<p>Putting it all together, the following very short command will try attach to an existing session or create a new one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">tmux a <span style="color: #000000;font-weight: bold">||</span> tmux</code></pre>
</div>
</div>
<div class="paragraph">
<p>To have a robust SSH connection you can do one of the following things:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Always manually run <code>tmux a || tmux</code> before doing any work when you connect over SSH (tedious and error prone).</p>
</li>
<li>
<p>Add the command <code>tmux a || tmux</code> to the end of your <code>~/.ssh/rc</code> file on the server you&#8217;re connecting to.</p>
</li>
<li>
<p>Assuming your SSH GUI supports it, add the command <code>tmux a || tmux</code> to the shortcut/favourite for your server so your SSH client automatically executes it for you.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that I am suggesting <code>~/.ssh/rc</code> rather than <code>~/.bashrc</code>, <code>~/.bash_profile</code>, <code>~/.zshrc</code>, or <code>~/.zlogin</code> because I only want <code>tmux</code> to kick in when SSHing to the machine, not when opening a terminal window in the GUI or connecting via a console.</p>
</div>
<div class="paragraph">
<p>Not all SSH clients support automatically executing a command when you connect, but my favourite SSH client, <a href="https://apps.apple.com/us/app/core-shell/id1354319581?mt=12">Core Shell</a>, does. If you&#8217;re a fellow Core Shell user you&#8217;ll find the correct place to enter the command at the bottom of the <em>Advanced</em> tab of the server&#8217;s <em>Settings</em> pane. The setting is named <em>RemoteCommand</em>, and is grouped under <em>Post Command</em>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt38/Screenshot-2020-07-11-at-16.15.55.png" alt="The Core Shell Post Command Setting">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_final_thoughts_9">Final Thoughts</h3>
<div class="paragraph">
<p>In this instalment we&#8217;ve focused on using <code>tmux</code> as a replacement for <code>screen</code>, so we&#8217;ve confined ourselves to the simple situation where each of our sessions has a single window containing a single pane. We&#8217;ve ignored the ways in which <code>tmux</code> is much more feature-rich. In the next instalment we&#8217;ll rectify that by learning how to work with windows and panes within our sessions.</p>
</div>
<div class="paragraph">
<p>Finally, you might want to bookmark this wonderful <a href="https://gist.github.com/MohamedAlaa/2961058">tmux cheat-sheet</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt39">TTT Part 39 of n &#8212; Advanced TMUX</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the previous instalment we learned how to use the <code>tmux</code> command as a replacement for the <code>screen</code> command which has been deprecated on RedHat Enterprise Linux (and hence CentOS as well.) In this instalment we&#8217;ll take TMUX to the next level, making use of the fact that a single TMUX session can contain arbitrarily many windows, each consisting of arbitrarily many panes.</p>
</div>
<div class="paragraph">
<p>As a reminder from last time&#8201;&#8212;&#8201;in the TMUX-universe, sessions contain windows contain panes. By default a session contains one window which contains one full-width and full-height pane. Windows can be thought of as stacking behind each other, like tabs in a browser, and panes are arrayed next to each other within a window.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 39</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 39<br>
part of  <a href="https://www.podfeet.com/blog/2020/07/ccatp-647/">episode 647 of the Chit Chat Across the Pond Podcast</a></p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/ttt-39-advanced-tmux/TTT_39_Advanced_TMUX.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_39.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also
<a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/ttt-39-advanced-tmux/TTT_39_Advanced_TMUX.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_windows">Working with Windows</h3>
<div class="paragraph">
<p>Let&#8217;s start by opening a completely vanilla default <code>tmux</code> session:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">tmux new</code></pre>
</div>
</div>
<div class="paragraph">
<p>This session has one window, very imaginatively named <code>0</code>. So that we can recognise it later, let&#8217;s just enter a command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">echo</span> <span style="color: #d14">'The first window!'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Before we start creating and navigating between windows, I&#8217;d like to draw your attention to the left-part of the status bar. In this entirely default single-window-single-pane session is should look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #000000;font-weight: bold">[</span>0] 0:zsh<span style="color: #000000;font-weight: bold">*</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As we create and manipulate windows it will change, and I expect the meaning will become intuitively obvious as we go. If not, don&#8217;t worry, we&#8217;ll circle back to it later.</p>
</div>
<div class="sect3">
<h4 id="_creating_windows">Creating Windows</h4>
<div class="paragraph">
<p>Let&#8217;s start by creating a new window within our simple session. We do this be entering control mode with <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> and then pressing <kbd>c</kbd> for <em>create window</em>. We immediately jump to a fresh window. If you look down at the status bar you&#8217;ll see that the left-most part has changed to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #000000;font-weight: bold">[</span>0] 0:zsh- 1:zsh<span style="color: #000000;font-weight: bold">*</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s now start a process in this new window so we can easily recognise it in future:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">top</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that starting the <code>top</code> command in the second window change the status bar again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #000000;font-weight: bold">[</span>0] 0:zsh- 1:top<span style="color: #000000;font-weight: bold">*</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s create a third one by entering command mode again with <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> and pressing <kbd>c</kbd>. So we can recognise it, let&#8217;s run a command so it has some content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">less /etc/profile</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, notice the status bar change:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #000000;font-weight: bold">[</span>0] 0:zsh 1:top-  2:less<span style="color: #000000;font-weight: bold">*</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, before we look at navigating between windows, let&#8217;s create one more window by again entering command mode again with <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> and pressing <kbd>c</kbd>. Notice the state of the status bar is now:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #000000;font-weight: bold">[</span>0] 0:zsh  1:top  2:less- 3:zsh<span style="color: #000000;font-weight: bold">*</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_navigating_between_windows">Navigating Between Windows</h4>
<div class="paragraph">
<p><strong>We can move between windows by entering control mode with <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> and then pressing <kbd>p</kbd> for <em>previous window</em>, or n for <em>next window</em>.</strong> Remember, think of windows like tabs in a browser, they have an order based on the order in which they were created. The first window to be opened becomes the left-most <em>tab</em>, and subsequent windows line up to the right. With this mental model in place, we can get into the habit of thinking of <em>previous</em> as <em>the one directly to my left</em>, and next as <em>the one directly to my right</em>. One last thing to note is that both <em>next</em> and <em>previous</em> wrap around, so if you go next/right from the right-most window you end up on the left-most window, and <em>vice-versa</em>.</p>
</div>
<div class="paragraph">
<p>Use those keystrokes to move about as you wish, and as you do, watch the status bar changing.</p>
</div>
<div class="paragraph">
<p>The more windows you have, the more useful it becomes to be able to jump directly to a specific window, and we have two options for doing that. Firstly, <strong>the first ten windows are available by entering command mode with <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> and hitting the numbers <kbd>0</kbd> to <kbd>9</kbd></strong>. And secondly, like <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> <kbd>s</kbd> gives us a session picker (as we saw in the previous instalment), <strong><span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> <kbd>w</kbd> gives us a window picker</strong>.</p>
</div>
<div class="paragraph">
<p>Using the method of your choice, jump to the second window, and then, directly to the fourth (<span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> <kbd>1</kbd> followed by <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> <kbd>3</kbd> will do it).</p>
</div>
</div>
<div class="sect3">
<h4 id="_understanding_the_status_bar">Understanding the Status Bar</h4>
<div class="paragraph">
<p>The status bar should now look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #000000;font-weight: bold">[</span>0] 0:zsh  1:top- 2:less  3:zsh<span style="color: #000000;font-weight: bold">*</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So what does it mean?</p>
</div>
<div class="paragraph">
<p>The left-most item is the name of the session in square brackets. Because we opened a completely default session without naming it, it has defaulted to the very unimaginative <code>0</code>! Let&#8217;s prove that it really is the session name by entering control mode with <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> and hitting <kbd>$</kbd> to rename the session. I&#8217;m going to call mine <em>BB Sess</em>. My status bar now looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #000000;font-weight: bold">[</span>BB Sess] 0:zsh  1:top- 2:less  3:zsh<span style="color: #000000;font-weight: bold">*</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next to the session name in square brackets are items for each of our windows in order. Like sessions, windows have names, but unlike sessions, the default names are useful! By default a window is named for its currently running process. As you start and stop commands, the name of the window changes. The status bar item for each window consists of the windows&#8217;s number in the list and its name, separated by a colon, so <code>0:zsh</code> is the first window and it&#8217;s named <code>zsh</code> because we didn&#8217;t give it an explicit name, and it is currently running a <code>zsh</code> shell. Similarly, <code>2:less</code> is the third window and is currently running the <code>less</code> command.</p>
</div>
<div class="paragraph">
<p>But what about the <code>-</code> and <code>*</code> tagged on to the ends of the items for the second and fourth windows? As you were moving around between windows you may have noticed that <code>*</code> is appended to the current window, and <code>-</code> to the last-viewed window before the current one. Because we jumped straight from the second to the fourth window, the last-viewed window is not adjacent to the current window.</p>
</div>
</div>
<div class="sect3">
<h4 id="_toggling_between_last_viewed_windows">Toggling Between Last-viewed Windows</h4>
<div class="paragraph">
<p>Why would TMUX dedicate valuable status bar space to an indicator for the last viewed window? Simple&#8201;&#8212;&#8201;because <strong>you can jump directly to that window by entering command mode with <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> and hitting <kbd>l</kbd></strong> (lower-case L for <em>last</em>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_renaming_windows">Renaming Windows</h4>
<div class="paragraph">
<p>Just like you can rename sessions, you can rename windows. Note that when you explicitly set a window&#8217;s name it will not change as you run different processes. A lot of the time, the default name is more than sufficient, but that breaks down in situations where you&#8217;re running the same command in different windows simultaneously&#8201;&#8212;&#8201;perhaps you&#8217;re editing two files with <code>vi</code>, or watching two log files with <code>tail</code>.</p>
</div>
<div class="paragraph">
<p>Switch to the fourth window using what ever means you like, then change into the system log folder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">cd</span> /var/log</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>You can rename the current window by entering command mode with <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> and pressing <kbd>,</kbd></strong>.</p>
</div>
<div class="paragraph">
<p>I&#8217;m going to name the window <code>logs</code>, and after I do my status bar now looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #000000;font-weight: bold">[</span>BB Sess] 0:zsh  1:top- 2:less  3:logs<span style="color: #000000;font-weight: bold">*</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_closing_windows">Closing Windows</h4>
<div class="paragraph">
<p><strong>You can close a window by ending the shell process running within it, e.g. with the <code>exit</code> command</strong>. Try this in the 4th window. You should now be in the third window with the <code>top</code> process we started near the beginning of this instalment still running.</p>
</div>
<div class="paragraph">
<p><strong>You can also close a window by pressing <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> to enter command mode and hitting <kbd>&amp;</kbd>.</strong> Try it on the third and second windows. Notice that TMUX is polite enough to ask you if you&#8217;re sure 🙂</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_panes">Working with Panes</h3>
<div class="paragraph">
<p>Panes are created by splitting an existing pane horizontally or vertically. Remember that by default, every TMUX window contains one pane, so there is always a pane to split.</p>
</div>
<div class="paragraph">
<p><strong>To split a pane enter command mode with <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span>, then press <kbd>"</kbd> to split it horizontally, or <kbd>%</kbd> to split it vertically.</strong> Let&#8217;s do both of those in order in our session. You should now have three panes, a big one across the top, and two small ones across the bottom. The current pane is highlighted with a green border.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/ttt39/Screenshot-2020-07-25-at-16.52.40.png" alt="Screenshot showing 3-pane TMUX window">
</div>
</div>
<div class="sect3">
<h4 id="_moving_between_panes">Moving Between Panes</h4>
<div class="paragraph">
<p>You can <strong>move between panes by pressing <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> to enter command mode and then pressing an arrow key.</strong> Additionally <strong>you can cycle through your panes by entering command mode with <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> and pressing <kbd>o</kbd> to move to the next pane in the sequence</strong>.</p>
</div>
<div class="paragraph">
<p>You can also jump directly to a specific pane by number. <strong>To see the numbers assigned to each pane enter command mode with <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> and press <kbd>q</kbd></strong>. <strong>To jump directly to a pane by number enter command mode with <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span>, press <kbd>q</kbd>, then the desired number.</strong> (You need to be quite quick&#8201;&#8212;&#8201;you have to press the number before the labels vanish!).</p>
</div>
<div class="paragraph">
<p>You can also <strong>jump to the most recently active pane by entering command mode with <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> and pressing <kbd>;</kbd></strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_expanding_panes_with_zoom_mode">Expanding Panes with Zoom Mode</h4>
<div class="paragraph">
<p>The whole point in having panes is to be able to easily see the outputs from multiple commands at once, but that doesn&#8217;t mean there are not times you&#8217;ll want to focus in on a single pane for a while. TMUX supports this with a toggleable <em>zoom mode</em>. When you enter zoom mode the current pane takes up the full window until you toggle zoom mode off again. <strong>You can toggle zoom mode by entering command mode with <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> and pressing <kbd>z</kbd></strong>. Note that zoom mode is applied at the window level, not the session level, so if you have multiple windows you can zoom some of them but not others. Finally, TMUX will not allow you to enter zoom mode on windows with just a single pane.</p>
</div>
<div class="paragraph">
<p>Try entering zoom mode and watch the status bar. Notice that zoomed windows get a <code>Z</code> appended to them in the status bar.</p>
</div>
</div>
<div class="sect3">
<h4 id="_closing_panes">Closing Panes</h4>
<div class="paragraph">
<p><strong>You can close the current pane by exiting the shell</strong> running within it, for example with the <code>exit</code> command. Also, you can close a pane by entering command mode with <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>b</kbd></span> and pressing <kbd>x</kbd>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_final_thoughts_10">Final Thoughts</h3>
<div class="paragraph">
<p>As you might remember from the previous instalment, the name TMUX is a portmanteau of <em>Terminal Multiplexer</em>. In this instalment we&#8217;ve really put the <em>multi</em> into <em>multiplexer</em> by adding multiple windows to our sessions, and then splitting those windows into multiple panes.</p>
</div>
<div class="paragraph">
<p>These complex TMUX layouts can be very useful, but it takes a lot of keystrokes to create them. Wouldn&#8217;t it be nice to be able to build an entire layout in a single command and somehow save that for future use? I certainly find that ability very useful, so that&#8217;s what we&#8217;ll be doing in the next instalment.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ttt40">TTT Part 40 of n &#8212; Automating TMUX</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In <a href="#ttt38">instalment 38</a> we introduced TMUX as a replacement for the <code>screen</code> command which RedHat have deprecated on RedHat Enterprise Linux, and its free community variants CentOS and Fedora. Next we looked at how we can use TMUX&#8217;s windows and panes model to take things to the next level and give us multiple virtual terminal windows within a single actual terminal window. We learned that sessions contain windows which contain panes which run a shell.</p>
</div>
<div class="paragraph">
<p>We learned how to create a fresh TMUX session which gives us a single window containing a single pane running our default shell (bash or ZSH most probably). We then used TMUX commands to create additional windows, which we described as being like browser tabs, and we learned how to navigate between them. Finally, we learned how to split single panes vertically or horizontally, and to navigate between the panes within the current window.</p>
</div>
<div class="paragraph">
<p>Given the knowledge we have to date we can start a TMUX session, create the windows we need, and split those into the desired number of panes, but, we have to do it all manually each time we start a new TMUX session. Wouldn&#8217;t it be nice to be able to automate the process? Well, that&#8217;s what we&#8217;re going to do in this instalment, and along the way we&#8217;ll get two little shell-related bonus tips to boot!</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Matching Podcast Episode 40</div>
<div class="paragraph">
<p>Listen Along: Taming the Terminal Podcast Episode 40<br>
part of <a href="https://www.podfeet.com/blog/2020/08/ccatp-650/">episode 650 of the Chit Chat Across the Pond Podcast</a></p>
</div>
<div class="audioblock">
<div class="content">
<audio src="https://media.blubrry.com/tamingtheterminal/archive.org/download/ttt-40-automating-tmux/TTT_40_Automating_TMUX.mp3" controls>
Your browser does not support the audio tag.
</audio>
</div>
</div>
<div class="paragraph">
<p>Scan the QRcode to listen on a different device</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="assets/qrcodes/TTT_40.png" alt="QRcode">
</div>
</div>
<div class="paragraph">
<p>You can also
<a href="https://media.blubrry.com/tamingtheterminal/archive.org/download/ttt-40-automating-tmux/TTT_40_Automating_TMUX.mp3">play/download the MP3 in your browser</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_multiple_tmux_commands_in_a_single_shell_command">Multiple TMUX Commands in a Single Shell Command</h3>
<div class="paragraph">
<p>The phraseology and nomenclature is about to get potentially confusing, so let&#8217;s nip that in the bud by being extremely explicit.</p>
</div>
<div class="paragraph">
<p>Consider the following shell/terminal command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">tmux new <span style="color: #000080">-s</span> ttt40</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a single shell command that executes <code>tmux</code> with three shell arguments — <code>new</code>, <code>-s</code>, and <code>ttt40</code>. Those three shell arguments are handed to <code>tmux</code> which gets to interpret them how it will. To TMUX those three shell arguments are interpreted as the TMUX command <code>new</code>, the TMUX flag <code>-s</code> for <em>session name</em>, and a value for the flag, i.e. the name to give the session.</p>
</div>
<div class="paragraph">
<p>So, we have a single shell command executing TMUX with a single TMUX command. All our examples to date have taken this form.</p>
</div>
<div class="paragraph">
<p>The key to automating the creation of complex TMUX sessions is TMUX&#8217;s ability to accept multiple TMUX commands within a single shell command. These multiple commands will be applied in order, so they effectively allow us to script the TMUX session initialisation.</p>
</div>
<div class="paragraph">
<p>Multiple TMUX commands are separated by passing <code>;</code> as a shell argument. The thing to watch out for is that the <code>;</code> character has a meaning in the shells we are using in this series (Bash &amp; ZSH), so we need to escape that character. We can do that in two ways, we can prefix it with a backslash, or, we can single-quote it. The following will both create named new sessions with a horizontally split pane:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">tmux new <span style="color: #000080">-s</span> ttt40-slash <span style="color: #d14">\;</span> split-window
tmux new <span style="color: #000080">-s</span> ttt40-quote <span style="color: #d14">';'</span> split-window</code></pre>
</div>
</div>
<div class="paragraph">
<p>In both cases we have a single shell command which executes <code>tmux</code>, and within that single shell command we have two TMUX commands, <code>new</code> with the <code>-s</code> flag, and <code>split-window</code> with no arguments.</p>
</div>
</div>
<div class="sect2">
<h3 id="_refresher_listing_tmux_commands">Refresher — Listing TMUX Commands</h3>
<div class="paragraph">
<p>As we learned previously, we can use the <code>list-commands</code> TMUX command (or its alias <code>lscm</code>) to get a listing of all TMUX commands. We can also use <code>grep</code> to see the details of just a single command, e.g. to see all the commands for creating new things with their arguments we can run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="console"><span style="color: #555555">[root@www2 ~]#</span><span style="color: #bbbbbb"> </span>tmux lscm | <span style="color: #0086B3">grep </span>new
<span style="color: #888888">new-session (new) [-AdDP] [-F format] [-n window-name] [-s session-name] [-t target-session] [-x width] [-y height] [command]
new-window (neww) [-adkP] [-c start-directory] [-F format] [-n window-name] [-t target-window] [command]
rename-session (rename) [-t target-session] new-name
rename-window (renamew) [-t target-window] new-name
</span><span style="color: #555555">[root@www2 ~]#</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is very useful for simply refreshing your memory, but you may need to refer to the man pages for more details, like for example, the meaning of the various one-letter flags supported by the <code>new-session</code> command.</p>
</div>
</div>
<div class="sect2">
<h3 id="_bonus_1_controlling_the_current_tmux_session_from_within_tmux_with_tmux">Bonus 1 — Controlling the Current TMUX Session from Within TMUX with <code>tmux</code></h3>
<div class="paragraph">
<p>If you run a <code>tmux</code> command that operates on a specific session, pane, or window from within a shell in a TMUX session it will default to the session/window/pane the command is running in. So, to end a TMUX session from within a TMUX session simply run the command <code>tmux kill-session</code>. You&#8217;ll find this quite convenient as you go through the examples in this instalment, otherwise you&#8217;ll end up with a lot of TMUX sessions!</p>
</div>
<div class="paragraph">
<p>Since this sensible defaulting works with any TMUX command that targets a session, window, or pane those of you who find the <span class="keyseq"><kbd>ctrl</kbd>+<kbd>b</kbd></span> key combinations harder to remember than English-y terminal commands can use the same approach for splitting panes (<code>tmux split-window</code>) or killing them (<code>tmux kill-pane</code>) etc..</p>
</div>
</div>
<div class="sect2">
<h3 id="_building_complex_tmux_sessions_from_the_cli">Building Complex TMUX Sessions from the CLI</h3>
<div class="paragraph">
<p>If you run <code>tmux lscm</code>, or indeed <code>man tmux</code>, you&#8217;ll notice that TMUX supports a lot of commands — far more than we&#8217;ve seen to so far in this series of TMUX instalments, and indeed, far more than we will see in the remainder of the series. If you want to do something with TMUX, there&#8217;s probably a command for it, you&#8217;ll just need to RTFM (<em>read the fine manual</em>).</p>
</div>
<div class="paragraph">
<p>Although I don&#8217;t want to duplicate the manual by listing everything TMUX can do, I do want to draw your attention to a few important features you&#8217;re likely to want when building TMUX sessions from the CLI (<em>Commandline interface</em>).</p>
</div>
<div class="sect3">
<h4 id="_executing_shellterminal_commands_in_sessionswindowspanes">Executing Shell/Terminal Commands in Sessions/Windows/Panes</h4>
<div class="paragraph">
<p>TMUX&#8217;s commands for creating new sessions, new windows, and new panes accept arguments named <code>command</code> in the descriptions — this is how you can specify a shell/terminal command to execute in the new session/window/pane. The command should be passed as a single shell argument, so if the command to run has spaces or special characters in it you&#8217;ll need to quote and/or escape those.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The astute readers of man pages among you note that in some situations TMUX can understand and accept shell commands spread over multiple arguments, but in my experience that doesn&#8217;t work reliably, especially when the commands have flags in them, so I always pass the entire command as single shell argument, quoted and/or escaped as needed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As an example, if we want a named session running the <code>top</code> command in the first pane and no command in the second we would run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">tmux new <span style="color: #000080">-s</span> ttt40-top1 top <span style="color: #d14">\;</span> split-window</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that because <code>top</code> is a single word shell command we didn&#8217;t have to quote or escape it.</p>
</div>
<div class="paragraph">
<p>If we wanted three panes with one for running commands, one for showing top, and one for showing the main system log file could do something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #999988;font-style: italic"># on Linux</span>
tmux new <span style="color: #000080">-s</span> ttt40-toptail1-linux top <span style="color: #d14">\;</span> split-window <span style="color: #d14">'tail -f /var/log/messages'</span> <span style="color: #d14">\;</span> split-window

<span style="color: #999988;font-style: italic"># on Mac</span>
tmux new <span style="color: #000080">-s</span> ttt40-toptail1-mac top <span style="color: #d14">\;</span> split-window <span style="color: #d14">'tail -f /var/log/system.log'</span> <span style="color: #d14">\;</span> split-window</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that because the <code>tail -f &#8230;&#8203;</code> command contains spaces, I had to quote it to represent it as a single shell argument.</p>
</div>
</div>
<div class="sect3">
<h4 id="_applying_standard_layouts">Applying Standard Layouts</h4>
<div class="paragraph">
<p>So far we&#8217;ve simply been splitting panes and accepting the default behaviour of each pane splitting in half horizontally each time. What if we wanted our three panes to be equal, or what if we had six and we wanted them nicely tiled?</p>
</div>
<div class="paragraph">
<p>These are very common things to want to do, so TMUX provides us with a mechanism for easily arranging our panes into a number of pre-defined standard layouts. You&#8217;ll find the full list of them in the man page. The three I find most useful are <code>even-horizontal</code>, <code>even-vertical</code>, and <code>tiled</code>.</p>
</div>
<div class="paragraph">
<p>We can use the <code>select-layout</code> command to enable one of these standard layouts. As an example, let&#8217;s enhance the previous example by applying the <code>even-vertical</code> layout:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #999988;font-style: italic"># on Linux</span>
tmux new <span style="color: #000080">-s</span> ttt40-toptail2-linux top <span style="color: #d14">\;</span> split-window <span style="color: #d14">'tail -f /var/log/messages'</span> <span style="color: #d14">\;</span> split-window <span style="color: #d14">\;</span> <span style="color: #000000;font-weight: bold">select</span><span style="color: #000080">-layout</span> even-vertical

<span style="color: #999988;font-style: italic"># on Mac</span>
tmux new <span style="color: #000080">-s</span> ttt40-toptail2-mac top <span style="color: #d14">\;</span> split-window <span style="color: #d14">'tail -f /var/log/system.log'</span> <span style="color: #d14">\;</span> split-window <span style="color: #d14">\;</span> <span style="color: #000000;font-weight: bold">select</span><span style="color: #000080">-layout</span> even-vertical</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_moving_the_focus">Moving the Focus</h4>
<div class="paragraph">
<p>Notice that so far, the final pane to be created has always been the active one. What if we wanted our pane with nothing in it to be at the top and for that to be the pane to get focus? We can use the <code>select-pane</code> command for that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #999988;font-style: italic"># on Linux</span>
tmux new <span style="color: #000080">-s</span> ttt40-toptail3-linux <span style="color: #d14">\;</span> split-window top <span style="color: #d14">\;</span> split-window <span style="color: #d14">'tail -f /var/log/messages'</span> <span style="color: #d14">\;</span> <span style="color: #000000;font-weight: bold">select</span><span style="color: #000080">-layout</span> even-vertical <span style="color: #d14">\;</span> <span style="color: #000000;font-weight: bold">select</span><span style="color: #000080">-pane</span> <span style="color: #000080">-t</span> 0

<span style="color: #999988;font-style: italic"># on Mac</span>
tmux new <span style="color: #000080">-s</span> ttt40-toptail3-mac <span style="color: #d14">\;</span> split-window top <span style="color: #d14">\;</span> split-window <span style="color: #d14">'tail -f /var/log/system.log'</span> <span style="color: #d14">\;</span> <span style="color: #000000;font-weight: bold">select</span><span style="color: #000080">-layout</span> even-vertical <span style="color: #d14">\;</span> <span style="color: #000000;font-weight: bold">select</span><span style="color: #000080">-pane</span> <span style="color: #000080">-t</span> 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the use of the <code>-t</code> flag to <em>target</em> the 0th pane.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_advice_on_targeting_sessions_windows_panes">Advice on Targeting Sessions, Windows &amp; Panes</h3>
<div class="paragraph">
<p>Many TMUX commands use the <code>-t</code> flag to allow you to target a specific session, window, or pane. TMUX actually supports many different targeting mechanisms, and the man page explains them all in detail, and in the order they are applied, but my advice is to keep it simple.</p>
</div>
<div class="paragraph">
<p>The first thing to understand is full paths — for sessions that&#8217;s simply their name, which as we learned right at the start of our exploration of TMUX defaults to being a number. For windows the full path takes the form <code>SESSION:WINDOW</code> where <code>SESSION</code> is a session name and <code>WINDOW</code> is a window name or number. Finally, for panes the full path takes the form <code>SESSION:WINDOW.PANE</code> where <code>PANE</code> is the pane&#8217;s number.</p>
</div>
<div class="paragraph">
<p>Thankfully you don&#8217;t often need to use full paths because TMUX defaults to the current session, window, and pane. This is why <code>select-pane -t 0</code> worked in the previous example — the session and window were defaulted to the current ones, so the target was simply pane 0.</p>
</div>
<div class="paragraph">
<p>If you do need to use full paths, I strongly recommend always naming your sessions and panes so the full paths look sensible — that can really help save your sanity. 🙂</p>
</div>
</div>
<div class="sect2">
<h3 id="_bonus_2_single_shellterminal_commands_on_multiple_lines">Bonus 2 — Single Shell/Terminal Commands on Multiple Lines</h3>
<div class="paragraph">
<p>At this stage our single <code>tmux</code> terminal commands are getting very long indeed, and as a result, quite difficult to read. Wouldn&#8217;t it be nice to be able to split long terminal commands across multiple lines? Thankfully the good people behind Bash and ZSH thought so too!</p>
</div>
<div class="paragraph">
<p>We&#8217;ve already seen that the <code>\</code> can be used to escape special characters in Bash/ZSH, well, the newline character is a special character, so it too can be escaped by preceding it with a <code>\</code>. To spread a terminal command over multiple lines, simply end each line that&#8217;s not the last line with a backslash.</p>
</div>
<div class="paragraph">
<p>We can use this to divide our complex TMUX commands into easier to read, and hence understand, pieces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">tmux new <span style="color: #000080">-s</span> ttt40-top2 <span style="color: #d14">\;</span> <span style="color: #d14">\</span>
split-window top <span style="color: #d14">\;</span> <span style="color: #d14">\</span>
<span style="color: #000000;font-weight: bold">select</span><span style="color: #000080">-pane</span> <span style="color: #000080">-t</span> 0</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_saving_complex_tmux_commands_for_easy_reuse">Saving Complex TMUX Commands for Easy Reuse</h3>
<div class="paragraph">
<p>Having taken so much time to build up a complex TMUX command, it makes sense to save it in some way for future reuse. You could use tools outside of the terminal for that, perhaps one of the many key-stroke expanders like TextExpander, but since we&#8217;re in the business of taming terminals here, let&#8217;s look at two approaches for saving our complete commands within the terminal environment.</p>
</div>
<div class="paragraph">
<p>Before we do that, we should make our commands just a little bit more robust by reusing the tip from the end of <a href="#ttt38">instalment 38</a> and using the <code>||</code> operator to reattach to an existing session with the desired name, or, create a new one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell">tmux a <span style="color: #000080">-t</span> topterm <span style="color: #000000;font-weight: bold">||</span> <span style="color: #d14">\</span>
tmux new <span style="color: #000080">-s</span> topterm <span style="color: #d14">\;</span> <span style="color: #d14">\</span>
split-window top <span style="color: #d14">\;</span> <span style="color: #d14">\</span>
<span style="color: #000000;font-weight: bold">select</span><span style="color: #000080">-pane</span> <span style="color: #000080">-t</span> 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a reminder, the <code>||</code> operator represents binary OR, and Bash &amp; ZSH use so-called <em>lazy evaluation</em> to determine whether an OR operation evaluates to true or false. That means that if the first command succeeds, the second one will never be attempted, but if the first fails, it will. So, in this case that means if we succeed in reattaching to a session named <code>topterm</code> we&#8217;ll do that and never execute the command to build a new session, but if we fail to attach to an existing session we&#8217;ll create a new one named <code>topterm</code>.</p>
</div>
<div class="sect3">
<h4 id="_tmux_commands_in_shell_scripts">TMUX Commands in Shell Scripts</h4>
<div class="paragraph">
<p>The simplest way to save any terminal command or series of terminal commands for reuse is to save them as a shell script.</p>
</div>
<div class="paragraph">
<p>A shell script is simply a text file that meets three simple criteria:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The file is a plain text file</p>
</li>
<li>
<p>The first line is a so-called <em>shebang line</em></p>
</li>
<li>
<p>The file is marked as executable</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In Linux/Unix/Mac environments, the operating system can figure out how to run a plain-text executable file automatically if the very first line starts with <code>#!</code> followed by the path to a shell. This specially formatted opening line is known colloquially as the <em>shebang line</em>.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll be using Bash, so our scripts will be plain text files starting with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #999988;font-style: italic">#!/bin/bash</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s create a script to start a TMUX session named <code>topterm</code> that will have two panes, one to enter commands into at the top, and one below running the <code>top</code> command.</p>
</div>
<div class="paragraph">
<p>To start, let&#8217;s create a folder in our home folder named <code>scripts</code>, and change into it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">mkdir</span> <span style="color: #000080">-p</span> ~/scripts
<span style="color: #0086B3">cd</span> ~/scripts</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that by using <code>-p</code> (for <em>path</em>) we stop <code>mkdir</code> complaining if the folder already exists.</p>
</div>
<div class="paragraph">
<p>In this folder, use your favourite plain text editor to create a file named <code>topterm</code> without a file extension containing the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #999988;font-style: italic">#!/bin/bash</span>
tmux a <span style="color: #000080">-t</span> topterm <span style="color: #d14">\</span>
 <span style="color: #000000;font-weight: bold">||</span> <span style="color: #d14">\</span>
tmux new <span style="color: #000080">-s</span> topterm <span style="color: #d14">\;</span> <span style="color: #d14">\</span>
  split-window top <span style="color: #d14">\;</span> <span style="color: #d14">\</span>
  <span style="color: #000000;font-weight: bold">select</span><span style="color: #000080">-pane</span> <span style="color: #000080">-t</span> 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that I&#8217;ve chosen to use some indentation to make the complex command a little more readable.</p>
</div>
<div class="paragraph">
<p>Now make the file executable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">chmod </span>755 topterm</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now run this script from the current folder with <code>./topterm</code>, or better yet, from any folder using <code>~/scripts/topterm</code>.</p>
</div>
<div class="paragraph">
<p>If you&#8217;d like this script to be executable from any folder without needing to prefix it with <code>~/scripts/</code> you need to add <code>~/scripts</code> to your <code>PATH</code> environment (for a detailed discussion on <code>PATH</code> see <a href="#ttt13">instalment 13</a>). In Bash you can do that by adding the following line to the end of your <code>~/.bash_profile</code> file and opening a fresh terminal window (or sourcing the updated profile with <code>source ~/.bash_profile</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">export </span><span style="color: #008080">PATH</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #008080">$PATH</span>:~/scripts</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tmux_commands_as_bash_aliases">TMUX Commands as Bash Aliases</h4>
<div class="paragraph">
<p>An alternative approach to shell scripts is shell aliases. Most shells support these, including Bash &amp; ZSH.</p>
</div>
<div class="paragraph">
<p>We looked as aliases in <a href="#ttt14">instalment 14</a>, but as a quick reminder — the command to create an alias in Bash (and ZSH) is <code>alias</code>, it takes the following form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">alias </span><span style="color: #008080">ALIAS</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">"COMMAND"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As an example, the following aliases <code>ls -l</code> as <code>lsl</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">alias </span><span style="color: #008080">lsl</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">"ls -l"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now invoke <code>ls -l</code> by simply typing <code>lsl</code>.</p>
</div>
<div class="paragraph">
<p>Similarly, we can create an alias for our <code>topterm</code> TMUX session like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="shell"><span style="color: #0086B3">alias </span><span style="color: #008080">topterm</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">"</span><span style="color: #d14">\</span><span style="color: #d14">
  tmux a -t topterm </span><span style="color: #d14">\</span><span style="color: #d14">
  || </span><span style="color: #d14">\</span><span style="color: #d14">
  tmux new -s topterm </span><span style="color: #d14">\;</span><span style="color: #d14"> </span><span style="color: #d14">\</span><span style="color: #d14">
    split-window top </span><span style="color: #d14">\;</span><span style="color: #d14"> </span><span style="color: #d14">\</span><span style="color: #d14">
    select-pane -t 0"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the trick of using <code>\</code> at the end of lines to split commands over multiple lines even works within double-quoted strings!</p>
</div>
<div class="paragraph">
<p>Something to note is that aliases only last until the current shell ends, so to have a permanent alias you need to create it in a file that gets loaded each time your shell starts. If you&#8217;re using Bash the correct file to add your aliases to is <code>~/.bashrc</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_final_thoughts_11">Final Thoughts</h3>
<div class="paragraph">
<p>TMUX is clearly a very powerful tool. We&#8217;ve used it to build complex multi-shell environments that can be connected to and detached from at will, and simultaneously connected to from arbitrarily many terminal windows. The most amazing thing about TMUX is that we&#8217;ve only scratched the surface of what it can do!</p>
</div>
<div class="paragraph">
<p>However, since my intention here was never to try teach everything there is to know about TMUX, we&#8217;re going to end our exploration of the tool here. Hopefully this has been enough to pique your interest, and to enable you to learn anything else you need independently.</p>
</div>
<div class="paragraph">
<p>This series will now go back on hiatus for a little while, but the plan is to resurrect it again in a few months when Apple release macOS 11 Big Sur. Why? Because that&#8217;s an opportune moment to release a series of instalments on the topic of switching from Bash to ZSH. Since macOS Catalina the default shell on the Mac has been ZSH rather than Bash, with Bash available as an option. Since Catalina was such a bug-fest on launch many people have chosen not to upgrade all their machines (me included!), but I expect that with Big Sur&#8217;s debut there will be a lot of Terminal Tamers suddenly finding Bash&#8217;s familiar <code>$</code> command prompt replaced with ZSH&#8217;s alien-feeling <code>%</code> command prompt!</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="afterword">Afterword</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The creation of Taming the Terminal was executed using open source tools on an open source platform and with version control through the open source git technology. Allison Sheridan interviewed Dr. Helma van der Linden on how she created the book in an episode of the Chit Chat Across the Pond podcast. Helma walks through how each tool played its part, and how she developed the process. It&#8217;s a great story of ingenuity on Helma&#8217;s part and an amazing story of how open source allows us to build great things. You can find the audio and notes with links to the tools at <a href="https://www.podfeet.com/blog/2020/08/ccatp-649/" class="bare">https://www.podfeet.com/blog/2020/08/ccatp-649/</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="colophon">Colophon</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Podfeet Press</p>
</div>
<div class="paragraph">
<p>&#169; 2020 by The Podfeet Press</p>
</div>
<div class="paragraph">
<p>Published in the Milky Way Galaxy</p>
</div>
<div class="paragraph">
<p>Version 1.4.2</p>
</div>
<div class="paragraph">
<p>Date revision 2020-10-07</p>
</div>
<div class="paragraph">
<p><em>Compiled: 2020-10-07  6-16-59</em></p>
</div>
<div class="paragraph">
<p>This book is designed and handcrafted by Allison Sheridan and Helma van der Linden.
The cover is designed by Allison Sheridan.
The font types are Noto Sans and Noto Serif.</p>
</div>
<div class="paragraph">
<p>Created in <a href="https://asciidoctor.org">Asciidoctor</a> and macOS.</p>
</div>
<div id="updates" class="exampleblock">
<div class="content">
<div class="paragraph">
<p><strong>Updates</strong></p>
</div>
<div class="paragraph">
<p>This book will be updated whenever new episodes are added or errors are fixed.
You can check if a new update is available at:
<a href="https://github.com/bartificer/taming-the-terminal/releases" class="bare">https://github.com/bartificer/taming-the-terminal/releases</a></p>
</div>
</div>
</div>
<div id="license" class="paragraph">
<p><strong>Creative Commons license</strong></p>
</div>
<div class="paragraph">
<p>This work is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img src="assets/creativecommons.org_by-nc-nd_4.0_88x31.png" alt="Creative Commons License"></a>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Actually, it&#8217;s octal, but for simplicity we will call it decimal.
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. Allison and I recommended an app called SSH Shell during the matching podcast episode for this blog post, but it has been replaced by Core Shell: <a href="https://apps.apple.com/us/app/core-shell/id1354319581" class="bare">https://apps.apple.com/us/app/core-shell/id1354319581</a>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.4.2<br>
Last updated 2020-10-07 06:15:42 UTC
</div>
</div>
</body>
</html>