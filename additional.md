# Additional information

This document contains additional information that might be of interest to a few people but does not contain any information about the tutorial itself or how to compile it.

## Why asciidoctor?

The request was to build an ePub out of the episodes. That meant these requirements:

- keep the code blocks with source code highlighting
- keep the definition lists
- create a single ePub of all the separate chapters
- add a Table of Contents

At first the original HTML pages were converted to Github Flavor Markdown, basically with a slightly modified version of pbsconvert. The initial conversion from Markdown to an ePub was done with pandoc and pygments as source code highlighter.
From experience I know that Markdown doesn't support definition lists, and Bart explicitly mentioned once that he likes definition lists so it would be a shame to convert them all to a table markup which I did initially.
In hindsight, 3 weeks later, I found out I didn't look hard enough at Pandoc's documentation, it DOES support it.

Pygments, the source code highlighter does have support for Bash or shell scripts, but somehow most builtins are not color coded. Because the earlier episodes mostly use builtins, that would mean there is no color coding at all.
I came across an extension that added these builtins to Pygments, but I wasn't able to convert them to the language and plugin syntax Pandoc could understand.

In my search for a solution I came across the [Progit](https://github.com/progit/progit) eBook repository. They referred to their second version [Progit 2](https://github.com/progit/progit2) which mentioned that they switched to Asciidoc. Curious, I googled some more and came across this page [Convert Markdown to Asciidoctor with PanDoc](https://matthewsetter.com/convert-markdown-to-asciidoc-withpandoc/) and the
[Asciidoctor](https://asciidoctor.org) website.
It solved many of my problems:

- definition lists
- support for various source code highlighters, including Pygments, which also support shell scripts
- and the Progit 2 project had a script file that could generate an ePub as well as a PDF and a single page HTML.

I converted an episode by hand, Markdown and Asciidoctor have very similar syntax, and ran it through the build script. Lo and behold there was nice color coding. And the switch to Rouge, another syntax highlighter was even easier and provided also color coding for the builtins.

The decision was made, TTT would be in Asciidoctor.

Note: it turned out to be easier to convert Markdown to Asciidoctor using [Kramdoc-Asciidoc](https://matthewsetter.com/technical-documentation/asciidoc/convert-markdown-to-asciidoc-with-kramdoc/).

## Links

This section contains additional links that might be relevant to the publications:

- https://itunespartner.apple.com/books/articles/create-book-cover-art-2712
- https://help.apple.com/itc/booksassetguide/#/itc04314e64a
- https://blog.kotobee.com/publishing-amazon-ibookstore-10-things-watch/
- https://www.w3.org/publishing/epub32/epub-packages.html#elemdef-opf-package
- https://w3c.github.io/publ-epub-revision/epub32/spec/epub-packages.html#attrdef-item-fallback
- https://github.com/krisztianmukli/epub-boilerplate/blob/master/publish-ebook
- https://matthewsetter.com/writing-tools/npm-broken-link-checker/

### Asciidoctor

- [Syntax Quick Reference](https://asciidoctor.org/docs/asciidoc-syntax-quick-reference/)
- [Asciidoctor User Manual](https://asciidoctor.org/docs/user-manual/)

### Asciidoctor PDF

- [GitHub repository](https://github.com/asciidoctor/asciidoctor-pdf)
- [Documentation](https://asciidoctor.org/docs/asciidoctor-pdf/)
- [Theming Guide](http://gist.asciidoctor.org/?github-asciidoctor%2Fasciidoctor-pdf%2F%2Fdocs%2Ftheming-guide.adoc)

### Asciidoctor EPUB

- [GitHub repository](https://github.com/asciidoctor/asciidoctor-epub3)
- [Documentation](https://asciidoctor.org/docs/asciidoctor-epub3/)

## Favicons

The favicons are generated by uploading a PNG version of the logo on https://realfavicongenerator.net.
The icon for the Touchbar icon and the pinned tab in Safari is set to 'Turn your picture into a monochrome icon ....'

Threshold is set one step to the right.
The background color is set to #29c943.

## Notes on debugging Apple Books

Issue #86 (links are hardly visible in Night mode) sparked a search on the internet. The main result:

- the links were all internal links
- the links were marked as 'visited'
- the epub3.css theme colored the visited links dark grey
- external links somehow don't get the 'visited' attribute

Apple Books alters the CSS of the ePub by adding an indication which color mode is used and sets the colors accordingly.
Info here: https://stackoverflow.com/questions/14305164/any-way-to-detect-if-dark-theme-is-active-in-ibooks-from-within-epub

All colors are described here:
https://gist.github.com/adaptivegarage/aef95223fab9a39db45f

Debug the CSS in Apple Books on the Mac by using the web inspector:

http://epubsecrets.com/how-to-access-the-web-inspector-for-desktop-ibooks.php

## Debugging GitHub Workflow actions

Recently the publish workflow action failed with an obscure error. Attempts to replicate the exact workflow in a local Ubuntu Vagrant machine failed, probably due to slightly different setups. Replication of the GitHub actions locally is not possible.

That leaves debugging the action as it runs.

Info:

- https://github.community/t/debugging-github-actions-locally-or-ssh-to-workspace/16974
- https://github.com/marketplace/actions/debugging-with-tmate

Preparation:

- add the installation of tmate to the github workflow just before the problematic step
- if necessary change the scheduling frequency to something easier to work with
- commit and push the changes
- commit and push another change in a file not in the .github directory to trigger the new workflow (and activate the new schedule)

Debug:

- wait for the build to run
- open the action and check the steps that are executed
- when tmate executes it will print a command in the console like `ssh <random number>.tmate.io`
- copy the command and paste and execute it in a Terminal window
- you are now ssh-ed into the running build and you can debug the problem

Final steps:

- remove the tmate step
- fix the schedule
- commit and push the workflow file
- fix the problem
- commit and push the problem to activate the new version of the workflow (and fix the problem)
